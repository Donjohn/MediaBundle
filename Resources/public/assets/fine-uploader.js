(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["fine-uploader"],{

/***/ "./node_modules/@fortawesome/fontawesome-free/js/fontawesome.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@fortawesome/fontawesome-free/js/fontawesome.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

/*!
 * Font Awesome Free 5.6.1 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 */
(function () {
  'use strict';

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  function _defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    return Constructor;
  }

  function _defineProperty(obj, key, value) {
    if (key in obj) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      obj[key] = value;
    }

    return obj;
  }

  function _objectSpread(target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i] != null ? arguments[i] : {};
      var ownKeys = Object.keys(source);

      if (typeof Object.getOwnPropertySymbols === 'function') {
        ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {
          return Object.getOwnPropertyDescriptor(source, sym).enumerable;
        }));
      }

      ownKeys.forEach(function (key) {
        _defineProperty(target, key, source[key]);
      });
    }

    return target;
  }

  function _slicedToArray(arr, i) {
    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();
  }

  function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();
  }

  function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) {
      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];

      return arr2;
    }
  }

  function _arrayWithHoles(arr) {
    if (Array.isArray(arr)) return arr;
  }

  function _iterableToArray(iter) {
    if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter);
  }

  function _iterableToArrayLimit(arr, i) {
    var _arr = [];
    var _n = true;
    var _d = false;
    var _e = undefined;

    try {
      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
        _arr.push(_s.value);

        if (i && _arr.length === i) break;
      }
    } catch (err) {
      _d = true;
      _e = err;
    } finally {
      try {
        if (!_n && _i["return"] != null) _i["return"]();
      } finally {
        if (_d) throw _e;
      }
    }

    return _arr;
  }

  function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance");
  }

  function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance");
  }

  var noop = function noop() {};

  var _WINDOW = {};
  var _DOCUMENT = {};
  var _MUTATION_OBSERVER = null;
  var _PERFORMANCE = {
    mark: noop,
    measure: noop
  };

  try {
    if (typeof window !== 'undefined') _WINDOW = window;
    if (typeof document !== 'undefined') _DOCUMENT = document;
    if (typeof MutationObserver !== 'undefined') _MUTATION_OBSERVER = MutationObserver;
    if (typeof performance !== 'undefined') _PERFORMANCE = performance;
  } catch (e) {}

  var _ref = _WINDOW.navigator || {},
      _ref$userAgent = _ref.userAgent,
      userAgent = _ref$userAgent === void 0 ? '' : _ref$userAgent;

  var WINDOW = _WINDOW;
  var DOCUMENT = _DOCUMENT;
  var MUTATION_OBSERVER = _MUTATION_OBSERVER;
  var PERFORMANCE = _PERFORMANCE;
  var IS_BROWSER = !!WINDOW.document;
  var IS_DOM = !!DOCUMENT.documentElement && !!DOCUMENT.head && typeof DOCUMENT.addEventListener === 'function' && typeof DOCUMENT.createElement === 'function';
  var IS_IE = ~userAgent.indexOf('MSIE') || ~userAgent.indexOf('Trident/');

  var NAMESPACE_IDENTIFIER = '___FONT_AWESOME___';
  var UNITS_IN_GRID = 16;
  var DEFAULT_FAMILY_PREFIX = 'fa';
  var DEFAULT_REPLACEMENT_CLASS = 'svg-inline--fa';
  var DATA_FA_I2SVG = 'data-fa-i2svg';
  var DATA_FA_PSEUDO_ELEMENT = 'data-fa-pseudo-element';
  var DATA_PREFIX = 'data-prefix';
  var DATA_ICON = 'data-icon';
  var HTML_CLASS_I2SVG_BASE_CLASS = 'fontawesome-i2svg';
  var TAGNAMES_TO_SKIP_FOR_PSEUDOELEMENTS = ['HTML', 'HEAD', 'STYLE', 'SCRIPT'];
  var PRODUCTION = function () {
    try {
      return "production" === 'production';
    } catch (e) {
      return false;
    }
  }();
  var oneToTen = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
  var oneToTwenty = oneToTen.concat([11, 12, 13, 14, 15, 16, 17, 18, 19, 20]);
  var ATTRIBUTES_WATCHED_FOR_MUTATION = ['class', 'data-prefix', 'data-icon', 'data-fa-transform', 'data-fa-mask'];
  var RESERVED_CLASSES = ['xs', 'sm', 'lg', 'fw', 'ul', 'li', 'border', 'pull-left', 'pull-right', 'spin', 'pulse', 'rotate-90', 'rotate-180', 'rotate-270', 'flip-horizontal', 'flip-vertical', 'stack', 'stack-1x', 'stack-2x', 'inverse', 'layers', 'layers-text', 'layers-counter'].concat(oneToTen.map(function (n) {
    return "".concat(n, "x");
  })).concat(oneToTwenty.map(function (n) {
    return "w-".concat(n);
  }));

  var initial = WINDOW.FontAwesomeConfig || {};

  function getAttrConfig(attr) {
    var element = DOCUMENT.querySelector('script[' + attr + ']');

    if (element) {
      return element.getAttribute(attr);
    }
  }

  function coerce(val) {
    // Getting an empty string will occur if the attribute is set on the HTML tag but without a value
    // We'll assume that this is an indication that it should be toggled to true
    // For example <script data-search-pseudo-elements src="..."></script>
    if (val === '') return true;
    if (val === 'false') return false;
    if (val === 'true') return true;
    return val;
  }

  if (DOCUMENT && typeof DOCUMENT.querySelector === 'function') {
    var attrs = [['data-family-prefix', 'familyPrefix'], ['data-replacement-class', 'replacementClass'], ['data-auto-replace-svg', 'autoReplaceSvg'], ['data-auto-add-css', 'autoAddCss'], ['data-auto-a11y', 'autoA11y'], ['data-search-pseudo-elements', 'searchPseudoElements'], ['data-observe-mutations', 'observeMutations'], ['data-keep-original-source', 'keepOriginalSource'], ['data-measure-performance', 'measurePerformance'], ['data-show-missing-icons', 'showMissingIcons']];
    attrs.forEach(function (_ref) {
      var _ref2 = _slicedToArray(_ref, 2),
          attr = _ref2[0],
          key = _ref2[1];

      var val = coerce(getAttrConfig(attr));

      if (val !== undefined && val !== null) {
        initial[key] = val;
      }
    });
  }

  var _default = _objectSpread({
    familyPrefix: DEFAULT_FAMILY_PREFIX,
    replacementClass: DEFAULT_REPLACEMENT_CLASS,
    autoReplaceSvg: true,
    autoAddCss: true,
    autoA11y: true,
    searchPseudoElements: false,
    observeMutations: true,
    keepOriginalSource: true,
    measurePerformance: false,
    showMissingIcons: true
  }, initial);

  if (!_default.autoReplaceSvg) _default.observeMutations = false;

  var config = _objectSpread({}, _default);

  WINDOW.FontAwesomeConfig = config;

  var w = WINDOW || {};
  if (!w[NAMESPACE_IDENTIFIER]) w[NAMESPACE_IDENTIFIER] = {};
  if (!w[NAMESPACE_IDENTIFIER].styles) w[NAMESPACE_IDENTIFIER].styles = {};
  if (!w[NAMESPACE_IDENTIFIER].hooks) w[NAMESPACE_IDENTIFIER].hooks = {};
  if (!w[NAMESPACE_IDENTIFIER].shims) w[NAMESPACE_IDENTIFIER].shims = [];
  var namespace = w[NAMESPACE_IDENTIFIER];

  var functions = [];

  var listener = function listener() {
    DOCUMENT.removeEventListener('DOMContentLoaded', listener);
    loaded = 1;
    functions.map(function (fn) {
      return fn();
    });
  };

  var loaded = false;

  if (IS_DOM) {
    loaded = (DOCUMENT.documentElement.doScroll ? /^loaded|^c/ : /^loaded|^i|^c/).test(DOCUMENT.readyState);
    if (!loaded) DOCUMENT.addEventListener('DOMContentLoaded', listener);
  }

  function domready (fn) {
    if (!IS_DOM) return;
    loaded ? setTimeout(fn, 0) : functions.push(fn);
  }

  var d = UNITS_IN_GRID;
  var meaninglessTransform = {
    size: 16,
    x: 0,
    y: 0,
    rotate: 0,
    flipX: false,
    flipY: false
  };

  function isReserved(name) {
    return ~RESERVED_CLASSES.indexOf(name);
  }

  function bunker(fn) {
    try {
      fn();
    } catch (e) {
      if (!PRODUCTION) {
        throw e;
      }
    }
  }
  function insertCss(css) {
    if (!css || !IS_DOM) {
      return;
    }

    var style = DOCUMENT.createElement('style');
    style.setAttribute('type', 'text/css');
    style.innerHTML = css;
    var headChildren = DOCUMENT.head.childNodes;
    var beforeChild = null;

    for (var i = headChildren.length - 1; i > -1; i--) {
      var child = headChildren[i];
      var tagName = (child.tagName || '').toUpperCase();

      if (['STYLE', 'LINK'].indexOf(tagName) > -1) {
        beforeChild = child;
      }
    }

    DOCUMENT.head.insertBefore(style, beforeChild);
    return css;
  }
  var idPool = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
  function nextUniqueId() {
    var size = 12;
    var id = '';

    while (size-- > 0) {
      id += idPool[Math.random() * 62 | 0];
    }

    return id;
  }
  function toArray(obj) {
    var array = [];

    for (var i = (obj || []).length >>> 0; i--;) {
      array[i] = obj[i];
    }

    return array;
  }
  function classArray(node) {
    if (node.classList) {
      return toArray(node.classList);
    } else {
      return (node.getAttribute('class') || '').split(' ').filter(function (i) {
        return i;
      });
    }
  }
  function getIconName(familyPrefix, cls) {
    var parts = cls.split('-');
    var prefix = parts[0];
    var iconName = parts.slice(1).join('-');

    if (prefix === familyPrefix && iconName !== '' && !isReserved(iconName)) {
      return iconName;
    } else {
      return null;
    }
  }
  function htmlEscape(str) {
    return "".concat(str).replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  }
  function joinAttributes(attributes) {
    return Object.keys(attributes || {}).reduce(function (acc, attributeName) {
      return acc + "".concat(attributeName, "=\"").concat(htmlEscape(attributes[attributeName]), "\" ");
    }, '').trim();
  }
  function joinStyles(styles) {
    return Object.keys(styles || {}).reduce(function (acc, styleName) {
      return acc + "".concat(styleName, ": ").concat(styles[styleName], ";");
    }, '');
  }
  function transformIsMeaningful(transform) {
    return transform.size !== meaninglessTransform.size || transform.x !== meaninglessTransform.x || transform.y !== meaninglessTransform.y || transform.rotate !== meaninglessTransform.rotate || transform.flipX || transform.flipY;
  }
  function transformForSvg(_ref) {
    var transform = _ref.transform,
        containerWidth = _ref.containerWidth,
        iconWidth = _ref.iconWidth;
    var outer = {
      transform: "translate(".concat(containerWidth / 2, " 256)")
    };
    var innerTranslate = "translate(".concat(transform.x * 32, ", ").concat(transform.y * 32, ") ");
    var innerScale = "scale(".concat(transform.size / 16 * (transform.flipX ? -1 : 1), ", ").concat(transform.size / 16 * (transform.flipY ? -1 : 1), ") ");
    var innerRotate = "rotate(".concat(transform.rotate, " 0 0)");
    var inner = {
      transform: "".concat(innerTranslate, " ").concat(innerScale, " ").concat(innerRotate)
    };
    var path = {
      transform: "translate(".concat(iconWidth / 2 * -1, " -256)")
    };
    return {
      outer: outer,
      inner: inner,
      path: path
    };
  }
  function transformForCss(_ref2) {
    var transform = _ref2.transform,
        _ref2$width = _ref2.width,
        width = _ref2$width === void 0 ? UNITS_IN_GRID : _ref2$width,
        _ref2$height = _ref2.height,
        height = _ref2$height === void 0 ? UNITS_IN_GRID : _ref2$height,
        _ref2$startCentered = _ref2.startCentered,
        startCentered = _ref2$startCentered === void 0 ? false : _ref2$startCentered;
    var val = '';

    if (startCentered && IS_IE) {
      val += "translate(".concat(transform.x / d - width / 2, "em, ").concat(transform.y / d - height / 2, "em) ");
    } else if (startCentered) {
      val += "translate(calc(-50% + ".concat(transform.x / d, "em), calc(-50% + ").concat(transform.y / d, "em)) ");
    } else {
      val += "translate(".concat(transform.x / d, "em, ").concat(transform.y / d, "em) ");
    }

    val += "scale(".concat(transform.size / d * (transform.flipX ? -1 : 1), ", ").concat(transform.size / d * (transform.flipY ? -1 : 1), ") ");
    val += "rotate(".concat(transform.rotate, "deg) ");
    return val;
  }

  var ALL_SPACE = {
    x: 0,
    y: 0,
    width: '100%',
    height: '100%'
  };
  function makeIconMasking (_ref) {
    var children = _ref.children,
        attributes = _ref.attributes,
        main = _ref.main,
        mask = _ref.mask,
        transform = _ref.transform;
    var mainWidth = main.width,
        mainPath = main.icon;
    var maskWidth = mask.width,
        maskPath = mask.icon;
    var trans = transformForSvg({
      transform: transform,
      containerWidth: maskWidth,
      iconWidth: mainWidth
    });
    var maskRect = {
      tag: 'rect',
      attributes: _objectSpread({}, ALL_SPACE, {
        fill: 'white'
      })
    };
    var maskInnerGroup = {
      tag: 'g',
      attributes: _objectSpread({}, trans.inner),
      children: [{
        tag: 'path',
        attributes: _objectSpread({}, mainPath.attributes, trans.path, {
          fill: 'black'
        })
      }]
    };
    var maskOuterGroup = {
      tag: 'g',
      attributes: _objectSpread({}, trans.outer),
      children: [maskInnerGroup]
    };
    var maskId = "mask-".concat(nextUniqueId());
    var clipId = "clip-".concat(nextUniqueId());
    var maskTag = {
      tag: 'mask',
      attributes: _objectSpread({}, ALL_SPACE, {
        id: maskId,
        maskUnits: 'userSpaceOnUse',
        maskContentUnits: 'userSpaceOnUse'
      }),
      children: [maskRect, maskOuterGroup]
    };
    var defs = {
      tag: 'defs',
      children: [{
        tag: 'clipPath',
        attributes: {
          id: clipId
        },
        children: [maskPath]
      }, maskTag]
    };
    children.push(defs, {
      tag: 'rect',
      attributes: _objectSpread({
        fill: 'currentColor',
        'clip-path': "url(#".concat(clipId, ")"),
        mask: "url(#".concat(maskId, ")")
      }, ALL_SPACE)
    });
    return {
      children: children,
      attributes: attributes
    };
  }

  function makeIconStandard (_ref) {
    var children = _ref.children,
        attributes = _ref.attributes,
        main = _ref.main,
        transform = _ref.transform,
        styles = _ref.styles;
    var styleString = joinStyles(styles);

    if (styleString.length > 0) {
      attributes['style'] = styleString;
    }

    if (transformIsMeaningful(transform)) {
      var trans = transformForSvg({
        transform: transform,
        containerWidth: main.width,
        iconWidth: main.width
      });
      children.push({
        tag: 'g',
        attributes: _objectSpread({}, trans.outer),
        children: [{
          tag: 'g',
          attributes: _objectSpread({}, trans.inner),
          children: [{
            tag: main.icon.tag,
            children: main.icon.children,
            attributes: _objectSpread({}, main.icon.attributes, trans.path)
          }]
        }]
      });
    } else {
      children.push(main.icon);
    }

    return {
      children: children,
      attributes: attributes
    };
  }

  function asIcon (_ref) {
    var children = _ref.children,
        main = _ref.main,
        mask = _ref.mask,
        attributes = _ref.attributes,
        styles = _ref.styles,
        transform = _ref.transform;

    if (transformIsMeaningful(transform) && main.found && !mask.found) {
      var width = main.width,
          height = main.height;
      var offset = {
        x: width / height / 2,
        y: 0.5
      };
      attributes['style'] = joinStyles(_objectSpread({}, styles, {
        'transform-origin': "".concat(offset.x + transform.x / 16, "em ").concat(offset.y + transform.y / 16, "em")
      }));
    }

    return [{
      tag: 'svg',
      attributes: attributes,
      children: children
    }];
  }

  function asSymbol (_ref) {
    var prefix = _ref.prefix,
        iconName = _ref.iconName,
        children = _ref.children,
        attributes = _ref.attributes,
        symbol = _ref.symbol;
    var id = symbol === true ? "".concat(prefix, "-").concat(config.familyPrefix, "-").concat(iconName) : symbol;
    return [{
      tag: 'svg',
      attributes: {
        style: 'display: none;'
      },
      children: [{
        tag: 'symbol',
        attributes: _objectSpread({}, attributes, {
          id: id
        }),
        children: children
      }]
    }];
  }

  function makeInlineSvgAbstract(params) {
    var _params$icons = params.icons,
        main = _params$icons.main,
        mask = _params$icons.mask,
        prefix = params.prefix,
        iconName = params.iconName,
        transform = params.transform,
        symbol = params.symbol,
        title = params.title,
        extra = params.extra,
        _params$watchable = params.watchable,
        watchable = _params$watchable === void 0 ? false : _params$watchable;

    var _ref = mask.found ? mask : main,
        width = _ref.width,
        height = _ref.height;

    var widthClass = "fa-w-".concat(Math.ceil(width / height * 16));
    var attrClass = [config.replacementClass, iconName ? "".concat(config.familyPrefix, "-").concat(iconName) : '', widthClass].filter(function (c) {
      return extra.classes.indexOf(c) === -1;
    }).concat(extra.classes).join(' ');
    var content = {
      children: [],
      attributes: _objectSpread({}, extra.attributes, {
        'data-prefix': prefix,
        'data-icon': iconName,
        'class': attrClass,
        'role': 'img',
        'xmlns': 'http://www.w3.org/2000/svg',
        'viewBox': "0 0 ".concat(width, " ").concat(height)
      })
    };

    if (watchable) {
      content.attributes[DATA_FA_I2SVG] = '';
    }

    if (title) content.children.push({
      tag: 'title',
      attributes: {
        id: content.attributes['aria-labelledby'] || "title-".concat(nextUniqueId())
      },
      children: [title]
    });

    var args = _objectSpread({}, content, {
      prefix: prefix,
      iconName: iconName,
      main: main,
      mask: mask,
      transform: transform,
      symbol: symbol,
      styles: extra.styles
    });

    var _ref2 = mask.found && main.found ? makeIconMasking(args) : makeIconStandard(args),
        children = _ref2.children,
        attributes = _ref2.attributes;

    args.children = children;
    args.attributes = attributes;

    if (symbol) {
      return asSymbol(args);
    } else {
      return asIcon(args);
    }
  }
  function makeLayersTextAbstract(params) {
    var content = params.content,
        width = params.width,
        height = params.height,
        transform = params.transform,
        title = params.title,
        extra = params.extra,
        _params$watchable2 = params.watchable,
        watchable = _params$watchable2 === void 0 ? false : _params$watchable2;

    var attributes = _objectSpread({}, extra.attributes, title ? {
      'title': title
    } : {}, {
      'class': extra.classes.join(' ')
    });

    if (watchable) {
      attributes[DATA_FA_I2SVG] = '';
    }

    var styles = _objectSpread({}, extra.styles);

    if (transformIsMeaningful(transform)) {
      styles['transform'] = transformForCss({
        transform: transform,
        startCentered: true,
        width: width,
        height: height
      });
      styles['-webkit-transform'] = styles['transform'];
    }

    var styleString = joinStyles(styles);

    if (styleString.length > 0) {
      attributes['style'] = styleString;
    }

    var val = [];
    val.push({
      tag: 'span',
      attributes: attributes,
      children: [content]
    });

    if (title) {
      val.push({
        tag: 'span',
        attributes: {
          class: 'sr-only'
        },
        children: [title]
      });
    }

    return val;
  }
  function makeLayersCounterAbstract(params) {
    var content = params.content,
        title = params.title,
        extra = params.extra;

    var attributes = _objectSpread({}, extra.attributes, title ? {
      'title': title
    } : {}, {
      'class': extra.classes.join(' ')
    });

    var styleString = joinStyles(extra.styles);

    if (styleString.length > 0) {
      attributes['style'] = styleString;
    }

    var val = [];
    val.push({
      tag: 'span',
      attributes: attributes,
      children: [content]
    });

    if (title) {
      val.push({
        tag: 'span',
        attributes: {
          class: 'sr-only'
        },
        children: [title]
      });
    }

    return val;
  }

  var noop$1 = function noop() {};

  var p = config.measurePerformance && PERFORMANCE && PERFORMANCE.mark && PERFORMANCE.measure ? PERFORMANCE : {
    mark: noop$1,
    measure: noop$1
  };
  var preamble = "FA \"5.6.1\"";

  var begin = function begin(name) {
    p.mark("".concat(preamble, " ").concat(name, " begins"));
    return function () {
      return end(name);
    };
  };

  var end = function end(name) {
    p.mark("".concat(preamble, " ").concat(name, " ends"));
    p.measure("".concat(preamble, " ").concat(name), "".concat(preamble, " ").concat(name, " begins"), "".concat(preamble, " ").concat(name, " ends"));
  };

  var perf = {
    begin: begin,
    end: end
  };

  /**
   * Internal helper to bind a function known to have 4 arguments
   * to a given context.
   */

  var bindInternal4 = function bindInternal4(func, thisContext) {
    return function (a, b, c, d) {
      return func.call(thisContext, a, b, c, d);
    };
  };

  /**
   * # Reduce
   *
   * A fast object `.reduce()` implementation.
   *
   * @param  {Object}   subject      The object to reduce over.
   * @param  {Function} fn           The reducer function.
   * @param  {mixed}    initialValue The initial value for the reducer, defaults to subject[0].
   * @param  {Object}   thisContext  The context for the reducer.
   * @return {mixed}                 The final result.
   */


  var reduce = function fastReduceObject(subject, fn, initialValue, thisContext) {
    var keys = Object.keys(subject),
        length = keys.length,
        iterator = thisContext !== undefined ? bindInternal4(fn, thisContext) : fn,
        i,
        key,
        result;

    if (initialValue === undefined) {
      i = 1;
      result = subject[keys[0]];
    } else {
      i = 0;
      result = initialValue;
    }

    for (; i < length; i++) {
      key = keys[i];
      result = iterator(result, subject[key], key, subject);
    }

    return result;
  };

  var styles = namespace.styles,
      shims = namespace.shims;
  var _byUnicode = {};
  var _byLigature = {};
  var _byOldName = {};
  var build = function build() {
    var lookup = function lookup(reducer) {
      return reduce(styles, function (o, style, prefix) {
        o[prefix] = reduce(style, reducer, {});
        return o;
      }, {});
    };

    _byUnicode = lookup(function (acc, icon, iconName) {
      acc[icon[3]] = iconName;
      return acc;
    });
    _byLigature = lookup(function (acc, icon, iconName) {
      var ligatures = icon[2];
      acc[iconName] = iconName;
      ligatures.forEach(function (ligature) {
        acc[ligature] = iconName;
      });
      return acc;
    });
    var hasRegular = 'far' in styles;
    _byOldName = reduce(shims, function (acc, shim) {
      var oldName = shim[0];
      var prefix = shim[1];
      var iconName = shim[2];

      if (prefix === 'far' && !hasRegular) {
        prefix = 'fas';
      }

      acc[oldName] = {
        prefix: prefix,
        iconName: iconName
      };
      return acc;
    }, {});
  };
  build();
  function byUnicode(prefix, unicode) {
    return _byUnicode[prefix][unicode];
  }
  function byLigature(prefix, ligature) {
    return _byLigature[prefix][ligature];
  }
  function byOldName(name) {
    return _byOldName[name] || {
      prefix: null,
      iconName: null
    };
  }

  var styles$1 = namespace.styles;
  var emptyCanonicalIcon = function emptyCanonicalIcon() {
    return {
      prefix: null,
      iconName: null,
      rest: []
    };
  };
  function getCanonicalIcon(values) {
    return values.reduce(function (acc, cls) {
      var iconName = getIconName(config.familyPrefix, cls);

      if (styles$1[cls]) {
        acc.prefix = cls;
      } else if (iconName) {
        var shim = acc.prefix === 'fa' ? byOldName(iconName) : {};
        acc.iconName = shim.iconName || iconName;
        acc.prefix = shim.prefix || acc.prefix;
      } else if (cls !== config.replacementClass && cls.indexOf('fa-w-') !== 0) {
        acc.rest.push(cls);
      }

      return acc;
    }, emptyCanonicalIcon());
  }
  function iconFromMapping(mapping, prefix, iconName) {
    if (mapping && mapping[prefix] && mapping[prefix][iconName]) {
      return {
        prefix: prefix,
        iconName: iconName,
        icon: mapping[prefix][iconName]
      };
    }
  }

  function toHtml(abstractNodes) {
    var tag = abstractNodes.tag,
        _abstractNodes$attrib = abstractNodes.attributes,
        attributes = _abstractNodes$attrib === void 0 ? {} : _abstractNodes$attrib,
        _abstractNodes$childr = abstractNodes.children,
        children = _abstractNodes$childr === void 0 ? [] : _abstractNodes$childr;

    if (typeof abstractNodes === 'string') {
      return htmlEscape(abstractNodes);
    } else {
      return "<".concat(tag, " ").concat(joinAttributes(attributes), ">").concat(children.map(toHtml).join(''), "</").concat(tag, ">");
    }
  }

  var noop$2 = function noop() {};

  function isWatched(node) {
    var i2svg = node.getAttribute ? node.getAttribute(DATA_FA_I2SVG) : null;
    return typeof i2svg === 'string';
  }

  function getMutator() {
    if (config.autoReplaceSvg === true) {
      return mutators.replace;
    }

    var mutator = mutators[config.autoReplaceSvg];
    return mutator || mutators.replace;
  }

  var mutators = {
    replace: function replace(mutation) {
      var node = mutation[0];
      var abstract = mutation[1];
      var newOuterHTML = abstract.map(function (a) {
        return toHtml(a);
      }).join('\n');

      if (node.parentNode && node.outerHTML) {
        node.outerHTML = newOuterHTML + (config.keepOriginalSource && node.tagName.toLowerCase() !== 'svg' ? "<!-- ".concat(node.outerHTML, " -->") : '');
      } else if (node.parentNode) {
        var newNode = document.createElement('span');
        node.parentNode.replaceChild(newNode, node);
        newNode.outerHTML = newOuterHTML;
      }
    },
    nest: function nest(mutation) {
      var node = mutation[0];
      var abstract = mutation[1]; // If we already have a replaced node we do not want to continue nesting within it.
      // Short-circuit to the standard replacement

      if (~classArray(node).indexOf(config.replacementClass)) {
        return mutators.replace(mutation);
      }

      var forSvg = new RegExp("".concat(config.familyPrefix, "-.*"));
      delete abstract[0].attributes.style;
      var splitClasses = abstract[0].attributes.class.split(' ').reduce(function (acc, cls) {
        if (cls === config.replacementClass || cls.match(forSvg)) {
          acc.toSvg.push(cls);
        } else {
          acc.toNode.push(cls);
        }

        return acc;
      }, {
        toNode: [],
        toSvg: []
      });
      abstract[0].attributes.class = splitClasses.toSvg.join(' ');
      var newInnerHTML = abstract.map(function (a) {
        return toHtml(a);
      }).join('\n');
      node.setAttribute('class', splitClasses.toNode.join(' '));
      node.setAttribute(DATA_FA_I2SVG, '');
      node.innerHTML = newInnerHTML;
    }
  };
  function perform(mutations, callback) {
    var callbackFunction = typeof callback === 'function' ? callback : noop$2;

    if (mutations.length === 0) {
      callbackFunction();
    } else {
      var frame = WINDOW.requestAnimationFrame || function (op) {
        return op();
      };

      frame(function () {
        var mutator = getMutator();
        var mark = perf.begin('mutate');
        mutations.map(mutator);
        mark();
        callbackFunction();
      });
    }
  }
  var disabled = false;
  function disableObservation(operation) {
    disabled = true;
    operation();
    disabled = false;
  }
  var mo = null;
  function observe(options) {
    if (!MUTATION_OBSERVER) {
      return;
    }

    if (!config.observeMutations) {
      return;
    }

    var treeCallback = options.treeCallback,
        nodeCallback = options.nodeCallback,
        pseudoElementsCallback = options.pseudoElementsCallback,
        _options$observeMutat = options.observeMutationsRoot,
        observeMutationsRoot = _options$observeMutat === void 0 ? DOCUMENT.body : _options$observeMutat;
    mo = new MUTATION_OBSERVER(function (objects) {
      if (disabled) return;
      toArray(objects).forEach(function (mutationRecord) {
        if (mutationRecord.type === 'childList' && mutationRecord.addedNodes.length > 0 && !isWatched(mutationRecord.addedNodes[0])) {
          if (config.searchPseudoElements) {
            pseudoElementsCallback(mutationRecord.target);
          }

          treeCallback(mutationRecord.target);
        }

        if (mutationRecord.type === 'attributes' && mutationRecord.target.parentNode && config.searchPseudoElements) {
          pseudoElementsCallback(mutationRecord.target.parentNode);
        }

        if (mutationRecord.type === 'attributes' && isWatched(mutationRecord.target) && ~ATTRIBUTES_WATCHED_FOR_MUTATION.indexOf(mutationRecord.attributeName)) {
          if (mutationRecord.attributeName === 'class') {
            var _getCanonicalIcon = getCanonicalIcon(classArray(mutationRecord.target)),
                prefix = _getCanonicalIcon.prefix,
                iconName = _getCanonicalIcon.iconName;

            if (prefix) mutationRecord.target.setAttribute('data-prefix', prefix);
            if (iconName) mutationRecord.target.setAttribute('data-icon', iconName);
          } else {
            nodeCallback(mutationRecord.target);
          }
        }
      });
    });
    if (!IS_DOM) return;
    mo.observe(observeMutationsRoot, {
      childList: true,
      attributes: true,
      characterData: true,
      subtree: true
    });
  }
  function disconnect() {
    if (!mo) return;
    mo.disconnect();
  }

  function styleParser (node) {
    var style = node.getAttribute('style');
    var val = [];

    if (style) {
      val = style.split(';').reduce(function (acc, style) {
        var styles = style.split(':');
        var prop = styles[0];
        var value = styles.slice(1);

        if (prop && value.length > 0) {
          acc[prop] = value.join(':').trim();
        }

        return acc;
      }, {});
    }

    return val;
  }

  function toHex(unicode) {
    var result = '';

    for (var i = 0; i < unicode.length; i++) {
      var hex = unicode.charCodeAt(i).toString(16);
      result += ('000' + hex).slice(-4);
    }

    return result;
  }

  function classParser (node) {
    var existingPrefix = node.getAttribute('data-prefix');
    var existingIconName = node.getAttribute('data-icon');
    var innerText = node.innerText !== undefined ? node.innerText.trim() : '';
    var val = getCanonicalIcon(classArray(node));

    if (existingPrefix && existingIconName) {
      val.prefix = existingPrefix;
      val.iconName = existingIconName;
    }

    if (val.prefix && innerText.length > 1) {
      val.iconName = byLigature(val.prefix, node.innerText);
    } else if (val.prefix && innerText.length === 1) {
      val.iconName = byUnicode(val.prefix, toHex(node.innerText));
    }

    return val;
  }

  var parseTransformString = function parseTransformString(transformString) {
    var transform = {
      size: 16,
      x: 0,
      y: 0,
      flipX: false,
      flipY: false,
      rotate: 0
    };

    if (!transformString) {
      return transform;
    } else {
      return transformString.toLowerCase().split(' ').reduce(function (acc, n) {
        var parts = n.toLowerCase().split('-');
        var first = parts[0];
        var rest = parts.slice(1).join('-');

        if (first && rest === 'h') {
          acc.flipX = true;
          return acc;
        }

        if (first && rest === 'v') {
          acc.flipY = true;
          return acc;
        }

        rest = parseFloat(rest);

        if (isNaN(rest)) {
          return acc;
        }

        switch (first) {
          case 'grow':
            acc.size = acc.size + rest;
            break;

          case 'shrink':
            acc.size = acc.size - rest;
            break;

          case 'left':
            acc.x = acc.x - rest;
            break;

          case 'right':
            acc.x = acc.x + rest;
            break;

          case 'up':
            acc.y = acc.y - rest;
            break;

          case 'down':
            acc.y = acc.y + rest;
            break;

          case 'rotate':
            acc.rotate = acc.rotate + rest;
            break;
        }

        return acc;
      }, transform);
    }
  };
  function transformParser (node) {
    return parseTransformString(node.getAttribute('data-fa-transform'));
  }

  function symbolParser (node) {
    var symbol = node.getAttribute('data-fa-symbol');
    return symbol === null ? false : symbol === '' ? true : symbol;
  }

  function attributesParser (node) {
    var extraAttributes = toArray(node.attributes).reduce(function (acc, attr) {
      if (acc.name !== 'class' && acc.name !== 'style') {
        acc[attr.name] = attr.value;
      }

      return acc;
    }, {});
    var title = node.getAttribute('title');

    if (config.autoA11y) {
      if (title) {
        extraAttributes['aria-labelledby'] = "".concat(config.replacementClass, "-title-").concat(nextUniqueId());
      } else {
        extraAttributes['aria-hidden'] = 'true';
      }
    }

    return extraAttributes;
  }

  function maskParser (node) {
    var mask = node.getAttribute('data-fa-mask');

    if (!mask) {
      return emptyCanonicalIcon();
    } else {
      return getCanonicalIcon(mask.split(' ').map(function (i) {
        return i.trim();
      }));
    }
  }

  var blankMeta = {
    iconName: null,
    title: null,
    prefix: null,
    transform: meaninglessTransform,
    symbol: false,
    mask: null,
    extra: {
      classes: [],
      styles: {},
      attributes: {}
    }
  };
  function parseMeta(node) {
    var _classParser = classParser(node),
        iconName = _classParser.iconName,
        prefix = _classParser.prefix,
        extraClasses = _classParser.rest;

    var extraStyles = styleParser(node);
    var transform = transformParser(node);
    var symbol = symbolParser(node);
    var extraAttributes = attributesParser(node);
    var mask = maskParser(node);
    return {
      iconName: iconName,
      title: node.getAttribute('title'),
      prefix: prefix,
      transform: transform,
      symbol: symbol,
      mask: mask,
      extra: {
        classes: extraClasses,
        styles: extraStyles,
        attributes: extraAttributes
      }
    };
  }

  function MissingIcon(error) {
    this.name = 'MissingIcon';
    this.message = error || 'Icon unavailable';
    this.stack = new Error().stack;
  }
  MissingIcon.prototype = Object.create(Error.prototype);
  MissingIcon.prototype.constructor = MissingIcon;

  var FILL = {
    fill: 'currentColor'
  };
  var ANIMATION_BASE = {
    attributeType: 'XML',
    repeatCount: 'indefinite',
    dur: '2s'
  };
  var RING = {
    tag: 'path',
    attributes: _objectSpread({}, FILL, {
      d: 'M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z'
    })
  };

  var OPACITY_ANIMATE = _objectSpread({}, ANIMATION_BASE, {
    attributeName: 'opacity'
  });

  var DOT = {
    tag: 'circle',
    attributes: _objectSpread({}, FILL, {
      cx: '256',
      cy: '364',
      r: '28'
    }),
    children: [{
      tag: 'animate',
      attributes: _objectSpread({}, ANIMATION_BASE, {
        attributeName: 'r',
        values: '28;14;28;28;14;28;'
      })
    }, {
      tag: 'animate',
      attributes: _objectSpread({}, OPACITY_ANIMATE, {
        values: '1;0;1;1;0;1;'
      })
    }]
  };
  var QUESTION = {
    tag: 'path',
    attributes: _objectSpread({}, FILL, {
      opacity: '1',
      d: 'M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z'
    }),
    children: [{
      tag: 'animate',
      attributes: _objectSpread({}, OPACITY_ANIMATE, {
        values: '1;0;0;0;0;1;'
      })
    }]
  };
  var EXCLAMATION = {
    tag: 'path',
    attributes: _objectSpread({}, FILL, {
      opacity: '0',
      d: 'M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z'
    }),
    children: [{
      tag: 'animate',
      attributes: _objectSpread({}, OPACITY_ANIMATE, {
        values: '0;0;1;1;0;0;'
      })
    }]
  };
  var missing = {
    tag: 'g',
    children: [RING, DOT, QUESTION, EXCLAMATION]
  };

  var styles$2 = namespace.styles;
  var LAYERS_TEXT_CLASSNAME = 'fa-layers-text';
  var FONT_FAMILY_PATTERN = /Font Awesome 5 (Solid|Regular|Light|Brands|Free|Pro)/;
  var STYLE_TO_PREFIX = {
    'Solid': 'fas',
    'Regular': 'far',
    'Light': 'fal',
    'Brands': 'fab'
  };
  var FONT_WEIGHT_TO_PREFIX = {
    '900': 'fas',
    '400': 'far',
    '300': 'fal'
  };

  function findIcon(iconName, prefix) {
    var val = {
      found: false,
      width: 512,
      height: 512,
      icon: missing
    };

    if (iconName && prefix && styles$2[prefix] && styles$2[prefix][iconName]) {
      var icon = styles$2[prefix][iconName];
      var width = icon[0];
      var height = icon[1];
      var vectorData = icon.slice(4);
      val = {
        found: true,
        width: width,
        height: height,
        icon: {
          tag: 'path',
          attributes: {
            fill: 'currentColor',
            d: vectorData[0]
          }
        }
      };
    } else if (iconName && prefix && !config.showMissingIcons) {
      throw new MissingIcon("Icon is missing for prefix ".concat(prefix, " with icon name ").concat(iconName));
    }

    return val;
  }

  function generateSvgReplacementMutation(node, nodeMeta) {
    var iconName = nodeMeta.iconName,
        title = nodeMeta.title,
        prefix = nodeMeta.prefix,
        transform = nodeMeta.transform,
        symbol = nodeMeta.symbol,
        mask = nodeMeta.mask,
        extra = nodeMeta.extra;
    return [node, makeInlineSvgAbstract({
      icons: {
        main: findIcon(iconName, prefix),
        mask: findIcon(mask.iconName, mask.prefix)
      },
      prefix: prefix,
      iconName: iconName,
      transform: transform,
      symbol: symbol,
      mask: mask,
      title: title,
      extra: extra,
      watchable: true
    })];
  }

  function generateLayersText(node, nodeMeta) {
    var title = nodeMeta.title,
        transform = nodeMeta.transform,
        extra = nodeMeta.extra;
    var width = null;
    var height = null;

    if (IS_IE) {
      var computedFontSize = parseInt(getComputedStyle(node).fontSize, 10);
      var boundingClientRect = node.getBoundingClientRect();
      width = boundingClientRect.width / computedFontSize;
      height = boundingClientRect.height / computedFontSize;
    }

    if (config.autoA11y && !title) {
      extra.attributes['aria-hidden'] = 'true';
    }

    return [node, makeLayersTextAbstract({
      content: node.innerHTML,
      width: width,
      height: height,
      transform: transform,
      title: title,
      extra: extra,
      watchable: true
    })];
  }

  function generateMutation(node) {
    var nodeMeta = parseMeta(node);

    if (~nodeMeta.extra.classes.indexOf(LAYERS_TEXT_CLASSNAME)) {
      return generateLayersText(node, nodeMeta);
    } else {
      return generateSvgReplacementMutation(node, nodeMeta);
    }
  }

  function searchPseudoElements(root) {
    if (!IS_DOM) return;
    var end = perf.begin('searchPseudoElements');
    disableObservation(function () {
      toArray(root.querySelectorAll('*')).filter(function (n) {
        return n.parentNode !== document.head && !~TAGNAMES_TO_SKIP_FOR_PSEUDOELEMENTS.indexOf(n.tagName.toUpperCase()) && !n.getAttribute(DATA_FA_PSEUDO_ELEMENT) && (!n.parentNode || n.parentNode.tagName !== 'svg');
      }).forEach(function (node) {
        [':before', ':after'].forEach(function (pos) {
          var children = toArray(node.children);
          var alreadyProcessedPseudoElement = children.filter(function (c) {
            return c.getAttribute(DATA_FA_PSEUDO_ELEMENT) === pos;
          })[0];
          var styles = WINDOW.getComputedStyle(node, pos);
          var fontFamily = styles.getPropertyValue('font-family').match(FONT_FAMILY_PATTERN);
          var fontWeight = styles.getPropertyValue('font-weight');

          if (alreadyProcessedPseudoElement && !fontFamily) {
            // If we've already processed it but the current computed style does not result in a font-family,
            // that probably means that a class name that was previously present to make the icon has been
            // removed. So we now should delete the icon.
            node.removeChild(alreadyProcessedPseudoElement);
          } else if (fontFamily) {
            var content = styles.getPropertyValue('content');
            var prefix = ~['Light', 'Regular', 'Solid', 'Brands'].indexOf(fontFamily[1]) ? STYLE_TO_PREFIX[fontFamily[1]] : FONT_WEIGHT_TO_PREFIX[fontWeight];
            var iconName = byUnicode(prefix, toHex(content.length === 3 ? content.substr(1, 1) : content)); // Only convert the pseudo element in this :before/:after position into an icon if we haven't
            // already done so with the same prefix and iconName

            if (!alreadyProcessedPseudoElement || alreadyProcessedPseudoElement.getAttribute(DATA_PREFIX) !== prefix || alreadyProcessedPseudoElement.getAttribute(DATA_ICON) !== iconName) {
              if (alreadyProcessedPseudoElement) {
                // Delete the old one, since we're replacing it with a new one
                node.removeChild(alreadyProcessedPseudoElement);
              }

              var extra = blankMeta.extra;
              extra.attributes[DATA_FA_PSEUDO_ELEMENT] = pos;
              var abstract = makeInlineSvgAbstract(_objectSpread({}, blankMeta, {
                icons: {
                  main: findIcon(iconName, prefix),
                  mask: emptyCanonicalIcon()
                },
                prefix: prefix,
                iconName: iconName,
                extra: extra,
                watchable: true
              }));
              var element = DOCUMENT.createElement('svg');

              if (pos === ':before') {
                node.insertBefore(element, node.firstChild);
              } else {
                node.appendChild(element);
              }

              element.outerHTML = abstract.map(function (a) {
                return toHtml(a);
              }).join('\n');
            }
          }
        });
      });
    });
    end();
  }
  function onTree(root) {
    var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    if (!IS_DOM) return;
    var htmlClassList = DOCUMENT.documentElement.classList;

    var hclAdd = function hclAdd(suffix) {
      return htmlClassList.add("".concat(HTML_CLASS_I2SVG_BASE_CLASS, "-").concat(suffix));
    };

    var hclRemove = function hclRemove(suffix) {
      return htmlClassList.remove("".concat(HTML_CLASS_I2SVG_BASE_CLASS, "-").concat(suffix));
    };

    var prefixes = Object.keys(styles$2);
    var prefixesDomQuery = [".".concat(LAYERS_TEXT_CLASSNAME, ":not([").concat(DATA_FA_I2SVG, "])")].concat(prefixes.map(function (p) {
      return ".".concat(p, ":not([").concat(DATA_FA_I2SVG, "])");
    })).join(', ');

    if (prefixesDomQuery.length === 0) {
      return;
    }

    var candidates = toArray(root.querySelectorAll(prefixesDomQuery));

    if (candidates.length > 0) {
      hclAdd('pending');
      hclRemove('complete');
    } else {
      return;
    }

    var mark = perf.begin('onTree');
    var mutations = candidates.reduce(function (acc, node) {
      try {
        var mutation = generateMutation(node);

        if (mutation) {
          acc.push(mutation);
        }
      } catch (e) {
        if (!PRODUCTION) {
          if (e instanceof MissingIcon) {
            console.error(e);
          }
        }
      }

      return acc;
    }, []);
    mark();
    perform(mutations, function () {
      hclAdd('active');
      hclAdd('complete');
      hclRemove('pending');
      if (typeof callback === 'function') callback();
    });
  }
  function onNode(node) {
    var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    var mutation = generateMutation(node);

    if (mutation) {
      perform([mutation], callback);
    }
  }

  var baseStyles = "svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;-webkit-box-sizing:border-box;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.3333333333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:solid .08em #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fa-rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{-webkit-transform:scale(1,-1);transform:scale(1,-1)}.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1,-1);transform:scale(-1,-1)}:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}";

  function css () {
    var dfp = DEFAULT_FAMILY_PREFIX;
    var drc = DEFAULT_REPLACEMENT_CLASS;
    var fp = config.familyPrefix;
    var rc = config.replacementClass;
    var s = baseStyles;

    if (fp !== dfp || rc !== drc) {
      var dPatt = new RegExp("\\.".concat(dfp, "\\-"), 'g');
      var rPatt = new RegExp("\\.".concat(drc), 'g');
      s = s.replace(dPatt, ".".concat(fp, "-")).replace(rPatt, ".".concat(rc));
    }

    return s;
  }

  function define(prefix, icons) {
    var normalized = Object.keys(icons).reduce(function (acc, iconName) {
      var icon = icons[iconName];
      var expanded = !!icon.icon;

      if (expanded) {
        acc[icon.iconName] = icon.icon;
      } else {
        acc[iconName] = icon;
      }

      return acc;
    }, {});

    if (typeof namespace.hooks.addPack === 'function') {
      namespace.hooks.addPack(prefix, normalized);
    } else {
      namespace.styles[prefix] = _objectSpread({}, namespace.styles[prefix] || {}, normalized);
    }
    /**
     * Font Awesome 4 used the prefix of `fa` for all icons. With the introduction
     * of new styles we needed to differentiate between them. Prefix `fa` is now an alias
     * for `fas` so we'll easy the upgrade process for our users by automatically defining
     * this as well.
     */


    if (prefix === 'fas') {
      define('fa', icons);
    }
  }

  var Library =
  /*#__PURE__*/
  function () {
    function Library() {
      _classCallCheck(this, Library);

      this.definitions = {};
    }

    _createClass(Library, [{
      key: "add",
      value: function add() {
        var _this = this;

        for (var _len = arguments.length, definitions = new Array(_len), _key = 0; _key < _len; _key++) {
          definitions[_key] = arguments[_key];
        }

        var additions = definitions.reduce(this._pullDefinitions, {});
        Object.keys(additions).forEach(function (key) {
          _this.definitions[key] = _objectSpread({}, _this.definitions[key] || {}, additions[key]);
          define(key, additions[key]);
          build();
        });
      }
    }, {
      key: "reset",
      value: function reset() {
        this.definitions = {};
      }
    }, {
      key: "_pullDefinitions",
      value: function _pullDefinitions(additions, definition) {
        var normalized = definition.prefix && definition.iconName && definition.icon ? {
          0: definition
        } : definition;
        Object.keys(normalized).map(function (key) {
          var _normalized$key = normalized[key],
              prefix = _normalized$key.prefix,
              iconName = _normalized$key.iconName,
              icon = _normalized$key.icon;
          if (!additions[prefix]) additions[prefix] = {};
          additions[prefix][iconName] = icon;
        });
        return additions;
      }
    }]);

    return Library;
  }();

  function prepIcon(icon) {
    var width = icon[0];
    var height = icon[1];
    var vectorData = icon.slice(4);
    return {
      found: true,
      width: width,
      height: height,
      icon: {
        tag: 'path',
        attributes: {
          fill: 'currentColor',
          d: vectorData[0]
        }
      }
    };
  }

  function ensureCss() {
    if (config.autoAddCss && !_cssInserted) {
      insertCss(css());

      _cssInserted = true;
    }
  }

  function apiObject(val, abstractCreator) {
    Object.defineProperty(val, 'abstract', {
      get: abstractCreator
    });
    Object.defineProperty(val, 'html', {
      get: function get() {
        return val.abstract.map(function (a) {
          return toHtml(a);
        });
      }
    });
    Object.defineProperty(val, 'node', {
      get: function get() {
        if (!IS_DOM) return;
        var container = DOCUMENT.createElement('div');
        container.innerHTML = val.html;
        return container.children;
      }
    });
    return val;
  }

  function findIconDefinition(params) {
    var _params$prefix = params.prefix,
        prefix = _params$prefix === void 0 ? 'fa' : _params$prefix,
        iconName = params.iconName;
    if (!iconName) return;
    return iconFromMapping(library.definitions, prefix, iconName) || iconFromMapping(namespace.styles, prefix, iconName);
  }

  function resolveIcons(next) {
    return function (maybeIconDefinition) {
      var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      var iconDefinition = (maybeIconDefinition || {}).icon ? maybeIconDefinition : findIconDefinition(maybeIconDefinition || {});
      var mask = params.mask;

      if (mask) {
        mask = (mask || {}).icon ? mask : findIconDefinition(mask || {});
      }

      return next(iconDefinition, _objectSpread({}, params, {
        mask: mask
      }));
    };
  }

  var library = new Library();
  var noAuto = function noAuto() {
    config.autoReplaceSvg = false;
    config.observeMutations = false;
    disconnect();
  };
  var _cssInserted = false;
  var dom = {
    i2svg: function i2svg() {
      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

      if (IS_DOM) {
        ensureCss();
        var _params$node = params.node,
            node = _params$node === void 0 ? DOCUMENT : _params$node,
            _params$callback = params.callback,
            callback = _params$callback === void 0 ? function () {} : _params$callback;

        if (config.searchPseudoElements) {
          searchPseudoElements(node);
        }

        onTree(node, callback);
      }
    },
    css: css,
    insertCss: function insertCss$$1() {
      if (!_cssInserted) {
        insertCss(css());

        _cssInserted = true;
      }
    },
    watch: function watch() {
      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var autoReplaceSvgRoot = params.autoReplaceSvgRoot,
          observeMutationsRoot = params.observeMutationsRoot;

      if (config.autoReplaceSvg === false) {
        config.autoReplaceSvg = true;
      }

      config.observeMutations = true;
      domready(function () {
        autoReplace({
          autoReplaceSvgRoot: autoReplaceSvgRoot
        });
        observe({
          treeCallback: onTree,
          nodeCallback: onNode,
          pseudoElementsCallback: searchPseudoElements,
          observeMutationsRoot: observeMutationsRoot
        });
      });
    }
  };
  var parse = {
    transform: function transform(transformString) {
      return parseTransformString(transformString);
    }
  };
  var icon = resolveIcons(function (iconDefinition) {
    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var _params$transform = params.transform,
        transform = _params$transform === void 0 ? meaninglessTransform : _params$transform,
        _params$symbol = params.symbol,
        symbol = _params$symbol === void 0 ? false : _params$symbol,
        _params$mask = params.mask,
        mask = _params$mask === void 0 ? null : _params$mask,
        _params$title = params.title,
        title = _params$title === void 0 ? null : _params$title,
        _params$classes = params.classes,
        classes = _params$classes === void 0 ? [] : _params$classes,
        _params$attributes = params.attributes,
        attributes = _params$attributes === void 0 ? {} : _params$attributes,
        _params$styles = params.styles,
        styles = _params$styles === void 0 ? {} : _params$styles;
    if (!iconDefinition) return;
    var prefix = iconDefinition.prefix,
        iconName = iconDefinition.iconName,
        icon = iconDefinition.icon;
    return apiObject(_objectSpread({
      type: 'icon'
    }, iconDefinition), function () {
      ensureCss();

      if (config.autoA11y) {
        if (title) {
          attributes['aria-labelledby'] = "".concat(config.replacementClass, "-title-").concat(nextUniqueId());
        } else {
          attributes['aria-hidden'] = 'true';
        }
      }

      return makeInlineSvgAbstract({
        icons: {
          main: prepIcon(icon),
          mask: mask ? prepIcon(mask.icon) : {
            found: false,
            width: null,
            height: null,
            icon: {}
          }
        },
        prefix: prefix,
        iconName: iconName,
        transform: _objectSpread({}, meaninglessTransform, transform),
        symbol: symbol,
        title: title,
        extra: {
          attributes: attributes,
          styles: styles,
          classes: classes
        }
      });
    });
  });
  var text = function text(content) {
    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var _params$transform2 = params.transform,
        transform = _params$transform2 === void 0 ? meaninglessTransform : _params$transform2,
        _params$title2 = params.title,
        title = _params$title2 === void 0 ? null : _params$title2,
        _params$classes2 = params.classes,
        classes = _params$classes2 === void 0 ? [] : _params$classes2,
        _params$attributes2 = params.attributes,
        attributes = _params$attributes2 === void 0 ? {} : _params$attributes2,
        _params$styles2 = params.styles,
        styles = _params$styles2 === void 0 ? {} : _params$styles2;
    return apiObject({
      type: 'text',
      content: content
    }, function () {
      ensureCss();
      return makeLayersTextAbstract({
        content: content,
        transform: _objectSpread({}, meaninglessTransform, transform),
        title: title,
        extra: {
          attributes: attributes,
          styles: styles,
          classes: ["".concat(config.familyPrefix, "-layers-text")].concat(_toConsumableArray(classes))
        }
      });
    });
  };
  var counter = function counter(content) {
    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var _params$title3 = params.title,
        title = _params$title3 === void 0 ? null : _params$title3,
        _params$classes3 = params.classes,
        classes = _params$classes3 === void 0 ? [] : _params$classes3,
        _params$attributes3 = params.attributes,
        attributes = _params$attributes3 === void 0 ? {} : _params$attributes3,
        _params$styles3 = params.styles,
        styles = _params$styles3 === void 0 ? {} : _params$styles3;
    return apiObject({
      type: 'counter',
      content: content
    }, function () {
      ensureCss();
      return makeLayersCounterAbstract({
        content: content.toString(),
        title: title,
        extra: {
          attributes: attributes,
          styles: styles,
          classes: ["".concat(config.familyPrefix, "-layers-counter")].concat(_toConsumableArray(classes))
        }
      });
    });
  };
  var layer = function layer(assembler) {
    return apiObject({
      type: 'layer'
    }, function () {
      ensureCss();
      var children = [];
      assembler(function (args) {
        Array.isArray(args) ? args.map(function (a) {
          children = children.concat(a.abstract);
        }) : children = children.concat(args.abstract);
      });
      return [{
        tag: 'span',
        attributes: {
          class: "".concat(config.familyPrefix, "-layers")
        },
        children: children
      }];
    });
  };
  var api = {
    noAuto: noAuto,
    config: config,
    dom: dom,
    library: library,
    parse: parse,
    findIconDefinition: findIconDefinition,
    icon: icon,
    text: text,
    counter: counter,
    layer: layer,
    toHtml: toHtml
  };

  var autoReplace = function autoReplace() {
    var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var _params$autoReplaceSv = params.autoReplaceSvgRoot,
        autoReplaceSvgRoot = _params$autoReplaceSv === void 0 ? DOCUMENT : _params$autoReplaceSv;
    if (Object.keys(namespace.styles).length > 0 && IS_DOM && config.autoReplaceSvg) api.dom.i2svg({
      node: autoReplaceSvgRoot
    });
  };

  function bootstrap() {
    if (IS_BROWSER) {
      if (!WINDOW.FontAwesome) {
        WINDOW.FontAwesome = api;
      }

      domready(function () {
        autoReplace();
        observe({
          treeCallback: onTree,
          nodeCallback: onNode,
          pseudoElementsCallback: searchPseudoElements
        });
      });
    }

    namespace.hooks = _objectSpread({}, namespace.hooks, {
      addPack: function addPack(prefix, icons) {
        namespace.styles[prefix] = _objectSpread({}, namespace.styles[prefix] || {}, icons);
        build();
        autoReplace();
      },
      addShims: function addShims(shims) {
        var _namespace$shims;

        (_namespace$shims = namespace.shims).push.apply(_namespace$shims, _toConsumableArray(shims));

        build();
        autoReplace();
      }
    });
  }

  bunker(bootstrap);

}());


/***/ }),

/***/ "./node_modules/fine-uploader/fine-uploader/fine-uploader-gallery.css":
/*!****************************************************************************!*\
  !*** ./node_modules/fine-uploader/fine-uploader/fine-uploader-gallery.css ***!
  \****************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),

/***/ "./node_modules/fine-uploader/fine-uploader/fine-uploader.js":
/*!*******************************************************************!*\
  !*** ./node_modules/fine-uploader/fine-uploader/fine-uploader.js ***!
  \*******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_RESULT__;// Fine Uploader 5.16.2 - MIT licensed. http://fineuploader.com
(function(global) {
    var qq = function(element) {
        "use strict";
        return {
            hide: function() {
                element.style.display = "none";
                return this;
            },
            attach: function(type, fn) {
                if (element.addEventListener) {
                    element.addEventListener(type, fn, false);
                } else if (element.attachEvent) {
                    element.attachEvent("on" + type, fn);
                }
                return function() {
                    qq(element).detach(type, fn);
                };
            },
            detach: function(type, fn) {
                if (element.removeEventListener) {
                    element.removeEventListener(type, fn, false);
                } else if (element.attachEvent) {
                    element.detachEvent("on" + type, fn);
                }
                return this;
            },
            contains: function(descendant) {
                if (!descendant) {
                    return false;
                }
                if (element === descendant) {
                    return true;
                }
                if (element.contains) {
                    return element.contains(descendant);
                } else {
                    return !!(descendant.compareDocumentPosition(element) & 8);
                }
            },
            insertBefore: function(elementB) {
                elementB.parentNode.insertBefore(element, elementB);
                return this;
            },
            remove: function() {
                element.parentNode.removeChild(element);
                return this;
            },
            css: function(styles) {
                if (element.style == null) {
                    throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");
                }
                if (styles.opacity != null) {
                    if (typeof element.style.opacity !== "string" && typeof element.filters !== "undefined") {
                        styles.filter = "alpha(opacity=" + Math.round(100 * styles.opacity) + ")";
                    }
                }
                qq.extend(element.style, styles);
                return this;
            },
            hasClass: function(name, considerParent) {
                var re = new RegExp("(^| )" + name + "( |$)");
                return re.test(element.className) || !!(considerParent && re.test(element.parentNode.className));
            },
            addClass: function(name) {
                if (!qq(element).hasClass(name)) {
                    element.className += " " + name;
                }
                return this;
            },
            removeClass: function(name) {
                var re = new RegExp("(^| )" + name + "( |$)");
                element.className = element.className.replace(re, " ").replace(/^\s+|\s+$/g, "");
                return this;
            },
            getByClass: function(className, first) {
                var candidates, result = [];
                if (first && element.querySelector) {
                    return element.querySelector("." + className);
                } else if (element.querySelectorAll) {
                    return element.querySelectorAll("." + className);
                }
                candidates = element.getElementsByTagName("*");
                qq.each(candidates, function(idx, val) {
                    if (qq(val).hasClass(className)) {
                        result.push(val);
                    }
                });
                return first ? result[0] : result;
            },
            getFirstByClass: function(className) {
                return qq(element).getByClass(className, true);
            },
            children: function() {
                var children = [], child = element.firstChild;
                while (child) {
                    if (child.nodeType === 1) {
                        children.push(child);
                    }
                    child = child.nextSibling;
                }
                return children;
            },
            setText: function(text) {
                element.innerText = text;
                element.textContent = text;
                return this;
            },
            clearText: function() {
                return qq(element).setText("");
            },
            hasAttribute: function(attrName) {
                var attrVal;
                if (element.hasAttribute) {
                    if (!element.hasAttribute(attrName)) {
                        return false;
                    }
                    return /^false$/i.exec(element.getAttribute(attrName)) == null;
                } else {
                    attrVal = element[attrName];
                    if (attrVal === undefined) {
                        return false;
                    }
                    return /^false$/i.exec(attrVal) == null;
                }
            }
        };
    };
    (function() {
        "use strict";
        qq.canvasToBlob = function(canvas, mime, quality) {
            return qq.dataUriToBlob(canvas.toDataURL(mime, quality));
        };
        qq.dataUriToBlob = function(dataUri) {
            var arrayBuffer, byteString, createBlob = function(data, mime) {
                var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder, blobBuilder = BlobBuilder && new BlobBuilder();
                if (blobBuilder) {
                    blobBuilder.append(data);
                    return blobBuilder.getBlob(mime);
                } else {
                    return new Blob([ data ], {
                        type: mime
                    });
                }
            }, intArray, mimeString;
            if (dataUri.split(",")[0].indexOf("base64") >= 0) {
                byteString = atob(dataUri.split(",")[1]);
            } else {
                byteString = decodeURI(dataUri.split(",")[1]);
            }
            mimeString = dataUri.split(",")[0].split(":")[1].split(";")[0];
            arrayBuffer = new ArrayBuffer(byteString.length);
            intArray = new Uint8Array(arrayBuffer);
            qq.each(byteString, function(idx, character) {
                intArray[idx] = character.charCodeAt(0);
            });
            return createBlob(arrayBuffer, mimeString);
        };
        qq.log = function(message, level) {
            if (window.console) {
                if (!level || level === "info") {
                    window.console.log(message);
                } else {
                    if (window.console[level]) {
                        window.console[level](message);
                    } else {
                        window.console.log("<" + level + "> " + message);
                    }
                }
            }
        };
        qq.isObject = function(variable) {
            return variable && !variable.nodeType && Object.prototype.toString.call(variable) === "[object Object]";
        };
        qq.isFunction = function(variable) {
            return typeof variable === "function";
        };
        qq.isArray = function(value) {
            return Object.prototype.toString.call(value) === "[object Array]" || value && window.ArrayBuffer && value.buffer && value.buffer.constructor === ArrayBuffer;
        };
        qq.isItemList = function(maybeItemList) {
            return Object.prototype.toString.call(maybeItemList) === "[object DataTransferItemList]";
        };
        qq.isNodeList = function(maybeNodeList) {
            return Object.prototype.toString.call(maybeNodeList) === "[object NodeList]" || maybeNodeList.item && maybeNodeList.namedItem;
        };
        qq.isString = function(maybeString) {
            return Object.prototype.toString.call(maybeString) === "[object String]";
        };
        qq.trimStr = function(string) {
            if (String.prototype.trim) {
                return string.trim();
            }
            return string.replace(/^\s+|\s+$/g, "");
        };
        qq.format = function(str) {
            var args = Array.prototype.slice.call(arguments, 1), newStr = str, nextIdxToReplace = newStr.indexOf("{}");
            qq.each(args, function(idx, val) {
                var strBefore = newStr.substring(0, nextIdxToReplace), strAfter = newStr.substring(nextIdxToReplace + 2);
                newStr = strBefore + val + strAfter;
                nextIdxToReplace = newStr.indexOf("{}", nextIdxToReplace + val.length);
                if (nextIdxToReplace < 0) {
                    return false;
                }
            });
            return newStr;
        };
        qq.isFile = function(maybeFile) {
            return window.File && Object.prototype.toString.call(maybeFile) === "[object File]";
        };
        qq.isFileList = function(maybeFileList) {
            return window.FileList && Object.prototype.toString.call(maybeFileList) === "[object FileList]";
        };
        qq.isFileOrInput = function(maybeFileOrInput) {
            return qq.isFile(maybeFileOrInput) || qq.isInput(maybeFileOrInput);
        };
        qq.isInput = function(maybeInput, notFile) {
            var evaluateType = function(type) {
                var normalizedType = type.toLowerCase();
                if (notFile) {
                    return normalizedType !== "file";
                }
                return normalizedType === "file";
            };
            if (window.HTMLInputElement) {
                if (Object.prototype.toString.call(maybeInput) === "[object HTMLInputElement]") {
                    if (maybeInput.type && evaluateType(maybeInput.type)) {
                        return true;
                    }
                }
            }
            if (maybeInput.tagName) {
                if (maybeInput.tagName.toLowerCase() === "input") {
                    if (maybeInput.type && evaluateType(maybeInput.type)) {
                        return true;
                    }
                }
            }
            return false;
        };
        qq.isBlob = function(maybeBlob) {
            if (window.Blob && Object.prototype.toString.call(maybeBlob) === "[object Blob]") {
                return true;
            }
        };
        qq.isXhrUploadSupported = function() {
            var input = document.createElement("input");
            input.type = "file";
            return input.multiple !== undefined && typeof File !== "undefined" && typeof FormData !== "undefined" && typeof qq.createXhrInstance().upload !== "undefined";
        };
        qq.createXhrInstance = function() {
            if (window.XMLHttpRequest) {
                return new XMLHttpRequest();
            }
            try {
                return new ActiveXObject("MSXML2.XMLHTTP.3.0");
            } catch (error) {
                qq.log("Neither XHR or ActiveX are supported!", "error");
                return null;
            }
        };
        qq.isFolderDropSupported = function(dataTransfer) {
            return dataTransfer.items && dataTransfer.items.length > 0 && dataTransfer.items[0].webkitGetAsEntry;
        };
        qq.isFileChunkingSupported = function() {
            return !qq.androidStock() && qq.isXhrUploadSupported() && (File.prototype.slice !== undefined || File.prototype.webkitSlice !== undefined || File.prototype.mozSlice !== undefined);
        };
        qq.sliceBlob = function(fileOrBlob, start, end) {
            var slicer = fileOrBlob.slice || fileOrBlob.mozSlice || fileOrBlob.webkitSlice;
            return slicer.call(fileOrBlob, start, end);
        };
        qq.arrayBufferToHex = function(buffer) {
            var bytesAsHex = "", bytes = new Uint8Array(buffer);
            qq.each(bytes, function(idx, byt) {
                var byteAsHexStr = byt.toString(16);
                if (byteAsHexStr.length < 2) {
                    byteAsHexStr = "0" + byteAsHexStr;
                }
                bytesAsHex += byteAsHexStr;
            });
            return bytesAsHex;
        };
        qq.readBlobToHex = function(blob, startOffset, length) {
            var initialBlob = qq.sliceBlob(blob, startOffset, startOffset + length), fileReader = new FileReader(), promise = new qq.Promise();
            fileReader.onload = function() {
                promise.success(qq.arrayBufferToHex(fileReader.result));
            };
            fileReader.onerror = promise.failure;
            fileReader.readAsArrayBuffer(initialBlob);
            return promise;
        };
        qq.extend = function(first, second, extendNested) {
            qq.each(second, function(prop, val) {
                if (extendNested && qq.isObject(val)) {
                    if (first[prop] === undefined) {
                        first[prop] = {};
                    }
                    qq.extend(first[prop], val, true);
                } else {
                    first[prop] = val;
                }
            });
            return first;
        };
        qq.override = function(target, sourceFn) {
            var super_ = {}, source = sourceFn(super_);
            qq.each(source, function(srcPropName, srcPropVal) {
                if (target[srcPropName] !== undefined) {
                    super_[srcPropName] = target[srcPropName];
                }
                target[srcPropName] = srcPropVal;
            });
            return target;
        };
        qq.indexOf = function(arr, elt, from) {
            if (arr.indexOf) {
                return arr.indexOf(elt, from);
            }
            from = from || 0;
            var len = arr.length;
            if (from < 0) {
                from += len;
            }
            for (;from < len; from += 1) {
                if (arr.hasOwnProperty(from) && arr[from] === elt) {
                    return from;
                }
            }
            return -1;
        };
        qq.getUniqueId = function() {
            return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == "x" ? r : r & 3 | 8;
                return v.toString(16);
            });
        };
        qq.ie = function() {
            return navigator.userAgent.indexOf("MSIE") !== -1 || navigator.userAgent.indexOf("Trident") !== -1;
        };
        qq.ie7 = function() {
            return navigator.userAgent.indexOf("MSIE 7") !== -1;
        };
        qq.ie8 = function() {
            return navigator.userAgent.indexOf("MSIE 8") !== -1;
        };
        qq.ie10 = function() {
            return navigator.userAgent.indexOf("MSIE 10") !== -1;
        };
        qq.ie11 = function() {
            return qq.ie() && navigator.userAgent.indexOf("rv:11") !== -1;
        };
        qq.edge = function() {
            return navigator.userAgent.indexOf("Edge") >= 0;
        };
        qq.safari = function() {
            return navigator.vendor !== undefined && navigator.vendor.indexOf("Apple") !== -1;
        };
        qq.chrome = function() {
            return navigator.vendor !== undefined && navigator.vendor.indexOf("Google") !== -1;
        };
        qq.opera = function() {
            return navigator.vendor !== undefined && navigator.vendor.indexOf("Opera") !== -1;
        };
        qq.firefox = function() {
            return !qq.edge() && !qq.ie11() && navigator.userAgent.indexOf("Mozilla") !== -1 && navigator.vendor !== undefined && navigator.vendor === "";
        };
        qq.windows = function() {
            return navigator.platform === "Win32";
        };
        qq.android = function() {
            return navigator.userAgent.toLowerCase().indexOf("android") !== -1;
        };
        qq.androidStock = function() {
            return qq.android() && navigator.userAgent.toLowerCase().indexOf("chrome") < 0;
        };
        qq.ios6 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 6_") !== -1;
        };
        qq.ios7 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 7_") !== -1;
        };
        qq.ios8 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 8_") !== -1;
        };
        qq.ios800 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 8_0 ") !== -1;
        };
        qq.ios = function() {
            return navigator.userAgent.indexOf("iPad") !== -1 || navigator.userAgent.indexOf("iPod") !== -1 || navigator.userAgent.indexOf("iPhone") !== -1;
        };
        qq.iosChrome = function() {
            return qq.ios() && navigator.userAgent.indexOf("CriOS") !== -1;
        };
        qq.iosSafari = function() {
            return qq.ios() && !qq.iosChrome() && navigator.userAgent.indexOf("Safari") !== -1;
        };
        qq.iosSafariWebView = function() {
            return qq.ios() && !qq.iosChrome() && !qq.iosSafari();
        };
        qq.preventDefault = function(e) {
            if (e.preventDefault) {
                e.preventDefault();
            } else {
                e.returnValue = false;
            }
        };
        qq.toElement = function() {
            var div = document.createElement("div");
            return function(html) {
                div.innerHTML = html;
                var element = div.firstChild;
                div.removeChild(element);
                return element;
            };
        }();
        qq.each = function(iterableItem, callback) {
            var keyOrIndex, retVal;
            if (iterableItem) {
                if (window.Storage && iterableItem.constructor === window.Storage) {
                    for (keyOrIndex = 0; keyOrIndex < iterableItem.length; keyOrIndex++) {
                        retVal = callback(iterableItem.key(keyOrIndex), iterableItem.getItem(iterableItem.key(keyOrIndex)));
                        if (retVal === false) {
                            break;
                        }
                    }
                } else if (qq.isArray(iterableItem) || qq.isItemList(iterableItem) || qq.isNodeList(iterableItem)) {
                    for (keyOrIndex = 0; keyOrIndex < iterableItem.length; keyOrIndex++) {
                        retVal = callback(keyOrIndex, iterableItem[keyOrIndex]);
                        if (retVal === false) {
                            break;
                        }
                    }
                } else if (qq.isString(iterableItem)) {
                    for (keyOrIndex = 0; keyOrIndex < iterableItem.length; keyOrIndex++) {
                        retVal = callback(keyOrIndex, iterableItem.charAt(keyOrIndex));
                        if (retVal === false) {
                            break;
                        }
                    }
                } else {
                    for (keyOrIndex in iterableItem) {
                        if (Object.prototype.hasOwnProperty.call(iterableItem, keyOrIndex)) {
                            retVal = callback(keyOrIndex, iterableItem[keyOrIndex]);
                            if (retVal === false) {
                                break;
                            }
                        }
                    }
                }
            }
        };
        qq.bind = function(oldFunc, context) {
            if (qq.isFunction(oldFunc)) {
                var args = Array.prototype.slice.call(arguments, 2);
                return function() {
                    var newArgs = qq.extend([], args);
                    if (arguments.length) {
                        newArgs = newArgs.concat(Array.prototype.slice.call(arguments));
                    }
                    return oldFunc.apply(context, newArgs);
                };
            }
            throw new Error("first parameter must be a function!");
        };
        qq.obj2url = function(obj, temp, prefixDone) {
            var uristrings = [], prefix = "&", add = function(nextObj, i) {
                var nextTemp = temp ? /\[\]$/.test(temp) ? temp : temp + "[" + i + "]" : i;
                if (nextTemp !== "undefined" && i !== "undefined") {
                    uristrings.push(typeof nextObj === "object" ? qq.obj2url(nextObj, nextTemp, true) : Object.prototype.toString.call(nextObj) === "[object Function]" ? encodeURIComponent(nextTemp) + "=" + encodeURIComponent(nextObj()) : encodeURIComponent(nextTemp) + "=" + encodeURIComponent(nextObj));
                }
            };
            if (!prefixDone && temp) {
                prefix = /\?/.test(temp) ? /\?$/.test(temp) ? "" : "&" : "?";
                uristrings.push(temp);
                uristrings.push(qq.obj2url(obj));
            } else if (Object.prototype.toString.call(obj) === "[object Array]" && typeof obj !== "undefined") {
                qq.each(obj, function(idx, val) {
                    add(val, idx);
                });
            } else if (typeof obj !== "undefined" && obj !== null && typeof obj === "object") {
                qq.each(obj, function(prop, val) {
                    add(val, prop);
                });
            } else {
                uristrings.push(encodeURIComponent(temp) + "=" + encodeURIComponent(obj));
            }
            if (temp) {
                return uristrings.join(prefix);
            } else {
                return uristrings.join(prefix).replace(/^&/, "").replace(/%20/g, "+");
            }
        };
        qq.obj2FormData = function(obj, formData, arrayKeyName) {
            if (!formData) {
                formData = new FormData();
            }
            qq.each(obj, function(key, val) {
                key = arrayKeyName ? arrayKeyName + "[" + key + "]" : key;
                if (qq.isObject(val)) {
                    qq.obj2FormData(val, formData, key);
                } else if (qq.isFunction(val)) {
                    formData.append(key, val());
                } else {
                    formData.append(key, val);
                }
            });
            return formData;
        };
        qq.obj2Inputs = function(obj, form) {
            var input;
            if (!form) {
                form = document.createElement("form");
            }
            qq.obj2FormData(obj, {
                append: function(key, val) {
                    input = document.createElement("input");
                    input.setAttribute("name", key);
                    input.setAttribute("value", val);
                    form.appendChild(input);
                }
            });
            return form;
        };
        qq.parseJson = function(json) {
            if (window.JSON && qq.isFunction(JSON.parse)) {
                return JSON.parse(json);
            } else {
                return eval("(" + json + ")");
            }
        };
        qq.getExtension = function(filename) {
            var extIdx = filename.lastIndexOf(".") + 1;
            if (extIdx > 0) {
                return filename.substr(extIdx, filename.length - extIdx);
            }
        };
        qq.getFilename = function(blobOrFileInput) {
            if (qq.isInput(blobOrFileInput)) {
                return blobOrFileInput.value.replace(/.*(\/|\\)/, "");
            } else if (qq.isFile(blobOrFileInput)) {
                if (blobOrFileInput.fileName !== null && blobOrFileInput.fileName !== undefined) {
                    return blobOrFileInput.fileName;
                }
            }
            return blobOrFileInput.name;
        };
        qq.DisposeSupport = function() {
            var disposers = [];
            return {
                dispose: function() {
                    var disposer;
                    do {
                        disposer = disposers.shift();
                        if (disposer) {
                            disposer();
                        }
                    } while (disposer);
                },
                attach: function() {
                    var args = arguments;
                    this.addDisposer(qq(args[0]).attach.apply(this, Array.prototype.slice.call(arguments, 1)));
                },
                addDisposer: function(disposeFunction) {
                    disposers.push(disposeFunction);
                }
            };
        };
    })();
    (function() {
        "use strict";
        if (true) {
            !(__WEBPACK_AMD_DEFINE_RESULT__ = (function() {
                return qq;
            }).call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
        } else {}
    })();
    (function() {
        "use strict";
        qq.Error = function(message) {
            this.message = "[Fine Uploader " + qq.version + "] " + message;
        };
        qq.Error.prototype = new Error();
    })();
    qq.version = "5.16.2";
    qq.supportedFeatures = function() {
        "use strict";
        var supportsUploading, supportsUploadingBlobs, supportsFileDrop, supportsAjaxFileUploading, supportsFolderDrop, supportsChunking, supportsResume, supportsUploadViaPaste, supportsUploadCors, supportsDeleteFileXdr, supportsDeleteFileCorsXhr, supportsDeleteFileCors, supportsFolderSelection, supportsImagePreviews, supportsUploadProgress;
        function testSupportsFileInputElement() {
            var supported = true, tempInput;
            try {
                tempInput = document.createElement("input");
                tempInput.type = "file";
                qq(tempInput).hide();
                if (tempInput.disabled) {
                    supported = false;
                }
            } catch (ex) {
                supported = false;
            }
            return supported;
        }
        function isChrome14OrHigher() {
            return (qq.chrome() || qq.opera()) && navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/) !== undefined;
        }
        function isCrossOriginXhrSupported() {
            if (window.XMLHttpRequest) {
                var xhr = qq.createXhrInstance();
                return xhr.withCredentials !== undefined;
            }
            return false;
        }
        function isXdrSupported() {
            return window.XDomainRequest !== undefined;
        }
        function isCrossOriginAjaxSupported() {
            if (isCrossOriginXhrSupported()) {
                return true;
            }
            return isXdrSupported();
        }
        function isFolderSelectionSupported() {
            return document.createElement("input").webkitdirectory !== undefined;
        }
        function isLocalStorageSupported() {
            try {
                return !!window.localStorage && qq.isFunction(window.localStorage.setItem);
            } catch (error) {
                return false;
            }
        }
        function isDragAndDropSupported() {
            var span = document.createElement("span");
            return ("draggable" in span || "ondragstart" in span && "ondrop" in span) && !qq.android() && !qq.ios();
        }
        supportsUploading = testSupportsFileInputElement();
        supportsAjaxFileUploading = supportsUploading && qq.isXhrUploadSupported();
        supportsUploadingBlobs = supportsAjaxFileUploading && !qq.androidStock();
        supportsFileDrop = supportsAjaxFileUploading && isDragAndDropSupported();
        supportsFolderDrop = supportsFileDrop && function() {
            var input = document.createElement("input");
            input.type = "file";
            return !!("webkitdirectory" in (input || document.querySelectorAll("input[type=file]")[0]));
        }();
        supportsChunking = supportsAjaxFileUploading && qq.isFileChunkingSupported();
        supportsResume = supportsAjaxFileUploading && supportsChunking && isLocalStorageSupported();
        supportsUploadViaPaste = supportsAjaxFileUploading && isChrome14OrHigher();
        supportsUploadCors = supportsUploading && (window.postMessage !== undefined || supportsAjaxFileUploading);
        supportsDeleteFileCorsXhr = isCrossOriginXhrSupported();
        supportsDeleteFileXdr = isXdrSupported();
        supportsDeleteFileCors = isCrossOriginAjaxSupported();
        supportsFolderSelection = isFolderSelectionSupported();
        supportsImagePreviews = supportsAjaxFileUploading && window.FileReader !== undefined;
        supportsUploadProgress = function() {
            if (supportsAjaxFileUploading) {
                return !qq.androidStock() && !qq.iosChrome();
            }
            return false;
        }();
        return {
            ajaxUploading: supportsAjaxFileUploading,
            blobUploading: supportsUploadingBlobs,
            canDetermineSize: supportsAjaxFileUploading,
            chunking: supportsChunking,
            deleteFileCors: supportsDeleteFileCors,
            deleteFileCorsXdr: supportsDeleteFileXdr,
            deleteFileCorsXhr: supportsDeleteFileCorsXhr,
            dialogElement: !!window.HTMLDialogElement,
            fileDrop: supportsFileDrop,
            folderDrop: supportsFolderDrop,
            folderSelection: supportsFolderSelection,
            imagePreviews: supportsImagePreviews,
            imageValidation: supportsImagePreviews,
            itemSizeValidation: supportsAjaxFileUploading,
            pause: supportsChunking,
            progressBar: supportsUploadProgress,
            resume: supportsResume,
            scaling: supportsImagePreviews && supportsUploadingBlobs,
            tiffPreviews: qq.safari(),
            unlimitedScaledImageSize: !qq.ios(),
            uploading: supportsUploading,
            uploadCors: supportsUploadCors,
            uploadCustomHeaders: supportsAjaxFileUploading,
            uploadNonMultipart: supportsAjaxFileUploading,
            uploadViaPaste: supportsUploadViaPaste
        };
    }();
    qq.isGenericPromise = function(maybePromise) {
        "use strict";
        return !!(maybePromise && maybePromise.then && qq.isFunction(maybePromise.then));
    };
    qq.Promise = function() {
        "use strict";
        var successArgs, failureArgs, successCallbacks = [], failureCallbacks = [], doneCallbacks = [], state = 0;
        qq.extend(this, {
            then: function(onSuccess, onFailure) {
                if (state === 0) {
                    if (onSuccess) {
                        successCallbacks.push(onSuccess);
                    }
                    if (onFailure) {
                        failureCallbacks.push(onFailure);
                    }
                } else if (state === -1) {
                    onFailure && onFailure.apply(null, failureArgs);
                } else if (onSuccess) {
                    onSuccess.apply(null, successArgs);
                }
                return this;
            },
            done: function(callback) {
                if (state === 0) {
                    doneCallbacks.push(callback);
                } else {
                    callback.apply(null, failureArgs === undefined ? successArgs : failureArgs);
                }
                return this;
            },
            success: function() {
                state = 1;
                successArgs = arguments;
                if (successCallbacks.length) {
                    qq.each(successCallbacks, function(idx, callback) {
                        callback.apply(null, successArgs);
                    });
                }
                if (doneCallbacks.length) {
                    qq.each(doneCallbacks, function(idx, callback) {
                        callback.apply(null, successArgs);
                    });
                }
                return this;
            },
            failure: function() {
                state = -1;
                failureArgs = arguments;
                if (failureCallbacks.length) {
                    qq.each(failureCallbacks, function(idx, callback) {
                        callback.apply(null, failureArgs);
                    });
                }
                if (doneCallbacks.length) {
                    qq.each(doneCallbacks, function(idx, callback) {
                        callback.apply(null, failureArgs);
                    });
                }
                return this;
            }
        });
    };
    qq.BlobProxy = function(referenceBlob, onCreate) {
        "use strict";
        qq.extend(this, {
            referenceBlob: referenceBlob,
            create: function() {
                return onCreate(referenceBlob);
            }
        });
    };
    qq.UploadButton = function(o) {
        "use strict";
        var self = this, disposeSupport = new qq.DisposeSupport(), options = {
            acceptFiles: null,
            element: null,
            focusClass: "qq-upload-button-focus",
            folders: false,
            hoverClass: "qq-upload-button-hover",
            ios8BrowserCrashWorkaround: false,
            multiple: false,
            name: "qqfile",
            onChange: function(input) {},
            title: null
        }, input, buttonId;
        qq.extend(options, o);
        buttonId = qq.getUniqueId();
        function createInput() {
            var input = document.createElement("input");
            input.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME, buttonId);
            input.setAttribute("title", options.title);
            self.setMultiple(options.multiple, input);
            if (options.folders && qq.supportedFeatures.folderSelection) {
                input.setAttribute("webkitdirectory", "");
            }
            if (options.acceptFiles) {
                input.setAttribute("accept", options.acceptFiles);
            }
            input.setAttribute("type", "file");
            input.setAttribute("name", options.name);
            qq(input).css({
                position: "absolute",
                right: 0,
                top: 0,
                fontFamily: "Arial",
                fontSize: qq.ie() && !qq.ie8() ? "3500px" : "118px",
                margin: 0,
                padding: 0,
                cursor: "pointer",
                opacity: 0
            });
            !qq.ie7() && qq(input).css({
                height: "100%"
            });
            options.element.appendChild(input);
            disposeSupport.attach(input, "change", function() {
                options.onChange(input);
            });
            disposeSupport.attach(input, "mouseover", function() {
                qq(options.element).addClass(options.hoverClass);
            });
            disposeSupport.attach(input, "mouseout", function() {
                qq(options.element).removeClass(options.hoverClass);
            });
            disposeSupport.attach(input, "focus", function() {
                qq(options.element).addClass(options.focusClass);
            });
            disposeSupport.attach(input, "blur", function() {
                qq(options.element).removeClass(options.focusClass);
            });
            return input;
        }
        qq(options.element).css({
            position: "relative",
            overflow: "hidden",
            direction: "ltr"
        });
        qq.extend(this, {
            getInput: function() {
                return input;
            },
            getButtonId: function() {
                return buttonId;
            },
            setMultiple: function(isMultiple, optInput) {
                var input = optInput || this.getInput();
                if (options.ios8BrowserCrashWorkaround && qq.ios8() && (qq.iosChrome() || qq.iosSafariWebView())) {
                    input.setAttribute("multiple", "");
                } else {
                    if (isMultiple) {
                        input.setAttribute("multiple", "");
                    } else {
                        input.removeAttribute("multiple");
                    }
                }
            },
            setAcceptFiles: function(acceptFiles) {
                if (acceptFiles !== options.acceptFiles) {
                    input.setAttribute("accept", acceptFiles);
                }
            },
            reset: function() {
                if (input.parentNode) {
                    qq(input).remove();
                }
                qq(options.element).removeClass(options.focusClass);
                input = null;
                input = createInput();
            }
        });
        input = createInput();
    };
    qq.UploadButton.BUTTON_ID_ATTR_NAME = "qq-button-id";
    qq.UploadData = function(uploaderProxy) {
        "use strict";
        var data = [], byUuid = {}, byStatus = {}, byProxyGroupId = {}, byBatchId = {};
        function getDataByIds(idOrIds) {
            if (qq.isArray(idOrIds)) {
                var entries = [];
                qq.each(idOrIds, function(idx, id) {
                    entries.push(data[id]);
                });
                return entries;
            }
            return data[idOrIds];
        }
        function getDataByUuids(uuids) {
            if (qq.isArray(uuids)) {
                var entries = [];
                qq.each(uuids, function(idx, uuid) {
                    entries.push(data[byUuid[uuid]]);
                });
                return entries;
            }
            return data[byUuid[uuids]];
        }
        function getDataByStatus(status) {
            var statusResults = [], statuses = [].concat(status);
            qq.each(statuses, function(index, statusEnum) {
                var statusResultIndexes = byStatus[statusEnum];
                if (statusResultIndexes !== undefined) {
                    qq.each(statusResultIndexes, function(i, dataIndex) {
                        statusResults.push(data[dataIndex]);
                    });
                }
            });
            return statusResults;
        }
        qq.extend(this, {
            addFile: function(spec) {
                var status = spec.status || qq.status.SUBMITTING, id = data.push({
                    name: spec.name,
                    originalName: spec.name,
                    uuid: spec.uuid,
                    size: spec.size == null ? -1 : spec.size,
                    status: status,
                    file: spec.file
                }) - 1;
                if (spec.batchId) {
                    data[id].batchId = spec.batchId;
                    if (byBatchId[spec.batchId] === undefined) {
                        byBatchId[spec.batchId] = [];
                    }
                    byBatchId[spec.batchId].push(id);
                }
                if (spec.proxyGroupId) {
                    data[id].proxyGroupId = spec.proxyGroupId;
                    if (byProxyGroupId[spec.proxyGroupId] === undefined) {
                        byProxyGroupId[spec.proxyGroupId] = [];
                    }
                    byProxyGroupId[spec.proxyGroupId].push(id);
                }
                data[id].id = id;
                byUuid[spec.uuid] = id;
                if (byStatus[status] === undefined) {
                    byStatus[status] = [];
                }
                byStatus[status].push(id);
                spec.onBeforeStatusChange && spec.onBeforeStatusChange(id);
                uploaderProxy.onStatusChange(id, null, status);
                return id;
            },
            retrieve: function(optionalFilter) {
                if (qq.isObject(optionalFilter) && data.length) {
                    if (optionalFilter.id !== undefined) {
                        return getDataByIds(optionalFilter.id);
                    } else if (optionalFilter.uuid !== undefined) {
                        return getDataByUuids(optionalFilter.uuid);
                    } else if (optionalFilter.status) {
                        return getDataByStatus(optionalFilter.status);
                    }
                } else {
                    return qq.extend([], data, true);
                }
            },
            removeFileRef: function(id) {
                var record = getDataByIds(id);
                if (record) {
                    delete record.file;
                }
            },
            reset: function() {
                data = [];
                byUuid = {};
                byStatus = {};
                byBatchId = {};
            },
            setStatus: function(id, newStatus) {
                var oldStatus = data[id].status, byStatusOldStatusIndex = qq.indexOf(byStatus[oldStatus], id);
                byStatus[oldStatus].splice(byStatusOldStatusIndex, 1);
                data[id].status = newStatus;
                if (byStatus[newStatus] === undefined) {
                    byStatus[newStatus] = [];
                }
                byStatus[newStatus].push(id);
                uploaderProxy.onStatusChange(id, oldStatus, newStatus);
            },
            uuidChanged: function(id, newUuid) {
                var oldUuid = data[id].uuid;
                data[id].uuid = newUuid;
                byUuid[newUuid] = id;
                delete byUuid[oldUuid];
            },
            updateName: function(id, newName) {
                data[id].name = newName;
            },
            updateSize: function(id, newSize) {
                data[id].size = newSize;
            },
            setParentId: function(targetId, parentId) {
                data[targetId].parentId = parentId;
            },
            getIdsInProxyGroup: function(id) {
                var proxyGroupId = data[id].proxyGroupId;
                if (proxyGroupId) {
                    return byProxyGroupId[proxyGroupId];
                }
                return [];
            },
            getIdsInBatch: function(id) {
                var batchId = data[id].batchId;
                return byBatchId[batchId];
            }
        });
    };
    qq.status = {
        SUBMITTING: "submitting",
        SUBMITTED: "submitted",
        REJECTED: "rejected",
        QUEUED: "queued",
        CANCELED: "canceled",
        PAUSED: "paused",
        UPLOADING: "uploading",
        UPLOAD_FINALIZING: "upload finalizing",
        UPLOAD_RETRYING: "retrying upload",
        UPLOAD_SUCCESSFUL: "upload successful",
        UPLOAD_FAILED: "upload failed",
        DELETE_FAILED: "delete failed",
        DELETING: "deleting",
        DELETED: "deleted"
    };
    (function() {
        "use strict";
        qq.basePublicApi = {
            addBlobs: function(blobDataOrArray, params, endpoint) {
                this.addFiles(blobDataOrArray, params, endpoint);
            },
            addInitialFiles: function(cannedFileList) {
                var self = this;
                qq.each(cannedFileList, function(index, cannedFile) {
                    self._addCannedFile(cannedFile);
                });
            },
            addFiles: function(data, params, endpoint) {
                this._maybeHandleIos8SafariWorkaround();
                var batchId = this._storedIds.length === 0 ? qq.getUniqueId() : this._currentBatchId, processBlob = qq.bind(function(blob) {
                    this._handleNewFile({
                        blob: blob,
                        name: this._options.blobs.defaultName
                    }, batchId, verifiedFiles);
                }, this), processBlobData = qq.bind(function(blobData) {
                    this._handleNewFile(blobData, batchId, verifiedFiles);
                }, this), processCanvas = qq.bind(function(canvas) {
                    var blob = qq.canvasToBlob(canvas);
                    this._handleNewFile({
                        blob: blob,
                        name: this._options.blobs.defaultName + ".png"
                    }, batchId, verifiedFiles);
                }, this), processCanvasData = qq.bind(function(canvasData) {
                    var normalizedQuality = canvasData.quality && canvasData.quality / 100, blob = qq.canvasToBlob(canvasData.canvas, canvasData.type, normalizedQuality);
                    this._handleNewFile({
                        blob: blob,
                        name: canvasData.name
                    }, batchId, verifiedFiles);
                }, this), processFileOrInput = qq.bind(function(fileOrInput) {
                    if (qq.isInput(fileOrInput) && qq.supportedFeatures.ajaxUploading) {
                        var files = Array.prototype.slice.call(fileOrInput.files), self = this;
                        qq.each(files, function(idx, file) {
                            self._handleNewFile(file, batchId, verifiedFiles);
                        });
                    } else {
                        this._handleNewFile(fileOrInput, batchId, verifiedFiles);
                    }
                }, this), normalizeData = function() {
                    if (qq.isFileList(data)) {
                        data = Array.prototype.slice.call(data);
                    }
                    data = [].concat(data);
                }, self = this, verifiedFiles = [];
                this._currentBatchId = batchId;
                if (data) {
                    normalizeData();
                    qq.each(data, function(idx, fileContainer) {
                        if (qq.isFileOrInput(fileContainer)) {
                            processFileOrInput(fileContainer);
                        } else if (qq.isBlob(fileContainer)) {
                            processBlob(fileContainer);
                        } else if (qq.isObject(fileContainer)) {
                            if (fileContainer.blob && fileContainer.name) {
                                processBlobData(fileContainer);
                            } else if (fileContainer.canvas && fileContainer.name) {
                                processCanvasData(fileContainer);
                            }
                        } else if (fileContainer.tagName && fileContainer.tagName.toLowerCase() === "canvas") {
                            processCanvas(fileContainer);
                        } else {
                            self.log(fileContainer + " is not a valid file container!  Ignoring!", "warn");
                        }
                    });
                    this.log("Received " + verifiedFiles.length + " files.");
                    this._prepareItemsForUpload(verifiedFiles, params, endpoint);
                }
            },
            cancel: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (uploadData && uploadData.status === qq.status.UPLOAD_FINALIZING) {
                    this.log(qq.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.", id, this.getName(id)), "error");
                } else {
                    this._handler.cancel(id);
                }
            },
            cancelAll: function() {
                var storedIdsCopy = [], self = this;
                qq.extend(storedIdsCopy, this._storedIds);
                qq.each(storedIdsCopy, function(idx, storedFileId) {
                    self.cancel(storedFileId);
                });
                this._handler.cancelAll();
            },
            clearStoredFiles: function() {
                this._storedIds = [];
            },
            continueUpload: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (!qq.supportedFeatures.pause || !this._options.chunking.enabled) {
                    return false;
                }
                if (uploadData.status === qq.status.PAUSED) {
                    this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.", id, this.getName(id)));
                    this._uploadFile(id);
                    return true;
                } else {
                    this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.", id, this.getName(id)), "error");
                }
                return false;
            },
            deleteFile: function(id) {
                return this._onSubmitDelete(id);
            },
            doesExist: function(fileOrBlobId) {
                return this._handler.isValid(fileOrBlobId);
            },
            drawThumbnail: function(fileId, imgOrCanvas, maxSize, fromServer, customResizeFunction) {
                var promiseToReturn = new qq.Promise(), fileOrUrl, options;
                if (this._imageGenerator) {
                    fileOrUrl = this._thumbnailUrls[fileId];
                    options = {
                        customResizeFunction: customResizeFunction,
                        maxSize: maxSize > 0 ? maxSize : null,
                        scale: maxSize > 0
                    };
                    if (!fromServer && qq.supportedFeatures.imagePreviews) {
                        fileOrUrl = this.getFile(fileId);
                    }
                    if (fileOrUrl == null) {
                        promiseToReturn.failure({
                            container: imgOrCanvas,
                            error: "File or URL not found."
                        });
                    } else {
                        this._imageGenerator.generate(fileOrUrl, imgOrCanvas, options).then(function success(modifiedContainer) {
                            promiseToReturn.success(modifiedContainer);
                        }, function failure(container, reason) {
                            promiseToReturn.failure({
                                container: container,
                                error: reason || "Problem generating thumbnail"
                            });
                        });
                    }
                } else {
                    promiseToReturn.failure({
                        container: imgOrCanvas,
                        error: "Missing image generator module"
                    });
                }
                return promiseToReturn;
            },
            getButton: function(fileId) {
                return this._getButton(this._buttonIdsForFileIds[fileId]);
            },
            getEndpoint: function(fileId) {
                return this._endpointStore.get(fileId);
            },
            getFile: function(fileOrBlobId) {
                var file = this._handler.getFile(fileOrBlobId);
                var uploadDataRecord;
                if (!file) {
                    uploadDataRecord = this._uploadData.retrieve({
                        id: fileOrBlobId
                    });
                    if (uploadDataRecord) {
                        file = uploadDataRecord.file;
                    }
                }
                return file || null;
            },
            getInProgress: function() {
                return this._uploadData.retrieve({
                    status: [ qq.status.UPLOADING, qq.status.UPLOAD_RETRYING, qq.status.QUEUED ]
                }).length;
            },
            getName: function(id) {
                return this._uploadData.retrieve({
                    id: id
                }).name;
            },
            getParentId: function(id) {
                var uploadDataEntry = this.getUploads({
                    id: id
                }), parentId = null;
                if (uploadDataEntry) {
                    if (uploadDataEntry.parentId !== undefined) {
                        parentId = uploadDataEntry.parentId;
                    }
                }
                return parentId;
            },
            getResumableFilesData: function() {
                return this._handler.getResumableFilesData();
            },
            getSize: function(id) {
                return this._uploadData.retrieve({
                    id: id
                }).size;
            },
            getNetUploads: function() {
                return this._netUploaded;
            },
            getRemainingAllowedItems: function() {
                var allowedItems = this._currentItemLimit;
                if (allowedItems > 0) {
                    return allowedItems - this._netUploadedOrQueued;
                }
                return null;
            },
            getUploads: function(optionalFilter) {
                return this._uploadData.retrieve(optionalFilter);
            },
            getUuid: function(id) {
                return this._uploadData.retrieve({
                    id: id
                }).uuid;
            },
            isResumable: function(id) {
                return this._handler.hasResumeRecord(id);
            },
            log: function(str, level) {
                if (this._options.debug && (!level || level === "info")) {
                    qq.log("[Fine Uploader " + qq.version + "] " + str);
                } else if (level && level !== "info") {
                    qq.log("[Fine Uploader " + qq.version + "] " + str, level);
                }
            },
            pauseUpload: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (!qq.supportedFeatures.pause || !this._options.chunking.enabled) {
                    return false;
                }
                if (qq.indexOf([ qq.status.UPLOADING, qq.status.UPLOAD_RETRYING ], uploadData.status) >= 0) {
                    if (this._handler.pause(id)) {
                        this._uploadData.setStatus(id, qq.status.PAUSED);
                        return true;
                    } else {
                        this.log(qq.format("Unable to pause file ID {} ({}).", id, this.getName(id)), "error");
                    }
                } else {
                    this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.", id, this.getName(id)), "error");
                }
                return false;
            },
            removeFileRef: function(id) {
                this._handler.expunge(id);
                this._uploadData.removeFileRef(id);
            },
            reset: function() {
                this.log("Resetting uploader...");
                this._handler.reset();
                this._storedIds = [];
                this._autoRetries = [];
                this._retryTimeouts = [];
                this._preventRetries = [];
                this._thumbnailUrls = [];
                qq.each(this._buttons, function(idx, button) {
                    button.reset();
                });
                this._paramsStore.reset();
                this._endpointStore.reset();
                this._netUploadedOrQueued = 0;
                this._netUploaded = 0;
                this._uploadData.reset();
                this._buttonIdsForFileIds = [];
                this._pasteHandler && this._pasteHandler.reset();
                this._options.session.refreshOnReset && this._refreshSessionData();
                this._succeededSinceLastAllComplete = [];
                this._failedSinceLastAllComplete = [];
                this._totalProgress && this._totalProgress.reset();
                this._customResumeDataStore.reset();
            },
            retry: function(id) {
                return this._manualRetry(id);
            },
            scaleImage: function(id, specs) {
                var self = this;
                return qq.Scaler.prototype.scaleImage(id, specs, {
                    log: qq.bind(self.log, self),
                    getFile: qq.bind(self.getFile, self),
                    uploadData: self._uploadData
                });
            },
            setCustomHeaders: function(headers, id) {
                this._customHeadersStore.set(headers, id);
            },
            setCustomResumeData: function(id, data) {
                this._customResumeDataStore.set(data, id);
            },
            setDeleteFileCustomHeaders: function(headers, id) {
                this._deleteFileCustomHeadersStore.set(headers, id);
            },
            setDeleteFileEndpoint: function(endpoint, id) {
                this._deleteFileEndpointStore.set(endpoint, id);
            },
            setDeleteFileParams: function(params, id) {
                this._deleteFileParamsStore.set(params, id);
            },
            setEndpoint: function(endpoint, id) {
                this._endpointStore.set(endpoint, id);
            },
            setForm: function(elementOrId) {
                this._updateFormSupportAndParams(elementOrId);
            },
            setItemLimit: function(newItemLimit) {
                this._currentItemLimit = newItemLimit;
            },
            setName: function(id, newName) {
                this._uploadData.updateName(id, newName);
            },
            setParams: function(params, id) {
                this._paramsStore.set(params, id);
            },
            setUuid: function(id, newUuid) {
                return this._uploadData.uuidChanged(id, newUuid);
            },
            setStatus: function(id, newStatus) {
                var fileRecord = this.getUploads({
                    id: id
                });
                if (!fileRecord) {
                    throw new qq.Error(id + " is not a valid file ID.");
                }
                switch (newStatus) {
                  case qq.status.DELETED:
                    this._onDeleteComplete(id, null, false);
                    break;

                  case qq.status.DELETE_FAILED:
                    this._onDeleteComplete(id, null, true);
                    break;

                  default:
                    var errorMessage = "Method setStatus called on '" + name + "' not implemented yet for " + newStatus;
                    this.log(errorMessage);
                    throw new qq.Error(errorMessage);
                }
            },
            uploadStoredFiles: function() {
                if (this._storedIds.length === 0) {
                    this._itemError("noFilesError");
                } else {
                    this._uploadStoredFiles();
                }
            }
        };
        qq.basePrivateApi = {
            _addCannedFile: function(sessionData) {
                var self = this;
                return this._uploadData.addFile({
                    uuid: sessionData.uuid,
                    name: sessionData.name,
                    size: sessionData.size,
                    status: qq.status.UPLOAD_SUCCESSFUL,
                    onBeforeStatusChange: function(id) {
                        sessionData.deleteFileEndpoint && self.setDeleteFileEndpoint(sessionData.deleteFileEndpoint, id);
                        sessionData.deleteFileParams && self.setDeleteFileParams(sessionData.deleteFileParams, id);
                        if (sessionData.thumbnailUrl) {
                            self._thumbnailUrls[id] = sessionData.thumbnailUrl;
                        }
                        self._netUploaded++;
                        self._netUploadedOrQueued++;
                    }
                });
            },
            _annotateWithButtonId: function(file, associatedInput) {
                if (qq.isFile(file)) {
                    file.qqButtonId = this._getButtonId(associatedInput);
                }
            },
            _batchError: function(message) {
                this._options.callbacks.onError(null, null, message, undefined);
            },
            _createDeleteHandler: function() {
                var self = this;
                return new qq.DeleteFileAjaxRequester({
                    method: this._options.deleteFile.method.toUpperCase(),
                    maxConnections: this._options.maxConnections,
                    uuidParamName: this._options.request.uuidName,
                    customHeaders: this._deleteFileCustomHeadersStore,
                    paramsStore: this._deleteFileParamsStore,
                    endpointStore: this._deleteFileEndpointStore,
                    cors: this._options.cors,
                    log: qq.bind(self.log, self),
                    onDelete: function(id) {
                        self._onDelete(id);
                        self._options.callbacks.onDelete(id);
                    },
                    onDeleteComplete: function(id, xhrOrXdr, isError) {
                        self._onDeleteComplete(id, xhrOrXdr, isError);
                        self._options.callbacks.onDeleteComplete(id, xhrOrXdr, isError);
                    }
                });
            },
            _createPasteHandler: function() {
                var self = this;
                return new qq.PasteSupport({
                    targetElement: this._options.paste.targetElement,
                    callbacks: {
                        log: qq.bind(self.log, self),
                        pasteReceived: function(blob) {
                            self._handleCheckedCallback({
                                name: "onPasteReceived",
                                callback: qq.bind(self._options.callbacks.onPasteReceived, self, blob),
                                onSuccess: qq.bind(self._handlePasteSuccess, self, blob),
                                identifier: "pasted image"
                            });
                        }
                    }
                });
            },
            _createStore: function(initialValue, _readOnlyValues_) {
                var store = {}, catchall = initialValue, perIdReadOnlyValues = {}, readOnlyValues = _readOnlyValues_, copy = function(orig) {
                    if (qq.isObject(orig)) {
                        return qq.extend({}, orig);
                    }
                    return orig;
                }, getReadOnlyValues = function() {
                    if (qq.isFunction(readOnlyValues)) {
                        return readOnlyValues();
                    }
                    return readOnlyValues;
                }, includeReadOnlyValues = function(id, existing) {
                    if (readOnlyValues && qq.isObject(existing)) {
                        qq.extend(existing, getReadOnlyValues());
                    }
                    if (perIdReadOnlyValues[id]) {
                        qq.extend(existing, perIdReadOnlyValues[id]);
                    }
                };
                return {
                    set: function(val, id) {
                        if (id == null) {
                            store = {};
                            catchall = copy(val);
                        } else {
                            store[id] = copy(val);
                        }
                    },
                    get: function(id) {
                        var values;
                        if (id != null && store[id]) {
                            values = store[id];
                        } else {
                            values = copy(catchall);
                        }
                        includeReadOnlyValues(id, values);
                        return copy(values);
                    },
                    addReadOnly: function(id, values) {
                        if (qq.isObject(store)) {
                            if (id === null) {
                                if (qq.isFunction(values)) {
                                    readOnlyValues = values;
                                } else {
                                    readOnlyValues = readOnlyValues || {};
                                    qq.extend(readOnlyValues, values);
                                }
                            } else {
                                perIdReadOnlyValues[id] = perIdReadOnlyValues[id] || {};
                                qq.extend(perIdReadOnlyValues[id], values);
                            }
                        }
                    },
                    remove: function(fileId) {
                        return delete store[fileId];
                    },
                    reset: function() {
                        store = {};
                        perIdReadOnlyValues = {};
                        catchall = initialValue;
                    }
                };
            },
            _createUploadDataTracker: function() {
                var self = this;
                return new qq.UploadData({
                    getName: function(id) {
                        return self.getName(id);
                    },
                    getUuid: function(id) {
                        return self.getUuid(id);
                    },
                    getSize: function(id) {
                        return self.getSize(id);
                    },
                    onStatusChange: function(id, oldStatus, newStatus) {
                        self._onUploadStatusChange(id, oldStatus, newStatus);
                        self._options.callbacks.onStatusChange(id, oldStatus, newStatus);
                        self._maybeAllComplete(id, newStatus);
                        if (self._totalProgress) {
                            setTimeout(function() {
                                self._totalProgress.onStatusChange(id, oldStatus, newStatus);
                            }, 0);
                        }
                    }
                });
            },
            _createUploadButton: function(spec) {
                var self = this, acceptFiles = spec.accept || this._options.validation.acceptFiles, allowedExtensions = spec.allowedExtensions || this._options.validation.allowedExtensions, button;
                function allowMultiple() {
                    if (qq.supportedFeatures.ajaxUploading) {
                        if (self._options.workarounds.iosEmptyVideos && qq.ios() && !qq.ios6() && self._isAllowedExtension(allowedExtensions, ".mov")) {
                            return false;
                        }
                        if (spec.multiple === undefined) {
                            return self._options.multiple;
                        }
                        return spec.multiple;
                    }
                    return false;
                }
                button = new qq.UploadButton({
                    acceptFiles: acceptFiles,
                    element: spec.element,
                    focusClass: this._options.classes.buttonFocus,
                    folders: spec.folders,
                    hoverClass: this._options.classes.buttonHover,
                    ios8BrowserCrashWorkaround: this._options.workarounds.ios8BrowserCrash,
                    multiple: allowMultiple(),
                    name: this._options.request.inputName,
                    onChange: function(input) {
                        self._onInputChange(input);
                    },
                    title: spec.title == null ? this._options.text.fileInputTitle : spec.title
                });
                this._disposeSupport.addDisposer(function() {
                    button.dispose();
                });
                self._buttons.push(button);
                return button;
            },
            _createUploadHandler: function(additionalOptions, namespace) {
                var self = this, lastOnProgress = {}, options = {
                    debug: this._options.debug,
                    maxConnections: this._options.maxConnections,
                    cors: this._options.cors,
                    paramsStore: this._paramsStore,
                    endpointStore: this._endpointStore,
                    chunking: this._options.chunking,
                    resume: this._options.resume,
                    blobs: this._options.blobs,
                    log: qq.bind(self.log, self),
                    preventRetryParam: this._options.retry.preventRetryResponseProperty,
                    onProgress: function(id, name, loaded, total) {
                        if (loaded < 0 || total < 0) {
                            return;
                        }
                        if (lastOnProgress[id]) {
                            if (lastOnProgress[id].loaded !== loaded || lastOnProgress[id].total !== total) {
                                self._onProgress(id, name, loaded, total);
                                self._options.callbacks.onProgress(id, name, loaded, total);
                            }
                        } else {
                            self._onProgress(id, name, loaded, total);
                            self._options.callbacks.onProgress(id, name, loaded, total);
                        }
                        lastOnProgress[id] = {
                            loaded: loaded,
                            total: total
                        };
                    },
                    onComplete: function(id, name, result, xhr) {
                        delete lastOnProgress[id];
                        var status = self.getUploads({
                            id: id
                        }).status, retVal;
                        if (status === qq.status.UPLOAD_SUCCESSFUL || status === qq.status.UPLOAD_FAILED) {
                            return;
                        }
                        retVal = self._onComplete(id, name, result, xhr);
                        if (retVal instanceof qq.Promise) {
                            retVal.done(function() {
                                self._options.callbacks.onComplete(id, name, result, xhr);
                            });
                        } else {
                            self._options.callbacks.onComplete(id, name, result, xhr);
                        }
                    },
                    onCancel: function(id, name, cancelFinalizationEffort) {
                        var promise = new qq.Promise();
                        self._handleCheckedCallback({
                            name: "onCancel",
                            callback: qq.bind(self._options.callbacks.onCancel, self, id, name),
                            onFailure: promise.failure,
                            onSuccess: function() {
                                cancelFinalizationEffort.then(function() {
                                    self._onCancel(id, name);
                                });
                                promise.success();
                            },
                            identifier: id
                        });
                        return promise;
                    },
                    onUploadPrep: qq.bind(this._onUploadPrep, this),
                    onUpload: function(id, name) {
                        self._onUpload(id, name);
                        var onUploadResult = self._options.callbacks.onUpload(id, name);
                        if (qq.isGenericPromise(onUploadResult)) {
                            self.log(qq.format("onUpload for {} returned a Promise - waiting for resolution.", id));
                            return onUploadResult;
                        }
                        return new qq.Promise().success();
                    },
                    onUploadChunk: function(id, name, chunkData) {
                        self._onUploadChunk(id, chunkData);
                        var onUploadChunkResult = self._options.callbacks.onUploadChunk(id, name, chunkData);
                        if (qq.isGenericPromise(onUploadChunkResult)) {
                            self.log(qq.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.", id, chunkData.partIndex));
                            return onUploadChunkResult;
                        }
                        return new qq.Promise().success();
                    },
                    onUploadChunkSuccess: function(id, chunkData, result, xhr) {
                        self._onUploadChunkSuccess(id, chunkData);
                        self._options.callbacks.onUploadChunkSuccess.apply(self, arguments);
                    },
                    onResume: function(id, name, chunkData, customResumeData) {
                        return self._options.callbacks.onResume(id, name, chunkData, customResumeData);
                    },
                    onAutoRetry: function(id, name, responseJSON, xhr) {
                        return self._onAutoRetry.apply(self, arguments);
                    },
                    onUuidChanged: function(id, newUuid) {
                        self.log("Server requested UUID change from '" + self.getUuid(id) + "' to '" + newUuid + "'");
                        self.setUuid(id, newUuid);
                    },
                    getName: qq.bind(self.getName, self),
                    getUuid: qq.bind(self.getUuid, self),
                    getSize: qq.bind(self.getSize, self),
                    setSize: qq.bind(self._setSize, self),
                    getDataByUuid: function(uuid) {
                        return self.getUploads({
                            uuid: uuid
                        });
                    },
                    isQueued: function(id) {
                        var status = self.getUploads({
                            id: id
                        }).status;
                        return status === qq.status.QUEUED || status === qq.status.SUBMITTED || status === qq.status.UPLOAD_RETRYING || status === qq.status.PAUSED;
                    },
                    getIdsInProxyGroup: self._uploadData.getIdsInProxyGroup,
                    getIdsInBatch: self._uploadData.getIdsInBatch,
                    isInProgress: function(id) {
                        return self.getUploads({
                            id: id
                        }).status === qq.status.UPLOADING;
                    },
                    getCustomResumeData: qq.bind(self._getCustomResumeData, self),
                    setStatus: function(id, status) {
                        self._uploadData.setStatus(id, status);
                    }
                };
                qq.each(this._options.request, function(prop, val) {
                    options[prop] = val;
                });
                options.customHeaders = this._customHeadersStore;
                if (additionalOptions) {
                    qq.each(additionalOptions, function(key, val) {
                        options[key] = val;
                    });
                }
                return new qq.UploadHandlerController(options, namespace);
            },
            _fileOrBlobRejected: function(id) {
                this._netUploadedOrQueued--;
                this._uploadData.setStatus(id, qq.status.REJECTED);
            },
            _formatSize: function(bytes) {
                if (bytes === 0) {
                    return bytes + this._options.text.sizeSymbols[0];
                }
                var i = -1;
                do {
                    bytes = bytes / 1e3;
                    i++;
                } while (bytes > 999);
                return Math.max(bytes, .1).toFixed(1) + this._options.text.sizeSymbols[i];
            },
            _generateExtraButtonSpecs: function() {
                var self = this;
                this._extraButtonSpecs = {};
                qq.each(this._options.extraButtons, function(idx, extraButtonOptionEntry) {
                    var multiple = extraButtonOptionEntry.multiple, validation = qq.extend({}, self._options.validation, true), extraButtonSpec = qq.extend({}, extraButtonOptionEntry);
                    if (multiple === undefined) {
                        multiple = self._options.multiple;
                    }
                    if (extraButtonSpec.validation) {
                        qq.extend(validation, extraButtonOptionEntry.validation, true);
                    }
                    qq.extend(extraButtonSpec, {
                        multiple: multiple,
                        validation: validation
                    }, true);
                    self._initExtraButton(extraButtonSpec);
                });
            },
            _getButton: function(buttonId) {
                var extraButtonsSpec = this._extraButtonSpecs[buttonId];
                if (extraButtonsSpec) {
                    return extraButtonsSpec.element;
                } else if (buttonId === this._defaultButtonId) {
                    return this._options.button;
                }
            },
            _getButtonId: function(buttonOrFileInputOrFile) {
                var inputs, fileInput, fileBlobOrInput = buttonOrFileInputOrFile;
                if (fileBlobOrInput instanceof qq.BlobProxy) {
                    fileBlobOrInput = fileBlobOrInput.referenceBlob;
                }
                if (fileBlobOrInput && !qq.isBlob(fileBlobOrInput)) {
                    if (qq.isFile(fileBlobOrInput)) {
                        return fileBlobOrInput.qqButtonId;
                    } else if (fileBlobOrInput.tagName.toLowerCase() === "input" && fileBlobOrInput.type.toLowerCase() === "file") {
                        return fileBlobOrInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);
                    }
                    inputs = fileBlobOrInput.getElementsByTagName("input");
                    qq.each(inputs, function(idx, input) {
                        if (input.getAttribute("type") === "file") {
                            fileInput = input;
                            return false;
                        }
                    });
                    if (fileInput) {
                        return fileInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);
                    }
                }
            },
            _getCustomResumeData: function(fileId) {
                return this._customResumeDataStore.get(fileId);
            },
            _getNotFinished: function() {
                return this._uploadData.retrieve({
                    status: [ qq.status.UPLOADING, qq.status.UPLOAD_RETRYING, qq.status.QUEUED, qq.status.SUBMITTING, qq.status.SUBMITTED, qq.status.PAUSED ]
                }).length;
            },
            _getValidationBase: function(buttonId) {
                var extraButtonSpec = this._extraButtonSpecs[buttonId];
                return extraButtonSpec ? extraButtonSpec.validation : this._options.validation;
            },
            _getValidationDescriptor: function(fileWrapper) {
                if (fileWrapper.file instanceof qq.BlobProxy) {
                    return {
                        name: qq.getFilename(fileWrapper.file.referenceBlob),
                        size: fileWrapper.file.referenceBlob.size
                    };
                }
                return {
                    name: this.getUploads({
                        id: fileWrapper.id
                    }).name,
                    size: this.getUploads({
                        id: fileWrapper.id
                    }).size
                };
            },
            _getValidationDescriptors: function(fileWrappers) {
                var self = this, fileDescriptors = [];
                qq.each(fileWrappers, function(idx, fileWrapper) {
                    fileDescriptors.push(self._getValidationDescriptor(fileWrapper));
                });
                return fileDescriptors;
            },
            _handleCameraAccess: function() {
                if (this._options.camera.ios && qq.ios()) {
                    var acceptIosCamera = "image/*;capture=camera", button = this._options.camera.button, buttonId = button ? this._getButtonId(button) : this._defaultButtonId, optionRoot = this._options;
                    if (buttonId && buttonId !== this._defaultButtonId) {
                        optionRoot = this._extraButtonSpecs[buttonId];
                    }
                    optionRoot.multiple = false;
                    if (optionRoot.validation.acceptFiles === null) {
                        optionRoot.validation.acceptFiles = acceptIosCamera;
                    } else {
                        optionRoot.validation.acceptFiles += "," + acceptIosCamera;
                    }
                    qq.each(this._buttons, function(idx, button) {
                        if (button.getButtonId() === buttonId) {
                            button.setMultiple(optionRoot.multiple);
                            button.setAcceptFiles(optionRoot.acceptFiles);
                            return false;
                        }
                    });
                }
            },
            _handleCheckedCallback: function(details) {
                var self = this, callbackRetVal = details.callback();
                if (qq.isGenericPromise(callbackRetVal)) {
                    this.log(details.name + " - waiting for " + details.name + " promise to be fulfilled for " + details.identifier);
                    return callbackRetVal.then(function(successParam) {
                        self.log(details.name + " promise success for " + details.identifier);
                        details.onSuccess(successParam);
                    }, function() {
                        if (details.onFailure) {
                            self.log(details.name + " promise failure for " + details.identifier);
                            details.onFailure();
                        } else {
                            self.log(details.name + " promise failure for " + details.identifier);
                        }
                    });
                }
                if (callbackRetVal !== false) {
                    details.onSuccess(callbackRetVal);
                } else {
                    if (details.onFailure) {
                        this.log(details.name + " - return value was 'false' for " + details.identifier + ".  Invoking failure callback.");
                        details.onFailure();
                    } else {
                        this.log(details.name + " - return value was 'false' for " + details.identifier + ".  Will not proceed.");
                    }
                }
                return callbackRetVal;
            },
            _handleNewFile: function(file, batchId, newFileWrapperList) {
                var self = this, uuid = qq.getUniqueId(), size = -1, name = qq.getFilename(file), actualFile = file.blob || file, handler = this._customNewFileHandler ? this._customNewFileHandler : qq.bind(self._handleNewFileGeneric, self);
                if (!qq.isInput(actualFile) && actualFile.size >= 0) {
                    size = actualFile.size;
                }
                handler(actualFile, name, uuid, size, newFileWrapperList, batchId, this._options.request.uuidName, {
                    uploadData: self._uploadData,
                    paramsStore: self._paramsStore,
                    addFileToHandler: function(id, file) {
                        self._handler.add(id, file);
                        self._netUploadedOrQueued++;
                        self._trackButton(id);
                    }
                });
            },
            _handleNewFileGeneric: function(file, name, uuid, size, fileList, batchId) {
                var id = this._uploadData.addFile({
                    uuid: uuid,
                    name: name,
                    size: size,
                    batchId: batchId,
                    file: file
                });
                this._handler.add(id, file);
                this._trackButton(id);
                this._netUploadedOrQueued++;
                fileList.push({
                    id: id,
                    file: file
                });
            },
            _handlePasteSuccess: function(blob, extSuppliedName) {
                var extension = blob.type.split("/")[1], name = extSuppliedName;
                if (name == null) {
                    name = this._options.paste.defaultName;
                }
                name += "." + extension;
                this.addFiles({
                    name: name,
                    blob: blob
                });
            },
            _handleDeleteSuccess: function(id) {
                if (this.getUploads({
                    id: id
                }).status !== qq.status.DELETED) {
                    var name = this.getName(id);
                    this._netUploadedOrQueued--;
                    this._netUploaded--;
                    this._handler.expunge(id);
                    this._uploadData.setStatus(id, qq.status.DELETED);
                    this.log("Delete request for '" + name + "' has succeeded.");
                }
            },
            _handleDeleteFailed: function(id, xhrOrXdr) {
                var name = this.getName(id);
                this._uploadData.setStatus(id, qq.status.DELETE_FAILED);
                this.log("Delete request for '" + name + "' has failed.", "error");
                if (!xhrOrXdr || xhrOrXdr.withCredentials === undefined) {
                    this._options.callbacks.onError(id, name, "Delete request failed", xhrOrXdr);
                } else {
                    this._options.callbacks.onError(id, name, "Delete request failed with response code " + xhrOrXdr.status, xhrOrXdr);
                }
            },
            _initExtraButton: function(spec) {
                var button = this._createUploadButton({
                    accept: spec.validation.acceptFiles,
                    allowedExtensions: spec.validation.allowedExtensions,
                    element: spec.element,
                    folders: spec.folders,
                    multiple: spec.multiple,
                    title: spec.fileInputTitle
                });
                this._extraButtonSpecs[button.getButtonId()] = spec;
            },
            _initFormSupportAndParams: function() {
                this._formSupport = qq.FormSupport && new qq.FormSupport(this._options.form, qq.bind(this.uploadStoredFiles, this), qq.bind(this.log, this));
                if (this._formSupport && this._formSupport.attachedToForm) {
                    this._paramsStore = this._createStore(this._options.request.params, this._formSupport.getFormInputsAsObject);
                    this._options.autoUpload = this._formSupport.newAutoUpload;
                    if (this._formSupport.newEndpoint) {
                        this._options.request.endpoint = this._formSupport.newEndpoint;
                    }
                } else {
                    this._paramsStore = this._createStore(this._options.request.params);
                }
            },
            _isDeletePossible: function() {
                if (!qq.DeleteFileAjaxRequester || !this._options.deleteFile.enabled) {
                    return false;
                }
                if (this._options.cors.expected) {
                    if (qq.supportedFeatures.deleteFileCorsXhr) {
                        return true;
                    }
                    if (qq.supportedFeatures.deleteFileCorsXdr && this._options.cors.allowXdr) {
                        return true;
                    }
                    return false;
                }
                return true;
            },
            _isAllowedExtension: function(allowed, fileName) {
                var valid = false;
                if (!allowed.length) {
                    return true;
                }
                qq.each(allowed, function(idx, allowedExt) {
                    if (qq.isString(allowedExt)) {
                        var extRegex = new RegExp("\\." + allowedExt + "$", "i");
                        if (fileName.match(extRegex) != null) {
                            valid = true;
                            return false;
                        }
                    }
                });
                return valid;
            },
            _itemError: function(code, maybeNameOrNames, item) {
                var message = this._options.messages[code], allowedExtensions = [], names = [].concat(maybeNameOrNames), name = names[0], buttonId = this._getButtonId(item), validationBase = this._getValidationBase(buttonId), extensionsForMessage, placeholderMatch;
                function r(name, replacement) {
                    message = message.replace(name, replacement);
                }
                qq.each(validationBase.allowedExtensions, function(idx, allowedExtension) {
                    if (qq.isString(allowedExtension)) {
                        allowedExtensions.push(allowedExtension);
                    }
                });
                extensionsForMessage = allowedExtensions.join(", ").toLowerCase();
                r("{file}", this._options.formatFileName(name));
                r("{extensions}", extensionsForMessage);
                r("{sizeLimit}", this._formatSize(validationBase.sizeLimit));
                r("{minSizeLimit}", this._formatSize(validationBase.minSizeLimit));
                placeholderMatch = message.match(/(\{\w+\})/g);
                if (placeholderMatch !== null) {
                    qq.each(placeholderMatch, function(idx, placeholder) {
                        r(placeholder, names[idx]);
                    });
                }
                this._options.callbacks.onError(null, name, message, undefined);
                return message;
            },
            _manualRetry: function(id, callback) {
                if (this._onBeforeManualRetry(id)) {
                    this._netUploadedOrQueued++;
                    this._uploadData.setStatus(id, qq.status.UPLOAD_RETRYING);
                    if (callback) {
                        callback(id);
                    } else {
                        this._handler.retry(id);
                    }
                    return true;
                }
            },
            _maybeAllComplete: function(id, status) {
                var self = this, notFinished = this._getNotFinished();
                if (status === qq.status.UPLOAD_SUCCESSFUL) {
                    this._succeededSinceLastAllComplete.push(id);
                } else if (status === qq.status.UPLOAD_FAILED) {
                    this._failedSinceLastAllComplete.push(id);
                }
                if (notFinished === 0 && (this._succeededSinceLastAllComplete.length || this._failedSinceLastAllComplete.length)) {
                    setTimeout(function() {
                        self._onAllComplete(self._succeededSinceLastAllComplete, self._failedSinceLastAllComplete);
                    }, 0);
                }
            },
            _maybeHandleIos8SafariWorkaround: function() {
                var self = this;
                if (this._options.workarounds.ios8SafariUploads && qq.ios800() && qq.iosSafari()) {
                    setTimeout(function() {
                        window.alert(self._options.messages.unsupportedBrowserIos8Safari);
                    }, 0);
                    throw new qq.Error(this._options.messages.unsupportedBrowserIos8Safari);
                }
            },
            _maybeParseAndSendUploadError: function(id, name, response, xhr) {
                if (!response.success) {
                    if (xhr && xhr.status !== 200 && !response.error) {
                        this._options.callbacks.onError(id, name, "XHR returned response code " + xhr.status, xhr);
                    } else {
                        var errorReason = response.error ? response.error : this._options.text.defaultResponseError;
                        this._options.callbacks.onError(id, name, errorReason, xhr);
                    }
                }
            },
            _maybeProcessNextItemAfterOnValidateCallback: function(validItem, items, index, params, endpoint) {
                var self = this;
                if (items.length > index) {
                    if (validItem || !this._options.validation.stopOnFirstInvalidFile) {
                        setTimeout(function() {
                            var validationDescriptor = self._getValidationDescriptor(items[index]), buttonId = self._getButtonId(items[index].file), button = self._getButton(buttonId);
                            self._handleCheckedCallback({
                                name: "onValidate",
                                callback: qq.bind(self._options.callbacks.onValidate, self, validationDescriptor, button),
                                onSuccess: qq.bind(self._onValidateCallbackSuccess, self, items, index, params, endpoint),
                                onFailure: qq.bind(self._onValidateCallbackFailure, self, items, index, params, endpoint),
                                identifier: "Item '" + validationDescriptor.name + "', size: " + validationDescriptor.size
                            });
                        }, 0);
                    } else if (!validItem) {
                        for (;index < items.length; index++) {
                            self._fileOrBlobRejected(items[index].id);
                        }
                    }
                }
            },
            _onAllComplete: function(successful, failed) {
                this._totalProgress && this._totalProgress.onAllComplete(successful, failed, this._preventRetries);
                this._options.callbacks.onAllComplete(qq.extend([], successful), qq.extend([], failed));
                this._succeededSinceLastAllComplete = [];
                this._failedSinceLastAllComplete = [];
            },
            _onAutoRetry: function(id, name, responseJSON, xhr, callback) {
                var self = this;
                self._preventRetries[id] = responseJSON[self._options.retry.preventRetryResponseProperty];
                if (self._shouldAutoRetry(id)) {
                    var retryWaitPeriod = self._options.retry.autoAttemptDelay * 1e3;
                    self._maybeParseAndSendUploadError.apply(self, arguments);
                    self._options.callbacks.onAutoRetry(id, name, self._autoRetries[id]);
                    self._onBeforeAutoRetry(id, name);
                    self._uploadData.setStatus(id, qq.status.UPLOAD_RETRYING);
                    self._retryTimeouts[id] = setTimeout(function() {
                        self.log("Starting retry for " + name + "...");
                        if (callback) {
                            callback(id);
                        } else {
                            self._handler.retry(id);
                        }
                    }, retryWaitPeriod);
                    return true;
                }
            },
            _onBeforeAutoRetry: function(id, name) {
                this.log("Waiting " + this._options.retry.autoAttemptDelay + " seconds before retrying " + name + "...");
            },
            _onBeforeManualRetry: function(id) {
                var itemLimit = this._currentItemLimit, fileName;
                if (this._preventRetries[id]) {
                    this.log("Retries are forbidden for id " + id, "warn");
                    return false;
                } else if (this._handler.isValid(id)) {
                    fileName = this.getName(id);
                    if (this._options.callbacks.onManualRetry(id, fileName) === false) {
                        return false;
                    }
                    if (itemLimit > 0 && this._netUploadedOrQueued + 1 > itemLimit) {
                        this._itemError("retryFailTooManyItems");
                        return false;
                    }
                    this.log("Retrying upload for '" + fileName + "' (id: " + id + ")...");
                    return true;
                } else {
                    this.log("'" + id + "' is not a valid file ID", "error");
                    return false;
                }
            },
            _onCancel: function(id, name) {
                this._netUploadedOrQueued--;
                clearTimeout(this._retryTimeouts[id]);
                var storedItemIndex = qq.indexOf(this._storedIds, id);
                if (!this._options.autoUpload && storedItemIndex >= 0) {
                    this._storedIds.splice(storedItemIndex, 1);
                }
                this._uploadData.setStatus(id, qq.status.CANCELED);
            },
            _onComplete: function(id, name, result, xhr) {
                if (!result.success) {
                    this._netUploadedOrQueued--;
                    this._uploadData.setStatus(id, qq.status.UPLOAD_FAILED);
                    if (result[this._options.retry.preventRetryResponseProperty] === true) {
                        this._preventRetries[id] = true;
                    }
                } else {
                    if (result.thumbnailUrl) {
                        this._thumbnailUrls[id] = result.thumbnailUrl;
                    }
                    this._netUploaded++;
                    this._uploadData.setStatus(id, qq.status.UPLOAD_SUCCESSFUL);
                }
                this._maybeParseAndSendUploadError(id, name, result, xhr);
                return result.success ? true : false;
            },
            _onDelete: function(id) {
                this._uploadData.setStatus(id, qq.status.DELETING);
            },
            _onDeleteComplete: function(id, xhrOrXdr, isError) {
                var name = this.getName(id);
                if (isError) {
                    this._handleDeleteFailed(id, xhrOrXdr);
                } else {
                    this._handleDeleteSuccess(id);
                }
            },
            _onInputChange: function(input) {
                var fileIndex;
                if (qq.supportedFeatures.ajaxUploading) {
                    for (fileIndex = 0; fileIndex < input.files.length; fileIndex++) {
                        this._annotateWithButtonId(input.files[fileIndex], input);
                    }
                    this.addFiles(input.files);
                } else if (input.value.length > 0) {
                    this.addFiles(input);
                }
                qq.each(this._buttons, function(idx, button) {
                    button.reset();
                });
            },
            _onProgress: function(id, name, loaded, total) {
                this._totalProgress && this._totalProgress.onIndividualProgress(id, loaded, total);
            },
            _onSubmit: function(id, name) {},
            _onSubmitCallbackSuccess: function(id, name) {
                this._onSubmit.apply(this, arguments);
                this._uploadData.setStatus(id, qq.status.SUBMITTED);
                this._onSubmitted.apply(this, arguments);
                if (this._options.autoUpload) {
                    this._options.callbacks.onSubmitted.apply(this, arguments);
                    this._uploadFile(id);
                } else {
                    this._storeForLater(id);
                    this._options.callbacks.onSubmitted.apply(this, arguments);
                }
            },
            _onSubmitDelete: function(id, onSuccessCallback, additionalMandatedParams) {
                var uuid = this.getUuid(id), adjustedOnSuccessCallback;
                if (onSuccessCallback) {
                    adjustedOnSuccessCallback = qq.bind(onSuccessCallback, this, id, uuid, additionalMandatedParams);
                }
                if (this._isDeletePossible()) {
                    this._handleCheckedCallback({
                        name: "onSubmitDelete",
                        callback: qq.bind(this._options.callbacks.onSubmitDelete, this, id),
                        onSuccess: adjustedOnSuccessCallback || qq.bind(this._deleteHandler.sendDelete, this, id, uuid, additionalMandatedParams),
                        identifier: id
                    });
                    return true;
                } else {
                    this.log("Delete request ignored for ID " + id + ", delete feature is disabled or request not possible " + "due to CORS on a user agent that does not support pre-flighting.", "warn");
                    return false;
                }
            },
            _onSubmitted: function(id) {},
            _onTotalProgress: function(loaded, total) {
                this._options.callbacks.onTotalProgress(loaded, total);
            },
            _onUploadPrep: function(id) {},
            _onUpload: function(id, name) {
                this._uploadData.setStatus(id, qq.status.UPLOADING);
            },
            _onUploadChunk: function(id, chunkData) {},
            _onUploadChunkSuccess: function(id, chunkData) {
                if (!this._preventRetries[id] && this._options.retry.enableAuto) {
                    this._autoRetries[id] = 0;
                }
            },
            _onUploadStatusChange: function(id, oldStatus, newStatus) {
                if (newStatus === qq.status.PAUSED) {
                    clearTimeout(this._retryTimeouts[id]);
                }
            },
            _onValidateBatchCallbackFailure: function(fileWrappers) {
                var self = this;
                qq.each(fileWrappers, function(idx, fileWrapper) {
                    self._fileOrBlobRejected(fileWrapper.id);
                });
            },
            _onValidateBatchCallbackSuccess: function(validationDescriptors, items, params, endpoint, button) {
                var errorMessage, itemLimit = this._currentItemLimit, proposedNetFilesUploadedOrQueued = this._netUploadedOrQueued;
                if (itemLimit === 0 || proposedNetFilesUploadedOrQueued <= itemLimit) {
                    if (items.length > 0) {
                        this._handleCheckedCallback({
                            name: "onValidate",
                            callback: qq.bind(this._options.callbacks.onValidate, this, validationDescriptors[0], button),
                            onSuccess: qq.bind(this._onValidateCallbackSuccess, this, items, 0, params, endpoint),
                            onFailure: qq.bind(this._onValidateCallbackFailure, this, items, 0, params, endpoint),
                            identifier: "Item '" + items[0].file.name + "', size: " + items[0].file.size
                        });
                    } else {
                        this._itemError("noFilesError");
                    }
                } else {
                    this._onValidateBatchCallbackFailure(items);
                    errorMessage = this._options.messages.tooManyItemsError.replace(/\{netItems\}/g, proposedNetFilesUploadedOrQueued).replace(/\{itemLimit\}/g, itemLimit);
                    this._batchError(errorMessage);
                }
            },
            _onValidateCallbackFailure: function(items, index, params, endpoint) {
                var nextIndex = index + 1;
                this._fileOrBlobRejected(items[index].id, items[index].file.name);
                this._maybeProcessNextItemAfterOnValidateCallback(false, items, nextIndex, params, endpoint);
            },
            _onValidateCallbackSuccess: function(items, index, params, endpoint) {
                var self = this, nextIndex = index + 1, validationDescriptor = this._getValidationDescriptor(items[index]);
                this._validateFileOrBlobData(items[index], validationDescriptor).then(function() {
                    self._upload(items[index].id, params, endpoint);
                    self._maybeProcessNextItemAfterOnValidateCallback(true, items, nextIndex, params, endpoint);
                }, function() {
                    self._maybeProcessNextItemAfterOnValidateCallback(false, items, nextIndex, params, endpoint);
                });
            },
            _prepareItemsForUpload: function(items, params, endpoint) {
                if (items.length === 0) {
                    this._itemError("noFilesError");
                    return;
                }
                var validationDescriptors = this._getValidationDescriptors(items), buttonId = this._getButtonId(items[0].file), button = this._getButton(buttonId);
                this._handleCheckedCallback({
                    name: "onValidateBatch",
                    callback: qq.bind(this._options.callbacks.onValidateBatch, this, validationDescriptors, button),
                    onSuccess: qq.bind(this._onValidateBatchCallbackSuccess, this, validationDescriptors, items, params, endpoint, button),
                    onFailure: qq.bind(this._onValidateBatchCallbackFailure, this, items),
                    identifier: "batch validation"
                });
            },
            _preventLeaveInProgress: function() {
                var self = this;
                this._disposeSupport.attach(window, "beforeunload", function(e) {
                    if (self.getInProgress()) {
                        e = e || window.event;
                        e.returnValue = self._options.messages.onLeave;
                        return self._options.messages.onLeave;
                    }
                });
            },
            _refreshSessionData: function() {
                var self = this, options = this._options.session;
                if (qq.Session && this._options.session.endpoint != null) {
                    if (!this._session) {
                        qq.extend(options, {
                            cors: this._options.cors
                        });
                        options.log = qq.bind(this.log, this);
                        options.addFileRecord = qq.bind(this._addCannedFile, this);
                        this._session = new qq.Session(options);
                    }
                    setTimeout(function() {
                        self._session.refresh().then(function(response, xhrOrXdr) {
                            self._sessionRequestComplete();
                            self._options.callbacks.onSessionRequestComplete(response, true, xhrOrXdr);
                        }, function(response, xhrOrXdr) {
                            self._options.callbacks.onSessionRequestComplete(response, false, xhrOrXdr);
                        });
                    }, 0);
                }
            },
            _sessionRequestComplete: function() {},
            _setSize: function(id, newSize) {
                this._uploadData.updateSize(id, newSize);
                this._totalProgress && this._totalProgress.onNewSize(id);
            },
            _shouldAutoRetry: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (!this._preventRetries[id] && this._options.retry.enableAuto && uploadData.status !== qq.status.PAUSED) {
                    if (this._autoRetries[id] === undefined) {
                        this._autoRetries[id] = 0;
                    }
                    if (this._autoRetries[id] < this._options.retry.maxAutoAttempts) {
                        this._autoRetries[id] += 1;
                        return true;
                    }
                }
                return false;
            },
            _storeForLater: function(id) {
                this._storedIds.push(id);
            },
            _trackButton: function(id) {
                var buttonId;
                if (qq.supportedFeatures.ajaxUploading) {
                    buttonId = this._handler.getFile(id).qqButtonId;
                } else {
                    buttonId = this._getButtonId(this._handler.getInput(id));
                }
                if (buttonId) {
                    this._buttonIdsForFileIds[id] = buttonId;
                }
            },
            _updateFormSupportAndParams: function(formElementOrId) {
                this._options.form.element = formElementOrId;
                this._formSupport = qq.FormSupport && new qq.FormSupport(this._options.form, qq.bind(this.uploadStoredFiles, this), qq.bind(this.log, this));
                if (this._formSupport && this._formSupport.attachedToForm) {
                    this._paramsStore.addReadOnly(null, this._formSupport.getFormInputsAsObject);
                    this._options.autoUpload = this._formSupport.newAutoUpload;
                    if (this._formSupport.newEndpoint) {
                        this.setEndpoint(this._formSupport.newEndpoint);
                    }
                }
            },
            _upload: function(id, params, endpoint) {
                var name = this.getName(id);
                if (params) {
                    this.setParams(params, id);
                }
                if (endpoint) {
                    this.setEndpoint(endpoint, id);
                }
                this._handleCheckedCallback({
                    name: "onSubmit",
                    callback: qq.bind(this._options.callbacks.onSubmit, this, id, name),
                    onSuccess: qq.bind(this._onSubmitCallbackSuccess, this, id, name),
                    onFailure: qq.bind(this._fileOrBlobRejected, this, id, name),
                    identifier: id
                });
            },
            _uploadFile: function(id) {
                if (!this._handler.upload(id)) {
                    this._uploadData.setStatus(id, qq.status.QUEUED);
                }
            },
            _uploadStoredFiles: function() {
                var idToUpload, stillSubmitting, self = this;
                while (this._storedIds.length) {
                    idToUpload = this._storedIds.shift();
                    this._uploadFile(idToUpload);
                }
                stillSubmitting = this.getUploads({
                    status: qq.status.SUBMITTING
                }).length;
                if (stillSubmitting) {
                    qq.log("Still waiting for " + stillSubmitting + " files to clear submit queue. Will re-parse stored IDs array shortly.");
                    setTimeout(function() {
                        self._uploadStoredFiles();
                    }, 1e3);
                }
            },
            _validateFileOrBlobData: function(fileWrapper, validationDescriptor) {
                var self = this, file = function() {
                    if (fileWrapper.file instanceof qq.BlobProxy) {
                        return fileWrapper.file.referenceBlob;
                    }
                    return fileWrapper.file;
                }(), name = validationDescriptor.name, size = validationDescriptor.size, buttonId = this._getButtonId(fileWrapper.file), validationBase = this._getValidationBase(buttonId), validityChecker = new qq.Promise();
                validityChecker.then(function() {}, function() {
                    self._fileOrBlobRejected(fileWrapper.id, name);
                });
                if (qq.isFileOrInput(file) && !this._isAllowedExtension(validationBase.allowedExtensions, name)) {
                    this._itemError("typeError", name, file);
                    return validityChecker.failure();
                }
                if (!this._options.validation.allowEmpty && size === 0) {
                    this._itemError("emptyError", name, file);
                    return validityChecker.failure();
                }
                if (size > 0 && validationBase.sizeLimit && size > validationBase.sizeLimit) {
                    this._itemError("sizeError", name, file);
                    return validityChecker.failure();
                }
                if (size > 0 && size < validationBase.minSizeLimit) {
                    this._itemError("minSizeError", name, file);
                    return validityChecker.failure();
                }
                if (qq.ImageValidation && qq.supportedFeatures.imagePreviews && qq.isFile(file)) {
                    new qq.ImageValidation(file, qq.bind(self.log, self)).validate(validationBase.image).then(validityChecker.success, function(errorCode) {
                        self._itemError(errorCode + "ImageError", name, file);
                        validityChecker.failure();
                    });
                } else {
                    validityChecker.success();
                }
                return validityChecker;
            },
            _wrapCallbacks: function() {
                var self, safeCallback, prop;
                self = this;
                safeCallback = function(name, callback, args) {
                    var errorMsg;
                    try {
                        return callback.apply(self, args);
                    } catch (exception) {
                        errorMsg = exception.message || exception.toString();
                        self.log("Caught exception in '" + name + "' callback - " + errorMsg, "error");
                    }
                };
                for (prop in this._options.callbacks) {
                    (function() {
                        var callbackName, callbackFunc;
                        callbackName = prop;
                        callbackFunc = self._options.callbacks[callbackName];
                        self._options.callbacks[callbackName] = function() {
                            return safeCallback(callbackName, callbackFunc, arguments);
                        };
                    })();
                }
            }
        };
    })();
    (function() {
        "use strict";
        qq.FineUploaderBasic = function(o) {
            var self = this;
            this._options = {
                debug: false,
                button: null,
                multiple: true,
                maxConnections: 3,
                disableCancelForFormUploads: false,
                autoUpload: true,
                warnBeforeUnload: true,
                request: {
                    customHeaders: {},
                    endpoint: "/server/upload",
                    filenameParam: "qqfilename",
                    forceMultipart: true,
                    inputName: "qqfile",
                    method: "POST",
                    omitDefaultParams: false,
                    params: {},
                    paramsInBody: true,
                    requireSuccessJson: true,
                    totalFileSizeName: "qqtotalfilesize",
                    uuidName: "qquuid"
                },
                validation: {
                    allowedExtensions: [],
                    sizeLimit: 0,
                    minSizeLimit: 0,
                    itemLimit: 0,
                    stopOnFirstInvalidFile: true,
                    acceptFiles: null,
                    image: {
                        maxHeight: 0,
                        maxWidth: 0,
                        minHeight: 0,
                        minWidth: 0
                    },
                    allowEmpty: false
                },
                callbacks: {
                    onSubmit: function(id, name) {},
                    onSubmitted: function(id, name) {},
                    onComplete: function(id, name, responseJSON, maybeXhr) {},
                    onAllComplete: function(successful, failed) {},
                    onCancel: function(id, name) {},
                    onUpload: function(id, name) {},
                    onUploadChunk: function(id, name, chunkData) {},
                    onUploadChunkSuccess: function(id, chunkData, responseJSON, xhr) {},
                    onResume: function(id, fileName, chunkData, customResumeData) {},
                    onProgress: function(id, name, loaded, total) {},
                    onTotalProgress: function(loaded, total) {},
                    onError: function(id, name, reason, maybeXhrOrXdr) {},
                    onAutoRetry: function(id, name, attemptNumber) {},
                    onManualRetry: function(id, name) {},
                    onValidateBatch: function(fileOrBlobData) {},
                    onValidate: function(fileOrBlobData) {},
                    onSubmitDelete: function(id) {},
                    onDelete: function(id) {},
                    onDeleteComplete: function(id, xhrOrXdr, isError) {},
                    onPasteReceived: function(blob) {},
                    onStatusChange: function(id, oldStatus, newStatus) {},
                    onSessionRequestComplete: function(response, success, xhrOrXdr) {}
                },
                messages: {
                    typeError: "{file} has an invalid extension. Valid extension(s): {extensions}.",
                    sizeError: "{file} is too large, maximum file size is {sizeLimit}.",
                    minSizeError: "{file} is too small, minimum file size is {minSizeLimit}.",
                    emptyError: "{file} is empty, please select files again without it.",
                    noFilesError: "No files to upload.",
                    tooManyItemsError: "Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",
                    maxHeightImageError: "Image is too tall.",
                    maxWidthImageError: "Image is too wide.",
                    minHeightImageError: "Image is not tall enough.",
                    minWidthImageError: "Image is not wide enough.",
                    retryFailTooManyItems: "Retry failed - you have reached your file limit.",
                    onLeave: "The files are being uploaded, if you leave now the upload will be canceled.",
                    unsupportedBrowserIos8Safari: "Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."
                },
                retry: {
                    enableAuto: false,
                    maxAutoAttempts: 3,
                    autoAttemptDelay: 5,
                    preventRetryResponseProperty: "preventRetry"
                },
                classes: {
                    buttonHover: "qq-upload-button-hover",
                    buttonFocus: "qq-upload-button-focus"
                },
                chunking: {
                    enabled: false,
                    concurrent: {
                        enabled: false
                    },
                    mandatory: false,
                    paramNames: {
                        partIndex: "qqpartindex",
                        partByteOffset: "qqpartbyteoffset",
                        chunkSize: "qqchunksize",
                        totalFileSize: "qqtotalfilesize",
                        totalParts: "qqtotalparts"
                    },
                    partSize: function(id) {
                        return 2e6;
                    },
                    success: {
                        endpoint: null,
                        headers: function(id) {
                            return null;
                        },
                        jsonPayload: false,
                        method: "POST",
                        params: function(id) {
                            return null;
                        },
                        resetOnStatus: []
                    }
                },
                resume: {
                    enabled: false,
                    recordsExpireIn: 7,
                    paramNames: {
                        resuming: "qqresume"
                    },
                    customKeys: function(fileId) {
                        return [];
                    }
                },
                formatFileName: function(fileOrBlobName) {
                    return fileOrBlobName;
                },
                text: {
                    defaultResponseError: "Upload failure reason unknown",
                    fileInputTitle: "file input",
                    sizeSymbols: [ "kB", "MB", "GB", "TB", "PB", "EB" ]
                },
                deleteFile: {
                    enabled: false,
                    method: "DELETE",
                    endpoint: "/server/upload",
                    customHeaders: {},
                    params: {}
                },
                cors: {
                    expected: false,
                    sendCredentials: false,
                    allowXdr: false
                },
                blobs: {
                    defaultName: "misc_data"
                },
                paste: {
                    targetElement: null,
                    defaultName: "pasted_image"
                },
                camera: {
                    ios: false,
                    button: null
                },
                extraButtons: [],
                session: {
                    endpoint: null,
                    params: {},
                    customHeaders: {},
                    refreshOnReset: true
                },
                form: {
                    element: "qq-form",
                    autoUpload: false,
                    interceptSubmit: true
                },
                scaling: {
                    customResizer: null,
                    sendOriginal: true,
                    orient: true,
                    defaultType: null,
                    defaultQuality: 80,
                    failureText: "Failed to scale",
                    includeExif: false,
                    sizes: []
                },
                workarounds: {
                    iosEmptyVideos: true,
                    ios8SafariUploads: true,
                    ios8BrowserCrash: false
                }
            };
            qq.extend(this._options, o, true);
            this._buttons = [];
            this._extraButtonSpecs = {};
            this._buttonIdsForFileIds = [];
            this._wrapCallbacks();
            this._disposeSupport = new qq.DisposeSupport();
            this._storedIds = [];
            this._autoRetries = [];
            this._retryTimeouts = [];
            this._preventRetries = [];
            this._thumbnailUrls = [];
            this._netUploadedOrQueued = 0;
            this._netUploaded = 0;
            this._uploadData = this._createUploadDataTracker();
            this._initFormSupportAndParams();
            this._customHeadersStore = this._createStore(this._options.request.customHeaders);
            this._deleteFileCustomHeadersStore = this._createStore(this._options.deleteFile.customHeaders);
            this._deleteFileParamsStore = this._createStore(this._options.deleteFile.params);
            this._endpointStore = this._createStore(this._options.request.endpoint);
            this._deleteFileEndpointStore = this._createStore(this._options.deleteFile.endpoint);
            this._handler = this._createUploadHandler();
            this._deleteHandler = qq.DeleteFileAjaxRequester && this._createDeleteHandler();
            if (this._options.button) {
                this._defaultButtonId = this._createUploadButton({
                    element: this._options.button,
                    title: this._options.text.fileInputTitle
                }).getButtonId();
            }
            this._generateExtraButtonSpecs();
            this._handleCameraAccess();
            if (this._options.paste.targetElement) {
                if (qq.PasteSupport) {
                    this._pasteHandler = this._createPasteHandler();
                } else {
                    this.log("Paste support module not found", "error");
                }
            }
            this._options.warnBeforeUnload && this._preventLeaveInProgress();
            this._imageGenerator = qq.ImageGenerator && new qq.ImageGenerator(qq.bind(this.log, this));
            this._refreshSessionData();
            this._succeededSinceLastAllComplete = [];
            this._failedSinceLastAllComplete = [];
            this._scaler = qq.Scaler && new qq.Scaler(this._options.scaling, qq.bind(this.log, this)) || {};
            if (this._scaler.enabled) {
                this._customNewFileHandler = qq.bind(this._scaler.handleNewFile, this._scaler);
            }
            if (qq.TotalProgress && qq.supportedFeatures.progressBar) {
                this._totalProgress = new qq.TotalProgress(qq.bind(this._onTotalProgress, this), function(id) {
                    var entry = self._uploadData.retrieve({
                        id: id
                    });
                    return entry && entry.size || 0;
                });
            }
            this._currentItemLimit = this._options.validation.itemLimit;
            this._customResumeDataStore = this._createStore();
        };
        qq.FineUploaderBasic.prototype = qq.basePublicApi;
        qq.extend(qq.FineUploaderBasic.prototype, qq.basePrivateApi);
    })();
    qq.AjaxRequester = function(o) {
        "use strict";
        var log, shouldParamsBeInQueryString, queue = [], requestData = {}, options = {
            acceptHeader: null,
            validMethods: [ "PATCH", "POST", "PUT" ],
            method: "POST",
            contentType: "application/x-www-form-urlencoded",
            maxConnections: 3,
            customHeaders: {},
            endpointStore: {},
            paramsStore: {},
            mandatedParams: {},
            allowXRequestedWithAndCacheControl: true,
            successfulResponseCodes: {
                DELETE: [ 200, 202, 204 ],
                PATCH: [ 200, 201, 202, 203, 204 ],
                POST: [ 200, 201, 202, 203, 204 ],
                PUT: [ 200, 201, 202, 203, 204 ],
                GET: [ 200 ]
            },
            cors: {
                expected: false,
                sendCredentials: false
            },
            log: function(str, level) {},
            onSend: function(id) {},
            onComplete: function(id, xhrOrXdr, isError) {},
            onProgress: null
        };
        qq.extend(options, o);
        log = options.log;
        if (qq.indexOf(options.validMethods, options.method) < 0) {
            throw new Error("'" + options.method + "' is not a supported method for this type of request!");
        }
        function isSimpleMethod() {
            return qq.indexOf([ "GET", "POST", "HEAD" ], options.method) >= 0;
        }
        function containsNonSimpleHeaders(headers) {
            var containsNonSimple = false;
            qq.each(containsNonSimple, function(idx, header) {
                if (qq.indexOf([ "Accept", "Accept-Language", "Content-Language", "Content-Type" ], header) < 0) {
                    containsNonSimple = true;
                    return false;
                }
            });
            return containsNonSimple;
        }
        function isXdr(xhr) {
            return options.cors.expected && xhr.withCredentials === undefined;
        }
        function getCorsAjaxTransport() {
            var xhrOrXdr;
            if (window.XMLHttpRequest || window.ActiveXObject) {
                xhrOrXdr = qq.createXhrInstance();
                if (xhrOrXdr.withCredentials === undefined) {
                    xhrOrXdr = new XDomainRequest();
                    xhrOrXdr.onload = function() {};
                    xhrOrXdr.onerror = function() {};
                    xhrOrXdr.ontimeout = function() {};
                    xhrOrXdr.onprogress = function() {};
                }
            }
            return xhrOrXdr;
        }
        function getXhrOrXdr(id, suppliedXhr) {
            var xhrOrXdr = requestData[id] && requestData[id].xhr;
            if (!xhrOrXdr) {
                if (suppliedXhr) {
                    xhrOrXdr = suppliedXhr;
                } else {
                    if (options.cors.expected) {
                        xhrOrXdr = getCorsAjaxTransport();
                    } else {
                        xhrOrXdr = qq.createXhrInstance();
                    }
                }
                requestData[id].xhr = xhrOrXdr;
            }
            return xhrOrXdr;
        }
        function dequeue(id) {
            var i = qq.indexOf(queue, id), max = options.maxConnections, nextId;
            delete requestData[id];
            queue.splice(i, 1);
            if (queue.length >= max && i < max) {
                nextId = queue[max - 1];
                sendRequest(nextId);
            }
        }
        function onComplete(id, xdrError) {
            var xhr = getXhrOrXdr(id), method = options.method, isError = xdrError === true;
            dequeue(id);
            if (isError) {
                log(method + " request for " + id + " has failed", "error");
            } else if (!isXdr(xhr) && !isResponseSuccessful(xhr.status)) {
                isError = true;
                log(method + " request for " + id + " has failed - response code " + xhr.status, "error");
            }
            options.onComplete(id, xhr, isError);
        }
        function getParams(id) {
            var onDemandParams = requestData[id].additionalParams, mandatedParams = options.mandatedParams, params;
            if (options.paramsStore.get) {
                params = options.paramsStore.get(id);
            }
            if (onDemandParams) {
                qq.each(onDemandParams, function(name, val) {
                    params = params || {};
                    params[name] = val;
                });
            }
            if (mandatedParams) {
                qq.each(mandatedParams, function(name, val) {
                    params = params || {};
                    params[name] = val;
                });
            }
            return params;
        }
        function sendRequest(id, optXhr) {
            var xhr = getXhrOrXdr(id, optXhr), method = options.method, params = getParams(id), payload = requestData[id].payload, url;
            options.onSend(id);
            url = createUrl(id, params, requestData[id].additionalQueryParams);
            if (isXdr(xhr)) {
                xhr.onload = getXdrLoadHandler(id);
                xhr.onerror = getXdrErrorHandler(id);
            } else {
                xhr.onreadystatechange = getXhrReadyStateChangeHandler(id);
            }
            registerForUploadProgress(id);
            xhr.open(method, url, true);
            if (options.cors.expected && options.cors.sendCredentials && !isXdr(xhr)) {
                xhr.withCredentials = true;
            }
            setHeaders(id);
            log("Sending " + method + " request for " + id);
            if (payload) {
                xhr.send(payload);
            } else if (shouldParamsBeInQueryString || !params) {
                xhr.send();
            } else if (params && options.contentType && options.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded") >= 0) {
                xhr.send(qq.obj2url(params, ""));
            } else if (params && options.contentType && options.contentType.toLowerCase().indexOf("application/json") >= 0) {
                xhr.send(JSON.stringify(params));
            } else {
                xhr.send(params);
            }
            return xhr;
        }
        function createUrl(id, params, additionalQueryParams) {
            var endpoint = options.endpointStore.get(id), addToPath = requestData[id].addToPath;
            if (addToPath != undefined) {
                endpoint += "/" + addToPath;
            }
            if (shouldParamsBeInQueryString && params) {
                endpoint = qq.obj2url(params, endpoint);
            }
            if (additionalQueryParams) {
                endpoint = qq.obj2url(additionalQueryParams, endpoint);
            }
            return endpoint;
        }
        function getXhrReadyStateChangeHandler(id) {
            return function() {
                if (getXhrOrXdr(id).readyState === 4) {
                    onComplete(id);
                }
            };
        }
        function registerForUploadProgress(id) {
            var onProgress = options.onProgress;
            if (onProgress) {
                getXhrOrXdr(id).upload.onprogress = function(e) {
                    if (e.lengthComputable) {
                        onProgress(id, e.loaded, e.total);
                    }
                };
            }
        }
        function getXdrLoadHandler(id) {
            return function() {
                onComplete(id);
            };
        }
        function getXdrErrorHandler(id) {
            return function() {
                onComplete(id, true);
            };
        }
        function setHeaders(id) {
            var xhr = getXhrOrXdr(id), customHeaders = options.customHeaders, onDemandHeaders = requestData[id].additionalHeaders || {}, method = options.method, allHeaders = {};
            if (!isXdr(xhr)) {
                options.acceptHeader && xhr.setRequestHeader("Accept", options.acceptHeader);
                if (options.allowXRequestedWithAndCacheControl) {
                    if (!options.cors.expected || (!isSimpleMethod() || containsNonSimpleHeaders(customHeaders))) {
                        xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
                        xhr.setRequestHeader("Cache-Control", "no-cache");
                    }
                }
                if (options.contentType && (method === "POST" || method === "PUT")) {
                    xhr.setRequestHeader("Content-Type", options.contentType);
                }
                qq.extend(allHeaders, qq.isFunction(customHeaders) ? customHeaders(id) : customHeaders);
                qq.extend(allHeaders, onDemandHeaders);
                qq.each(allHeaders, function(name, val) {
                    xhr.setRequestHeader(name, val);
                });
            }
        }
        function isResponseSuccessful(responseCode) {
            return qq.indexOf(options.successfulResponseCodes[options.method], responseCode) >= 0;
        }
        function prepareToSend(id, optXhr, addToPath, additionalParams, additionalQueryParams, additionalHeaders, payload) {
            requestData[id] = {
                addToPath: addToPath,
                additionalParams: additionalParams,
                additionalQueryParams: additionalQueryParams,
                additionalHeaders: additionalHeaders,
                payload: payload
            };
            var len = queue.push(id);
            if (len <= options.maxConnections) {
                return sendRequest(id, optXhr);
            }
        }
        shouldParamsBeInQueryString = options.method === "GET" || options.method === "DELETE";
        qq.extend(this, {
            initTransport: function(id) {
                var path, params, headers, payload, cacheBuster, additionalQueryParams;
                return {
                    withPath: function(appendToPath) {
                        path = appendToPath;
                        return this;
                    },
                    withParams: function(additionalParams) {
                        params = additionalParams;
                        return this;
                    },
                    withQueryParams: function(_additionalQueryParams_) {
                        additionalQueryParams = _additionalQueryParams_;
                        return this;
                    },
                    withHeaders: function(additionalHeaders) {
                        headers = additionalHeaders;
                        return this;
                    },
                    withPayload: function(thePayload) {
                        payload = thePayload;
                        return this;
                    },
                    withCacheBuster: function() {
                        cacheBuster = true;
                        return this;
                    },
                    send: function(optXhr) {
                        if (cacheBuster && qq.indexOf([ "GET", "DELETE" ], options.method) >= 0) {
                            params.qqtimestamp = new Date().getTime();
                        }
                        return prepareToSend(id, optXhr, path, params, additionalQueryParams, headers, payload);
                    }
                };
            },
            canceled: function(id) {
                dequeue(id);
            }
        });
    };
    qq.UploadHandler = function(spec) {
        "use strict";
        var proxy = spec.proxy, fileState = {}, onCancel = proxy.onCancel, getName = proxy.getName;
        qq.extend(this, {
            add: function(id, fileItem) {
                fileState[id] = fileItem;
                fileState[id].temp = {};
            },
            cancel: function(id) {
                var self = this, cancelFinalizationEffort = new qq.Promise(), onCancelRetVal = onCancel(id, getName(id), cancelFinalizationEffort);
                onCancelRetVal.then(function() {
                    if (self.isValid(id)) {
                        fileState[id].canceled = true;
                        self.expunge(id);
                    }
                    cancelFinalizationEffort.success();
                });
            },
            expunge: function(id) {
                delete fileState[id];
            },
            getThirdPartyFileId: function(id) {
                return fileState[id].key;
            },
            isValid: function(id) {
                return fileState[id] !== undefined;
            },
            reset: function() {
                fileState = {};
            },
            _getFileState: function(id) {
                return fileState[id];
            },
            _setThirdPartyFileId: function(id, thirdPartyFileId) {
                fileState[id].key = thirdPartyFileId;
            },
            _wasCanceled: function(id) {
                return !!fileState[id].canceled;
            }
        });
    };
    qq.UploadHandlerController = function(o, namespace) {
        "use strict";
        var controller = this, chunkingPossible = false, concurrentChunkingPossible = false, chunking, preventRetryResponse, log, handler, options = {
            paramsStore: {},
            maxConnections: 3,
            chunking: {
                enabled: false,
                multiple: {
                    enabled: false
                }
            },
            log: function(str, level) {},
            onProgress: function(id, fileName, loaded, total) {},
            onComplete: function(id, fileName, response, xhr) {},
            onCancel: function(id, fileName) {},
            onUploadPrep: function(id) {},
            onUpload: function(id, fileName) {},
            onUploadChunk: function(id, fileName, chunkData) {},
            onUploadChunkSuccess: function(id, chunkData, response, xhr) {},
            onAutoRetry: function(id, fileName, response, xhr) {},
            onResume: function(id, fileName, chunkData, customResumeData) {},
            onUuidChanged: function(id, newUuid) {},
            getName: function(id) {},
            setSize: function(id, newSize) {},
            isQueued: function(id) {},
            getIdsInProxyGroup: function(id) {},
            getIdsInBatch: function(id) {},
            isInProgress: function(id) {}
        }, chunked = {
            done: function(id, chunkIdx, response, xhr) {
                var chunkData = handler._getChunkData(id, chunkIdx);
                handler._getFileState(id).attemptingResume = false;
                delete handler._getFileState(id).temp.chunkProgress[chunkIdx];
                handler._getFileState(id).loaded += chunkData.size;
                options.onUploadChunkSuccess(id, handler._getChunkDataForCallback(chunkData), response, xhr);
            },
            finalize: function(id) {
                var size = options.getSize(id), name = options.getName(id);
                log("All chunks have been uploaded for " + id + " - finalizing....");
                handler.finalizeChunks(id).then(function(response, xhr) {
                    log("Finalize successful for " + id);
                    var normaizedResponse = upload.normalizeResponse(response, true);
                    options.onProgress(id, name, size, size);
                    handler._maybeDeletePersistedChunkData(id);
                    upload.cleanup(id, normaizedResponse, xhr);
                }, function(response, xhr) {
                    var normalizedResponse = upload.normalizeResponse(response, false);
                    log("Problem finalizing chunks for file ID " + id + " - " + normalizedResponse.error, "error");
                    if (normalizedResponse.reset || xhr && options.chunking.success.resetOnStatus.indexOf(xhr.status) >= 0) {
                        chunked.reset(id);
                    }
                    if (!options.onAutoRetry(id, name, normalizedResponse, xhr)) {
                        upload.cleanup(id, normalizedResponse, xhr);
                    }
                });
            },
            handleFailure: function(chunkIdx, id, response, xhr) {
                var name = options.getName(id);
                log("Chunked upload request failed for " + id + ", chunk " + chunkIdx);
                handler.clearCachedChunk(id, chunkIdx);
                var responseToReport = upload.normalizeResponse(response, false), inProgressIdx;
                if (responseToReport.reset) {
                    chunked.reset(id);
                } else {
                    var inProgressChunksArray = handler._getFileState(id).chunking.inProgress;
                    inProgressIdx = inProgressChunksArray ? qq.indexOf(inProgressChunksArray, chunkIdx) : -1;
                    if (inProgressIdx >= 0) {
                        handler._getFileState(id).chunking.inProgress.splice(inProgressIdx, 1);
                        handler._getFileState(id).chunking.remaining.unshift(chunkIdx);
                    }
                }
                if (!handler._getFileState(id).temp.ignoreFailure) {
                    if (concurrentChunkingPossible) {
                        handler._getFileState(id).temp.ignoreFailure = true;
                        log(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.", JSON.stringify(Object.keys(handler._getXhrs(id))), JSON.stringify(handler._getFileState(id).chunking.inProgress)));
                        qq.each(handler._getXhrs(id), function(ckid, ckXhr) {
                            log(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ", id, ckid, ckXhr.readyState));
                            ckXhr.abort();
                            ckXhr._cancelled = true;
                        });
                        handler.moveInProgressToRemaining(id);
                        connectionManager.free(id, true);
                    }
                    if (!options.onAutoRetry(id, name, responseToReport, xhr)) {
                        upload.cleanup(id, responseToReport, xhr);
                    }
                }
            },
            hasMoreParts: function(id) {
                return !!handler._getFileState(id).chunking.remaining.length;
            },
            nextPart: function(id) {
                var nextIdx = handler._getFileState(id).chunking.remaining.shift();
                if (nextIdx >= handler._getTotalChunks(id)) {
                    nextIdx = null;
                }
                return nextIdx;
            },
            reset: function(id) {
                log("Server or callback has ordered chunking effort to be restarted on next attempt for item ID " + id, "error");
                handler._maybeDeletePersistedChunkData(id);
                handler.reevaluateChunking(id);
                handler._getFileState(id).loaded = 0;
                handler._getFileState(id).attemptingResume = false;
            },
            sendNext: function(id) {
                var size = options.getSize(id), name = options.getName(id), chunkIdx = chunked.nextPart(id), chunkData = handler._getChunkData(id, chunkIdx), fileState = handler._getFileState(id), resuming = fileState.attemptingResume, inProgressChunks = fileState.chunking.inProgress || [];
                if (fileState.loaded == null) {
                    fileState.loaded = 0;
                }
                if (resuming && options.onResume(id, name, chunkData, fileState.customResumeData) === false) {
                    chunked.reset(id);
                    chunkIdx = chunked.nextPart(id);
                    chunkData = handler._getChunkData(id, chunkIdx);
                    resuming = false;
                }
                if (chunkIdx == null && inProgressChunks.length === 0) {
                    chunked.finalize(id);
                } else {
                    inProgressChunks.push(chunkIdx);
                    handler._getFileState(id).chunking.inProgress = inProgressChunks;
                    if (concurrentChunkingPossible) {
                        connectionManager.open(id, chunkIdx);
                    }
                    if (concurrentChunkingPossible && connectionManager.available() && handler._getFileState(id).chunking.remaining.length) {
                        chunked.sendNext(id);
                    }
                    if (chunkData.blob.size === 0) {
                        log(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.", chunkIdx, id), "error");
                        chunked.handleFailure(chunkIdx, id, "File is no longer available", null);
                    }
                    var onUploadChunkPromise = options.onUploadChunk(id, name, handler._getChunkDataForCallback(chunkData));
                    onUploadChunkPromise.then(function(requestOverrides) {
                        if (!options.isInProgress(id)) {
                            log(qq.format("Not sending chunked upload request for item {}.{} - no longer in progress.", id, chunkIdx));
                        } else {
                            log(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.", id, chunkIdx, chunkData.start + 1, chunkData.end, size));
                            var uploadChunkData = {
                                chunkIdx: chunkIdx,
                                id: id,
                                overrides: requestOverrides,
                                resuming: resuming
                            };
                            handler.uploadChunk(uploadChunkData).then(function success(response, xhr) {
                                log("Chunked upload request succeeded for " + id + ", chunk " + chunkIdx);
                                handler.clearCachedChunk(id, chunkIdx);
                                var inProgressChunks = handler._getFileState(id).chunking.inProgress || [], responseToReport = upload.normalizeResponse(response, true), inProgressChunkIdx = qq.indexOf(inProgressChunks, chunkIdx);
                                log(qq.format("Chunk {} for file {} uploaded successfully.", chunkIdx, id));
                                chunked.done(id, chunkIdx, responseToReport, xhr);
                                if (inProgressChunkIdx >= 0) {
                                    inProgressChunks.splice(inProgressChunkIdx, 1);
                                }
                                handler._maybePersistChunkedState(id);
                                if (!chunked.hasMoreParts(id) && inProgressChunks.length === 0) {
                                    chunked.finalize(id);
                                } else if (chunked.hasMoreParts(id)) {
                                    chunked.sendNext(id);
                                } else {
                                    log(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}", id, JSON.stringify(inProgressChunks)));
                                }
                            }, function failure(response, xhr) {
                                chunked.handleFailure(chunkIdx, id, response, xhr);
                            }).done(function() {
                                handler.clearXhr(id, chunkIdx);
                            });
                        }
                    }, function(error) {
                        chunked.handleFailure(chunkIdx, id, error, null);
                    });
                }
            }
        }, connectionManager = {
            _open: [],
            _openChunks: {},
            _waiting: [],
            available: function() {
                var max = options.maxConnections, openChunkEntriesCount = 0, openChunksCount = 0;
                qq.each(connectionManager._openChunks, function(fileId, openChunkIndexes) {
                    openChunkEntriesCount++;
                    openChunksCount += openChunkIndexes.length;
                });
                return max - (connectionManager._open.length - openChunkEntriesCount + openChunksCount);
            },
            free: function(id, dontAllowNext) {
                var allowNext = !dontAllowNext, waitingIndex = qq.indexOf(connectionManager._waiting, id), connectionsIndex = qq.indexOf(connectionManager._open, id), nextId;
                delete connectionManager._openChunks[id];
                if (upload.getProxyOrBlob(id) instanceof qq.BlobProxy) {
                    log("Generated blob upload has ended for " + id + ", disposing generated blob.");
                    delete handler._getFileState(id).file;
                }
                if (waitingIndex >= 0) {
                    connectionManager._waiting.splice(waitingIndex, 1);
                } else if (allowNext && connectionsIndex >= 0) {
                    connectionManager._open.splice(connectionsIndex, 1);
                    nextId = connectionManager._waiting.shift();
                    if (nextId >= 0) {
                        connectionManager._open.push(nextId);
                        upload.start(nextId);
                    }
                }
            },
            getWaitingOrConnected: function() {
                var waitingOrConnected = [];
                qq.each(connectionManager._openChunks, function(fileId, chunks) {
                    if (chunks && chunks.length) {
                        waitingOrConnected.push(parseInt(fileId));
                    }
                });
                qq.each(connectionManager._open, function(idx, fileId) {
                    if (!connectionManager._openChunks[fileId]) {
                        waitingOrConnected.push(parseInt(fileId));
                    }
                });
                waitingOrConnected = waitingOrConnected.concat(connectionManager._waiting);
                return waitingOrConnected;
            },
            isUsingConnection: function(id) {
                return qq.indexOf(connectionManager._open, id) >= 0;
            },
            open: function(id, chunkIdx) {
                if (chunkIdx == null) {
                    connectionManager._waiting.push(id);
                }
                if (connectionManager.available()) {
                    if (chunkIdx == null) {
                        connectionManager._waiting.pop();
                        connectionManager._open.push(id);
                    } else {
                        (function() {
                            var openChunksEntry = connectionManager._openChunks[id] || [];
                            openChunksEntry.push(chunkIdx);
                            connectionManager._openChunks[id] = openChunksEntry;
                        })();
                    }
                    return true;
                }
                return false;
            },
            reset: function() {
                connectionManager._waiting = [];
                connectionManager._open = [];
            }
        }, simple = {
            send: function(id, name) {
                var fileState = handler._getFileState(id);
                if (!fileState) {
                    log("Ignoring send request as this upload may have been cancelled, File ID " + id, "warn");
                    return;
                }
                fileState.loaded = 0;
                log("Sending simple upload request for " + id);
                handler.uploadFile(id).then(function(response, optXhr) {
                    log("Simple upload request succeeded for " + id);
                    var responseToReport = upload.normalizeResponse(response, true), size = options.getSize(id);
                    options.onProgress(id, name, size, size);
                    upload.maybeNewUuid(id, responseToReport);
                    upload.cleanup(id, responseToReport, optXhr);
                }, function(response, optXhr) {
                    log("Simple upload request failed for " + id);
                    var responseToReport = upload.normalizeResponse(response, false);
                    if (!options.onAutoRetry(id, name, responseToReport, optXhr)) {
                        upload.cleanup(id, responseToReport, optXhr);
                    }
                });
            }
        }, upload = {
            cancel: function(id) {
                log("Cancelling " + id);
                options.paramsStore.remove(id);
                connectionManager.free(id);
            },
            cleanup: function(id, response, optXhr) {
                var name = options.getName(id);
                options.onComplete(id, name, response, optXhr);
                if (handler._getFileState(id)) {
                    handler._clearXhrs && handler._clearXhrs(id);
                }
                connectionManager.free(id);
            },
            getProxyOrBlob: function(id) {
                return handler.getProxy && handler.getProxy(id) || handler.getFile && handler.getFile(id);
            },
            initHandler: function() {
                var handlerType = namespace ? qq[namespace] : qq.traditional, handlerModuleSubtype = qq.supportedFeatures.ajaxUploading ? "Xhr" : "Form";
                handler = new handlerType[handlerModuleSubtype + "UploadHandler"](options, {
                    getCustomResumeData: options.getCustomResumeData,
                    getDataByUuid: options.getDataByUuid,
                    getName: options.getName,
                    getSize: options.getSize,
                    getUuid: options.getUuid,
                    log: log,
                    onCancel: options.onCancel,
                    onProgress: options.onProgress,
                    onUuidChanged: options.onUuidChanged,
                    onFinalizing: function(id) {
                        options.setStatus(id, qq.status.UPLOAD_FINALIZING);
                    }
                });
                if (handler._removeExpiredChunkingRecords) {
                    handler._removeExpiredChunkingRecords();
                }
            },
            isDeferredEligibleForUpload: function(id) {
                return options.isQueued(id);
            },
            maybeDefer: function(id, blob) {
                if (blob && !handler.getFile(id) && blob instanceof qq.BlobProxy) {
                    options.onUploadPrep(id);
                    log("Attempting to generate a blob on-demand for " + id);
                    blob.create().then(function(generatedBlob) {
                        log("Generated an on-demand blob for " + id);
                        handler.updateBlob(id, generatedBlob);
                        options.setSize(id, generatedBlob.size);
                        handler.reevaluateChunking(id);
                        upload.maybeSendDeferredFiles(id);
                    }, function(errorMessage) {
                        var errorResponse = {};
                        if (errorMessage) {
                            errorResponse.error = errorMessage;
                        }
                        log(qq.format("Failed to generate blob for ID {}.  Error message: {}.", id, errorMessage), "error");
                        options.onComplete(id, options.getName(id), qq.extend(errorResponse, preventRetryResponse), null);
                        upload.maybeSendDeferredFiles(id);
                        connectionManager.free(id);
                    });
                } else {
                    return upload.maybeSendDeferredFiles(id);
                }
                return false;
            },
            maybeSendDeferredFiles: function(id) {
                var idsInGroup = options.getIdsInProxyGroup(id), uploadedThisId = false;
                if (idsInGroup && idsInGroup.length) {
                    log("Maybe ready to upload proxy group file " + id);
                    qq.each(idsInGroup, function(idx, idInGroup) {
                        if (upload.isDeferredEligibleForUpload(idInGroup) && !!handler.getFile(idInGroup)) {
                            uploadedThisId = idInGroup === id;
                            upload.now(idInGroup);
                        } else if (upload.isDeferredEligibleForUpload(idInGroup)) {
                            return false;
                        }
                    });
                } else {
                    uploadedThisId = true;
                    upload.now(id);
                }
                return uploadedThisId;
            },
            maybeNewUuid: function(id, response) {
                if (response.newUuid !== undefined) {
                    options.onUuidChanged(id, response.newUuid);
                }
            },
            normalizeResponse: function(originalResponse, successful) {
                var response = originalResponse;
                if (!qq.isObject(originalResponse)) {
                    response = {};
                    if (qq.isString(originalResponse) && !successful) {
                        response.error = originalResponse;
                    }
                }
                response.success = successful;
                return response;
            },
            now: function(id) {
                var name = options.getName(id);
                if (!controller.isValid(id)) {
                    throw new qq.Error(id + " is not a valid file ID to upload!");
                }
                options.onUpload(id, name).then(function(response) {
                    if (response && response.pause) {
                        options.setStatus(id, qq.status.PAUSED);
                        handler.pause(id);
                        connectionManager.free(id);
                    } else {
                        if (chunkingPossible && handler._shouldChunkThisFile(id)) {
                            chunked.sendNext(id);
                        } else {
                            simple.send(id, name);
                        }
                    }
                }, function(error) {
                    error = error || {};
                    log(id + " upload start aborted due to rejected onUpload Promise - details: " + error, "error");
                    if (!options.onAutoRetry(id, name, error.responseJSON || {})) {
                        var response = upload.normalizeResponse(error.responseJSON, false);
                        upload.cleanup(id, response);
                    }
                });
            },
            start: function(id) {
                var blobToUpload = upload.getProxyOrBlob(id);
                if (blobToUpload) {
                    return upload.maybeDefer(id, blobToUpload);
                } else {
                    upload.now(id);
                    return true;
                }
            }
        };
        qq.extend(this, {
            add: function(id, file) {
                handler.add.apply(this, arguments);
            },
            upload: function(id) {
                if (connectionManager.open(id)) {
                    return upload.start(id);
                }
                return false;
            },
            retry: function(id) {
                if (concurrentChunkingPossible) {
                    handler._getFileState(id).temp.ignoreFailure = false;
                }
                if (connectionManager.isUsingConnection(id)) {
                    return upload.start(id);
                } else {
                    return controller.upload(id);
                }
            },
            cancel: function(id) {
                var cancelRetVal = handler.cancel(id);
                if (qq.isGenericPromise(cancelRetVal)) {
                    cancelRetVal.then(function() {
                        upload.cancel(id);
                    });
                } else if (cancelRetVal !== false) {
                    upload.cancel(id);
                }
            },
            cancelAll: function() {
                var waitingOrConnected = connectionManager.getWaitingOrConnected(), i;
                if (waitingOrConnected.length) {
                    for (i = waitingOrConnected.length - 1; i >= 0; i--) {
                        controller.cancel(waitingOrConnected[i]);
                    }
                }
                connectionManager.reset();
            },
            getFile: function(id) {
                if (handler.getProxy && handler.getProxy(id)) {
                    return handler.getProxy(id).referenceBlob;
                }
                return handler.getFile && handler.getFile(id);
            },
            isProxied: function(id) {
                return !!(handler.getProxy && handler.getProxy(id));
            },
            getInput: function(id) {
                if (handler.getInput) {
                    return handler.getInput(id);
                }
            },
            reset: function() {
                log("Resetting upload handler");
                controller.cancelAll();
                connectionManager.reset();
                handler.reset();
            },
            expunge: function(id) {
                if (controller.isValid(id)) {
                    return handler.expunge(id);
                }
            },
            isValid: function(id) {
                return handler.isValid(id);
            },
            hasResumeRecord: function(id) {
                var key = handler.isValid(id) && handler._getLocalStorageId && handler._getLocalStorageId(id);
                if (key) {
                    return !!localStorage.getItem(key);
                }
                return false;
            },
            getResumableFilesData: function() {
                if (handler.getResumableFilesData) {
                    return handler.getResumableFilesData();
                }
                return [];
            },
            getThirdPartyFileId: function(id) {
                if (controller.isValid(id)) {
                    return handler.getThirdPartyFileId(id);
                }
            },
            pause: function(id) {
                if (controller.isResumable(id) && handler.pause && controller.isValid(id) && handler.pause(id)) {
                    connectionManager.free(id);
                    handler.moveInProgressToRemaining(id);
                    return true;
                }
                return false;
            },
            isAttemptingResume: function(id) {
                return !!handler.isAttemptingResume && handler.isAttemptingResume(id);
            },
            isResumable: function(id) {
                return !!handler.isResumable && handler.isResumable(id);
            }
        });
        qq.extend(options, o);
        log = options.log;
        chunkingPossible = options.chunking.enabled && qq.supportedFeatures.chunking;
        concurrentChunkingPossible = chunkingPossible && options.chunking.concurrent.enabled;
        preventRetryResponse = function() {
            var response = {};
            response[options.preventRetryParam] = true;
            return response;
        }();
        upload.initHandler();
    };
    qq.WindowReceiveMessage = function(o) {
        "use strict";
        var options = {
            log: function(message, level) {}
        }, callbackWrapperDetachers = {};
        qq.extend(options, o);
        qq.extend(this, {
            receiveMessage: function(id, callback) {
                var onMessageCallbackWrapper = function(event) {
                    callback(event.data);
                };
                if (window.postMessage) {
                    callbackWrapperDetachers[id] = qq(window).attach("message", onMessageCallbackWrapper);
                } else {
                    log("iframe message passing not supported in this browser!", "error");
                }
            },
            stopReceivingMessages: function(id) {
                if (window.postMessage) {
                    var detacher = callbackWrapperDetachers[id];
                    if (detacher) {
                        detacher();
                    }
                }
            }
        });
    };
    qq.FormUploadHandler = function(spec) {
        "use strict";
        var options = spec.options, handler = this, proxy = spec.proxy, formHandlerInstanceId = qq.getUniqueId(), onloadCallbacks = {}, detachLoadEvents = {}, postMessageCallbackTimers = {}, isCors = options.isCors, inputName = options.inputName, getUuid = proxy.getUuid, log = proxy.log, corsMessageReceiver = new qq.WindowReceiveMessage({
            log: log
        });
        function expungeFile(id) {
            delete detachLoadEvents[id];
            if (isCors) {
                clearTimeout(postMessageCallbackTimers[id]);
                delete postMessageCallbackTimers[id];
                corsMessageReceiver.stopReceivingMessages(id);
            }
            var iframe = document.getElementById(handler._getIframeName(id));
            if (iframe) {
                iframe.setAttribute("src", "javascript:false;");
                qq(iframe).remove();
            }
        }
        function getFileIdForIframeName(iframeName) {
            return iframeName.split("_")[0];
        }
        function initIframeForUpload(name) {
            var iframe = qq.toElement("<iframe src='javascript:false;' name='" + name + "' />");
            iframe.setAttribute("id", name);
            iframe.style.display = "none";
            document.body.appendChild(iframe);
            return iframe;
        }
        function registerPostMessageCallback(iframe, callback) {
            var iframeName = iframe.id, fileId = getFileIdForIframeName(iframeName), uuid = getUuid(fileId);
            onloadCallbacks[uuid] = callback;
            detachLoadEvents[fileId] = qq(iframe).attach("load", function() {
                if (handler.getInput(fileId)) {
                    log("Received iframe load event for CORS upload request (iframe name " + iframeName + ")");
                    postMessageCallbackTimers[iframeName] = setTimeout(function() {
                        var errorMessage = "No valid message received from loaded iframe for iframe name " + iframeName;
                        log(errorMessage, "error");
                        callback({
                            error: errorMessage
                        });
                    }, 1e3);
                }
            });
            corsMessageReceiver.receiveMessage(iframeName, function(message) {
                log("Received the following window message: '" + message + "'");
                var fileId = getFileIdForIframeName(iframeName), response = handler._parseJsonResponse(message), uuid = response.uuid, onloadCallback;
                if (uuid && onloadCallbacks[uuid]) {
                    log("Handling response for iframe name " + iframeName);
                    clearTimeout(postMessageCallbackTimers[iframeName]);
                    delete postMessageCallbackTimers[iframeName];
                    handler._detachLoadEvent(iframeName);
                    onloadCallback = onloadCallbacks[uuid];
                    delete onloadCallbacks[uuid];
                    corsMessageReceiver.stopReceivingMessages(iframeName);
                    onloadCallback(response);
                } else if (!uuid) {
                    log("'" + message + "' does not contain a UUID - ignoring.");
                }
            });
        }
        qq.extend(this, new qq.UploadHandler(spec));
        qq.override(this, function(super_) {
            return {
                add: function(id, fileInput) {
                    super_.add(id, {
                        input: fileInput
                    });
                    fileInput.setAttribute("name", inputName);
                    if (fileInput.parentNode) {
                        qq(fileInput).remove();
                    }
                },
                expunge: function(id) {
                    expungeFile(id);
                    super_.expunge(id);
                },
                isValid: function(id) {
                    return super_.isValid(id) && handler._getFileState(id).input !== undefined;
                }
            };
        });
        qq.extend(this, {
            getInput: function(id) {
                return handler._getFileState(id).input;
            },
            _attachLoadEvent: function(iframe, callback) {
                var responseDescriptor;
                if (isCors) {
                    registerPostMessageCallback(iframe, callback);
                } else {
                    detachLoadEvents[iframe.id] = qq(iframe).attach("load", function() {
                        log("Received response for " + iframe.id);
                        if (!iframe.parentNode) {
                            return;
                        }
                        try {
                            if (iframe.contentDocument && iframe.contentDocument.body && iframe.contentDocument.body.innerHTML == "false") {
                                return;
                            }
                        } catch (error) {
                            log("Error when attempting to access iframe during handling of upload response (" + error.message + ")", "error");
                            responseDescriptor = {
                                success: false
                            };
                        }
                        callback(responseDescriptor);
                    });
                }
            },
            _createIframe: function(id) {
                var iframeName = handler._getIframeName(id);
                return initIframeForUpload(iframeName);
            },
            _detachLoadEvent: function(id) {
                if (detachLoadEvents[id] !== undefined) {
                    detachLoadEvents[id]();
                    delete detachLoadEvents[id];
                }
            },
            _getIframeName: function(fileId) {
                return fileId + "_" + formHandlerInstanceId;
            },
            _initFormForUpload: function(spec) {
                var method = spec.method, endpoint = spec.endpoint, params = spec.params, paramsInBody = spec.paramsInBody, targetName = spec.targetName, form = qq.toElement("<form method='" + method + "' enctype='multipart/form-data'></form>"), url = endpoint;
                if (paramsInBody) {
                    qq.obj2Inputs(params, form);
                } else {
                    url = qq.obj2url(params, endpoint);
                }
                form.setAttribute("action", url);
                form.setAttribute("target", targetName);
                form.style.display = "none";
                document.body.appendChild(form);
                return form;
            },
            _parseJsonResponse: function(innerHtmlOrMessage) {
                var response = {};
                try {
                    response = qq.parseJson(innerHtmlOrMessage);
                } catch (error) {
                    log("Error when attempting to parse iframe upload response (" + error.message + ")", "error");
                }
                return response;
            }
        });
    };
    qq.XhrUploadHandler = function(spec) {
        "use strict";
        var handler = this, namespace = spec.options.namespace, proxy = spec.proxy, chunking = spec.options.chunking, getChunkSize = function(id) {
            var fileState = handler._getFileState(id);
            if (fileState.chunkSize) {
                return fileState.chunkSize;
            } else {
                var chunkSize = chunking.partSize;
                if (qq.isFunction(chunkSize)) {
                    chunkSize = chunkSize(id, getSize(id));
                }
                fileState.chunkSize = chunkSize;
                return chunkSize;
            }
        }, resume = spec.options.resume, chunkFiles = chunking && spec.options.chunking.enabled && qq.supportedFeatures.chunking, resumeEnabled = resume && spec.options.resume.enabled && chunkFiles && qq.supportedFeatures.resume, getName = proxy.getName, getSize = proxy.getSize, getUuid = proxy.getUuid, getEndpoint = proxy.getEndpoint, getDataByUuid = proxy.getDataByUuid, onUuidChanged = proxy.onUuidChanged, onProgress = proxy.onProgress, log = proxy.log, getCustomResumeData = proxy.getCustomResumeData;
        function abort(id) {
            qq.each(handler._getXhrs(id), function(xhrId, xhr) {
                var ajaxRequester = handler._getAjaxRequester(id, xhrId);
                xhr.onreadystatechange = null;
                xhr.upload.onprogress = null;
                xhr.abort();
                ajaxRequester && ajaxRequester.canceled && ajaxRequester.canceled(id);
            });
        }
        qq.extend(this, new qq.UploadHandler(spec));
        qq.override(this, function(super_) {
            return {
                add: function(id, blobOrProxy) {
                    if (qq.isFile(blobOrProxy) || qq.isBlob(blobOrProxy)) {
                        super_.add(id, {
                            file: blobOrProxy
                        });
                    } else if (blobOrProxy instanceof qq.BlobProxy) {
                        super_.add(id, {
                            proxy: blobOrProxy
                        });
                    } else {
                        throw new Error("Passed obj is not a File, Blob, or proxy");
                    }
                    handler._initTempState(id);
                    resumeEnabled && handler._maybePrepareForResume(id);
                },
                expunge: function(id) {
                    abort(id);
                    handler._maybeDeletePersistedChunkData(id);
                    handler._clearXhrs(id);
                    super_.expunge(id);
                }
            };
        });
        qq.extend(this, {
            clearCachedChunk: function(id, chunkIdx) {
                var fileState = handler._getFileState(id);
                if (fileState) {
                    delete fileState.temp.cachedChunks[chunkIdx];
                }
            },
            clearXhr: function(id, chunkIdx) {
                var tempState = handler._getFileState(id).temp;
                if (tempState.xhrs) {
                    delete tempState.xhrs[chunkIdx];
                }
                if (tempState.ajaxRequesters) {
                    delete tempState.ajaxRequesters[chunkIdx];
                }
            },
            finalizeChunks: function(id, responseParser) {
                var lastChunkIdx = handler._getTotalChunks(id) - 1, xhr = handler._getXhr(id, lastChunkIdx);
                if (responseParser) {
                    return new qq.Promise().success(responseParser(xhr), xhr);
                }
                return new qq.Promise().success({}, xhr);
            },
            getFile: function(id) {
                return handler.isValid(id) && handler._getFileState(id).file;
            },
            getProxy: function(id) {
                return handler.isValid(id) && handler._getFileState(id).proxy;
            },
            getResumableFilesData: function() {
                var resumableFilesData = [];
                handler._iterateResumeRecords(function(key, uploadData) {
                    handler.moveInProgressToRemaining(null, uploadData.chunking.inProgress, uploadData.chunking.remaining);
                    var data = {
                        name: uploadData.name,
                        remaining: uploadData.chunking.remaining,
                        size: uploadData.size,
                        uuid: uploadData.uuid
                    };
                    if (uploadData.key) {
                        data.key = uploadData.key;
                    }
                    if (uploadData.customResumeData) {
                        data.customResumeData = uploadData.customResumeData;
                    }
                    resumableFilesData.push(data);
                });
                return resumableFilesData;
            },
            isAttemptingResume: function(id) {
                return handler._getFileState(id).attemptingResume;
            },
            isResumable: function(id) {
                return !!chunking && handler.isValid(id) && !handler._getFileState(id).notResumable;
            },
            moveInProgressToRemaining: function(id, optInProgress, optRemaining) {
                var fileState = handler._getFileState(id) || {}, chunkingState = fileState.chunking || {}, inProgress = optInProgress || chunkingState.inProgress, remaining = optRemaining || chunkingState.remaining;
                if (inProgress) {
                    log(qq.format("Moving these chunks from in-progress {}, to remaining.", JSON.stringify(inProgress)));
                    inProgress.reverse();
                    qq.each(inProgress, function(idx, chunkIdx) {
                        remaining.unshift(chunkIdx);
                    });
                    inProgress.length = 0;
                }
            },
            pause: function(id) {
                if (handler.isValid(id)) {
                    log(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.", id, getName(id)));
                    handler._getFileState(id).paused = true;
                    abort(id);
                    return true;
                }
            },
            reevaluateChunking: function(id) {
                if (chunking && handler.isValid(id)) {
                    var state = handler._getFileState(id), totalChunks, i;
                    delete state.chunking;
                    state.chunking = {};
                    totalChunks = handler._getTotalChunks(id);
                    if (totalChunks > 1 || chunking.mandatory) {
                        state.chunking.enabled = true;
                        state.chunking.parts = totalChunks;
                        state.chunking.remaining = [];
                        for (i = 0; i < totalChunks; i++) {
                            state.chunking.remaining.push(i);
                        }
                        handler._initTempState(id);
                    } else {
                        state.chunking.enabled = false;
                    }
                }
            },
            updateBlob: function(id, newBlob) {
                if (handler.isValid(id)) {
                    handler._getFileState(id).file = newBlob;
                }
            },
            _clearXhrs: function(id) {
                var tempState = handler._getFileState(id).temp;
                qq.each(tempState.ajaxRequesters, function(chunkId) {
                    delete tempState.ajaxRequesters[chunkId];
                });
                qq.each(tempState.xhrs, function(chunkId) {
                    delete tempState.xhrs[chunkId];
                });
            },
            _createXhr: function(id, optChunkIdx) {
                return handler._registerXhr(id, optChunkIdx, qq.createXhrInstance());
            },
            _getAjaxRequester: function(id, optChunkIdx) {
                var chunkIdx = optChunkIdx == null ? -1 : optChunkIdx;
                return handler._getFileState(id).temp.ajaxRequesters[chunkIdx];
            },
            _getChunkData: function(id, chunkIndex) {
                var chunkSize = getChunkSize(id), fileSize = getSize(id), fileOrBlob = handler.getFile(id), startBytes = chunkSize * chunkIndex, endBytes = startBytes + chunkSize >= fileSize ? fileSize : startBytes + chunkSize, totalChunks = handler._getTotalChunks(id), cachedChunks = this._getFileState(id).temp.cachedChunks, blob = cachedChunks[chunkIndex] || qq.sliceBlob(fileOrBlob, startBytes, endBytes);
                cachedChunks[chunkIndex] = blob;
                return {
                    part: chunkIndex,
                    start: startBytes,
                    end: endBytes,
                    count: totalChunks,
                    blob: blob,
                    size: endBytes - startBytes
                };
            },
            _getChunkDataForCallback: function(chunkData) {
                return {
                    partIndex: chunkData.part,
                    startByte: chunkData.start + 1,
                    endByte: chunkData.end,
                    totalParts: chunkData.count
                };
            },
            _getLocalStorageId: function(id) {
                var formatVersion = "5.0", name = getName(id), size = getSize(id), chunkSize = getChunkSize(id), endpoint = getEndpoint(id), customKeys = resume.customKeys(id), localStorageId = qq.format("qq{}resume{}-{}-{}-{}-{}", namespace, formatVersion, name, size, chunkSize, endpoint);
                customKeys.forEach(function(key) {
                    localStorageId += "-" + key;
                });
                return localStorageId;
            },
            _getMimeType: function(id) {
                return handler.getFile(id).type;
            },
            _getPersistableData: function(id) {
                return handler._getFileState(id).chunking;
            },
            _getTotalChunks: function(id) {
                if (chunking) {
                    var fileSize = getSize(id), chunkSize = getChunkSize(id);
                    return Math.ceil(fileSize / chunkSize);
                }
            },
            _getXhr: function(id, optChunkIdx) {
                var chunkIdx = optChunkIdx == null ? -1 : optChunkIdx;
                return handler._getFileState(id).temp.xhrs[chunkIdx];
            },
            _getXhrs: function(id) {
                return handler._getFileState(id).temp.xhrs;
            },
            _iterateResumeRecords: function(callback) {
                if (resumeEnabled) {
                    qq.each(localStorage, function(key, item) {
                        if (key.indexOf(qq.format("qq{}resume", namespace)) === 0) {
                            var uploadData = JSON.parse(item);
                            callback(key, uploadData);
                        }
                    });
                }
            },
            _initTempState: function(id) {
                handler._getFileState(id).temp = {
                    ajaxRequesters: {},
                    chunkProgress: {},
                    xhrs: {},
                    cachedChunks: {}
                };
            },
            _markNotResumable: function(id) {
                handler._getFileState(id).notResumable = true;
            },
            _maybeDeletePersistedChunkData: function(id) {
                var localStorageId;
                if (resumeEnabled && handler.isResumable(id)) {
                    localStorageId = handler._getLocalStorageId(id);
                    if (localStorageId && localStorage.getItem(localStorageId)) {
                        localStorage.removeItem(localStorageId);
                        return true;
                    }
                }
                return false;
            },
            _maybePrepareForResume: function(id) {
                var state = handler._getFileState(id), localStorageId, persistedData;
                if (resumeEnabled && state.key === undefined) {
                    localStorageId = handler._getLocalStorageId(id);
                    persistedData = localStorage.getItem(localStorageId);
                    if (persistedData) {
                        persistedData = JSON.parse(persistedData);
                        if (getDataByUuid(persistedData.uuid)) {
                            handler._markNotResumable(id);
                        } else {
                            log(qq.format("Identified file with ID {} and name of {} as resumable.", id, getName(id)));
                            onUuidChanged(id, persistedData.uuid);
                            state.key = persistedData.key;
                            state.chunking = persistedData.chunking;
                            state.loaded = persistedData.loaded;
                            state.customResumeData = persistedData.customResumeData;
                            state.attemptingResume = true;
                            handler.moveInProgressToRemaining(id);
                        }
                    }
                }
            },
            _maybePersistChunkedState: function(id) {
                var state = handler._getFileState(id), localStorageId, persistedData;
                if (resumeEnabled && handler.isResumable(id)) {
                    var customResumeData = getCustomResumeData(id);
                    localStorageId = handler._getLocalStorageId(id);
                    persistedData = {
                        name: getName(id),
                        size: getSize(id),
                        uuid: getUuid(id),
                        key: state.key,
                        chunking: state.chunking,
                        loaded: state.loaded,
                        lastUpdated: Date.now()
                    };
                    if (customResumeData) {
                        persistedData.customResumeData = customResumeData;
                    }
                    try {
                        localStorage.setItem(localStorageId, JSON.stringify(persistedData));
                    } catch (error) {
                        log(qq.format("Unable to save resume data for '{}' due to error: '{}'.", id, error.toString()), "warn");
                    }
                }
            },
            _registerProgressHandler: function(id, chunkIdx, chunkSize) {
                var xhr = handler._getXhr(id, chunkIdx), name = getName(id), progressCalculator = {
                    simple: function(loaded, total) {
                        var fileSize = getSize(id);
                        if (loaded === total) {
                            onProgress(id, name, fileSize, fileSize);
                        } else {
                            onProgress(id, name, loaded >= fileSize ? fileSize - 1 : loaded, fileSize);
                        }
                    },
                    chunked: function(loaded, total) {
                        var chunkProgress = handler._getFileState(id).temp.chunkProgress, totalSuccessfullyLoadedForFile = handler._getFileState(id).loaded, loadedForRequest = loaded, totalForRequest = total, totalFileSize = getSize(id), estActualChunkLoaded = loadedForRequest - (totalForRequest - chunkSize), totalLoadedForFile = totalSuccessfullyLoadedForFile;
                        chunkProgress[chunkIdx] = estActualChunkLoaded;
                        qq.each(chunkProgress, function(chunkIdx, chunkLoaded) {
                            totalLoadedForFile += chunkLoaded;
                        });
                        onProgress(id, name, totalLoadedForFile, totalFileSize);
                    }
                };
                xhr.upload.onprogress = function(e) {
                    if (e.lengthComputable) {
                        var type = chunkSize == null ? "simple" : "chunked";
                        progressCalculator[type](e.loaded, e.total);
                    }
                };
            },
            _registerXhr: function(id, optChunkIdx, xhr, optAjaxRequester) {
                var xhrsId = optChunkIdx == null ? -1 : optChunkIdx, tempState = handler._getFileState(id).temp;
                tempState.xhrs = tempState.xhrs || {};
                tempState.ajaxRequesters = tempState.ajaxRequesters || {};
                tempState.xhrs[xhrsId] = xhr;
                if (optAjaxRequester) {
                    tempState.ajaxRequesters[xhrsId] = optAjaxRequester;
                }
                return xhr;
            },
            _removeExpiredChunkingRecords: function() {
                var expirationDays = resume.recordsExpireIn;
                handler._iterateResumeRecords(function(key, uploadData) {
                    var expirationDate = new Date(uploadData.lastUpdated);
                    expirationDate.setDate(expirationDate.getDate() + expirationDays);
                    if (expirationDate.getTime() <= Date.now()) {
                        log("Removing expired resume record with key " + key);
                        localStorage.removeItem(key);
                    }
                });
            },
            _shouldChunkThisFile: function(id) {
                var state = handler._getFileState(id);
                if (state) {
                    if (!state.chunking) {
                        handler.reevaluateChunking(id);
                    }
                    return state.chunking.enabled;
                }
            }
        });
    };
    qq.DeleteFileAjaxRequester = function(o) {
        "use strict";
        var requester, options = {
            method: "DELETE",
            uuidParamName: "qquuid",
            endpointStore: {},
            maxConnections: 3,
            customHeaders: function(id) {
                return {};
            },
            paramsStore: {},
            cors: {
                expected: false,
                sendCredentials: false
            },
            log: function(str, level) {},
            onDelete: function(id) {},
            onDeleteComplete: function(id, xhrOrXdr, isError) {}
        };
        qq.extend(options, o);
        function getMandatedParams() {
            if (options.method.toUpperCase() === "POST") {
                return {
                    _method: "DELETE"
                };
            }
            return {};
        }
        requester = qq.extend(this, new qq.AjaxRequester({
            acceptHeader: "application/json",
            validMethods: [ "POST", "DELETE" ],
            method: options.method,
            endpointStore: options.endpointStore,
            paramsStore: options.paramsStore,
            mandatedParams: getMandatedParams(),
            maxConnections: options.maxConnections,
            customHeaders: function(id) {
                return options.customHeaders.get(id);
            },
            log: options.log,
            onSend: options.onDelete,
            onComplete: options.onDeleteComplete,
            cors: options.cors
        }));
        qq.extend(this, {
            sendDelete: function(id, uuid, additionalMandatedParams) {
                var additionalOptions = additionalMandatedParams || {};
                options.log("Submitting delete file request for " + id);
                if (options.method === "DELETE") {
                    requester.initTransport(id).withPath(uuid).withParams(additionalOptions).send();
                } else {
                    additionalOptions[options.uuidParamName] = uuid;
                    requester.initTransport(id).withParams(additionalOptions).send();
                }
            }
        });
    };
    (function() {
        function detectSubsampling(img) {
            var iw = img.naturalWidth, ih = img.naturalHeight, canvas = document.createElement("canvas"), ctx;
            if (iw * ih > 1024 * 1024) {
                canvas.width = canvas.height = 1;
                ctx = canvas.getContext("2d");
                ctx.drawImage(img, -iw + 1, 0);
                return ctx.getImageData(0, 0, 1, 1).data[3] === 0;
            } else {
                return false;
            }
        }
        function detectVerticalSquash(img, iw, ih) {
            var canvas = document.createElement("canvas"), sy = 0, ey = ih, py = ih, ctx, data, alpha, ratio;
            canvas.width = 1;
            canvas.height = ih;
            ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            data = ctx.getImageData(0, 0, 1, ih).data;
            while (py > sy) {
                alpha = data[(py - 1) * 4 + 3];
                if (alpha === 0) {
                    ey = py;
                } else {
                    sy = py;
                }
                py = ey + sy >> 1;
            }
            ratio = py / ih;
            return ratio === 0 ? 1 : ratio;
        }
        function renderImageToDataURL(img, blob, options, doSquash) {
            var canvas = document.createElement("canvas"), mime = options.mime || "image/jpeg", promise = new qq.Promise();
            renderImageToCanvas(img, blob, canvas, options, doSquash).then(function() {
                promise.success(canvas.toDataURL(mime, options.quality || .8));
            });
            return promise;
        }
        function maybeCalculateDownsampledDimensions(spec) {
            var maxPixels = 5241e3;
            if (!qq.ios()) {
                throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");
            }
            if (spec.origHeight * spec.origWidth > maxPixels) {
                return {
                    newHeight: Math.round(Math.sqrt(maxPixels * (spec.origHeight / spec.origWidth))),
                    newWidth: Math.round(Math.sqrt(maxPixels * (spec.origWidth / spec.origHeight)))
                };
            }
        }
        function renderImageToCanvas(img, blob, canvas, options, doSquash) {
            var iw = img.naturalWidth, ih = img.naturalHeight, width = options.width, height = options.height, ctx = canvas.getContext("2d"), promise = new qq.Promise(), modifiedDimensions;
            ctx.save();
            if (options.resize) {
                return renderImageToCanvasWithCustomResizer({
                    blob: blob,
                    canvas: canvas,
                    image: img,
                    imageHeight: ih,
                    imageWidth: iw,
                    orientation: options.orientation,
                    resize: options.resize,
                    targetHeight: height,
                    targetWidth: width
                });
            }
            if (!qq.supportedFeatures.unlimitedScaledImageSize) {
                modifiedDimensions = maybeCalculateDownsampledDimensions({
                    origWidth: width,
                    origHeight: height
                });
                if (modifiedDimensions) {
                    qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h", width, height, modifiedDimensions.newWidth, modifiedDimensions.newHeight), "warn");
                    width = modifiedDimensions.newWidth;
                    height = modifiedDimensions.newHeight;
                }
            }
            transformCoordinate(canvas, width, height, options.orientation);
            if (qq.ios()) {
                (function() {
                    if (detectSubsampling(img)) {
                        iw /= 2;
                        ih /= 2;
                    }
                    var d = 1024, tmpCanvas = document.createElement("canvas"), vertSquashRatio = doSquash ? detectVerticalSquash(img, iw, ih) : 1, dw = Math.ceil(d * width / iw), dh = Math.ceil(d * height / ih / vertSquashRatio), sy = 0, dy = 0, tmpCtx, sx, dx;
                    tmpCanvas.width = tmpCanvas.height = d;
                    tmpCtx = tmpCanvas.getContext("2d");
                    while (sy < ih) {
                        sx = 0;
                        dx = 0;
                        while (sx < iw) {
                            tmpCtx.clearRect(0, 0, d, d);
                            tmpCtx.drawImage(img, -sx, -sy);
                            ctx.drawImage(tmpCanvas, 0, 0, d, d, dx, dy, dw, dh);
                            sx += d;
                            dx += dw;
                        }
                        sy += d;
                        dy += dh;
                    }
                    ctx.restore();
                    tmpCanvas = tmpCtx = null;
                })();
            } else {
                ctx.drawImage(img, 0, 0, width, height);
            }
            canvas.qqImageRendered && canvas.qqImageRendered();
            promise.success();
            return promise;
        }
        function renderImageToCanvasWithCustomResizer(resizeInfo) {
            var blob = resizeInfo.blob, image = resizeInfo.image, imageHeight = resizeInfo.imageHeight, imageWidth = resizeInfo.imageWidth, orientation = resizeInfo.orientation, promise = new qq.Promise(), resize = resizeInfo.resize, sourceCanvas = document.createElement("canvas"), sourceCanvasContext = sourceCanvas.getContext("2d"), targetCanvas = resizeInfo.canvas, targetHeight = resizeInfo.targetHeight, targetWidth = resizeInfo.targetWidth;
            transformCoordinate(sourceCanvas, imageWidth, imageHeight, orientation);
            targetCanvas.height = targetHeight;
            targetCanvas.width = targetWidth;
            sourceCanvasContext.drawImage(image, 0, 0);
            resize({
                blob: blob,
                height: targetHeight,
                image: image,
                sourceCanvas: sourceCanvas,
                targetCanvas: targetCanvas,
                width: targetWidth
            }).then(function success() {
                targetCanvas.qqImageRendered && targetCanvas.qqImageRendered();
                promise.success();
            }, promise.failure);
            return promise;
        }
        function transformCoordinate(canvas, width, height, orientation) {
            switch (orientation) {
              case 5:
              case 6:
              case 7:
              case 8:
                canvas.width = height;
                canvas.height = width;
                break;

              default:
                canvas.width = width;
                canvas.height = height;
            }
            var ctx = canvas.getContext("2d");
            switch (orientation) {
              case 2:
                ctx.translate(width, 0);
                ctx.scale(-1, 1);
                break;

              case 3:
                ctx.translate(width, height);
                ctx.rotate(Math.PI);
                break;

              case 4:
                ctx.translate(0, height);
                ctx.scale(1, -1);
                break;

              case 5:
                ctx.rotate(.5 * Math.PI);
                ctx.scale(1, -1);
                break;

              case 6:
                ctx.rotate(.5 * Math.PI);
                ctx.translate(0, -height);
                break;

              case 7:
                ctx.rotate(.5 * Math.PI);
                ctx.translate(width, -height);
                ctx.scale(-1, 1);
                break;

              case 8:
                ctx.rotate(-.5 * Math.PI);
                ctx.translate(-width, 0);
                break;

              default:
                break;
            }
        }
        function MegaPixImage(srcImage, errorCallback) {
            var self = this;
            if (window.Blob && srcImage instanceof Blob) {
                (function() {
                    var img = new Image(), URL = window.URL && window.URL.createObjectURL ? window.URL : window.webkitURL && window.webkitURL.createObjectURL ? window.webkitURL : null;
                    if (!URL) {
                        throw Error("No createObjectURL function found to create blob url");
                    }
                    img.src = URL.createObjectURL(srcImage);
                    self.blob = srcImage;
                    srcImage = img;
                })();
            }
            if (!srcImage.naturalWidth && !srcImage.naturalHeight) {
                srcImage.onload = function() {
                    var listeners = self.imageLoadListeners;
                    if (listeners) {
                        self.imageLoadListeners = null;
                        setTimeout(function() {
                            for (var i = 0, len = listeners.length; i < len; i++) {
                                listeners[i]();
                            }
                        }, 0);
                    }
                };
                srcImage.onerror = errorCallback;
                this.imageLoadListeners = [];
            }
            this.srcImage = srcImage;
        }
        MegaPixImage.prototype.render = function(target, options) {
            options = options || {};
            var self = this, imgWidth = this.srcImage.naturalWidth, imgHeight = this.srcImage.naturalHeight, width = options.width, height = options.height, maxWidth = options.maxWidth, maxHeight = options.maxHeight, doSquash = !this.blob || this.blob.type === "image/jpeg", tagName = target.tagName.toLowerCase(), opt;
            if (this.imageLoadListeners) {
                this.imageLoadListeners.push(function() {
                    self.render(target, options);
                });
                return;
            }
            if (width && !height) {
                height = imgHeight * width / imgWidth << 0;
            } else if (height && !width) {
                width = imgWidth * height / imgHeight << 0;
            } else {
                width = imgWidth;
                height = imgHeight;
            }
            if (maxWidth && width > maxWidth) {
                width = maxWidth;
                height = imgHeight * width / imgWidth << 0;
            }
            if (maxHeight && height > maxHeight) {
                height = maxHeight;
                width = imgWidth * height / imgHeight << 0;
            }
            opt = {
                width: width,
                height: height
            }, qq.each(options, function(optionsKey, optionsValue) {
                opt[optionsKey] = optionsValue;
            });
            if (tagName === "img") {
                (function() {
                    var oldTargetSrc = target.src;
                    renderImageToDataURL(self.srcImage, self.blob, opt, doSquash).then(function(dataUri) {
                        target.src = dataUri;
                        oldTargetSrc === target.src && target.onload();
                    });
                })();
            } else if (tagName === "canvas") {
                renderImageToCanvas(this.srcImage, this.blob, target, opt, doSquash);
            }
            if (typeof this.onrender === "function") {
                this.onrender(target);
            }
        };
        qq.MegaPixImage = MegaPixImage;
    })();
    qq.ImageGenerator = function(log) {
        "use strict";
        function isImg(el) {
            return el.tagName.toLowerCase() === "img";
        }
        function isCanvas(el) {
            return el.tagName.toLowerCase() === "canvas";
        }
        function isImgCorsSupported() {
            return new Image().crossOrigin !== undefined;
        }
        function isCanvasSupported() {
            var canvas = document.createElement("canvas");
            return canvas.getContext && canvas.getContext("2d");
        }
        function determineMimeOfFileName(nameWithPath) {
            var pathSegments = nameWithPath.split("/"), name = pathSegments[pathSegments.length - 1].split("?")[0], extension = qq.getExtension(name);
            extension = extension && extension.toLowerCase();
            switch (extension) {
              case "jpeg":
              case "jpg":
                return "image/jpeg";

              case "png":
                return "image/png";

              case "bmp":
                return "image/bmp";

              case "gif":
                return "image/gif";

              case "tiff":
              case "tif":
                return "image/tiff";
            }
        }
        function isCrossOrigin(url) {
            var targetAnchor = document.createElement("a"), targetProtocol, targetHostname, targetPort;
            targetAnchor.href = url;
            targetProtocol = targetAnchor.protocol;
            targetPort = targetAnchor.port;
            targetHostname = targetAnchor.hostname;
            if (targetProtocol.toLowerCase() !== window.location.protocol.toLowerCase()) {
                return true;
            }
            if (targetHostname.toLowerCase() !== window.location.hostname.toLowerCase()) {
                return true;
            }
            if (targetPort !== window.location.port && !qq.ie()) {
                return true;
            }
            return false;
        }
        function registerImgLoadListeners(img, promise) {
            img.onload = function() {
                img.onload = null;
                img.onerror = null;
                promise.success(img);
            };
            img.onerror = function() {
                img.onload = null;
                img.onerror = null;
                log("Problem drawing thumbnail!", "error");
                promise.failure(img, "Problem drawing thumbnail!");
            };
        }
        function registerCanvasDrawImageListener(canvas, promise) {
            canvas.qqImageRendered = function() {
                promise.success(canvas);
            };
        }
        function registerThumbnailRenderedListener(imgOrCanvas, promise) {
            var registered = isImg(imgOrCanvas) || isCanvas(imgOrCanvas);
            if (isImg(imgOrCanvas)) {
                registerImgLoadListeners(imgOrCanvas, promise);
            } else if (isCanvas(imgOrCanvas)) {
                registerCanvasDrawImageListener(imgOrCanvas, promise);
            } else {
                promise.failure(imgOrCanvas);
                log(qq.format("Element container of type {} is not supported!", imgOrCanvas.tagName), "error");
            }
            return registered;
        }
        function draw(fileOrBlob, container, options) {
            var drawPreview = new qq.Promise(), identifier = new qq.Identify(fileOrBlob, log), maxSize = options.maxSize, orient = options.orient == null ? true : options.orient, megapixErrorHandler = function() {
                container.onerror = null;
                container.onload = null;
                log("Could not render preview, file may be too large!", "error");
                drawPreview.failure(container, "Browser cannot render image!");
            };
            identifier.isPreviewable().then(function(mime) {
                var dummyExif = {
                    parse: function() {
                        return new qq.Promise().success();
                    }
                }, exif = orient ? new qq.Exif(fileOrBlob, log) : dummyExif, mpImg = new qq.MegaPixImage(fileOrBlob, megapixErrorHandler);
                if (registerThumbnailRenderedListener(container, drawPreview)) {
                    exif.parse().then(function(exif) {
                        var orientation = exif && exif.Orientation;
                        mpImg.render(container, {
                            maxWidth: maxSize,
                            maxHeight: maxSize,
                            orientation: orientation,
                            mime: mime,
                            resize: options.customResizeFunction
                        });
                    }, function(failureMsg) {
                        log(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.", failureMsg));
                        mpImg.render(container, {
                            maxWidth: maxSize,
                            maxHeight: maxSize,
                            mime: mime,
                            resize: options.customResizeFunction
                        });
                    });
                }
            }, function() {
                log("Not previewable");
                drawPreview.failure(container, "Not previewable");
            });
            return drawPreview;
        }
        function drawOnCanvasOrImgFromUrl(url, canvasOrImg, draw, maxSize, customResizeFunction) {
            var tempImg = new Image(), tempImgRender = new qq.Promise();
            registerThumbnailRenderedListener(tempImg, tempImgRender);
            if (isCrossOrigin(url)) {
                tempImg.crossOrigin = "anonymous";
            }
            tempImg.src = url;
            tempImgRender.then(function rendered() {
                registerThumbnailRenderedListener(canvasOrImg, draw);
                var mpImg = new qq.MegaPixImage(tempImg);
                mpImg.render(canvasOrImg, {
                    maxWidth: maxSize,
                    maxHeight: maxSize,
                    mime: determineMimeOfFileName(url),
                    resize: customResizeFunction
                });
            }, draw.failure);
        }
        function drawOnImgFromUrlWithCssScaling(url, img, draw, maxSize) {
            registerThumbnailRenderedListener(img, draw);
            qq(img).css({
                maxWidth: maxSize + "px",
                maxHeight: maxSize + "px"
            });
            img.src = url;
        }
        function drawFromUrl(url, container, options) {
            var draw = new qq.Promise(), scale = options.scale, maxSize = scale ? options.maxSize : null;
            if (scale && isImg(container)) {
                if (isCanvasSupported()) {
                    if (isCrossOrigin(url) && !isImgCorsSupported()) {
                        drawOnImgFromUrlWithCssScaling(url, container, draw, maxSize);
                    } else {
                        drawOnCanvasOrImgFromUrl(url, container, draw, maxSize);
                    }
                } else {
                    drawOnImgFromUrlWithCssScaling(url, container, draw, maxSize);
                }
            } else if (isCanvas(container)) {
                drawOnCanvasOrImgFromUrl(url, container, draw, maxSize);
            } else if (registerThumbnailRenderedListener(container, draw)) {
                container.src = url;
            }
            return draw;
        }
        qq.extend(this, {
            generate: function(fileBlobOrUrl, container, options) {
                if (qq.isString(fileBlobOrUrl)) {
                    log("Attempting to update thumbnail based on server response.");
                    return drawFromUrl(fileBlobOrUrl, container, options || {});
                } else {
                    log("Attempting to draw client-side image preview.");
                    return draw(fileBlobOrUrl, container, options || {});
                }
            }
        });
        this._testing = {};
        this._testing.isImg = isImg;
        this._testing.isCanvas = isCanvas;
        this._testing.isCrossOrigin = isCrossOrigin;
        this._testing.determineMimeOfFileName = determineMimeOfFileName;
    };
    qq.Exif = function(fileOrBlob, log) {
        "use strict";
        var TAG_IDS = [ 274 ], TAG_INFO = {
            274: {
                name: "Orientation",
                bytes: 2
            }
        };
        function parseLittleEndian(hex) {
            var result = 0, pow = 0;
            while (hex.length > 0) {
                result += parseInt(hex.substring(0, 2), 16) * Math.pow(2, pow);
                hex = hex.substring(2, hex.length);
                pow += 8;
            }
            return result;
        }
        function seekToApp1(offset, promise) {
            var theOffset = offset, thePromise = promise;
            if (theOffset === undefined) {
                theOffset = 2;
                thePromise = new qq.Promise();
            }
            qq.readBlobToHex(fileOrBlob, theOffset, 4).then(function(hex) {
                var match = /^ffe([0-9])/.exec(hex), segmentLength;
                if (match) {
                    if (match[1] !== "1") {
                        segmentLength = parseInt(hex.slice(4, 8), 16);
                        seekToApp1(theOffset + segmentLength + 2, thePromise);
                    } else {
                        thePromise.success(theOffset);
                    }
                } else {
                    thePromise.failure("No EXIF header to be found!");
                }
            });
            return thePromise;
        }
        function getApp1Offset() {
            var promise = new qq.Promise();
            qq.readBlobToHex(fileOrBlob, 0, 6).then(function(hex) {
                if (hex.indexOf("ffd8") !== 0) {
                    promise.failure("Not a valid JPEG!");
                } else {
                    seekToApp1().then(function(offset) {
                        promise.success(offset);
                    }, function(error) {
                        promise.failure(error);
                    });
                }
            });
            return promise;
        }
        function isLittleEndian(app1Start) {
            var promise = new qq.Promise();
            qq.readBlobToHex(fileOrBlob, app1Start + 10, 2).then(function(hex) {
                promise.success(hex === "4949");
            });
            return promise;
        }
        function getDirEntryCount(app1Start, littleEndian) {
            var promise = new qq.Promise();
            qq.readBlobToHex(fileOrBlob, app1Start + 18, 2).then(function(hex) {
                if (littleEndian) {
                    return promise.success(parseLittleEndian(hex));
                } else {
                    promise.success(parseInt(hex, 16));
                }
            });
            return promise;
        }
        function getIfd(app1Start, dirEntries) {
            var offset = app1Start + 20, bytes = dirEntries * 12;
            return qq.readBlobToHex(fileOrBlob, offset, bytes);
        }
        function getDirEntries(ifdHex) {
            var entries = [], offset = 0;
            while (offset + 24 <= ifdHex.length) {
                entries.push(ifdHex.slice(offset, offset + 24));
                offset += 24;
            }
            return entries;
        }
        function getTagValues(littleEndian, dirEntries) {
            var TAG_VAL_OFFSET = 16, tagsToFind = qq.extend([], TAG_IDS), vals = {};
            qq.each(dirEntries, function(idx, entry) {
                var idHex = entry.slice(0, 4), id = littleEndian ? parseLittleEndian(idHex) : parseInt(idHex, 16), tagsToFindIdx = tagsToFind.indexOf(id), tagValHex, tagName, tagValLength;
                if (tagsToFindIdx >= 0) {
                    tagName = TAG_INFO[id].name;
                    tagValLength = TAG_INFO[id].bytes;
                    tagValHex = entry.slice(TAG_VAL_OFFSET, TAG_VAL_OFFSET + tagValLength * 2);
                    vals[tagName] = littleEndian ? parseLittleEndian(tagValHex) : parseInt(tagValHex, 16);
                    tagsToFind.splice(tagsToFindIdx, 1);
                }
                if (tagsToFind.length === 0) {
                    return false;
                }
            });
            return vals;
        }
        qq.extend(this, {
            parse: function() {
                var parser = new qq.Promise(), onParseFailure = function(message) {
                    log(qq.format("EXIF header parse failed: '{}' ", message));
                    parser.failure(message);
                };
                getApp1Offset().then(function(app1Offset) {
                    log(qq.format("Moving forward with EXIF header parsing for '{}'", fileOrBlob.name === undefined ? "blob" : fileOrBlob.name));
                    isLittleEndian(app1Offset).then(function(littleEndian) {
                        log(qq.format("EXIF Byte order is {} endian", littleEndian ? "little" : "big"));
                        getDirEntryCount(app1Offset, littleEndian).then(function(dirEntryCount) {
                            log(qq.format("Found {} APP1 directory entries", dirEntryCount));
                            getIfd(app1Offset, dirEntryCount).then(function(ifdHex) {
                                var dirEntries = getDirEntries(ifdHex), tagValues = getTagValues(littleEndian, dirEntries);
                                log("Successfully parsed some EXIF tags");
                                parser.success(tagValues);
                            }, onParseFailure);
                        }, onParseFailure);
                    }, onParseFailure);
                }, onParseFailure);
                return parser;
            }
        });
        this._testing = {};
        this._testing.parseLittleEndian = parseLittleEndian;
    };
    qq.Identify = function(fileOrBlob, log) {
        "use strict";
        function isIdentifiable(magicBytes, questionableBytes) {
            var identifiable = false, magicBytesEntries = [].concat(magicBytes);
            qq.each(magicBytesEntries, function(idx, magicBytesArrayEntry) {
                if (questionableBytes.indexOf(magicBytesArrayEntry) === 0) {
                    identifiable = true;
                    return false;
                }
            });
            return identifiable;
        }
        qq.extend(this, {
            isPreviewable: function() {
                var self = this, identifier = new qq.Promise(), previewable = false, name = fileOrBlob.name === undefined ? "blob" : fileOrBlob.name;
                log(qq.format("Attempting to determine if {} can be rendered in this browser", name));
                log("First pass: check type attribute of blob object.");
                if (this.isPreviewableSync()) {
                    log("Second pass: check for magic bytes in file header.");
                    qq.readBlobToHex(fileOrBlob, 0, 4).then(function(hex) {
                        qq.each(self.PREVIEWABLE_MIME_TYPES, function(mime, bytes) {
                            if (isIdentifiable(bytes, hex)) {
                                if (mime !== "image/tiff" || qq.supportedFeatures.tiffPreviews) {
                                    previewable = true;
                                    identifier.success(mime);
                                }
                                return false;
                            }
                        });
                        log(qq.format("'{}' is {} able to be rendered in this browser", name, previewable ? "" : "NOT"));
                        if (!previewable) {
                            identifier.failure();
                        }
                    }, function() {
                        log("Error reading file w/ name '" + name + "'.  Not able to be rendered in this browser.");
                        identifier.failure();
                    });
                } else {
                    identifier.failure();
                }
                return identifier;
            },
            isPreviewableSync: function() {
                var fileMime = fileOrBlob.type, isRecognizedImage = qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES), fileMime) >= 0, previewable = false, name = fileOrBlob.name === undefined ? "blob" : fileOrBlob.name;
                if (isRecognizedImage) {
                    if (fileMime === "image/tiff") {
                        previewable = qq.supportedFeatures.tiffPreviews;
                    } else {
                        previewable = true;
                    }
                }
                !previewable && log(name + " is not previewable in this browser per the blob's type attr");
                return previewable;
            }
        });
    };
    qq.Identify.prototype.PREVIEWABLE_MIME_TYPES = {
        "image/jpeg": "ffd8ff",
        "image/gif": "474946",
        "image/png": "89504e",
        "image/bmp": "424d",
        "image/tiff": [ "49492a00", "4d4d002a" ]
    };
    qq.ImageValidation = function(blob, log) {
        "use strict";
        function hasNonZeroLimits(limits) {
            var atLeastOne = false;
            qq.each(limits, function(limit, value) {
                if (value > 0) {
                    atLeastOne = true;
                    return false;
                }
            });
            return atLeastOne;
        }
        function getWidthHeight() {
            var sizeDetermination = new qq.Promise();
            new qq.Identify(blob, log).isPreviewable().then(function() {
                var image = new Image(), url = window.URL && window.URL.createObjectURL ? window.URL : window.webkitURL && window.webkitURL.createObjectURL ? window.webkitURL : null;
                if (url) {
                    image.onerror = function() {
                        log("Cannot determine dimensions for image.  May be too large.", "error");
                        sizeDetermination.failure();
                    };
                    image.onload = function() {
                        sizeDetermination.success({
                            width: this.width,
                            height: this.height
                        });
                    };
                    image.src = url.createObjectURL(blob);
                } else {
                    log("No createObjectURL function available to generate image URL!", "error");
                    sizeDetermination.failure();
                }
            }, sizeDetermination.failure);
            return sizeDetermination;
        }
        function getFailingLimit(limits, dimensions) {
            var failingLimit;
            qq.each(limits, function(limitName, limitValue) {
                if (limitValue > 0) {
                    var limitMatcher = /(max|min)(Width|Height)/.exec(limitName), dimensionPropName = limitMatcher[2].charAt(0).toLowerCase() + limitMatcher[2].slice(1), actualValue = dimensions[dimensionPropName];
                    switch (limitMatcher[1]) {
                      case "min":
                        if (actualValue < limitValue) {
                            failingLimit = limitName;
                            return false;
                        }
                        break;

                      case "max":
                        if (actualValue > limitValue) {
                            failingLimit = limitName;
                            return false;
                        }
                        break;
                    }
                }
            });
            return failingLimit;
        }
        this.validate = function(limits) {
            var validationEffort = new qq.Promise();
            log("Attempting to validate image.");
            if (hasNonZeroLimits(limits)) {
                getWidthHeight().then(function(dimensions) {
                    var failingLimit = getFailingLimit(limits, dimensions);
                    if (failingLimit) {
                        validationEffort.failure(failingLimit);
                    } else {
                        validationEffort.success();
                    }
                }, validationEffort.success);
            } else {
                validationEffort.success();
            }
            return validationEffort;
        };
    };
    qq.Session = function(spec) {
        "use strict";
        var options = {
            endpoint: null,
            params: {},
            customHeaders: {},
            cors: {},
            addFileRecord: function(sessionData) {},
            log: function(message, level) {}
        };
        qq.extend(options, spec, true);
        function isJsonResponseValid(response) {
            if (qq.isArray(response)) {
                return true;
            }
            options.log("Session response is not an array.", "error");
        }
        function handleFileItems(fileItems, success, xhrOrXdr, promise) {
            var someItemsIgnored = false;
            success = success && isJsonResponseValid(fileItems);
            if (success) {
                qq.each(fileItems, function(idx, fileItem) {
                    if (fileItem.uuid == null) {
                        someItemsIgnored = true;
                        options.log(qq.format("Session response item {} did not include a valid UUID - ignoring.", idx), "error");
                    } else if (fileItem.name == null) {
                        someItemsIgnored = true;
                        options.log(qq.format("Session response item {} did not include a valid name - ignoring.", idx), "error");
                    } else {
                        try {
                            options.addFileRecord(fileItem);
                            return true;
                        } catch (err) {
                            someItemsIgnored = true;
                            options.log(err.message, "error");
                        }
                    }
                    return false;
                });
            }
            promise[success && !someItemsIgnored ? "success" : "failure"](fileItems, xhrOrXdr);
        }
        this.refresh = function() {
            var refreshEffort = new qq.Promise(), refreshCompleteCallback = function(response, success, xhrOrXdr) {
                handleFileItems(response, success, xhrOrXdr, refreshEffort);
            }, requesterOptions = qq.extend({}, options), requester = new qq.SessionAjaxRequester(qq.extend(requesterOptions, {
                onComplete: refreshCompleteCallback
            }));
            requester.queryServer();
            return refreshEffort;
        };
    };
    qq.SessionAjaxRequester = function(spec) {
        "use strict";
        var requester, options = {
            endpoint: null,
            customHeaders: {},
            params: {},
            cors: {
                expected: false,
                sendCredentials: false
            },
            onComplete: function(response, success, xhrOrXdr) {},
            log: function(str, level) {}
        };
        qq.extend(options, spec);
        function onComplete(id, xhrOrXdr, isError) {
            var response = null;
            if (xhrOrXdr.responseText != null) {
                try {
                    response = qq.parseJson(xhrOrXdr.responseText);
                } catch (err) {
                    options.log("Problem parsing session response: " + err.message, "error");
                    isError = true;
                }
            }
            options.onComplete(response, !isError, xhrOrXdr);
        }
        requester = qq.extend(this, new qq.AjaxRequester({
            acceptHeader: "application/json",
            validMethods: [ "GET" ],
            method: "GET",
            endpointStore: {
                get: function() {
                    return options.endpoint;
                }
            },
            customHeaders: options.customHeaders,
            log: options.log,
            onComplete: onComplete,
            cors: options.cors
        }));
        qq.extend(this, {
            queryServer: function() {
                var params = qq.extend({}, options.params);
                options.log("Session query request.");
                requester.initTransport("sessionRefresh").withParams(params).withCacheBuster().send();
            }
        });
    };
    qq.Scaler = function(spec, log) {
        "use strict";
        var self = this, customResizeFunction = spec.customResizer, includeOriginal = spec.sendOriginal, orient = spec.orient, defaultType = spec.defaultType, defaultQuality = spec.defaultQuality / 100, failedToScaleText = spec.failureText, includeExif = spec.includeExif, sizes = this._getSortedSizes(spec.sizes);
        qq.extend(this, {
            enabled: qq.supportedFeatures.scaling && sizes.length > 0,
            getFileRecords: function(originalFileUuid, originalFileName, originalBlobOrBlobData) {
                var self = this, records = [], originalBlob = originalBlobOrBlobData.blob ? originalBlobOrBlobData.blob : originalBlobOrBlobData, identifier = new qq.Identify(originalBlob, log);
                if (identifier.isPreviewableSync()) {
                    qq.each(sizes, function(idx, sizeRecord) {
                        var outputType = self._determineOutputType({
                            defaultType: defaultType,
                            requestedType: sizeRecord.type,
                            refType: originalBlob.type
                        });
                        records.push({
                            uuid: qq.getUniqueId(),
                            name: self._getName(originalFileName, {
                                name: sizeRecord.name,
                                type: outputType,
                                refType: originalBlob.type
                            }),
                            blob: new qq.BlobProxy(originalBlob, qq.bind(self._generateScaledImage, self, {
                                customResizeFunction: customResizeFunction,
                                maxSize: sizeRecord.maxSize,
                                orient: orient,
                                type: outputType,
                                quality: defaultQuality,
                                failedText: failedToScaleText,
                                includeExif: includeExif,
                                log: log
                            }))
                        });
                    });
                    records.push({
                        uuid: originalFileUuid,
                        name: originalFileName,
                        size: originalBlob.size,
                        blob: includeOriginal ? originalBlob : null
                    });
                } else {
                    records.push({
                        uuid: originalFileUuid,
                        name: originalFileName,
                        size: originalBlob.size,
                        blob: originalBlob
                    });
                }
                return records;
            },
            handleNewFile: function(file, name, uuid, size, fileList, batchId, uuidParamName, api) {
                var self = this, buttonId = file.qqButtonId || file.blob && file.blob.qqButtonId, scaledIds = [], originalId = null, addFileToHandler = api.addFileToHandler, uploadData = api.uploadData, paramsStore = api.paramsStore, proxyGroupId = qq.getUniqueId();
                qq.each(self.getFileRecords(uuid, name, file), function(idx, record) {
                    var blobSize = record.size, id;
                    if (record.blob instanceof qq.BlobProxy) {
                        blobSize = -1;
                    }
                    id = uploadData.addFile({
                        uuid: record.uuid,
                        name: record.name,
                        size: blobSize,
                        batchId: batchId,
                        proxyGroupId: proxyGroupId
                    });
                    if (record.blob instanceof qq.BlobProxy) {
                        scaledIds.push(id);
                    } else {
                        originalId = id;
                    }
                    if (record.blob) {
                        addFileToHandler(id, record.blob);
                        fileList.push({
                            id: id,
                            file: record.blob
                        });
                    } else {
                        uploadData.setStatus(id, qq.status.REJECTED);
                    }
                });
                if (originalId !== null) {
                    qq.each(scaledIds, function(idx, scaledId) {
                        var params = {
                            qqparentuuid: uploadData.retrieve({
                                id: originalId
                            }).uuid,
                            qqparentsize: uploadData.retrieve({
                                id: originalId
                            }).size
                        };
                        params[uuidParamName] = uploadData.retrieve({
                            id: scaledId
                        }).uuid;
                        uploadData.setParentId(scaledId, originalId);
                        paramsStore.addReadOnly(scaledId, params);
                    });
                    if (scaledIds.length) {
                        (function() {
                            var param = {};
                            param[uuidParamName] = uploadData.retrieve({
                                id: originalId
                            }).uuid;
                            paramsStore.addReadOnly(originalId, param);
                        })();
                    }
                }
            }
        });
    };
    qq.extend(qq.Scaler.prototype, {
        scaleImage: function(id, specs, api) {
            "use strict";
            if (!qq.supportedFeatures.scaling) {
                throw new qq.Error("Scaling is not supported in this browser!");
            }
            var scalingEffort = new qq.Promise(), log = api.log, file = api.getFile(id), uploadData = api.uploadData.retrieve({
                id: id
            }), name = uploadData && uploadData.name, uuid = uploadData && uploadData.uuid, scalingOptions = {
                customResizer: specs.customResizer,
                sendOriginal: false,
                orient: specs.orient,
                defaultType: specs.type || null,
                defaultQuality: specs.quality,
                failedToScaleText: "Unable to scale",
                sizes: [ {
                    name: "",
                    maxSize: specs.maxSize
                } ]
            }, scaler = new qq.Scaler(scalingOptions, log);
            if (!qq.Scaler || !qq.supportedFeatures.imagePreviews || !file) {
                scalingEffort.failure();
                log("Could not generate requested scaled image for " + id + ".  " + "Scaling is either not possible in this browser, or the file could not be located.", "error");
            } else {
                qq.bind(function() {
                    var record = scaler.getFileRecords(uuid, name, file)[0];
                    if (record && record.blob instanceof qq.BlobProxy) {
                        record.blob.create().then(scalingEffort.success, scalingEffort.failure);
                    } else {
                        log(id + " is not a scalable image!", "error");
                        scalingEffort.failure();
                    }
                }, this)();
            }
            return scalingEffort;
        },
        _determineOutputType: function(spec) {
            "use strict";
            var requestedType = spec.requestedType, defaultType = spec.defaultType, referenceType = spec.refType;
            if (!defaultType && !requestedType) {
                if (referenceType !== "image/jpeg") {
                    return "image/png";
                }
                return referenceType;
            }
            if (!requestedType) {
                return defaultType;
            }
            if (qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES), requestedType) >= 0) {
                if (requestedType === "image/tiff") {
                    return qq.supportedFeatures.tiffPreviews ? requestedType : defaultType;
                }
                return requestedType;
            }
            return defaultType;
        },
        _getName: function(originalName, scaledVersionProperties) {
            "use strict";
            var startOfExt = originalName.lastIndexOf("."), versionType = scaledVersionProperties.type || "image/png", referenceType = scaledVersionProperties.refType, scaledName = "", scaledExt = qq.getExtension(originalName), nameAppendage = "";
            if (scaledVersionProperties.name && scaledVersionProperties.name.trim().length) {
                nameAppendage = " (" + scaledVersionProperties.name + ")";
            }
            if (startOfExt >= 0) {
                scaledName = originalName.substr(0, startOfExt);
                if (referenceType !== versionType) {
                    scaledExt = versionType.split("/")[1];
                }
                scaledName += nameAppendage + "." + scaledExt;
            } else {
                scaledName = originalName + nameAppendage;
            }
            return scaledName;
        },
        _getSortedSizes: function(sizes) {
            "use strict";
            sizes = qq.extend([], sizes);
            return sizes.sort(function(a, b) {
                if (a.maxSize > b.maxSize) {
                    return 1;
                }
                if (a.maxSize < b.maxSize) {
                    return -1;
                }
                return 0;
            });
        },
        _generateScaledImage: function(spec, sourceFile) {
            "use strict";
            var self = this, customResizeFunction = spec.customResizeFunction, log = spec.log, maxSize = spec.maxSize, orient = spec.orient, type = spec.type, quality = spec.quality, failedText = spec.failedText, includeExif = spec.includeExif && sourceFile.type === "image/jpeg" && type === "image/jpeg", scalingEffort = new qq.Promise(), imageGenerator = new qq.ImageGenerator(log), canvas = document.createElement("canvas");
            log("Attempting to generate scaled version for " + sourceFile.name);
            imageGenerator.generate(sourceFile, canvas, {
                maxSize: maxSize,
                orient: orient,
                customResizeFunction: customResizeFunction
            }).then(function() {
                var scaledImageDataUri = canvas.toDataURL(type, quality), signalSuccess = function() {
                    log("Success generating scaled version for " + sourceFile.name);
                    var blob = qq.dataUriToBlob(scaledImageDataUri);
                    scalingEffort.success(blob);
                };
                if (includeExif) {
                    self._insertExifHeader(sourceFile, scaledImageDataUri, log).then(function(scaledImageDataUriWithExif) {
                        scaledImageDataUri = scaledImageDataUriWithExif;
                        signalSuccess();
                    }, function() {
                        log("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.", "error");
                        signalSuccess();
                    });
                } else {
                    signalSuccess();
                }
            }, function() {
                log("Failed attempt to generate scaled version for " + sourceFile.name, "error");
                scalingEffort.failure(failedText);
            });
            return scalingEffort;
        },
        _insertExifHeader: function(originalImage, scaledImageDataUri, log) {
            "use strict";
            var reader = new FileReader(), insertionEffort = new qq.Promise(), originalImageDataUri = "";
            reader.onload = function() {
                originalImageDataUri = reader.result;
                insertionEffort.success(qq.ExifRestorer.restore(originalImageDataUri, scaledImageDataUri));
            };
            reader.onerror = function() {
                log("Problem reading " + originalImage.name + " during attempt to transfer EXIF data to scaled version.", "error");
                insertionEffort.failure();
            };
            reader.readAsDataURL(originalImage);
            return insertionEffort;
        },
        _dataUriToBlob: function(dataUri) {
            "use strict";
            var byteString, mimeString, arrayBuffer, intArray;
            if (dataUri.split(",")[0].indexOf("base64") >= 0) {
                byteString = atob(dataUri.split(",")[1]);
            } else {
                byteString = decodeURI(dataUri.split(",")[1]);
            }
            mimeString = dataUri.split(",")[0].split(":")[1].split(";")[0];
            arrayBuffer = new ArrayBuffer(byteString.length);
            intArray = new Uint8Array(arrayBuffer);
            qq.each(byteString, function(idx, character) {
                intArray[idx] = character.charCodeAt(0);
            });
            return this._createBlob(arrayBuffer, mimeString);
        },
        _createBlob: function(data, mime) {
            "use strict";
            var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder, blobBuilder = BlobBuilder && new BlobBuilder();
            if (blobBuilder) {
                blobBuilder.append(data);
                return blobBuilder.getBlob(mime);
            } else {
                return new Blob([ data ], {
                    type: mime
                });
            }
        }
    });
    qq.ExifRestorer = function() {
        var ExifRestorer = {};
        ExifRestorer.KEY_STR = "ABCDEFGHIJKLMNOP" + "QRSTUVWXYZabcdef" + "ghijklmnopqrstuv" + "wxyz0123456789+/" + "=";
        ExifRestorer.encode64 = function(input) {
            var output = "", chr1, chr2, chr3 = "", enc1, enc2, enc3, enc4 = "", i = 0;
            do {
                chr1 = input[i++];
                chr2 = input[i++];
                chr3 = input[i++];
                enc1 = chr1 >> 2;
                enc2 = (chr1 & 3) << 4 | chr2 >> 4;
                enc3 = (chr2 & 15) << 2 | chr3 >> 6;
                enc4 = chr3 & 63;
                if (isNaN(chr2)) {
                    enc3 = enc4 = 64;
                } else if (isNaN(chr3)) {
                    enc4 = 64;
                }
                output = output + this.KEY_STR.charAt(enc1) + this.KEY_STR.charAt(enc2) + this.KEY_STR.charAt(enc3) + this.KEY_STR.charAt(enc4);
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
            } while (i < input.length);
            return output;
        };
        ExifRestorer.restore = function(origFileBase64, resizedFileBase64) {
            var expectedBase64Header = "data:image/jpeg;base64,";
            if (!origFileBase64.match(expectedBase64Header)) {
                return resizedFileBase64;
            }
            var rawImage = this.decode64(origFileBase64.replace(expectedBase64Header, ""));
            var segments = this.slice2Segments(rawImage);
            var image = this.exifManipulation(resizedFileBase64, segments);
            return expectedBase64Header + this.encode64(image);
        };
        ExifRestorer.exifManipulation = function(resizedFileBase64, segments) {
            var exifArray = this.getExifArray(segments), newImageArray = this.insertExif(resizedFileBase64, exifArray), aBuffer = new Uint8Array(newImageArray);
            return aBuffer;
        };
        ExifRestorer.getExifArray = function(segments) {
            var seg;
            for (var x = 0; x < segments.length; x++) {
                seg = segments[x];
                if (seg[0] == 255 & seg[1] == 225) {
                    return seg;
                }
            }
            return [];
        };
        ExifRestorer.insertExif = function(resizedFileBase64, exifArray) {
            var imageData = resizedFileBase64.replace("data:image/jpeg;base64,", ""), buf = this.decode64(imageData), separatePoint = buf.indexOf(255, 3), mae = buf.slice(0, separatePoint), ato = buf.slice(separatePoint), array = mae;
            array = array.concat(exifArray);
            array = array.concat(ato);
            return array;
        };
        ExifRestorer.slice2Segments = function(rawImageArray) {
            var head = 0, segments = [];
            while (1) {
                if (rawImageArray[head] == 255 & rawImageArray[head + 1] == 218) {
                    break;
                }
                if (rawImageArray[head] == 255 & rawImageArray[head + 1] == 216) {
                    head += 2;
                } else {
                    var length = rawImageArray[head + 2] * 256 + rawImageArray[head + 3], endPoint = head + length + 2, seg = rawImageArray.slice(head, endPoint);
                    segments.push(seg);
                    head = endPoint;
                }
                if (head > rawImageArray.length) {
                    break;
                }
            }
            return segments;
        };
        ExifRestorer.decode64 = function(input) {
            var output = "", chr1, chr2, chr3 = "", enc1, enc2, enc3, enc4 = "", i = 0, buf = [];
            var base64test = /[^A-Za-z0-9\+\/\=]/g;
            if (base64test.exec(input)) {
                throw new Error("There were invalid base64 characters in the input text.  " + "Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");
            }
            input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
            do {
                enc1 = this.KEY_STR.indexOf(input.charAt(i++));
                enc2 = this.KEY_STR.indexOf(input.charAt(i++));
                enc3 = this.KEY_STR.indexOf(input.charAt(i++));
                enc4 = this.KEY_STR.indexOf(input.charAt(i++));
                chr1 = enc1 << 2 | enc2 >> 4;
                chr2 = (enc2 & 15) << 4 | enc3 >> 2;
                chr3 = (enc3 & 3) << 6 | enc4;
                buf.push(chr1);
                if (enc3 != 64) {
                    buf.push(chr2);
                }
                if (enc4 != 64) {
                    buf.push(chr3);
                }
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
            } while (i < input.length);
            return buf;
        };
        return ExifRestorer;
    }();
    qq.TotalProgress = function(callback, getSize) {
        "use strict";
        var perFileProgress = {}, totalLoaded = 0, totalSize = 0, lastLoadedSent = -1, lastTotalSent = -1, callbackProxy = function(loaded, total) {
            if (loaded !== lastLoadedSent || total !== lastTotalSent) {
                callback(loaded, total);
            }
            lastLoadedSent = loaded;
            lastTotalSent = total;
        }, noRetryableFiles = function(failed, retryable) {
            var none = true;
            qq.each(failed, function(idx, failedId) {
                if (qq.indexOf(retryable, failedId) >= 0) {
                    none = false;
                    return false;
                }
            });
            return none;
        }, onCancel = function(id) {
            updateTotalProgress(id, -1, -1);
            delete perFileProgress[id];
        }, onAllComplete = function(successful, failed, retryable) {
            if (failed.length === 0 || noRetryableFiles(failed, retryable)) {
                callbackProxy(totalSize, totalSize);
                this.reset();
            }
        }, onNew = function(id) {
            var size = getSize(id);
            if (size > 0) {
                updateTotalProgress(id, 0, size);
                perFileProgress[id] = {
                    loaded: 0,
                    total: size
                };
            }
        }, updateTotalProgress = function(id, newLoaded, newTotal) {
            var oldLoaded = perFileProgress[id] ? perFileProgress[id].loaded : 0, oldTotal = perFileProgress[id] ? perFileProgress[id].total : 0;
            if (newLoaded === -1 && newTotal === -1) {
                totalLoaded -= oldLoaded;
                totalSize -= oldTotal;
            } else {
                if (newLoaded) {
                    totalLoaded += newLoaded - oldLoaded;
                }
                if (newTotal) {
                    totalSize += newTotal - oldTotal;
                }
            }
            callbackProxy(totalLoaded, totalSize);
        };
        qq.extend(this, {
            onAllComplete: onAllComplete,
            onStatusChange: function(id, oldStatus, newStatus) {
                if (newStatus === qq.status.CANCELED || newStatus === qq.status.REJECTED) {
                    onCancel(id);
                } else if (newStatus === qq.status.SUBMITTING) {
                    onNew(id);
                }
            },
            onIndividualProgress: function(id, loaded, total) {
                updateTotalProgress(id, loaded, total);
                perFileProgress[id] = {
                    loaded: loaded,
                    total: total
                };
            },
            onNewSize: function(id) {
                onNew(id);
            },
            reset: function() {
                perFileProgress = {};
                totalLoaded = 0;
                totalSize = 0;
            }
        });
    };
    qq.PasteSupport = function(o) {
        "use strict";
        var options, detachPasteHandler;
        options = {
            targetElement: null,
            callbacks: {
                log: function(message, level) {},
                pasteReceived: function(blob) {}
            }
        };
        function isImage(item) {
            return item.type && item.type.indexOf("image/") === 0;
        }
        function registerPasteHandler() {
            detachPasteHandler = qq(options.targetElement).attach("paste", function(event) {
                var clipboardData = event.clipboardData;
                if (clipboardData) {
                    qq.each(clipboardData.items, function(idx, item) {
                        if (isImage(item)) {
                            var blob = item.getAsFile();
                            options.callbacks.pasteReceived(blob);
                        }
                    });
                }
            });
        }
        function unregisterPasteHandler() {
            if (detachPasteHandler) {
                detachPasteHandler();
            }
        }
        qq.extend(options, o);
        registerPasteHandler();
        qq.extend(this, {
            reset: function() {
                unregisterPasteHandler();
            }
        });
    };
    qq.FormSupport = function(options, startUpload, log) {
        "use strict";
        var self = this, interceptSubmit = options.interceptSubmit, formEl = options.element, autoUpload = options.autoUpload;
        qq.extend(this, {
            newEndpoint: null,
            newAutoUpload: autoUpload,
            attachedToForm: false,
            getFormInputsAsObject: function() {
                if (formEl == null) {
                    return null;
                }
                return self._form2Obj(formEl);
            }
        });
        function determineNewEndpoint(formEl) {
            if (formEl.getAttribute("action")) {
                self.newEndpoint = formEl.getAttribute("action");
            }
        }
        function validateForm(formEl, nativeSubmit) {
            if (formEl.checkValidity && !formEl.checkValidity()) {
                log("Form did not pass validation checks - will not upload.", "error");
                nativeSubmit();
            } else {
                return true;
            }
        }
        function maybeUploadOnSubmit(formEl) {
            var nativeSubmit = formEl.submit;
            qq(formEl).attach("submit", function(event) {
                event = event || window.event;
                if (event.preventDefault) {
                    event.preventDefault();
                } else {
                    event.returnValue = false;
                }
                validateForm(formEl, nativeSubmit) && startUpload();
            });
            formEl.submit = function() {
                validateForm(formEl, nativeSubmit) && startUpload();
            };
        }
        function determineFormEl(formEl) {
            if (formEl) {
                if (qq.isString(formEl)) {
                    formEl = document.getElementById(formEl);
                }
                if (formEl) {
                    log("Attaching to form element.");
                    determineNewEndpoint(formEl);
                    interceptSubmit && maybeUploadOnSubmit(formEl);
                }
            }
            return formEl;
        }
        formEl = determineFormEl(formEl);
        this.attachedToForm = !!formEl;
    };
    qq.extend(qq.FormSupport.prototype, {
        _form2Obj: function(form) {
            "use strict";
            var obj = {}, notIrrelevantType = function(type) {
                var irrelevantTypes = [ "button", "image", "reset", "submit" ];
                return qq.indexOf(irrelevantTypes, type.toLowerCase()) < 0;
            }, radioOrCheckbox = function(type) {
                return qq.indexOf([ "checkbox", "radio" ], type.toLowerCase()) >= 0;
            }, ignoreValue = function(el) {
                if (radioOrCheckbox(el.type) && !el.checked) {
                    return true;
                }
                return el.disabled && el.type.toLowerCase() !== "hidden";
            }, selectValue = function(select) {
                var value = null;
                qq.each(qq(select).children(), function(idx, child) {
                    if (child.tagName.toLowerCase() === "option" && child.selected) {
                        value = child.value;
                        return false;
                    }
                });
                return value;
            };
            qq.each(form.elements, function(idx, el) {
                if ((qq.isInput(el, true) || el.tagName.toLowerCase() === "textarea") && notIrrelevantType(el.type) && !ignoreValue(el)) {
                    obj[el.name] = el.value;
                } else if (el.tagName.toLowerCase() === "select" && !ignoreValue(el)) {
                    var value = selectValue(el);
                    if (value !== null) {
                        obj[el.name] = value;
                    }
                }
            });
            return obj;
        }
    });
    qq.traditional = qq.traditional || {};
    qq.traditional.FormUploadHandler = function(options, proxy) {
        "use strict";
        var handler = this, getName = proxy.getName, getUuid = proxy.getUuid, log = proxy.log;
        function getIframeContentJson(id, iframe) {
            var response, doc, innerHtml;
            try {
                doc = iframe.contentDocument || iframe.contentWindow.document;
                innerHtml = doc.body.innerHTML;
                log("converting iframe's innerHTML to JSON");
                log("innerHTML = " + innerHtml);
                if (innerHtml && innerHtml.match(/^<pre/i)) {
                    innerHtml = doc.body.firstChild.firstChild.nodeValue;
                }
                response = handler._parseJsonResponse(innerHtml);
            } catch (error) {
                log("Error when attempting to parse form upload response (" + error.message + ")", "error");
                response = {
                    success: false
                };
            }
            return response;
        }
        function createForm(id, iframe) {
            var params = options.paramsStore.get(id), method = options.method.toLowerCase() === "get" ? "GET" : "POST", endpoint = options.endpointStore.get(id), name = getName(id);
            params[options.uuidName] = getUuid(id);
            params[options.filenameParam] = name;
            return handler._initFormForUpload({
                method: method,
                endpoint: endpoint,
                params: params,
                paramsInBody: options.paramsInBody,
                targetName: iframe.name
            });
        }
        this.uploadFile = function(id) {
            var input = handler.getInput(id), iframe = handler._createIframe(id), promise = new qq.Promise(), form;
            form = createForm(id, iframe);
            form.appendChild(input);
            handler._attachLoadEvent(iframe, function(responseFromMessage) {
                log("iframe loaded");
                var response = responseFromMessage ? responseFromMessage : getIframeContentJson(id, iframe);
                handler._detachLoadEvent(id);
                if (!options.cors.expected) {
                    qq(iframe).remove();
                }
                if (response.success) {
                    promise.success(response);
                } else {
                    promise.failure(response);
                }
            });
            log("Sending upload request for " + id);
            form.submit();
            qq(form).remove();
            return promise;
        };
        qq.extend(this, new qq.FormUploadHandler({
            options: {
                isCors: options.cors.expected,
                inputName: options.inputName
            },
            proxy: {
                onCancel: options.onCancel,
                getName: getName,
                getUuid: getUuid,
                log: log
            }
        }));
    };
    qq.traditional = qq.traditional || {};
    qq.traditional.XhrUploadHandler = function(spec, proxy) {
        "use strict";
        var handler = this, getName = proxy.getName, getSize = proxy.getSize, getUuid = proxy.getUuid, log = proxy.log, multipart = spec.forceMultipart || spec.paramsInBody, addChunkingSpecificParams = function(id, params, chunkData) {
            var size = getSize(id), name = getName(id);
            if (!spec.omitDefaultParams) {
                params[spec.chunking.paramNames.partIndex] = chunkData.part;
                params[spec.chunking.paramNames.partByteOffset] = chunkData.start;
                params[spec.chunking.paramNames.chunkSize] = chunkData.size;
                params[spec.chunking.paramNames.totalParts] = chunkData.count;
                params[spec.totalFileSizeName] = size;
            }
            if (multipart && !spec.omitDefaultParams) {
                params[spec.filenameParam] = name;
            }
        }, allChunksDoneRequester = new qq.traditional.AllChunksDoneAjaxRequester({
            cors: spec.cors,
            endpoint: spec.chunking.success.endpoint,
            headers: spec.chunking.success.headers,
            jsonPayload: spec.chunking.success.jsonPayload,
            log: log,
            method: spec.chunking.success.method,
            params: spec.chunking.success.params
        }), createReadyStateChangedHandler = function(id, xhr) {
            var promise = new qq.Promise();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    var result = onUploadOrChunkComplete(id, xhr);
                    if (result.success) {
                        promise.success(result.response, xhr);
                    } else {
                        promise.failure(result.response, xhr);
                    }
                }
            };
            return promise;
        }, getChunksCompleteParams = function(id) {
            var params = spec.paramsStore.get(id), name = getName(id), size = getSize(id);
            params[spec.uuidName] = getUuid(id);
            params[spec.filenameParam] = name;
            params[spec.totalFileSizeName] = size;
            params[spec.chunking.paramNames.totalParts] = handler._getTotalChunks(id);
            return params;
        }, isErrorUploadResponse = function(xhr, response) {
            return qq.indexOf([ 200, 201, 202, 203, 204 ], xhr.status) < 0 || spec.requireSuccessJson && !response.success || response.reset;
        }, onUploadOrChunkComplete = function(id, xhr) {
            var response;
            log("xhr - server response received for " + id);
            log("responseText = " + xhr.responseText);
            response = parseResponse(true, xhr);
            return {
                success: !isErrorUploadResponse(xhr, response),
                response: response
            };
        }, parseResponse = function(upload, xhr) {
            var response = {};
            try {
                log(qq.format("Received response status {} with body: {}", xhr.status, xhr.responseText));
                response = qq.parseJson(xhr.responseText);
            } catch (error) {
                upload && spec.requireSuccessJson && log("Error when attempting to parse xhr response text (" + error.message + ")", "error");
            }
            return response;
        }, sendChunksCompleteRequest = function(id) {
            var promise = new qq.Promise();
            allChunksDoneRequester.complete(id, handler._createXhr(id), getChunksCompleteParams(id), spec.customHeaders.get(id)).then(function(xhr) {
                promise.success(parseResponse(false, xhr), xhr);
            }, function(xhr) {
                promise.failure(parseResponse(false, xhr), xhr);
            });
            return promise;
        }, setParamsAndGetEntityToSend = function(entityToSendParams) {
            var fileOrBlob = entityToSendParams.fileOrBlob;
            var id = entityToSendParams.id;
            var xhr = entityToSendParams.xhr;
            var xhrOverrides = entityToSendParams.xhrOverrides || {};
            var customParams = entityToSendParams.customParams || {};
            var defaultParams = entityToSendParams.params || {};
            var xhrOverrideParams = xhrOverrides.params || {};
            var params;
            var formData = multipart ? new FormData() : null, method = xhrOverrides.method || spec.method, endpoint = xhrOverrides.endpoint || spec.endpointStore.get(id), name = getName(id), size = getSize(id);
            if (spec.omitDefaultParams) {
                params = qq.extend({}, customParams);
                qq.extend(params, xhrOverrideParams);
            } else {
                params = qq.extend({}, customParams);
                qq.extend(params, xhrOverrideParams);
                qq.extend(params, defaultParams);
                params[spec.uuidName] = getUuid(id);
                params[spec.filenameParam] = name;
                if (multipart) {
                    params[spec.totalFileSizeName] = size;
                } else if (!spec.paramsInBody) {
                    params[spec.inputName] = name;
                }
            }
            if (!spec.paramsInBody) {
                endpoint = qq.obj2url(params, endpoint);
            }
            xhr.open(method, endpoint, true);
            if (spec.cors.expected && spec.cors.sendCredentials) {
                xhr.withCredentials = true;
            }
            if (multipart) {
                if (spec.paramsInBody) {
                    qq.obj2FormData(params, formData);
                }
                formData.append(spec.inputName, fileOrBlob);
                return formData;
            }
            return fileOrBlob;
        }, setUploadHeaders = function(headersOptions) {
            var headerOverrides = headersOptions.headerOverrides;
            var id = headersOptions.id;
            var xhr = headersOptions.xhr;
            if (headerOverrides) {
                qq.each(headerOverrides, function(headerName, headerValue) {
                    xhr.setRequestHeader(headerName, headerValue);
                });
            } else {
                var extraHeaders = spec.customHeaders.get(id), fileOrBlob = handler.getFile(id);
                xhr.setRequestHeader("Accept", "application/json");
                xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
                xhr.setRequestHeader("Cache-Control", "no-cache");
                if (!multipart) {
                    xhr.setRequestHeader("Content-Type", "application/octet-stream");
                    xhr.setRequestHeader("X-Mime-Type", fileOrBlob.type);
                }
                qq.each(extraHeaders, function(name, val) {
                    xhr.setRequestHeader(name, val);
                });
            }
        };
        qq.extend(this, {
            uploadChunk: function(uploadChunkParams) {
                var id = uploadChunkParams.id;
                var chunkIdx = uploadChunkParams.chunkIdx;
                var overrides = uploadChunkParams.overrides || {};
                var resuming = uploadChunkParams.resuming;
                var chunkData = handler._getChunkData(id, chunkIdx), xhr = handler._createXhr(id, chunkIdx), promise, toSend, customParams, params = {};
                promise = createReadyStateChangedHandler(id, xhr);
                handler._registerProgressHandler(id, chunkIdx, chunkData.size);
                customParams = spec.paramsStore.get(id);
                addChunkingSpecificParams(id, params, chunkData);
                if (resuming) {
                    params[spec.resume.paramNames.resuming] = true;
                }
                toSend = setParamsAndGetEntityToSend({
                    fileOrBlob: chunkData.blob,
                    id: id,
                    customParams: customParams,
                    params: params,
                    xhr: xhr,
                    xhrOverrides: overrides
                });
                setUploadHeaders({
                    headerOverrides: overrides.headers,
                    id: id,
                    xhr: xhr
                });
                xhr.send(toSend);
                return promise;
            },
            uploadFile: function(id) {
                var fileOrBlob = handler.getFile(id), promise, xhr, customParams, toSend;
                xhr = handler._createXhr(id);
                handler._registerProgressHandler(id);
                promise = createReadyStateChangedHandler(id, xhr);
                customParams = spec.paramsStore.get(id);
                toSend = setParamsAndGetEntityToSend({
                    fileOrBlob: fileOrBlob,
                    id: id,
                    customParams: customParams,
                    xhr: xhr
                });
                setUploadHeaders({
                    id: id,
                    xhr: xhr
                });
                xhr.send(toSend);
                return promise;
            }
        });
        qq.extend(this, new qq.XhrUploadHandler({
            options: qq.extend({
                namespace: "traditional"
            }, spec),
            proxy: qq.extend({
                getEndpoint: spec.endpointStore.get
            }, proxy)
        }));
        qq.override(this, function(super_) {
            return {
                finalizeChunks: function(id) {
                    proxy.onFinalizing(id);
                    if (spec.chunking.success.endpoint) {
                        return sendChunksCompleteRequest(id);
                    } else {
                        return super_.finalizeChunks(id, qq.bind(parseResponse, this, true));
                    }
                }
            };
        });
    };
    qq.traditional.AllChunksDoneAjaxRequester = function(o) {
        "use strict";
        var requester, options = {
            cors: {
                allowXdr: false,
                expected: false,
                sendCredentials: false
            },
            endpoint: null,
            log: function(str, level) {},
            method: "POST"
        }, promises = {}, endpointHandler = {
            get: function(id) {
                if (qq.isFunction(options.endpoint)) {
                    return options.endpoint(id);
                }
                return options.endpoint;
            }
        };
        qq.extend(options, o);
        requester = qq.extend(this, new qq.AjaxRequester({
            acceptHeader: "application/json",
            contentType: options.jsonPayload ? "application/json" : "application/x-www-form-urlencoded",
            validMethods: [ options.method ],
            method: options.method,
            endpointStore: endpointHandler,
            allowXRequestedWithAndCacheControl: false,
            cors: options.cors,
            log: options.log,
            onComplete: function(id, xhr, isError) {
                var promise = promises[id];
                delete promises[id];
                if (isError) {
                    promise.failure(xhr);
                } else {
                    promise.success(xhr);
                }
            }
        }));
        qq.extend(this, {
            complete: function(id, xhr, params, headers) {
                var promise = new qq.Promise();
                options.log("Submitting All Chunks Done request for " + id);
                promises[id] = promise;
                requester.initTransport(id).withParams(options.params(id) || params).withHeaders(options.headers(id) || headers).send(xhr);
                return promise;
            }
        });
    };
    qq.DragAndDrop = function(o) {
        "use strict";
        var options, HIDE_ZONES_EVENT_NAME = "qq-hidezones", HIDE_BEFORE_ENTER_ATTR = "qq-hide-dropzone", uploadDropZones = [], droppedFiles = [], disposeSupport = new qq.DisposeSupport();
        options = {
            dropZoneElements: [],
            allowMultipleItems: true,
            classes: {
                dropActive: null
            },
            callbacks: new qq.DragAndDrop.callbacks()
        };
        qq.extend(options, o, true);
        function uploadDroppedFiles(files, uploadDropZone) {
            var filesAsArray = Array.prototype.slice.call(files);
            options.callbacks.dropLog("Grabbed " + files.length + " dropped files.");
            uploadDropZone.dropDisabled(false);
            options.callbacks.processingDroppedFilesComplete(filesAsArray, uploadDropZone.getElement());
        }
        function traverseFileTree(entry) {
            var parseEntryPromise = new qq.Promise();
            if (entry.isFile) {
                entry.file(function(file) {
                    file.qqPath = extractDirectoryPath(entry);
                    droppedFiles.push(file);
                    parseEntryPromise.success();
                }, function(fileError) {
                    options.callbacks.dropLog("Problem parsing '" + entry.fullPath + "'.  FileError code " + fileError.code + ".", "error");
                    parseEntryPromise.failure();
                });
            } else if (entry.isDirectory) {
                getFilesInDirectory(entry).then(function allEntriesRead(entries) {
                    var entriesLeft = entries.length;
                    qq.each(entries, function(idx, entry) {
                        traverseFileTree(entry).done(function() {
                            entriesLeft -= 1;
                            if (entriesLeft === 0) {
                                parseEntryPromise.success();
                            }
                        });
                    });
                    if (!entries.length) {
                        parseEntryPromise.success();
                    }
                }, function readFailure(fileError) {
                    options.callbacks.dropLog("Problem parsing '" + entry.fullPath + "'.  FileError code " + fileError.code + ".", "error");
                    parseEntryPromise.failure();
                });
            }
            return parseEntryPromise;
        }
        function extractDirectoryPath(entry) {
            var name = entry.name, fullPath = entry.fullPath, indexOfNameInFullPath = fullPath.lastIndexOf(name);
            fullPath = fullPath.substr(0, indexOfNameInFullPath);
            if (fullPath.charAt(0) === "/") {
                fullPath = fullPath.substr(1);
            }
            return fullPath;
        }
        function getFilesInDirectory(entry, reader, accumEntries, existingPromise) {
            var promise = existingPromise || new qq.Promise(), dirReader = reader || entry.createReader();
            dirReader.readEntries(function readSuccess(entries) {
                var newEntries = accumEntries ? accumEntries.concat(entries) : entries;
                if (entries.length) {
                    setTimeout(function() {
                        getFilesInDirectory(entry, dirReader, newEntries, promise);
                    }, 0);
                } else {
                    promise.success(newEntries);
                }
            }, promise.failure);
            return promise;
        }
        function handleDataTransfer(dataTransfer, uploadDropZone) {
            var pendingFolderPromises = [], handleDataTransferPromise = new qq.Promise();
            options.callbacks.processingDroppedFiles();
            uploadDropZone.dropDisabled(true);
            if (dataTransfer.files.length > 1 && !options.allowMultipleItems) {
                options.callbacks.processingDroppedFilesComplete([]);
                options.callbacks.dropError("tooManyFilesError", "");
                uploadDropZone.dropDisabled(false);
                handleDataTransferPromise.failure();
            } else {
                droppedFiles = [];
                if (qq.isFolderDropSupported(dataTransfer)) {
                    qq.each(dataTransfer.items, function(idx, item) {
                        var entry = item.webkitGetAsEntry();
                        if (entry) {
                            if (entry.isFile) {
                                droppedFiles.push(item.getAsFile());
                            } else {
                                pendingFolderPromises.push(traverseFileTree(entry).done(function() {
                                    pendingFolderPromises.pop();
                                    if (pendingFolderPromises.length === 0) {
                                        handleDataTransferPromise.success();
                                    }
                                }));
                            }
                        }
                    });
                } else {
                    droppedFiles = dataTransfer.files;
                }
                if (pendingFolderPromises.length === 0) {
                    handleDataTransferPromise.success();
                }
            }
            return handleDataTransferPromise;
        }
        function setupDropzone(dropArea) {
            var dropZone = new qq.UploadDropZone({
                HIDE_ZONES_EVENT_NAME: HIDE_ZONES_EVENT_NAME,
                element: dropArea,
                onEnter: function(e) {
                    qq(dropArea).addClass(options.classes.dropActive);
                    e.stopPropagation();
                },
                onLeaveNotDescendants: function(e) {
                    qq(dropArea).removeClass(options.classes.dropActive);
                },
                onDrop: function(e) {
                    handleDataTransfer(e.dataTransfer, dropZone).then(function() {
                        uploadDroppedFiles(droppedFiles, dropZone);
                    }, function() {
                        options.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.", "error");
                    });
                }
            });
            disposeSupport.addDisposer(function() {
                dropZone.dispose();
            });
            qq(dropArea).hasAttribute(HIDE_BEFORE_ENTER_ATTR) && qq(dropArea).hide();
            uploadDropZones.push(dropZone);
            return dropZone;
        }
        function isFileDrag(dragEvent) {
            var fileDrag;
            qq.each(dragEvent.dataTransfer.types, function(key, val) {
                if (val === "Files") {
                    fileDrag = true;
                    return false;
                }
            });
            return fileDrag;
        }
        function leavingDocumentOut(e) {
            if (qq.safari()) {
                return e.x < 0 || e.y < 0;
            }
            return e.x === 0 && e.y === 0;
        }
        function setupDragDrop() {
            var dropZones = options.dropZoneElements, maybeHideDropZones = function() {
                setTimeout(function() {
                    qq.each(dropZones, function(idx, dropZone) {
                        qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR) && qq(dropZone).hide();
                        qq(dropZone).removeClass(options.classes.dropActive);
                    });
                }, 10);
            };
            qq.each(dropZones, function(idx, dropZone) {
                var uploadDropZone = setupDropzone(dropZone);
                if (dropZones.length && qq.supportedFeatures.fileDrop) {
                    disposeSupport.attach(document, "dragenter", function(e) {
                        if (!uploadDropZone.dropDisabled() && isFileDrag(e)) {
                            qq.each(dropZones, function(idx, dropZone) {
                                if (dropZone instanceof HTMLElement && qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR)) {
                                    qq(dropZone).css({
                                        display: "block"
                                    });
                                }
                            });
                        }
                    });
                }
            });
            disposeSupport.attach(document, "dragleave", function(e) {
                if (leavingDocumentOut(e)) {
                    maybeHideDropZones();
                }
            });
            disposeSupport.attach(qq(document).children()[0], "mouseenter", function(e) {
                maybeHideDropZones();
            });
            disposeSupport.attach(document, "drop", function(e) {
                if (isFileDrag(e)) {
                    e.preventDefault();
                    maybeHideDropZones();
                }
            });
            disposeSupport.attach(document, HIDE_ZONES_EVENT_NAME, maybeHideDropZones);
        }
        setupDragDrop();
        qq.extend(this, {
            setupExtraDropzone: function(element) {
                options.dropZoneElements.push(element);
                setupDropzone(element);
            },
            removeDropzone: function(element) {
                var i, dzs = options.dropZoneElements;
                for (i in dzs) {
                    if (dzs[i] === element) {
                        return dzs.splice(i, 1);
                    }
                }
            },
            dispose: function() {
                disposeSupport.dispose();
                qq.each(uploadDropZones, function(idx, dropZone) {
                    dropZone.dispose();
                });
            }
        });
        this._testing = {};
        this._testing.extractDirectoryPath = extractDirectoryPath;
    };
    qq.DragAndDrop.callbacks = function() {
        "use strict";
        return {
            processingDroppedFiles: function() {},
            processingDroppedFilesComplete: function(files, targetEl) {},
            dropError: function(code, errorSpecifics) {
                qq.log("Drag & drop error code '" + code + " with these specifics: '" + errorSpecifics + "'", "error");
            },
            dropLog: function(message, level) {
                qq.log(message, level);
            }
        };
    };
    qq.UploadDropZone = function(o) {
        "use strict";
        var disposeSupport = new qq.DisposeSupport(), options, element, preventDrop, dropOutsideDisabled;
        options = {
            element: null,
            onEnter: function(e) {},
            onLeave: function(e) {},
            onLeaveNotDescendants: function(e) {},
            onDrop: function(e) {}
        };
        qq.extend(options, o);
        element = options.element;
        function dragoverShouldBeCanceled() {
            return qq.safari() || qq.firefox() && qq.windows();
        }
        function disableDropOutside(e) {
            if (!dropOutsideDisabled) {
                if (dragoverShouldBeCanceled) {
                    disposeSupport.attach(document, "dragover", function(e) {
                        e.preventDefault();
                    });
                } else {
                    disposeSupport.attach(document, "dragover", function(e) {
                        if (e.dataTransfer) {
                            e.dataTransfer.dropEffect = "none";
                            e.preventDefault();
                        }
                    });
                }
                dropOutsideDisabled = true;
            }
        }
        function isValidFileDrag(e) {
            if (!qq.supportedFeatures.fileDrop) {
                return false;
            }
            var effectTest, dt = e.dataTransfer, isSafari = qq.safari();
            effectTest = qq.ie() && qq.supportedFeatures.fileDrop ? true : dt.effectAllowed !== "none";
            return dt && effectTest && (dt.files && dt.files.length || !isSafari && dt.types.contains && dt.types.contains("Files") || dt.types.includes && dt.types.includes("Files"));
        }
        function isOrSetDropDisabled(isDisabled) {
            if (isDisabled !== undefined) {
                preventDrop = isDisabled;
            }
            return preventDrop;
        }
        function triggerHidezonesEvent() {
            var hideZonesEvent;
            function triggerUsingOldApi() {
                hideZonesEvent = document.createEvent("Event");
                hideZonesEvent.initEvent(options.HIDE_ZONES_EVENT_NAME, true, true);
            }
            if (window.CustomEvent) {
                try {
                    hideZonesEvent = new CustomEvent(options.HIDE_ZONES_EVENT_NAME);
                } catch (err) {
                    triggerUsingOldApi();
                }
            } else {
                triggerUsingOldApi();
            }
            document.dispatchEvent(hideZonesEvent);
        }
        function attachEvents() {
            disposeSupport.attach(element, "dragover", function(e) {
                if (!isValidFileDrag(e)) {
                    return;
                }
                var effect = qq.ie() && qq.supportedFeatures.fileDrop ? null : e.dataTransfer.effectAllowed;
                if (effect === "move" || effect === "linkMove") {
                    e.dataTransfer.dropEffect = "move";
                } else {
                    e.dataTransfer.dropEffect = "copy";
                }
                e.stopPropagation();
                e.preventDefault();
            });
            disposeSupport.attach(element, "dragenter", function(e) {
                if (!isOrSetDropDisabled()) {
                    if (!isValidFileDrag(e)) {
                        return;
                    }
                    options.onEnter(e);
                }
            });
            disposeSupport.attach(element, "dragleave", function(e) {
                if (!isValidFileDrag(e)) {
                    return;
                }
                options.onLeave(e);
                var relatedTarget = document.elementFromPoint(e.clientX, e.clientY);
                if (qq(this).contains(relatedTarget)) {
                    return;
                }
                options.onLeaveNotDescendants(e);
            });
            disposeSupport.attach(element, "drop", function(e) {
                if (!isOrSetDropDisabled()) {
                    if (!isValidFileDrag(e)) {
                        return;
                    }
                    e.preventDefault();
                    e.stopPropagation();
                    options.onDrop(e);
                    triggerHidezonesEvent();
                }
            });
        }
        disableDropOutside();
        attachEvents();
        qq.extend(this, {
            dropDisabled: function(isDisabled) {
                return isOrSetDropDisabled(isDisabled);
            },
            dispose: function() {
                disposeSupport.dispose();
            },
            getElement: function() {
                return element;
            }
        });
        this._testing = {};
        this._testing.isValidFileDrag = isValidFileDrag;
    };
    (function() {
        "use strict";
        qq.uiPublicApi = {
            addInitialFiles: function(cannedFileList) {
                this._parent.prototype.addInitialFiles.apply(this, arguments);
                this._templating.addCacheToDom();
            },
            clearStoredFiles: function() {
                this._parent.prototype.clearStoredFiles.apply(this, arguments);
                this._templating.clearFiles();
            },
            addExtraDropzone: function(element) {
                this._dnd && this._dnd.setupExtraDropzone(element);
            },
            removeExtraDropzone: function(element) {
                if (this._dnd) {
                    return this._dnd.removeDropzone(element);
                }
            },
            getItemByFileId: function(id) {
                if (!this._templating.isHiddenForever(id)) {
                    return this._templating.getFileContainer(id);
                }
            },
            reset: function() {
                this._parent.prototype.reset.apply(this, arguments);
                this._templating.reset();
                if (!this._options.button && this._templating.getButton()) {
                    this._defaultButtonId = this._createUploadButton({
                        element: this._templating.getButton(),
                        title: this._options.text.fileInputTitle
                    }).getButtonId();
                }
                if (this._dnd) {
                    this._dnd.dispose();
                    this._dnd = this._setupDragAndDrop();
                }
                this._totalFilesInBatch = 0;
                this._filesInBatchAddedToUi = 0;
                this._setupClickAndEditEventHandlers();
            },
            setName: function(id, newName) {
                var formattedFilename = this._options.formatFileName(newName);
                this._parent.prototype.setName.apply(this, arguments);
                this._templating.updateFilename(id, formattedFilename);
            },
            pauseUpload: function(id) {
                var paused = this._parent.prototype.pauseUpload.apply(this, arguments);
                paused && this._templating.uploadPaused(id);
                return paused;
            },
            continueUpload: function(id) {
                var continued = this._parent.prototype.continueUpload.apply(this, arguments);
                continued && this._templating.uploadContinued(id);
                return continued;
            },
            getId: function(fileContainerOrChildEl) {
                return this._templating.getFileId(fileContainerOrChildEl);
            },
            getDropTarget: function(fileId) {
                var file = this.getFile(fileId);
                return file.qqDropTarget;
            }
        };
        qq.uiPrivateApi = {
            _getButton: function(buttonId) {
                var button = this._parent.prototype._getButton.apply(this, arguments);
                if (!button) {
                    if (buttonId === this._defaultButtonId) {
                        button = this._templating.getButton();
                    }
                }
                return button;
            },
            _removeFileItem: function(fileId) {
                this._templating.removeFile(fileId);
            },
            _setupClickAndEditEventHandlers: function() {
                this._fileButtonsClickHandler = qq.FileButtonsClickHandler && this._bindFileButtonsClickEvent();
                this._focusinEventSupported = !qq.firefox();
                if (this._isEditFilenameEnabled()) {
                    this._filenameClickHandler = this._bindFilenameClickEvent();
                    this._filenameInputFocusInHandler = this._bindFilenameInputFocusInEvent();
                    this._filenameInputFocusHandler = this._bindFilenameInputFocusEvent();
                }
            },
            _setupDragAndDrop: function() {
                var self = this, dropZoneElements = this._options.dragAndDrop.extraDropzones, templating = this._templating, defaultDropZone = templating.getDropZone();
                defaultDropZone && dropZoneElements.push(defaultDropZone);
                return new qq.DragAndDrop({
                    dropZoneElements: dropZoneElements,
                    allowMultipleItems: this._options.multiple,
                    classes: {
                        dropActive: this._options.classes.dropActive
                    },
                    callbacks: {
                        processingDroppedFiles: function() {
                            templating.showDropProcessing();
                        },
                        processingDroppedFilesComplete: function(files, targetEl) {
                            templating.hideDropProcessing();
                            qq.each(files, function(idx, file) {
                                file.qqDropTarget = targetEl;
                            });
                            if (files.length) {
                                self.addFiles(files, null, null);
                            }
                        },
                        dropError: function(code, errorData) {
                            self._itemError(code, errorData);
                        },
                        dropLog: function(message, level) {
                            self.log(message, level);
                        }
                    }
                });
            },
            _bindFileButtonsClickEvent: function() {
                var self = this;
                return new qq.FileButtonsClickHandler({
                    templating: this._templating,
                    log: function(message, lvl) {
                        self.log(message, lvl);
                    },
                    onDeleteFile: function(fileId) {
                        self.deleteFile(fileId);
                    },
                    onCancel: function(fileId) {
                        self.cancel(fileId);
                    },
                    onRetry: function(fileId) {
                        self.retry(fileId);
                    },
                    onPause: function(fileId) {
                        self.pauseUpload(fileId);
                    },
                    onContinue: function(fileId) {
                        self.continueUpload(fileId);
                    },
                    onGetName: function(fileId) {
                        return self.getName(fileId);
                    }
                });
            },
            _isEditFilenameEnabled: function() {
                return this._templating.isEditFilenamePossible() && !this._options.autoUpload && qq.FilenameClickHandler && qq.FilenameInputFocusHandler && qq.FilenameInputFocusHandler;
            },
            _filenameEditHandler: function() {
                var self = this, templating = this._templating;
                return {
                    templating: templating,
                    log: function(message, lvl) {
                        self.log(message, lvl);
                    },
                    onGetUploadStatus: function(fileId) {
                        return self.getUploads({
                            id: fileId
                        }).status;
                    },
                    onGetName: function(fileId) {
                        return self.getName(fileId);
                    },
                    onSetName: function(id, newName) {
                        self.setName(id, newName);
                    },
                    onEditingStatusChange: function(id, isEditing) {
                        var qqInput = qq(templating.getEditInput(id)), qqFileContainer = qq(templating.getFileContainer(id));
                        if (isEditing) {
                            qqInput.addClass("qq-editing");
                            templating.hideFilename(id);
                            templating.hideEditIcon(id);
                        } else {
                            qqInput.removeClass("qq-editing");
                            templating.showFilename(id);
                            templating.showEditIcon(id);
                        }
                        qqFileContainer.addClass("qq-temp").removeClass("qq-temp");
                    }
                };
            },
            _onUploadStatusChange: function(id, oldStatus, newStatus) {
                this._parent.prototype._onUploadStatusChange.apply(this, arguments);
                if (this._isEditFilenameEnabled()) {
                    if (this._templating.getFileContainer(id) && newStatus !== qq.status.SUBMITTED) {
                        this._templating.markFilenameEditable(id);
                        this._templating.hideEditIcon(id);
                    }
                }
                if (oldStatus === qq.status.UPLOAD_RETRYING && newStatus === qq.status.UPLOADING) {
                    this._templating.hideRetry(id);
                    this._templating.setStatusText(id);
                    qq(this._templating.getFileContainer(id)).removeClass(this._classes.retrying);
                } else if (newStatus === qq.status.UPLOAD_FAILED) {
                    this._templating.hidePause(id);
                }
            },
            _bindFilenameInputFocusInEvent: function() {
                var spec = qq.extend({}, this._filenameEditHandler());
                return new qq.FilenameInputFocusInHandler(spec);
            },
            _bindFilenameInputFocusEvent: function() {
                var spec = qq.extend({}, this._filenameEditHandler());
                return new qq.FilenameInputFocusHandler(spec);
            },
            _bindFilenameClickEvent: function() {
                var spec = qq.extend({}, this._filenameEditHandler());
                return new qq.FilenameClickHandler(spec);
            },
            _storeForLater: function(id) {
                this._parent.prototype._storeForLater.apply(this, arguments);
                this._templating.hideSpinner(id);
            },
            _onAllComplete: function(successful, failed) {
                this._parent.prototype._onAllComplete.apply(this, arguments);
                this._templating.resetTotalProgress();
            },
            _onSubmit: function(id, name) {
                var file = this.getFile(id);
                if (file && file.qqPath && this._options.dragAndDrop.reportDirectoryPaths) {
                    this._paramsStore.addReadOnly(id, {
                        qqpath: file.qqPath
                    });
                }
                this._parent.prototype._onSubmit.apply(this, arguments);
                this._addToList(id, name);
            },
            _onSubmitted: function(id) {
                if (this._isEditFilenameEnabled()) {
                    this._templating.markFilenameEditable(id);
                    this._templating.showEditIcon(id);
                    if (!this._focusinEventSupported) {
                        this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(id));
                    }
                }
            },
            _onProgress: function(id, name, loaded, total) {
                this._parent.prototype._onProgress.apply(this, arguments);
                this._templating.updateProgress(id, loaded, total);
                if (total === 0 || Math.round(loaded / total * 100) === 100) {
                    this._templating.hideCancel(id);
                    this._templating.hidePause(id);
                    this._templating.hideProgress(id);
                    this._templating.setStatusText(id, this._options.text.waitingForResponse);
                    this._displayFileSize(id);
                } else {
                    this._displayFileSize(id, loaded, total);
                }
            },
            _onTotalProgress: function(loaded, total) {
                this._parent.prototype._onTotalProgress.apply(this, arguments);
                this._templating.updateTotalProgress(loaded, total);
            },
            _onComplete: function(id, name, result, xhr) {
                var parentRetVal = this._parent.prototype._onComplete.apply(this, arguments), templating = this._templating, fileContainer = templating.getFileContainer(id), self = this;
                function completeUpload(result) {
                    if (!fileContainer) {
                        return;
                    }
                    templating.setStatusText(id);
                    qq(fileContainer).removeClass(self._classes.retrying);
                    templating.hideProgress(id);
                    if (self.getUploads({
                        id: id
                    }).status !== qq.status.UPLOAD_FAILED) {
                        templating.hideCancel(id);
                    }
                    templating.hideSpinner(id);
                    if (result.success) {
                        self._markFileAsSuccessful(id);
                    } else {
                        qq(fileContainer).addClass(self._classes.fail);
                        templating.showCancel(id);
                        if (templating.isRetryPossible() && !self._preventRetries[id]) {
                            qq(fileContainer).addClass(self._classes.retryable);
                            templating.showRetry(id);
                        }
                        self._controlFailureTextDisplay(id, result);
                    }
                }
                if (parentRetVal instanceof qq.Promise) {
                    parentRetVal.done(function(newResult) {
                        completeUpload(newResult);
                    });
                } else {
                    completeUpload(result);
                }
                return parentRetVal;
            },
            _markFileAsSuccessful: function(id) {
                var templating = this._templating;
                if (this._isDeletePossible()) {
                    templating.showDeleteButton(id);
                }
                qq(templating.getFileContainer(id)).addClass(this._classes.success);
                this._maybeUpdateThumbnail(id);
            },
            _onUploadPrep: function(id) {
                this._parent.prototype._onUploadPrep.apply(this, arguments);
                this._templating.showSpinner(id);
            },
            _onUpload: function(id, name) {
                var parentRetVal = this._parent.prototype._onUpload.apply(this, arguments);
                this._templating.showSpinner(id);
                return parentRetVal;
            },
            _onUploadChunk: function(id, chunkData) {
                this._parent.prototype._onUploadChunk.apply(this, arguments);
                if (chunkData.partIndex > 0 && this._handler.isResumable(id)) {
                    this._templating.allowPause(id);
                }
            },
            _onCancel: function(id, name) {
                this._parent.prototype._onCancel.apply(this, arguments);
                this._removeFileItem(id);
                if (this._getNotFinished() === 0) {
                    this._templating.resetTotalProgress();
                }
            },
            _onBeforeAutoRetry: function(id) {
                var retryNumForDisplay, maxAuto, retryNote;
                this._parent.prototype._onBeforeAutoRetry.apply(this, arguments);
                this._showCancelLink(id);
                if (this._options.retry.showAutoRetryNote) {
                    retryNumForDisplay = this._autoRetries[id];
                    maxAuto = this._options.retry.maxAutoAttempts;
                    retryNote = this._options.retry.autoRetryNote.replace(/\{retryNum\}/g, retryNumForDisplay);
                    retryNote = retryNote.replace(/\{maxAuto\}/g, maxAuto);
                    this._templating.setStatusText(id, retryNote);
                    qq(this._templating.getFileContainer(id)).addClass(this._classes.retrying);
                }
            },
            _onBeforeManualRetry: function(id) {
                if (this._parent.prototype._onBeforeManualRetry.apply(this, arguments)) {
                    this._templating.resetProgress(id);
                    qq(this._templating.getFileContainer(id)).removeClass(this._classes.fail);
                    this._templating.setStatusText(id);
                    this._templating.showSpinner(id);
                    this._showCancelLink(id);
                    return true;
                } else {
                    qq(this._templating.getFileContainer(id)).addClass(this._classes.retryable);
                    this._templating.showRetry(id);
                    return false;
                }
            },
            _onSubmitDelete: function(id) {
                var onSuccessCallback = qq.bind(this._onSubmitDeleteSuccess, this);
                this._parent.prototype._onSubmitDelete.call(this, id, onSuccessCallback);
            },
            _onSubmitDeleteSuccess: function(id, uuid, additionalMandatedParams) {
                if (this._options.deleteFile.forceConfirm) {
                    this._showDeleteConfirm.apply(this, arguments);
                } else {
                    this._sendDeleteRequest.apply(this, arguments);
                }
            },
            _onDeleteComplete: function(id, xhr, isError) {
                this._parent.prototype._onDeleteComplete.apply(this, arguments);
                this._templating.hideSpinner(id);
                if (isError) {
                    this._templating.setStatusText(id, this._options.deleteFile.deletingFailedText);
                    this._templating.showDeleteButton(id);
                } else {
                    this._removeFileItem(id);
                }
            },
            _sendDeleteRequest: function(id, uuid, additionalMandatedParams) {
                this._templating.hideDeleteButton(id);
                this._templating.showSpinner(id);
                this._templating.setStatusText(id, this._options.deleteFile.deletingStatusText);
                this._deleteHandler.sendDelete.apply(this, arguments);
            },
            _showDeleteConfirm: function(id, uuid, mandatedParams) {
                var fileName = this.getName(id), confirmMessage = this._options.deleteFile.confirmMessage.replace(/\{filename\}/g, fileName), uuid = this.getUuid(id), deleteRequestArgs = arguments, self = this, retVal;
                retVal = this._options.showConfirm(confirmMessage);
                if (qq.isGenericPromise(retVal)) {
                    retVal.then(function() {
                        self._sendDeleteRequest.apply(self, deleteRequestArgs);
                    });
                } else if (retVal !== false) {
                    self._sendDeleteRequest.apply(self, deleteRequestArgs);
                }
            },
            _addToList: function(id, name, canned) {
                var prependData, prependIndex = 0, dontDisplay = this._handler.isProxied(id) && this._options.scaling.hideScaled, record;
                if (this._options.display.prependFiles) {
                    if (this._totalFilesInBatch > 1 && this._filesInBatchAddedToUi > 0) {
                        prependIndex = this._filesInBatchAddedToUi - 1;
                    }
                    prependData = {
                        index: prependIndex
                    };
                }
                if (!canned) {
                    if (this._options.disableCancelForFormUploads && !qq.supportedFeatures.ajaxUploading) {
                        this._templating.disableCancel();
                    }
                    if (!this._options.multiple) {
                        record = this.getUploads({
                            id: id
                        });
                        this._handledProxyGroup = this._handledProxyGroup || record.proxyGroupId;
                        if (record.proxyGroupId !== this._handledProxyGroup || !record.proxyGroupId) {
                            this._handler.cancelAll();
                            this._clearList();
                            this._handledProxyGroup = null;
                        }
                    }
                }
                if (canned) {
                    this._templating.addFileToCache(id, this._options.formatFileName(name), prependData, dontDisplay);
                    this._templating.updateThumbnail(id, this._thumbnailUrls[id], true, this._options.thumbnails.customResizer);
                } else {
                    this._templating.addFile(id, this._options.formatFileName(name), prependData, dontDisplay);
                    this._templating.generatePreview(id, this.getFile(id), this._options.thumbnails.customResizer);
                }
                this._filesInBatchAddedToUi += 1;
                if (canned || this._options.display.fileSizeOnSubmit && qq.supportedFeatures.ajaxUploading) {
                    this._displayFileSize(id);
                }
            },
            _clearList: function() {
                this._templating.clearFiles();
                this.clearStoredFiles();
            },
            _displayFileSize: function(id, loadedSize, totalSize) {
                var size = this.getSize(id), sizeForDisplay = this._formatSize(size);
                if (size >= 0) {
                    if (loadedSize !== undefined && totalSize !== undefined) {
                        sizeForDisplay = this._formatProgress(loadedSize, totalSize);
                    }
                    this._templating.updateSize(id, sizeForDisplay);
                }
            },
            _formatProgress: function(uploadedSize, totalSize) {
                var message = this._options.text.formatProgress;
                function r(name, replacement) {
                    message = message.replace(name, replacement);
                }
                r("{percent}", Math.round(uploadedSize / totalSize * 100));
                r("{total_size}", this._formatSize(totalSize));
                return message;
            },
            _controlFailureTextDisplay: function(id, response) {
                var mode, responseProperty, failureReason;
                mode = this._options.failedUploadTextDisplay.mode;
                responseProperty = this._options.failedUploadTextDisplay.responseProperty;
                if (mode === "custom") {
                    failureReason = response[responseProperty];
                    if (!failureReason) {
                        failureReason = this._options.text.failUpload;
                    }
                    this._templating.setStatusText(id, failureReason);
                    if (this._options.failedUploadTextDisplay.enableTooltip) {
                        this._showTooltip(id, failureReason);
                    }
                } else if (mode === "default") {
                    this._templating.setStatusText(id, this._options.text.failUpload);
                } else if (mode !== "none") {
                    this.log("failedUploadTextDisplay.mode value of '" + mode + "' is not valid", "warn");
                }
            },
            _showTooltip: function(id, text) {
                this._templating.getFileContainer(id).title = text;
            },
            _showCancelLink: function(id) {
                if (!this._options.disableCancelForFormUploads || qq.supportedFeatures.ajaxUploading) {
                    this._templating.showCancel(id);
                }
            },
            _itemError: function(code, name, item) {
                var message = this._parent.prototype._itemError.apply(this, arguments);
                this._options.showMessage(message);
            },
            _batchError: function(message) {
                this._parent.prototype._batchError.apply(this, arguments);
                this._options.showMessage(message);
            },
            _setupPastePrompt: function() {
                var self = this;
                this._options.callbacks.onPasteReceived = function() {
                    var message = self._options.paste.namePromptMessage, defaultVal = self._options.paste.defaultName;
                    return self._options.showPrompt(message, defaultVal);
                };
            },
            _fileOrBlobRejected: function(id, name) {
                this._totalFilesInBatch -= 1;
                this._parent.prototype._fileOrBlobRejected.apply(this, arguments);
            },
            _prepareItemsForUpload: function(items, params, endpoint) {
                this._totalFilesInBatch = items.length;
                this._filesInBatchAddedToUi = 0;
                this._parent.prototype._prepareItemsForUpload.apply(this, arguments);
            },
            _maybeUpdateThumbnail: function(fileId) {
                var thumbnailUrl = this._thumbnailUrls[fileId], fileStatus = this.getUploads({
                    id: fileId
                }).status;
                if (fileStatus !== qq.status.DELETED && (thumbnailUrl || this._options.thumbnails.placeholders.waitUntilResponse || !qq.supportedFeatures.imagePreviews)) {
                    this._templating.updateThumbnail(fileId, thumbnailUrl, this._options.thumbnails.customResizer);
                }
            },
            _addCannedFile: function(sessionData) {
                var id = this._parent.prototype._addCannedFile.apply(this, arguments);
                this._addToList(id, this.getName(id), true);
                this._templating.hideSpinner(id);
                this._templating.hideCancel(id);
                this._markFileAsSuccessful(id);
                return id;
            },
            _setSize: function(id, newSize) {
                this._parent.prototype._setSize.apply(this, arguments);
                this._templating.updateSize(id, this._formatSize(newSize));
            },
            _sessionRequestComplete: function() {
                this._templating.addCacheToDom();
                this._parent.prototype._sessionRequestComplete.apply(this, arguments);
            }
        };
    })();
    qq.FineUploader = function(o, namespace) {
        "use strict";
        var self = this;
        this._parent = namespace ? qq[namespace].FineUploaderBasic : qq.FineUploaderBasic;
        this._parent.apply(this, arguments);
        qq.extend(this._options, {
            element: null,
            button: null,
            listElement: null,
            dragAndDrop: {
                extraDropzones: [],
                reportDirectoryPaths: false
            },
            text: {
                formatProgress: "{percent}% of {total_size}",
                failUpload: "Upload failed",
                waitingForResponse: "Processing...",
                paused: "Paused"
            },
            template: "qq-template",
            classes: {
                retrying: "qq-upload-retrying",
                retryable: "qq-upload-retryable",
                success: "qq-upload-success",
                fail: "qq-upload-fail",
                editable: "qq-editable",
                hide: "qq-hide",
                dropActive: "qq-upload-drop-area-active"
            },
            failedUploadTextDisplay: {
                mode: "default",
                responseProperty: "error",
                enableTooltip: true
            },
            messages: {
                tooManyFilesError: "You may only drop one file",
                unsupportedBrowser: "Unrecoverable error - this browser does not permit file uploading of any kind."
            },
            retry: {
                showAutoRetryNote: true,
                autoRetryNote: "Retrying {retryNum}/{maxAuto}..."
            },
            deleteFile: {
                forceConfirm: false,
                confirmMessage: "Are you sure you want to delete {filename}?",
                deletingStatusText: "Deleting...",
                deletingFailedText: "Delete failed"
            },
            display: {
                fileSizeOnSubmit: false,
                prependFiles: false
            },
            paste: {
                promptForName: false,
                namePromptMessage: "Please name this image"
            },
            thumbnails: {
                customResizer: null,
                maxCount: 0,
                placeholders: {
                    waitUntilResponse: false,
                    notAvailablePath: null,
                    waitingPath: null
                },
                timeBetweenThumbs: 750
            },
            scaling: {
                hideScaled: false
            },
            showMessage: function(message) {
                if (self._templating.hasDialog("alert")) {
                    return self._templating.showDialog("alert", message);
                } else {
                    setTimeout(function() {
                        window.alert(message);
                    }, 0);
                }
            },
            showConfirm: function(message) {
                if (self._templating.hasDialog("confirm")) {
                    return self._templating.showDialog("confirm", message);
                } else {
                    return window.confirm(message);
                }
            },
            showPrompt: function(message, defaultValue) {
                if (self._templating.hasDialog("prompt")) {
                    return self._templating.showDialog("prompt", message, defaultValue);
                } else {
                    return window.prompt(message, defaultValue);
                }
            }
        }, true);
        qq.extend(this._options, o, true);
        this._templating = new qq.Templating({
            log: qq.bind(this.log, this),
            templateIdOrEl: this._options.template,
            containerEl: this._options.element,
            fileContainerEl: this._options.listElement,
            button: this._options.button,
            imageGenerator: this._imageGenerator,
            classes: {
                hide: this._options.classes.hide,
                editable: this._options.classes.editable
            },
            limits: {
                maxThumbs: this._options.thumbnails.maxCount,
                timeBetweenThumbs: this._options.thumbnails.timeBetweenThumbs
            },
            placeholders: {
                waitUntilUpdate: this._options.thumbnails.placeholders.waitUntilResponse,
                thumbnailNotAvailable: this._options.thumbnails.placeholders.notAvailablePath,
                waitingForThumbnail: this._options.thumbnails.placeholders.waitingPath
            },
            text: this._options.text
        });
        if (this._options.workarounds.ios8SafariUploads && qq.ios800() && qq.iosSafari()) {
            this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari);
        } else if (!qq.supportedFeatures.uploading || this._options.cors.expected && !qq.supportedFeatures.uploadCors) {
            this._templating.renderFailure(this._options.messages.unsupportedBrowser);
        } else {
            this._wrapCallbacks();
            this._templating.render();
            this._classes = this._options.classes;
            if (!this._options.button && this._templating.getButton()) {
                this._defaultButtonId = this._createUploadButton({
                    element: this._templating.getButton(),
                    title: this._options.text.fileInputTitle
                }).getButtonId();
            }
            this._setupClickAndEditEventHandlers();
            if (qq.DragAndDrop && qq.supportedFeatures.fileDrop) {
                this._dnd = this._setupDragAndDrop();
            }
            if (this._options.paste.targetElement && this._options.paste.promptForName) {
                if (qq.PasteSupport) {
                    this._setupPastePrompt();
                } else {
                    this.log("Paste support module not found.", "error");
                }
            }
            this._totalFilesInBatch = 0;
            this._filesInBatchAddedToUi = 0;
        }
    };
    qq.extend(qq.FineUploader.prototype, qq.basePublicApi);
    qq.extend(qq.FineUploader.prototype, qq.basePrivateApi);
    qq.extend(qq.FineUploader.prototype, qq.uiPublicApi);
    qq.extend(qq.FineUploader.prototype, qq.uiPrivateApi);
    qq.Templating = function(spec) {
        "use strict";
        var FILE_ID_ATTR = "qq-file-id", FILE_CLASS_PREFIX = "qq-file-id-", THUMBNAIL_MAX_SIZE_ATTR = "qq-max-size", THUMBNAIL_SERVER_SCALE_ATTR = "qq-server-scale", HIDE_DROPZONE_ATTR = "qq-hide-dropzone", DROPZPONE_TEXT_ATTR = "qq-drop-area-text", IN_PROGRESS_CLASS = "qq-in-progress", HIDDEN_FOREVER_CLASS = "qq-hidden-forever", fileBatch = {
            content: document.createDocumentFragment(),
            map: {}
        }, isCancelDisabled = false, generatedThumbnails = 0, thumbnailQueueMonitorRunning = false, thumbGenerationQueue = [], thumbnailMaxSize = -1, options = {
            log: null,
            limits: {
                maxThumbs: 0,
                timeBetweenThumbs: 750
            },
            templateIdOrEl: "qq-template",
            containerEl: null,
            fileContainerEl: null,
            button: null,
            imageGenerator: null,
            classes: {
                hide: "qq-hide",
                editable: "qq-editable"
            },
            placeholders: {
                waitUntilUpdate: false,
                thumbnailNotAvailable: null,
                waitingForThumbnail: null
            },
            text: {
                paused: "Paused"
            }
        }, selectorClasses = {
            button: "qq-upload-button-selector",
            alertDialog: "qq-alert-dialog-selector",
            dialogCancelButton: "qq-cancel-button-selector",
            confirmDialog: "qq-confirm-dialog-selector",
            dialogMessage: "qq-dialog-message-selector",
            dialogOkButton: "qq-ok-button-selector",
            promptDialog: "qq-prompt-dialog-selector",
            uploader: "qq-uploader-selector",
            drop: "qq-upload-drop-area-selector",
            list: "qq-upload-list-selector",
            progressBarContainer: "qq-progress-bar-container-selector",
            progressBar: "qq-progress-bar-selector",
            totalProgressBarContainer: "qq-total-progress-bar-container-selector",
            totalProgressBar: "qq-total-progress-bar-selector",
            file: "qq-upload-file-selector",
            spinner: "qq-upload-spinner-selector",
            size: "qq-upload-size-selector",
            cancel: "qq-upload-cancel-selector",
            pause: "qq-upload-pause-selector",
            continueButton: "qq-upload-continue-selector",
            deleteButton: "qq-upload-delete-selector",
            retry: "qq-upload-retry-selector",
            statusText: "qq-upload-status-text-selector",
            editFilenameInput: "qq-edit-filename-selector",
            editNameIcon: "qq-edit-filename-icon-selector",
            dropText: "qq-upload-drop-area-text-selector",
            dropProcessing: "qq-drop-processing-selector",
            dropProcessingSpinner: "qq-drop-processing-spinner-selector",
            thumbnail: "qq-thumbnail-selector"
        }, previewGeneration = {}, cachedThumbnailNotAvailableImg = new qq.Promise(), cachedWaitingForThumbnailImg = new qq.Promise(), log, isEditElementsExist, isRetryElementExist, templateDom, container, fileList, showThumbnails, serverScale, cacheThumbnailPlaceholders = function() {
            var notAvailableUrl = options.placeholders.thumbnailNotAvailable, waitingUrl = options.placeholders.waitingForThumbnail, spec = {
                maxSize: thumbnailMaxSize,
                scale: serverScale
            };
            if (showThumbnails) {
                if (notAvailableUrl) {
                    options.imageGenerator.generate(notAvailableUrl, new Image(), spec).then(function(updatedImg) {
                        cachedThumbnailNotAvailableImg.success(updatedImg);
                    }, function() {
                        cachedThumbnailNotAvailableImg.failure();
                        log("Problem loading 'not available' placeholder image at " + notAvailableUrl, "error");
                    });
                } else {
                    cachedThumbnailNotAvailableImg.failure();
                }
                if (waitingUrl) {
                    options.imageGenerator.generate(waitingUrl, new Image(), spec).then(function(updatedImg) {
                        cachedWaitingForThumbnailImg.success(updatedImg);
                    }, function() {
                        cachedWaitingForThumbnailImg.failure();
                        log("Problem loading 'waiting for thumbnail' placeholder image at " + waitingUrl, "error");
                    });
                } else {
                    cachedWaitingForThumbnailImg.failure();
                }
            }
        }, displayWaitingImg = function(thumbnail) {
            var waitingImgPlacement = new qq.Promise();
            cachedWaitingForThumbnailImg.then(function(img) {
                maybeScalePlaceholderViaCss(img, thumbnail);
                if (!thumbnail.src) {
                    thumbnail.src = img.src;
                    thumbnail.onload = function() {
                        thumbnail.onload = null;
                        show(thumbnail);
                        waitingImgPlacement.success();
                    };
                } else {
                    waitingImgPlacement.success();
                }
            }, function() {
                hide(thumbnail);
                waitingImgPlacement.success();
            });
            return waitingImgPlacement;
        }, generateNewPreview = function(id, blob, spec) {
            var thumbnail = getThumbnail(id);
            log("Generating new thumbnail for " + id);
            blob.qqThumbnailId = id;
            return options.imageGenerator.generate(blob, thumbnail, spec).then(function() {
                generatedThumbnails++;
                show(thumbnail);
                previewGeneration[id].success();
            }, function() {
                previewGeneration[id].failure();
                if (!options.placeholders.waitUntilUpdate) {
                    maybeSetDisplayNotAvailableImg(id, thumbnail);
                }
            });
        }, generateNextQueuedPreview = function() {
            if (thumbGenerationQueue.length) {
                thumbnailQueueMonitorRunning = true;
                var queuedThumbRequest = thumbGenerationQueue.shift();
                if (queuedThumbRequest.update) {
                    processUpdateQueuedPreviewRequest(queuedThumbRequest);
                } else {
                    processNewQueuedPreviewRequest(queuedThumbRequest);
                }
            } else {
                thumbnailQueueMonitorRunning = false;
            }
        }, getCancel = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.cancel);
        }, getContinue = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.continueButton);
        }, getDialog = function(type) {
            return getTemplateEl(container, selectorClasses[type + "Dialog"]);
        }, getDelete = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.deleteButton);
        }, getDropProcessing = function() {
            return getTemplateEl(container, selectorClasses.dropProcessing);
        }, getEditIcon = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.editNameIcon);
        }, getFile = function(id) {
            return fileBatch.map[id] || qq(fileList).getFirstByClass(FILE_CLASS_PREFIX + id);
        }, getFilename = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.file);
        }, getPause = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.pause);
        }, getProgress = function(id) {
            if (id == null) {
                return getTemplateEl(container, selectorClasses.totalProgressBarContainer) || getTemplateEl(container, selectorClasses.totalProgressBar);
            }
            return getTemplateEl(getFile(id), selectorClasses.progressBarContainer) || getTemplateEl(getFile(id), selectorClasses.progressBar);
        }, getRetry = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.retry);
        }, getSize = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.size);
        }, getSpinner = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.spinner);
        }, getTemplateEl = function(context, cssClass) {
            return context && qq(context).getFirstByClass(cssClass);
        }, getThumbnail = function(id) {
            return showThumbnails && getTemplateEl(getFile(id), selectorClasses.thumbnail);
        }, hide = function(el) {
            el && qq(el).addClass(options.classes.hide);
        }, maybeScalePlaceholderViaCss = function(placeholder, thumbnail) {
            var maxWidth = placeholder.style.maxWidth, maxHeight = placeholder.style.maxHeight;
            if (maxHeight && maxWidth && !thumbnail.style.maxWidth && !thumbnail.style.maxHeight) {
                qq(thumbnail).css({
                    maxWidth: maxWidth,
                    maxHeight: maxHeight
                });
            }
        }, maybeSetDisplayNotAvailableImg = function(id, thumbnail) {
            var previewing = previewGeneration[id] || new qq.Promise().failure(), notAvailableImgPlacement = new qq.Promise();
            cachedThumbnailNotAvailableImg.then(function(img) {
                previewing.then(function() {
                    notAvailableImgPlacement.success();
                }, function() {
                    maybeScalePlaceholderViaCss(img, thumbnail);
                    thumbnail.onload = function() {
                        thumbnail.onload = null;
                        notAvailableImgPlacement.success();
                    };
                    thumbnail.src = img.src;
                    show(thumbnail);
                });
            });
            return notAvailableImgPlacement;
        }, parseAndGetTemplate = function() {
            var scriptEl, scriptHtml, fileListNode, tempTemplateEl, fileListEl, defaultButton, dropArea, thumbnail, dropProcessing, dropTextEl, uploaderEl;
            log("Parsing template");
            if (options.templateIdOrEl == null) {
                throw new Error("You MUST specify either a template element or ID!");
            }
            if (qq.isString(options.templateIdOrEl)) {
                scriptEl = document.getElementById(options.templateIdOrEl);
                if (scriptEl === null) {
                    throw new Error(qq.format("Cannot find template script at ID '{}'!", options.templateIdOrEl));
                }
                scriptHtml = scriptEl.innerHTML;
            } else {
                if (options.templateIdOrEl.innerHTML === undefined) {
                    throw new Error("You have specified an invalid value for the template option!  " + "It must be an ID or an Element.");
                }
                scriptHtml = options.templateIdOrEl.innerHTML;
            }
            scriptHtml = qq.trimStr(scriptHtml);
            tempTemplateEl = document.createElement("div");
            tempTemplateEl.appendChild(qq.toElement(scriptHtml));
            uploaderEl = qq(tempTemplateEl).getFirstByClass(selectorClasses.uploader);
            if (options.button) {
                defaultButton = qq(tempTemplateEl).getFirstByClass(selectorClasses.button);
                if (defaultButton) {
                    qq(defaultButton).remove();
                }
            }
            if (!qq.DragAndDrop || !qq.supportedFeatures.fileDrop) {
                dropProcessing = qq(tempTemplateEl).getFirstByClass(selectorClasses.dropProcessing);
                if (dropProcessing) {
                    qq(dropProcessing).remove();
                }
            }
            dropArea = qq(tempTemplateEl).getFirstByClass(selectorClasses.drop);
            if (dropArea && !qq.DragAndDrop) {
                log("DnD module unavailable.", "info");
                qq(dropArea).remove();
            }
            if (!qq.supportedFeatures.fileDrop) {
                uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR);
                if (dropArea && qq(dropArea).hasAttribute(HIDE_DROPZONE_ATTR)) {
                    qq(dropArea).css({
                        display: "none"
                    });
                }
            } else if (qq(uploaderEl).hasAttribute(DROPZPONE_TEXT_ATTR) && dropArea) {
                dropTextEl = qq(dropArea).getFirstByClass(selectorClasses.dropText);
                dropTextEl && qq(dropTextEl).remove();
            }
            thumbnail = qq(tempTemplateEl).getFirstByClass(selectorClasses.thumbnail);
            if (!showThumbnails) {
                thumbnail && qq(thumbnail).remove();
            } else if (thumbnail) {
                thumbnailMaxSize = parseInt(thumbnail.getAttribute(THUMBNAIL_MAX_SIZE_ATTR));
                thumbnailMaxSize = thumbnailMaxSize > 0 ? thumbnailMaxSize : null;
                serverScale = qq(thumbnail).hasAttribute(THUMBNAIL_SERVER_SCALE_ATTR);
            }
            showThumbnails = showThumbnails && thumbnail;
            isEditElementsExist = qq(tempTemplateEl).getByClass(selectorClasses.editFilenameInput).length > 0;
            isRetryElementExist = qq(tempTemplateEl).getByClass(selectorClasses.retry).length > 0;
            fileListNode = qq(tempTemplateEl).getFirstByClass(selectorClasses.list);
            if (fileListNode == null) {
                throw new Error("Could not find the file list container in the template!");
            }
            fileListEl = fileListNode.children[0].cloneNode(true);
            fileListNode.innerHTML = "";
            if (tempTemplateEl.getElementsByTagName("DIALOG").length) {
                document.createElement("dialog");
            }
            log("Template parsing complete");
            return {
                template: tempTemplateEl,
                fileTemplate: fileListEl
            };
        }, prependFile = function(el, index, fileList) {
            var parentEl = fileList, beforeEl = parentEl.firstChild;
            if (index > 0) {
                beforeEl = qq(parentEl).children()[index].nextSibling;
            }
            parentEl.insertBefore(el, beforeEl);
        }, processNewQueuedPreviewRequest = function(queuedThumbRequest) {
            var id = queuedThumbRequest.id, optFileOrBlob = queuedThumbRequest.optFileOrBlob, relatedThumbnailId = optFileOrBlob && optFileOrBlob.qqThumbnailId, thumbnail = getThumbnail(id), spec = {
                customResizeFunction: queuedThumbRequest.customResizeFunction,
                maxSize: thumbnailMaxSize,
                orient: true,
                scale: true
            };
            if (qq.supportedFeatures.imagePreviews) {
                if (thumbnail) {
                    if (options.limits.maxThumbs && options.limits.maxThumbs <= generatedThumbnails) {
                        maybeSetDisplayNotAvailableImg(id, thumbnail);
                        generateNextQueuedPreview();
                    } else {
                        displayWaitingImg(thumbnail).done(function() {
                            previewGeneration[id] = new qq.Promise();
                            previewGeneration[id].done(function() {
                                setTimeout(generateNextQueuedPreview, options.limits.timeBetweenThumbs);
                            });
                            if (relatedThumbnailId != null) {
                                useCachedPreview(id, relatedThumbnailId);
                            } else {
                                generateNewPreview(id, optFileOrBlob, spec);
                            }
                        });
                    }
                } else {
                    generateNextQueuedPreview();
                }
            } else if (thumbnail) {
                displayWaitingImg(thumbnail);
                generateNextQueuedPreview();
            }
        }, processUpdateQueuedPreviewRequest = function(queuedThumbRequest) {
            var id = queuedThumbRequest.id, thumbnailUrl = queuedThumbRequest.thumbnailUrl, showWaitingImg = queuedThumbRequest.showWaitingImg, thumbnail = getThumbnail(id), spec = {
                customResizeFunction: queuedThumbRequest.customResizeFunction,
                scale: serverScale,
                maxSize: thumbnailMaxSize
            };
            if (thumbnail) {
                if (thumbnailUrl) {
                    if (options.limits.maxThumbs && options.limits.maxThumbs <= generatedThumbnails) {
                        maybeSetDisplayNotAvailableImg(id, thumbnail);
                        generateNextQueuedPreview();
                    } else {
                        if (showWaitingImg) {
                            displayWaitingImg(thumbnail);
                        }
                        return options.imageGenerator.generate(thumbnailUrl, thumbnail, spec).then(function() {
                            show(thumbnail);
                            generatedThumbnails++;
                            setTimeout(generateNextQueuedPreview, options.limits.timeBetweenThumbs);
                        }, function() {
                            maybeSetDisplayNotAvailableImg(id, thumbnail);
                            setTimeout(generateNextQueuedPreview, options.limits.timeBetweenThumbs);
                        });
                    }
                } else {
                    maybeSetDisplayNotAvailableImg(id, thumbnail);
                    generateNextQueuedPreview();
                }
            }
        }, setProgressBarWidth = function(id, percent) {
            var bar = getProgress(id), progressBarSelector = id == null ? selectorClasses.totalProgressBar : selectorClasses.progressBar;
            if (bar && !qq(bar).hasClass(progressBarSelector)) {
                bar = qq(bar).getFirstByClass(progressBarSelector);
            }
            if (bar) {
                qq(bar).css({
                    width: percent + "%"
                });
                bar.setAttribute("aria-valuenow", percent);
            }
        }, show = function(el) {
            el && qq(el).removeClass(options.classes.hide);
        }, useCachedPreview = function(targetThumbnailId, cachedThumbnailId) {
            var targetThumbnail = getThumbnail(targetThumbnailId), cachedThumbnail = getThumbnail(cachedThumbnailId);
            log(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.", targetThumbnailId, cachedThumbnailId, cachedThumbnailId));
            previewGeneration[cachedThumbnailId].then(function() {
                generatedThumbnails++;
                previewGeneration[targetThumbnailId].success();
                log(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.", cachedThumbnailId, targetThumbnailId));
                targetThumbnail.src = cachedThumbnail.src;
                show(targetThumbnail);
            }, function() {
                previewGeneration[targetThumbnailId].failure();
                if (!options.placeholders.waitUntilUpdate) {
                    maybeSetDisplayNotAvailableImg(targetThumbnailId, targetThumbnail);
                }
            });
        };
        qq.extend(options, spec);
        log = options.log;
        if (!qq.supportedFeatures.imagePreviews) {
            options.limits.timeBetweenThumbs = 0;
            options.limits.maxThumbs = 0;
        }
        container = options.containerEl;
        showThumbnails = options.imageGenerator !== undefined;
        templateDom = parseAndGetTemplate();
        cacheThumbnailPlaceholders();
        qq.extend(this, {
            render: function() {
                log("Rendering template in DOM.");
                generatedThumbnails = 0;
                container.appendChild(templateDom.template.cloneNode(true));
                hide(getDropProcessing());
                this.hideTotalProgress();
                fileList = options.fileContainerEl || getTemplateEl(container, selectorClasses.list);
                log("Template rendering complete");
            },
            renderFailure: function(message) {
                var cantRenderEl = qq.toElement(message);
                container.innerHTML = "";
                container.appendChild(cantRenderEl);
            },
            reset: function() {
                container.innerHTML = "";
                this.render();
            },
            clearFiles: function() {
                fileList.innerHTML = "";
            },
            disableCancel: function() {
                isCancelDisabled = true;
            },
            addFile: function(id, name, prependInfo, hideForever, batch) {
                var fileEl = templateDom.fileTemplate.cloneNode(true), fileNameEl = getTemplateEl(fileEl, selectorClasses.file), uploaderEl = getTemplateEl(container, selectorClasses.uploader), fileContainer = batch ? fileBatch.content : fileList, thumb;
                if (batch) {
                    fileBatch.map[id] = fileEl;
                }
                qq(fileEl).addClass(FILE_CLASS_PREFIX + id);
                uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR);
                if (fileNameEl) {
                    qq(fileNameEl).setText(name);
                    fileNameEl.setAttribute("title", name);
                }
                fileEl.setAttribute(FILE_ID_ATTR, id);
                if (prependInfo) {
                    prependFile(fileEl, prependInfo.index, fileContainer);
                } else {
                    fileContainer.appendChild(fileEl);
                }
                if (hideForever) {
                    fileEl.style.display = "none";
                    qq(fileEl).addClass(HIDDEN_FOREVER_CLASS);
                } else {
                    hide(getProgress(id));
                    hide(getSize(id));
                    hide(getDelete(id));
                    hide(getRetry(id));
                    hide(getPause(id));
                    hide(getContinue(id));
                    if (isCancelDisabled) {
                        this.hideCancel(id);
                    }
                    thumb = getThumbnail(id);
                    if (thumb && !thumb.src) {
                        cachedWaitingForThumbnailImg.then(function(waitingImg) {
                            thumb.src = waitingImg.src;
                            if (waitingImg.style.maxHeight && waitingImg.style.maxWidth) {
                                qq(thumb).css({
                                    maxHeight: waitingImg.style.maxHeight,
                                    maxWidth: waitingImg.style.maxWidth
                                });
                            }
                            show(thumb);
                        });
                    }
                }
            },
            addFileToCache: function(id, name, prependInfo, hideForever) {
                this.addFile(id, name, prependInfo, hideForever, true);
            },
            addCacheToDom: function() {
                fileList.appendChild(fileBatch.content);
                fileBatch.content = document.createDocumentFragment();
                fileBatch.map = {};
            },
            removeFile: function(id) {
                qq(getFile(id)).remove();
            },
            getFileId: function(el) {
                var currentNode = el;
                if (currentNode) {
                    while (currentNode.getAttribute(FILE_ID_ATTR) == null) {
                        currentNode = currentNode.parentNode;
                    }
                    return parseInt(currentNode.getAttribute(FILE_ID_ATTR));
                }
            },
            getFileList: function() {
                return fileList;
            },
            markFilenameEditable: function(id) {
                var filename = getFilename(id);
                filename && qq(filename).addClass(options.classes.editable);
            },
            updateFilename: function(id, name) {
                var filenameEl = getFilename(id);
                if (filenameEl) {
                    qq(filenameEl).setText(name);
                    filenameEl.setAttribute("title", name);
                }
            },
            hideFilename: function(id) {
                hide(getFilename(id));
            },
            showFilename: function(id) {
                show(getFilename(id));
            },
            isFileName: function(el) {
                return qq(el).hasClass(selectorClasses.file);
            },
            getButton: function() {
                return options.button || getTemplateEl(container, selectorClasses.button);
            },
            hideDropProcessing: function() {
                hide(getDropProcessing());
            },
            showDropProcessing: function() {
                show(getDropProcessing());
            },
            getDropZone: function() {
                return getTemplateEl(container, selectorClasses.drop);
            },
            isEditFilenamePossible: function() {
                return isEditElementsExist;
            },
            hideRetry: function(id) {
                hide(getRetry(id));
            },
            isRetryPossible: function() {
                return isRetryElementExist;
            },
            showRetry: function(id) {
                show(getRetry(id));
            },
            getFileContainer: function(id) {
                return getFile(id);
            },
            showEditIcon: function(id) {
                var icon = getEditIcon(id);
                icon && qq(icon).addClass(options.classes.editable);
            },
            isHiddenForever: function(id) {
                return qq(getFile(id)).hasClass(HIDDEN_FOREVER_CLASS);
            },
            hideEditIcon: function(id) {
                var icon = getEditIcon(id);
                icon && qq(icon).removeClass(options.classes.editable);
            },
            isEditIcon: function(el) {
                return qq(el).hasClass(selectorClasses.editNameIcon, true);
            },
            getEditInput: function(id) {
                return getTemplateEl(getFile(id), selectorClasses.editFilenameInput);
            },
            isEditInput: function(el) {
                return qq(el).hasClass(selectorClasses.editFilenameInput, true);
            },
            updateProgress: function(id, loaded, total) {
                var bar = getProgress(id), percent;
                if (bar && total > 0) {
                    percent = Math.round(loaded / total * 100);
                    if (percent === 100) {
                        hide(bar);
                    } else {
                        show(bar);
                    }
                    setProgressBarWidth(id, percent);
                }
            },
            updateTotalProgress: function(loaded, total) {
                this.updateProgress(null, loaded, total);
            },
            hideProgress: function(id) {
                var bar = getProgress(id);
                bar && hide(bar);
            },
            hideTotalProgress: function() {
                this.hideProgress();
            },
            resetProgress: function(id) {
                setProgressBarWidth(id, 0);
                this.hideTotalProgress(id);
            },
            resetTotalProgress: function() {
                this.resetProgress();
            },
            showCancel: function(id) {
                if (!isCancelDisabled) {
                    var cancel = getCancel(id);
                    cancel && qq(cancel).removeClass(options.classes.hide);
                }
            },
            hideCancel: function(id) {
                hide(getCancel(id));
            },
            isCancel: function(el) {
                return qq(el).hasClass(selectorClasses.cancel, true);
            },
            allowPause: function(id) {
                show(getPause(id));
                hide(getContinue(id));
            },
            uploadPaused: function(id) {
                this.setStatusText(id, options.text.paused);
                this.allowContinueButton(id);
                hide(getSpinner(id));
            },
            hidePause: function(id) {
                hide(getPause(id));
            },
            isPause: function(el) {
                return qq(el).hasClass(selectorClasses.pause, true);
            },
            isContinueButton: function(el) {
                return qq(el).hasClass(selectorClasses.continueButton, true);
            },
            allowContinueButton: function(id) {
                show(getContinue(id));
                hide(getPause(id));
            },
            uploadContinued: function(id) {
                this.setStatusText(id, "");
                this.allowPause(id);
                show(getSpinner(id));
            },
            showDeleteButton: function(id) {
                show(getDelete(id));
            },
            hideDeleteButton: function(id) {
                hide(getDelete(id));
            },
            isDeleteButton: function(el) {
                return qq(el).hasClass(selectorClasses.deleteButton, true);
            },
            isRetry: function(el) {
                return qq(el).hasClass(selectorClasses.retry, true);
            },
            updateSize: function(id, text) {
                var size = getSize(id);
                if (size) {
                    show(size);
                    qq(size).setText(text);
                }
            },
            setStatusText: function(id, text) {
                var textEl = getTemplateEl(getFile(id), selectorClasses.statusText);
                if (textEl) {
                    if (text == null) {
                        qq(textEl).clearText();
                    } else {
                        qq(textEl).setText(text);
                    }
                }
            },
            hideSpinner: function(id) {
                qq(getFile(id)).removeClass(IN_PROGRESS_CLASS);
                hide(getSpinner(id));
            },
            showSpinner: function(id) {
                qq(getFile(id)).addClass(IN_PROGRESS_CLASS);
                show(getSpinner(id));
            },
            generatePreview: function(id, optFileOrBlob, customResizeFunction) {
                if (!this.isHiddenForever(id)) {
                    thumbGenerationQueue.push({
                        id: id,
                        customResizeFunction: customResizeFunction,
                        optFileOrBlob: optFileOrBlob
                    });
                    !thumbnailQueueMonitorRunning && generateNextQueuedPreview();
                }
            },
            updateThumbnail: function(id, thumbnailUrl, showWaitingImg, customResizeFunction) {
                if (!this.isHiddenForever(id)) {
                    thumbGenerationQueue.push({
                        customResizeFunction: customResizeFunction,
                        update: true,
                        id: id,
                        thumbnailUrl: thumbnailUrl,
                        showWaitingImg: showWaitingImg
                    });
                    !thumbnailQueueMonitorRunning && generateNextQueuedPreview();
                }
            },
            hasDialog: function(type) {
                return qq.supportedFeatures.dialogElement && !!getDialog(type);
            },
            showDialog: function(type, message, defaultValue) {
                var dialog = getDialog(type), messageEl = getTemplateEl(dialog, selectorClasses.dialogMessage), inputEl = dialog.getElementsByTagName("INPUT")[0], cancelBtn = getTemplateEl(dialog, selectorClasses.dialogCancelButton), okBtn = getTemplateEl(dialog, selectorClasses.dialogOkButton), promise = new qq.Promise(), closeHandler = function() {
                    cancelBtn.removeEventListener("click", cancelClickHandler);
                    okBtn && okBtn.removeEventListener("click", okClickHandler);
                    promise.failure();
                }, cancelClickHandler = function() {
                    cancelBtn.removeEventListener("click", cancelClickHandler);
                    dialog.close();
                }, okClickHandler = function() {
                    dialog.removeEventListener("close", closeHandler);
                    okBtn.removeEventListener("click", okClickHandler);
                    dialog.close();
                    promise.success(inputEl && inputEl.value);
                };
                dialog.addEventListener("close", closeHandler);
                cancelBtn.addEventListener("click", cancelClickHandler);
                okBtn && okBtn.addEventListener("click", okClickHandler);
                if (inputEl) {
                    inputEl.value = defaultValue;
                }
                messageEl.textContent = message;
                dialog.showModal();
                return promise;
            }
        });
    };
    qq.UiEventHandler = function(s, protectedApi) {
        "use strict";
        var disposer = new qq.DisposeSupport(), spec = {
            eventType: "click",
            attachTo: null,
            onHandled: function(target, event) {}
        };
        qq.extend(this, {
            addHandler: function(element) {
                addHandler(element);
            },
            dispose: function() {
                disposer.dispose();
            }
        });
        function addHandler(element) {
            disposer.attach(element, spec.eventType, function(event) {
                event = event || window.event;
                var target = event.target || event.srcElement;
                spec.onHandled(target, event);
            });
        }
        qq.extend(protectedApi, {
            getFileIdFromItem: function(item) {
                return item.qqFileId;
            },
            getDisposeSupport: function() {
                return disposer;
            }
        });
        qq.extend(spec, s);
        if (spec.attachTo) {
            addHandler(spec.attachTo);
        }
    };
    qq.FileButtonsClickHandler = function(s) {
        "use strict";
        var inheritedInternalApi = {}, spec = {
            templating: null,
            log: function(message, lvl) {},
            onDeleteFile: function(fileId) {},
            onCancel: function(fileId) {},
            onRetry: function(fileId) {},
            onPause: function(fileId) {},
            onContinue: function(fileId) {},
            onGetName: function(fileId) {}
        }, buttonHandlers = {
            cancel: function(id) {
                spec.onCancel(id);
            },
            retry: function(id) {
                spec.onRetry(id);
            },
            deleteButton: function(id) {
                spec.onDeleteFile(id);
            },
            pause: function(id) {
                spec.onPause(id);
            },
            continueButton: function(id) {
                spec.onContinue(id);
            }
        };
        function examineEvent(target, event) {
            qq.each(buttonHandlers, function(buttonType, handler) {
                var firstLetterCapButtonType = buttonType.charAt(0).toUpperCase() + buttonType.slice(1), fileId;
                if (spec.templating["is" + firstLetterCapButtonType](target)) {
                    fileId = spec.templating.getFileId(target);
                    qq.preventDefault(event);
                    spec.log(qq.format("Detected valid file button click event on file '{}', ID: {}.", spec.onGetName(fileId), fileId));
                    handler(fileId);
                    return false;
                }
            });
        }
        qq.extend(spec, s);
        spec.eventType = "click";
        spec.onHandled = examineEvent;
        spec.attachTo = spec.templating.getFileList();
        qq.extend(this, new qq.UiEventHandler(spec, inheritedInternalApi));
    };
    qq.FilenameClickHandler = function(s) {
        "use strict";
        var inheritedInternalApi = {}, spec = {
            templating: null,
            log: function(message, lvl) {},
            classes: {
                file: "qq-upload-file",
                editNameIcon: "qq-edit-filename-icon"
            },
            onGetUploadStatus: function(fileId) {},
            onGetName: function(fileId) {}
        };
        qq.extend(spec, s);
        function examineEvent(target, event) {
            if (spec.templating.isFileName(target) || spec.templating.isEditIcon(target)) {
                var fileId = spec.templating.getFileId(target), status = spec.onGetUploadStatus(fileId);
                if (status === qq.status.SUBMITTED) {
                    spec.log(qq.format("Detected valid filename click event on file '{}', ID: {}.", spec.onGetName(fileId), fileId));
                    qq.preventDefault(event);
                    inheritedInternalApi.handleFilenameEdit(fileId, target, true);
                }
            }
        }
        spec.eventType = "click";
        spec.onHandled = examineEvent;
        qq.extend(this, new qq.FilenameEditHandler(spec, inheritedInternalApi));
    };
    qq.FilenameInputFocusInHandler = function(s, inheritedInternalApi) {
        "use strict";
        var spec = {
            templating: null,
            onGetUploadStatus: function(fileId) {},
            log: function(message, lvl) {}
        };
        if (!inheritedInternalApi) {
            inheritedInternalApi = {};
        }
        function handleInputFocus(target, event) {
            if (spec.templating.isEditInput(target)) {
                var fileId = spec.templating.getFileId(target), status = spec.onGetUploadStatus(fileId);
                if (status === qq.status.SUBMITTED) {
                    spec.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.", spec.onGetName(fileId), fileId));
                    inheritedInternalApi.handleFilenameEdit(fileId, target);
                }
            }
        }
        spec.eventType = "focusin";
        spec.onHandled = handleInputFocus;
        qq.extend(spec, s);
        qq.extend(this, new qq.FilenameEditHandler(spec, inheritedInternalApi));
    };
    qq.FilenameInputFocusHandler = function(spec) {
        "use strict";
        spec.eventType = "focus";
        spec.attachTo = null;
        qq.extend(this, new qq.FilenameInputFocusInHandler(spec, {}));
    };
    qq.FilenameEditHandler = function(s, inheritedInternalApi) {
        "use strict";
        var spec = {
            templating: null,
            log: function(message, lvl) {},
            onGetUploadStatus: function(fileId) {},
            onGetName: function(fileId) {},
            onSetName: function(fileId, newName) {},
            onEditingStatusChange: function(fileId, isEditing) {}
        };
        function getFilenameSansExtension(fileId) {
            var filenameSansExt = spec.onGetName(fileId), extIdx = filenameSansExt.lastIndexOf(".");
            if (extIdx > 0) {
                filenameSansExt = filenameSansExt.substr(0, extIdx);
            }
            return filenameSansExt;
        }
        function getOriginalExtension(fileId) {
            var origName = spec.onGetName(fileId);
            return qq.getExtension(origName);
        }
        function handleNameUpdate(newFilenameInputEl, fileId) {
            var newName = newFilenameInputEl.value, origExtension;
            if (newName !== undefined && qq.trimStr(newName).length > 0) {
                origExtension = getOriginalExtension(fileId);
                if (origExtension !== undefined) {
                    newName = newName + "." + origExtension;
                }
                spec.onSetName(fileId, newName);
            }
            spec.onEditingStatusChange(fileId, false);
        }
        function registerInputBlurHandler(inputEl, fileId) {
            inheritedInternalApi.getDisposeSupport().attach(inputEl, "blur", function() {
                handleNameUpdate(inputEl, fileId);
            });
        }
        function registerInputEnterKeyHandler(inputEl, fileId) {
            inheritedInternalApi.getDisposeSupport().attach(inputEl, "keyup", function(event) {
                var code = event.keyCode || event.which;
                if (code === 13) {
                    handleNameUpdate(inputEl, fileId);
                }
            });
        }
        qq.extend(spec, s);
        spec.attachTo = spec.templating.getFileList();
        qq.extend(this, new qq.UiEventHandler(spec, inheritedInternalApi));
        qq.extend(inheritedInternalApi, {
            handleFilenameEdit: function(id, target, focusInput) {
                var newFilenameInputEl = spec.templating.getEditInput(id);
                spec.onEditingStatusChange(id, true);
                newFilenameInputEl.value = getFilenameSansExtension(id);
                if (focusInput) {
                    newFilenameInputEl.focus();
                }
                registerInputBlurHandler(newFilenameInputEl, id);
                registerInputEnterKeyHandler(newFilenameInputEl, id);
            }
        });
    };
})(window);
//# sourceMappingURL=fine-uploader.js.map

/***/ }),

/***/ "./node_modules/fine-uploader/lib/traditional.js":
/*!*******************************************************!*\
  !*** ./node_modules/fine-uploader/lib/traditional.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = __webpack_require__(/*! ../fine-uploader/fine-uploader */ "./node_modules/fine-uploader/fine-uploader/fine-uploader.js");


/***/ }),

/***/ "./src/Donjohn/MediaBundle/Resources/assets/fine-uploader.js":
/*!*******************************************************************!*\
  !*** ./src/Donjohn/MediaBundle/Resources/assets/fine-uploader.js ***!
  \*******************************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var fine_uploader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fine-uploader */ "./node_modules/fine-uploader/lib/traditional.js");
/* harmony import */ var fine_uploader__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fine_uploader__WEBPACK_IMPORTED_MODULE_0__);


__webpack_require__(/*! fine-uploader/fine-uploader/fine-uploader-gallery.css */ "./node_modules/fine-uploader/fine-uploader/fine-uploader-gallery.css");

__webpack_require__(/*! @fortawesome/fontawesome-free */ "./node_modules/@fortawesome/fontawesome-free/js/fontawesome.js");

fine_uploader__WEBPACK_IMPORTED_MODULE_0___default.a.uiPrivateApi._isEditFilenameEnabled = function () {
  return this._templating.isEditFilenamePossible() && fine_uploader__WEBPACK_IMPORTED_MODULE_0___default.a.FilenameClickHandler && fine_uploader__WEBPACK_IMPORTED_MODULE_0___default.a.FilenameInputFocusHandler && fine_uploader__WEBPACK_IMPORTED_MODULE_0___default.a.FilenameInputFocusHandler;
};

window.addEventListener('load', function () {
  var fineUploaders = [];
  document.querySelectorAll('div[fine-uploader="true"]').forEach(function (element, index) {
    fineUploaders[index] = new fine_uploader__WEBPACK_IMPORTED_MODULE_0___default.a.FineUploader({
      // debug: true,
      element: element,
      request: {
        endpoint: element.dataset.requestEndpoint,
        paramsInBody: false
      },
      template: 'donjohn-media',
      chunking: {
        enabled: true,
        partSize: parseInt(element.dataset.chunkingPartsize, 10)
      },
      retry: {
        enableAuto: true
      },
      deleteFile: {
        enabled: true,
        endpoint: element.dataset.delete_fileEndpoint
      },
      callbacks: {
        onSubmitDelete: function onSubmitDelete(id) {
          this.setDeleteFileParams({
            filename: this.getName(id)
          }, id);
        }
      },
      thumbnails: {
        placeholders: {
          notAvailablePath: element.dataset.thumbnailsPlaceholdersNotAvailablepath,
          waitingPath: element.dataset.thumbnailsPlaceholdersWaitingpath,
          waitUntilResponse: true
        }
      },
      multiple: element.dataset.multiple,
      session: {
        endpoint: element.dataset.sessionEndpoint
      }
    });
  });
}, true);

/***/ })

},[["./src/Donjohn/MediaBundle/Resources/assets/fine-uploader.js","runtime"]]]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGZvcnRhd2Vzb21lL2ZvbnRhd2Vzb21lLWZyZWUvanMvZm9udGF3ZXNvbWUuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2ZpbmUtdXBsb2FkZXIvZmluZS11cGxvYWRlci9maW5lLXVwbG9hZGVyLWdhbGxlcnkuY3NzP2NlY2IiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2ZpbmUtdXBsb2FkZXIvZmluZS11cGxvYWRlci9maW5lLXVwbG9hZGVyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9maW5lLXVwbG9hZGVyL2xpYi90cmFkaXRpb25hbC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvRG9uam9obi9NZWRpYUJ1bmRsZS9SZXNvdXJjZXMvYXNzZXRzL2ZpbmUtdXBsb2FkZXIuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsInFxIiwidWlQcml2YXRlQXBpIiwiX2lzRWRpdEZpbGVuYW1lRW5hYmxlZCIsIl90ZW1wbGF0aW5nIiwiaXNFZGl0RmlsZW5hbWVQb3NzaWJsZSIsIkZpbGVuYW1lQ2xpY2tIYW5kbGVyIiwiRmlsZW5hbWVJbnB1dEZvY3VzSGFuZGxlciIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJmaW5lVXBsb2FkZXJzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImVsZW1lbnQiLCJpbmRleCIsIkZpbmVVcGxvYWRlciIsInJlcXVlc3QiLCJlbmRwb2ludCIsImRhdGFzZXQiLCJyZXF1ZXN0RW5kcG9pbnQiLCJwYXJhbXNJbkJvZHkiLCJ0ZW1wbGF0ZSIsImNodW5raW5nIiwiZW5hYmxlZCIsInBhcnRTaXplIiwicGFyc2VJbnQiLCJjaHVua2luZ1BhcnRzaXplIiwicmV0cnkiLCJlbmFibGVBdXRvIiwiZGVsZXRlRmlsZSIsImRlbGV0ZV9maWxlRW5kcG9pbnQiLCJjYWxsYmFja3MiLCJvblN1Ym1pdERlbGV0ZSIsImlkIiwic2V0RGVsZXRlRmlsZVBhcmFtcyIsImZpbGVuYW1lIiwiZ2V0TmFtZSIsInRodW1ibmFpbHMiLCJwbGFjZWhvbGRlcnMiLCJub3RBdmFpbGFibGVQYXRoIiwidGh1bWJuYWlsc1BsYWNlaG9sZGVyc05vdEF2YWlsYWJsZXBhdGgiLCJ3YWl0aW5nUGF0aCIsInRodW1ibmFpbHNQbGFjZWhvbGRlcnNXYWl0aW5ncGF0aCIsIndhaXRVbnRpbFJlc3BvbnNlIiwibXVsdGlwbGUiLCJzZXNzaW9uIiwic2Vzc2lvbkVuZHBvaW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLG1CQUFtQixrQkFBa0I7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsbUJBQW1CLHNCQUFzQjtBQUN6QztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsbURBQW1ELGdCQUFnQjs7QUFFbkU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLCtDQUErQywrQkFBK0I7QUFDOUU7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSCxvQ0FBb0M7QUFDcEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUEsK0JBQStCOztBQUUvQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSx5Q0FBeUMsUUFBUTtBQUNqRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFD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QTs7QUFFQSxVQUFVLFlBQVk7QUFDdEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLE9BQU8sSUFBSTtBQUNYOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLLElBQUk7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQ7QUFDMUQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE9BQU8sSUFBSTtBQUNYOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxtQkFBbUIsb0JBQW9CO0FBQ3ZDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSyxJQUFJO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7O0FBRUEsd0NBQXdDO0FBQ3hDO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0Esb0JBQW9CLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRztBQUNuQyxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0Esa0NBQWtDO0FBQ2xDLG1CQUFtQixFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUU7QUFDN0IsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDLG1CQUFtQixFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUU7QUFDN0IsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDLG1CQUFtQixFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUU7QUFDN0IsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0EsMkdB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QUFPO0FBQ1A7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7O0FBRUEsQ0FBQzs7Ozs7Ozs7Ozs7O0FDaDlERCx1Qzs7Ozs7Ozs7Ozs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGVBQWUscUJBQXFCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxzRUFBc0UsSUFBSTtBQUMxRSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlELElBQUk7QUFDN0Q7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQix3RUFBd0UsSUFBSTtBQUM1RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IseUJBQXlCO0FBQ3pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLHNFQUFzRSxJQUFJO0FBQzFFO0FBQ0EsaUJBQWlCO0FBQ2pCLHFFQUFxRSxJQUFJO0FBQ3pFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtB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ckI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsMERBQTBELGNBQWM7QUFDeEU7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBLGFBQWE7QUFDYixxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFC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O0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtB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Q0FBQ0ssT0FBUixDQUFnQlk7QUFGbEIsT0FmdUI7QUFtQm5DQyxlQUFTLEVBQUU7QUFDUEMsc0JBQWMsRUFBRSx3QkFBU0MsRUFBVCxFQUFjO0FBQzFCLGVBQUtDLG1CQUFMLENBQXlCO0FBQUNDLG9CQUFRLEVBQUUsS0FBS0MsT0FBTCxDQUFhSCxFQUFiO0FBQVgsV0FBekIsRUFBdURBLEVBQXZEO0FBQ0g7QUFITSxPQW5Cd0I7QUF3Qm5DSSxnQkFBVSxFQUFFO0FBQ1JDLG9CQUFZLEVBQUU7QUFDVkMsMEJBQWdCLEVBQUUxQixPQUFPLENBQUNLLE9BQVIsQ0FBZ0JzQixzQ0FEeEI7QUFFVkMscUJBQVcsRUFBRTVCLE9BQU8sQ0FBQ0ssT0FBUixDQUFnQndCLGlDQUZuQjtBQUdWQywyQkFBaUIsRUFBRTtBQUhUO0FBRE4sT0F4QnVCO0FBK0JuQ0MsY0FBUSxFQUFFL0IsT0FBTyxDQUFDSyxPQUFSLENBQWdCMEIsUUEvQlM7QUFnQ25DQyxhQUFPLEVBQUU7QUFDTDVCLGdCQUFRLEVBQUVKLE9BQU8sQ0FBQ0ssT0FBUixDQUFnQjRCO0FBRHJCO0FBaEMwQixLQUFwQixDQUF2QjtBQW9DSCxHQXRDRDtBQXVDSCxDQTFDRCxFQTBDRyxJQTFDSCxFIiwiZmlsZSI6ImZpbmUtdXBsb2FkZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEZvbnQgQXdlc29tZSBGcmVlIDUuNi4xIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tXG4gKiBMaWNlbnNlIC0gaHR0cHM6Ly9mb250YXdlc29tZS5jb20vbGljZW5zZS9mcmVlIChJY29uczogQ0MgQlkgNC4wLCBGb250czogU0lMIE9GTCAxLjEsIENvZGU6IE1JVCBMaWNlbnNlKVxuICovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge1xuICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO1xuICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO1xuICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO1xuICAgICAgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7XG4gICAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7XG4gICAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO1xuICAgIHJldHVybiBDb25zdHJ1Y3RvcjtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHtcbiAgICBpZiAoa2V5IGluIG9iaikge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7XG4gICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9ialtrZXldID0gdmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9iajtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9O1xuICAgICAgdmFyIG93bktleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpO1xuXG4gICAgICBpZiAodHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgb3duS2V5cyA9IG93bktleXMuY29uY2F0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoc291cmNlKS5maWx0ZXIoZnVuY3Rpb24gKHN5bSkge1xuICAgICAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwgc3ltKS5lbnVtZXJhYmxlO1xuICAgICAgICB9KSk7XG4gICAgICB9XG5cbiAgICAgIG93bktleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkge1xuICAgIHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7XG4gIH1cblxuICBmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgYXJyMltpXSA9IGFycltpXTtcblxuICAgICAgcmV0dXJuIGFycjI7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7XG4gIH1cblxuICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHtcbiAgICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09IFwiW29iamVjdCBBcmd1bWVudHNdXCIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge1xuICAgIHZhciBfYXJyID0gW107XG4gICAgdmFyIF9uID0gdHJ1ZTtcbiAgICB2YXIgX2QgPSBmYWxzZTtcbiAgICB2YXIgX2UgPSB1bmRlZmluZWQ7XG5cbiAgICB0cnkge1xuICAgICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge1xuICAgICAgICBfYXJyLnB1c2goX3MudmFsdWUpO1xuXG4gICAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhaztcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIF9kID0gdHJ1ZTtcbiAgICAgIF9lID0gZXJyO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIV9uICYmIF9pW1wicmV0dXJuXCJdICE9IG51bGwpIF9pW1wicmV0dXJuXCJdKCk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBpZiAoX2QpIHRocm93IF9lO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBfYXJyO1xuICB9XG5cbiAgZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZVwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2VcIik7XG4gIH1cblxuICB2YXIgbm9vcCA9IGZ1bmN0aW9uIG5vb3AoKSB7fTtcblxuICB2YXIgX1dJTkRPVyA9IHt9O1xuICB2YXIgX0RPQ1VNRU5UID0ge307XG4gIHZhciBfTVVUQVRJT05fT0JTRVJWRVIgPSBudWxsO1xuICB2YXIgX1BFUkZPUk1BTkNFID0ge1xuICAgIG1hcms6IG5vb3AsXG4gICAgbWVhc3VyZTogbm9vcFxuICB9O1xuXG4gIHRyeSB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSBfV0lORE9XID0gd2luZG93O1xuICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnKSBfRE9DVU1FTlQgPSBkb2N1bWVudDtcbiAgICBpZiAodHlwZW9mIE11dGF0aW9uT2JzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSBfTVVUQVRJT05fT0JTRVJWRVIgPSBNdXRhdGlvbk9ic2VydmVyO1xuICAgIGlmICh0eXBlb2YgcGVyZm9ybWFuY2UgIT09ICd1bmRlZmluZWQnKSBfUEVSRk9STUFOQ0UgPSBwZXJmb3JtYW5jZTtcbiAgfSBjYXRjaCAoZSkge31cblxuICB2YXIgX3JlZiA9IF9XSU5ET1cubmF2aWdhdG9yIHx8IHt9LFxuICAgICAgX3JlZiR1c2VyQWdlbnQgPSBfcmVmLnVzZXJBZ2VudCxcbiAgICAgIHVzZXJBZ2VudCA9IF9yZWYkdXNlckFnZW50ID09PSB2b2lkIDAgPyAnJyA6IF9yZWYkdXNlckFnZW50O1xuXG4gIHZhciBXSU5ET1cgPSBfV0lORE9XO1xuICB2YXIgRE9DVU1FTlQgPSBfRE9DVU1FTlQ7XG4gIHZhciBNVVRBVElPTl9PQlNFUlZFUiA9IF9NVVRBVElPTl9PQlNFUlZFUjtcbiAgdmFyIFBFUkZPUk1BTkNFID0gX1BFUkZPUk1BTkNFO1xuICB2YXIgSVNfQlJPV1NFUiA9ICEhV0lORE9XLmRvY3VtZW50O1xuICB2YXIgSVNfRE9NID0gISFET0NVTUVOVC5kb2N1bWVudEVsZW1lbnQgJiYgISFET0NVTUVOVC5oZWFkICYmIHR5cGVvZiBET0NVTUVOVC5hZGRFdmVudExpc3RlbmVyID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBET0NVTUVOVC5jcmVhdGVFbGVtZW50ID09PSAnZnVuY3Rpb24nO1xuICB2YXIgSVNfSUUgPSB+dXNlckFnZW50LmluZGV4T2YoJ01TSUUnKSB8fCB+dXNlckFnZW50LmluZGV4T2YoJ1RyaWRlbnQvJyk7XG5cbiAgdmFyIE5BTUVTUEFDRV9JREVOVElGSUVSID0gJ19fX0ZPTlRfQVdFU09NRV9fXyc7XG4gIHZhciBVTklUU19JTl9HUklEID0gMTY7XG4gIHZhciBERUZBVUxUX0ZBTUlMWV9QUkVGSVggPSAnZmEnO1xuICB2YXIgREVGQVVMVF9SRVBMQUNFTUVOVF9DTEFTUyA9ICdzdmctaW5saW5lLS1mYSc7XG4gIHZhciBEQVRBX0ZBX0kyU1ZHID0gJ2RhdGEtZmEtaTJzdmcnO1xuICB2YXIgREFUQV9GQV9QU0VVRE9fRUxFTUVOVCA9ICdkYXRhLWZhLXBzZXVkby1lbGVtZW50JztcbiAgdmFyIERBVEFfUFJFRklYID0gJ2RhdGEtcHJlZml4JztcbiAgdmFyIERBVEFfSUNPTiA9ICdkYXRhLWljb24nO1xuICB2YXIgSFRNTF9DTEFTU19JMlNWR19CQVNFX0NMQVNTID0gJ2ZvbnRhd2Vzb21lLWkyc3ZnJztcbiAgdmFyIFRBR05BTUVTX1RPX1NLSVBfRk9SX1BTRVVET0VMRU1FTlRTID0gWydIVE1MJywgJ0hFQUQnLCAnU1RZTEUnLCAnU0NSSVBUJ107XG4gIHZhciBQUk9EVUNUSU9OID0gZnVuY3Rpb24gKCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gXCJwcm9kdWN0aW9uXCIgPT09ICdwcm9kdWN0aW9uJztcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9KCk7XG4gIHZhciBvbmVUb1RlbiA9IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF07XG4gIHZhciBvbmVUb1R3ZW50eSA9IG9uZVRvVGVuLmNvbmNhdChbMTEsIDEyLCAxMywgMTQsIDE1LCAxNiwgMTcsIDE4LCAxOSwgMjBdKTtcbiAgdmFyIEFUVFJJQlVURVNfV0FUQ0hFRF9GT1JfTVVUQVRJT04gPSBbJ2NsYXNzJywgJ2RhdGEtcHJlZml4JywgJ2RhdGEtaWNvbicsICdkYXRhLWZhLXRyYW5zZm9ybScsICdkYXRhLWZhLW1hc2snXTtcbiAgdmFyIFJFU0VSVkVEX0NMQVNTRVMgPSBbJ3hzJywgJ3NtJywgJ2xnJywgJ2Z3JywgJ3VsJywgJ2xpJywgJ2JvcmRlcicsICdwdWxsLWxlZnQnLCAncHVsbC1yaWdodCcsICdzcGluJywgJ3B1bHNlJywgJ3JvdGF0ZS05MCcsICdyb3RhdGUtMTgwJywgJ3JvdGF0ZS0yNzAnLCAnZmxpcC1ob3Jpem9udGFsJywgJ2ZsaXAtdmVydGljYWwnLCAnc3RhY2snLCAnc3RhY2stMXgnLCAnc3RhY2stMngnLCAnaW52ZXJzZScsICdsYXllcnMnLCAnbGF5ZXJzLXRleHQnLCAnbGF5ZXJzLWNvdW50ZXInXS5jb25jYXQob25lVG9UZW4ubWFwKGZ1bmN0aW9uIChuKSB7XG4gICAgcmV0dXJuIFwiXCIuY29uY2F0KG4sIFwieFwiKTtcbiAgfSkpLmNvbmNhdChvbmVUb1R3ZW50eS5tYXAoZnVuY3Rpb24gKG4pIHtcbiAgICByZXR1cm4gXCJ3LVwiLmNvbmNhdChuKTtcbiAgfSkpO1xuXG4gIHZhciBpbml0aWFsID0gV0lORE9XLkZvbnRBd2Vzb21lQ29uZmlnIHx8IHt9O1xuXG4gIGZ1bmN0aW9uIGdldEF0dHJDb25maWcoYXR0cikge1xuICAgIHZhciBlbGVtZW50ID0gRE9DVU1FTlQucXVlcnlTZWxlY3Rvcignc2NyaXB0WycgKyBhdHRyICsgJ10nKTtcblxuICAgIGlmIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gY29lcmNlKHZhbCkge1xuICAgIC8vIEdldHRpbmcgYW4gZW1wdHkgc3RyaW5nIHdpbGwgb2NjdXIgaWYgdGhlIGF0dHJpYnV0ZSBpcyBzZXQgb24gdGhlIEhUTUwgdGFnIGJ1dCB3aXRob3V0IGEgdmFsdWVcbiAgICAvLyBXZSdsbCBhc3N1bWUgdGhhdCB0aGlzIGlzIGFuIGluZGljYXRpb24gdGhhdCBpdCBzaG91bGQgYmUgdG9nZ2xlZCB0byB0cnVlXG4gICAgLy8gRm9yIGV4YW1wbGUgPHNjcmlwdCBkYXRhLXNlYXJjaC1wc2V1ZG8tZWxlbWVudHMgc3JjPVwiLi4uXCI+PC9zY3JpcHQ+XG4gICAgaWYgKHZhbCA9PT0gJycpIHJldHVybiB0cnVlO1xuICAgIGlmICh2YWwgPT09ICdmYWxzZScpIHJldHVybiBmYWxzZTtcbiAgICBpZiAodmFsID09PSAndHJ1ZScpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiB2YWw7XG4gIH1cblxuICBpZiAoRE9DVU1FTlQgJiYgdHlwZW9mIERPQ1VNRU5ULnF1ZXJ5U2VsZWN0b3IgPT09ICdmdW5jdGlvbicpIHtcbiAgICB2YXIgYXR0cnMgPSBbWydkYXRhLWZhbWlseS1wcmVmaXgnLCAnZmFtaWx5UHJlZml4J10sIFsnZGF0YS1yZXBsYWNlbWVudC1jbGFzcycsICdyZXBsYWNlbWVudENsYXNzJ10sIFsnZGF0YS1hdXRvLXJlcGxhY2Utc3ZnJywgJ2F1dG9SZXBsYWNlU3ZnJ10sIFsnZGF0YS1hdXRvLWFkZC1jc3MnLCAnYXV0b0FkZENzcyddLCBbJ2RhdGEtYXV0by1hMTF5JywgJ2F1dG9BMTF5J10sIFsnZGF0YS1zZWFyY2gtcHNldWRvLWVsZW1lbnRzJywgJ3NlYXJjaFBzZXVkb0VsZW1lbnRzJ10sIFsnZGF0YS1vYnNlcnZlLW11dGF0aW9ucycsICdvYnNlcnZlTXV0YXRpb25zJ10sIFsnZGF0YS1rZWVwLW9yaWdpbmFsLXNvdXJjZScsICdrZWVwT3JpZ2luYWxTb3VyY2UnXSwgWydkYXRhLW1lYXN1cmUtcGVyZm9ybWFuY2UnLCAnbWVhc3VyZVBlcmZvcm1hbmNlJ10sIFsnZGF0YS1zaG93LW1pc3NpbmctaWNvbnMnLCAnc2hvd01pc3NpbmdJY29ucyddXTtcbiAgICBhdHRycy5mb3JFYWNoKGZ1bmN0aW9uIChfcmVmKSB7XG4gICAgICB2YXIgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAyKSxcbiAgICAgICAgICBhdHRyID0gX3JlZjJbMF0sXG4gICAgICAgICAga2V5ID0gX3JlZjJbMV07XG5cbiAgICAgIHZhciB2YWwgPSBjb2VyY2UoZ2V0QXR0ckNvbmZpZyhhdHRyKSk7XG5cbiAgICAgIGlmICh2YWwgIT09IHVuZGVmaW5lZCAmJiB2YWwgIT09IG51bGwpIHtcbiAgICAgICAgaW5pdGlhbFtrZXldID0gdmFsO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgdmFyIF9kZWZhdWx0ID0gX29iamVjdFNwcmVhZCh7XG4gICAgZmFtaWx5UHJlZml4OiBERUZBVUxUX0ZBTUlMWV9QUkVGSVgsXG4gICAgcmVwbGFjZW1lbnRDbGFzczogREVGQVVMVF9SRVBMQUNFTUVOVF9DTEFTUyxcbiAgICBhdXRvUmVwbGFjZVN2ZzogdHJ1ZSxcbiAgICBhdXRvQWRkQ3NzOiB0cnVlLFxuICAgIGF1dG9BMTF5OiB0cnVlLFxuICAgIHNlYXJjaFBzZXVkb0VsZW1lbnRzOiBmYWxzZSxcbiAgICBvYnNlcnZlTXV0YXRpb25zOiB0cnVlLFxuICAgIGtlZXBPcmlnaW5hbFNvdXJjZTogdHJ1ZSxcbiAgICBtZWFzdXJlUGVyZm9ybWFuY2U6IGZhbHNlLFxuICAgIHNob3dNaXNzaW5nSWNvbnM6IHRydWVcbiAgfSwgaW5pdGlhbCk7XG5cbiAgaWYgKCFfZGVmYXVsdC5hdXRvUmVwbGFjZVN2ZykgX2RlZmF1bHQub2JzZXJ2ZU11dGF0aW9ucyA9IGZhbHNlO1xuXG4gIHZhciBjb25maWcgPSBfb2JqZWN0U3ByZWFkKHt9LCBfZGVmYXVsdCk7XG5cbiAgV0lORE9XLkZvbnRBd2Vzb21lQ29uZmlnID0gY29uZmlnO1xuXG4gIHZhciB3ID0gV0lORE9XIHx8IHt9O1xuICBpZiAoIXdbTkFNRVNQQUNFX0lERU5USUZJRVJdKSB3W05BTUVTUEFDRV9JREVOVElGSUVSXSA9IHt9O1xuICBpZiAoIXdbTkFNRVNQQUNFX0lERU5USUZJRVJdLnN0eWxlcykgd1tOQU1FU1BBQ0VfSURFTlRJRklFUl0uc3R5bGVzID0ge307XG4gIGlmICghd1tOQU1FU1BBQ0VfSURFTlRJRklFUl0uaG9va3MpIHdbTkFNRVNQQUNFX0lERU5USUZJRVJdLmhvb2tzID0ge307XG4gIGlmICghd1tOQU1FU1BBQ0VfSURFTlRJRklFUl0uc2hpbXMpIHdbTkFNRVNQQUNFX0lERU5USUZJRVJdLnNoaW1zID0gW107XG4gIHZhciBuYW1lc3BhY2UgPSB3W05BTUVTUEFDRV9JREVOVElGSUVSXTtcblxuICB2YXIgZnVuY3Rpb25zID0gW107XG5cbiAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gbGlzdGVuZXIoKSB7XG4gICAgRE9DVU1FTlQucmVtb3ZlRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGxpc3RlbmVyKTtcbiAgICBsb2FkZWQgPSAxO1xuICAgIGZ1bmN0aW9ucy5tYXAoZnVuY3Rpb24gKGZuKSB7XG4gICAgICByZXR1cm4gZm4oKTtcbiAgICB9KTtcbiAgfTtcblxuICB2YXIgbG9hZGVkID0gZmFsc2U7XG5cbiAgaWYgKElTX0RPTSkge1xuICAgIGxvYWRlZCA9IChET0NVTUVOVC5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwgPyAvXmxvYWRlZHxeYy8gOiAvXmxvYWRlZHxeaXxeYy8pLnRlc3QoRE9DVU1FTlQucmVhZHlTdGF0ZSk7XG4gICAgaWYgKCFsb2FkZWQpIERPQ1VNRU5ULmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBsaXN0ZW5lcik7XG4gIH1cblxuICBmdW5jdGlvbiBkb21yZWFkeSAoZm4pIHtcbiAgICBpZiAoIUlTX0RPTSkgcmV0dXJuO1xuICAgIGxvYWRlZCA/IHNldFRpbWVvdXQoZm4sIDApIDogZnVuY3Rpb25zLnB1c2goZm4pO1xuICB9XG5cbiAgdmFyIGQgPSBVTklUU19JTl9HUklEO1xuICB2YXIgbWVhbmluZ2xlc3NUcmFuc2Zvcm0gPSB7XG4gICAgc2l6ZTogMTYsXG4gICAgeDogMCxcbiAgICB5OiAwLFxuICAgIHJvdGF0ZTogMCxcbiAgICBmbGlwWDogZmFsc2UsXG4gICAgZmxpcFk6IGZhbHNlXG4gIH07XG5cbiAgZnVuY3Rpb24gaXNSZXNlcnZlZChuYW1lKSB7XG4gICAgcmV0dXJuIH5SRVNFUlZFRF9DTEFTU0VTLmluZGV4T2YobmFtZSk7XG4gIH1cblxuICBmdW5jdGlvbiBidW5rZXIoZm4pIHtcbiAgICB0cnkge1xuICAgICAgZm4oKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoIVBST0RVQ1RJT04pIHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gaW5zZXJ0Q3NzKGNzcykge1xuICAgIGlmICghY3NzIHx8ICFJU19ET00pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgc3R5bGUgPSBET0NVTUVOVC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgIHN0eWxlLnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0L2NzcycpO1xuICAgIHN0eWxlLmlubmVySFRNTCA9IGNzcztcbiAgICB2YXIgaGVhZENoaWxkcmVuID0gRE9DVU1FTlQuaGVhZC5jaGlsZE5vZGVzO1xuICAgIHZhciBiZWZvcmVDaGlsZCA9IG51bGw7XG5cbiAgICBmb3IgKHZhciBpID0gaGVhZENoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPiAtMTsgaS0tKSB7XG4gICAgICB2YXIgY2hpbGQgPSBoZWFkQ2hpbGRyZW5baV07XG4gICAgICB2YXIgdGFnTmFtZSA9IChjaGlsZC50YWdOYW1lIHx8ICcnKS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgICBpZiAoWydTVFlMRScsICdMSU5LJ10uaW5kZXhPZih0YWdOYW1lKSA+IC0xKSB7XG4gICAgICAgIGJlZm9yZUNoaWxkID0gY2hpbGQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgRE9DVU1FTlQuaGVhZC5pbnNlcnRCZWZvcmUoc3R5bGUsIGJlZm9yZUNoaWxkKTtcbiAgICByZXR1cm4gY3NzO1xuICB9XG4gIHZhciBpZFBvb2wgPSAnMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonO1xuICBmdW5jdGlvbiBuZXh0VW5pcXVlSWQoKSB7XG4gICAgdmFyIHNpemUgPSAxMjtcbiAgICB2YXIgaWQgPSAnJztcblxuICAgIHdoaWxlIChzaXplLS0gPiAwKSB7XG4gICAgICBpZCArPSBpZFBvb2xbTWF0aC5yYW5kb20oKSAqIDYyIHwgMF07XG4gICAgfVxuXG4gICAgcmV0dXJuIGlkO1xuICB9XG4gIGZ1bmN0aW9uIHRvQXJyYXkob2JqKSB7XG4gICAgdmFyIGFycmF5ID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gKG9iaiB8fCBbXSkubGVuZ3RoID4+PiAwOyBpLS07KSB7XG4gICAgICBhcnJheVtpXSA9IG9ialtpXTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cbiAgZnVuY3Rpb24gY2xhc3NBcnJheShub2RlKSB7XG4gICAgaWYgKG5vZGUuY2xhc3NMaXN0KSB7XG4gICAgICByZXR1cm4gdG9BcnJheShub2RlLmNsYXNzTGlzdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAobm9kZS5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykgfHwgJycpLnNwbGl0KCcgJykuZmlsdGVyKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIHJldHVybiBpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGdldEljb25OYW1lKGZhbWlseVByZWZpeCwgY2xzKSB7XG4gICAgdmFyIHBhcnRzID0gY2xzLnNwbGl0KCctJyk7XG4gICAgdmFyIHByZWZpeCA9IHBhcnRzWzBdO1xuICAgIHZhciBpY29uTmFtZSA9IHBhcnRzLnNsaWNlKDEpLmpvaW4oJy0nKTtcblxuICAgIGlmIChwcmVmaXggPT09IGZhbWlseVByZWZpeCAmJiBpY29uTmFtZSAhPT0gJycgJiYgIWlzUmVzZXJ2ZWQoaWNvbk5hbWUpKSB7XG4gICAgICByZXR1cm4gaWNvbk5hbWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBodG1sRXNjYXBlKHN0cikge1xuICAgIHJldHVybiBcIlwiLmNvbmNhdChzdHIpLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvXCIvZywgJyZxdW90OycpLnJlcGxhY2UoLycvZywgJyYjMzk7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTtcbiAgfVxuICBmdW5jdGlvbiBqb2luQXR0cmlidXRlcyhhdHRyaWJ1dGVzKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMgfHwge30pLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICByZXR1cm4gYWNjICsgXCJcIi5jb25jYXQoYXR0cmlidXRlTmFtZSwgXCI9XFxcIlwiKS5jb25jYXQoaHRtbEVzY2FwZShhdHRyaWJ1dGVzW2F0dHJpYnV0ZU5hbWVdKSwgXCJcXFwiIFwiKTtcbiAgICB9LCAnJykudHJpbSgpO1xuICB9XG4gIGZ1bmN0aW9uIGpvaW5TdHlsZXMoc3R5bGVzKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHN0eWxlcyB8fCB7fSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHN0eWxlTmFtZSkge1xuICAgICAgcmV0dXJuIGFjYyArIFwiXCIuY29uY2F0KHN0eWxlTmFtZSwgXCI6IFwiKS5jb25jYXQoc3R5bGVzW3N0eWxlTmFtZV0sIFwiO1wiKTtcbiAgICB9LCAnJyk7XG4gIH1cbiAgZnVuY3Rpb24gdHJhbnNmb3JtSXNNZWFuaW5nZnVsKHRyYW5zZm9ybSkge1xuICAgIHJldHVybiB0cmFuc2Zvcm0uc2l6ZSAhPT0gbWVhbmluZ2xlc3NUcmFuc2Zvcm0uc2l6ZSB8fCB0cmFuc2Zvcm0ueCAhPT0gbWVhbmluZ2xlc3NUcmFuc2Zvcm0ueCB8fCB0cmFuc2Zvcm0ueSAhPT0gbWVhbmluZ2xlc3NUcmFuc2Zvcm0ueSB8fCB0cmFuc2Zvcm0ucm90YXRlICE9PSBtZWFuaW5nbGVzc1RyYW5zZm9ybS5yb3RhdGUgfHwgdHJhbnNmb3JtLmZsaXBYIHx8IHRyYW5zZm9ybS5mbGlwWTtcbiAgfVxuICBmdW5jdGlvbiB0cmFuc2Zvcm1Gb3JTdmcoX3JlZikge1xuICAgIHZhciB0cmFuc2Zvcm0gPSBfcmVmLnRyYW5zZm9ybSxcbiAgICAgICAgY29udGFpbmVyV2lkdGggPSBfcmVmLmNvbnRhaW5lcldpZHRoLFxuICAgICAgICBpY29uV2lkdGggPSBfcmVmLmljb25XaWR0aDtcbiAgICB2YXIgb3V0ZXIgPSB7XG4gICAgICB0cmFuc2Zvcm06IFwidHJhbnNsYXRlKFwiLmNvbmNhdChjb250YWluZXJXaWR0aCAvIDIsIFwiIDI1NilcIilcbiAgICB9O1xuICAgIHZhciBpbm5lclRyYW5zbGF0ZSA9IFwidHJhbnNsYXRlKFwiLmNvbmNhdCh0cmFuc2Zvcm0ueCAqIDMyLCBcIiwgXCIpLmNvbmNhdCh0cmFuc2Zvcm0ueSAqIDMyLCBcIikgXCIpO1xuICAgIHZhciBpbm5lclNjYWxlID0gXCJzY2FsZShcIi5jb25jYXQodHJhbnNmb3JtLnNpemUgLyAxNiAqICh0cmFuc2Zvcm0uZmxpcFggPyAtMSA6IDEpLCBcIiwgXCIpLmNvbmNhdCh0cmFuc2Zvcm0uc2l6ZSAvIDE2ICogKHRyYW5zZm9ybS5mbGlwWSA/IC0xIDogMSksIFwiKSBcIik7XG4gICAgdmFyIGlubmVyUm90YXRlID0gXCJyb3RhdGUoXCIuY29uY2F0KHRyYW5zZm9ybS5yb3RhdGUsIFwiIDAgMClcIik7XG4gICAgdmFyIGlubmVyID0ge1xuICAgICAgdHJhbnNmb3JtOiBcIlwiLmNvbmNhdChpbm5lclRyYW5zbGF0ZSwgXCIgXCIpLmNvbmNhdChpbm5lclNjYWxlLCBcIiBcIikuY29uY2F0KGlubmVyUm90YXRlKVxuICAgIH07XG4gICAgdmFyIHBhdGggPSB7XG4gICAgICB0cmFuc2Zvcm06IFwidHJhbnNsYXRlKFwiLmNvbmNhdChpY29uV2lkdGggLyAyICogLTEsIFwiIC0yNTYpXCIpXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgb3V0ZXI6IG91dGVyLFxuICAgICAgaW5uZXI6IGlubmVyLFxuICAgICAgcGF0aDogcGF0aFxuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gdHJhbnNmb3JtRm9yQ3NzKF9yZWYyKSB7XG4gICAgdmFyIHRyYW5zZm9ybSA9IF9yZWYyLnRyYW5zZm9ybSxcbiAgICAgICAgX3JlZjIkd2lkdGggPSBfcmVmMi53aWR0aCxcbiAgICAgICAgd2lkdGggPSBfcmVmMiR3aWR0aCA9PT0gdm9pZCAwID8gVU5JVFNfSU5fR1JJRCA6IF9yZWYyJHdpZHRoLFxuICAgICAgICBfcmVmMiRoZWlnaHQgPSBfcmVmMi5oZWlnaHQsXG4gICAgICAgIGhlaWdodCA9IF9yZWYyJGhlaWdodCA9PT0gdm9pZCAwID8gVU5JVFNfSU5fR1JJRCA6IF9yZWYyJGhlaWdodCxcbiAgICAgICAgX3JlZjIkc3RhcnRDZW50ZXJlZCA9IF9yZWYyLnN0YXJ0Q2VudGVyZWQsXG4gICAgICAgIHN0YXJ0Q2VudGVyZWQgPSBfcmVmMiRzdGFydENlbnRlcmVkID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYyJHN0YXJ0Q2VudGVyZWQ7XG4gICAgdmFyIHZhbCA9ICcnO1xuXG4gICAgaWYgKHN0YXJ0Q2VudGVyZWQgJiYgSVNfSUUpIHtcbiAgICAgIHZhbCArPSBcInRyYW5zbGF0ZShcIi5jb25jYXQodHJhbnNmb3JtLnggLyBkIC0gd2lkdGggLyAyLCBcImVtLCBcIikuY29uY2F0KHRyYW5zZm9ybS55IC8gZCAtIGhlaWdodCAvIDIsIFwiZW0pIFwiKTtcbiAgICB9IGVsc2UgaWYgKHN0YXJ0Q2VudGVyZWQpIHtcbiAgICAgIHZhbCArPSBcInRyYW5zbGF0ZShjYWxjKC01MCUgKyBcIi5jb25jYXQodHJhbnNmb3JtLnggLyBkLCBcImVtKSwgY2FsYygtNTAlICsgXCIpLmNvbmNhdCh0cmFuc2Zvcm0ueSAvIGQsIFwiZW0pKSBcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbCArPSBcInRyYW5zbGF0ZShcIi5jb25jYXQodHJhbnNmb3JtLnggLyBkLCBcImVtLCBcIikuY29uY2F0KHRyYW5zZm9ybS55IC8gZCwgXCJlbSkgXCIpO1xuICAgIH1cblxuICAgIHZhbCArPSBcInNjYWxlKFwiLmNvbmNhdCh0cmFuc2Zvcm0uc2l6ZSAvIGQgKiAodHJhbnNmb3JtLmZsaXBYID8gLTEgOiAxKSwgXCIsIFwiKS5jb25jYXQodHJhbnNmb3JtLnNpemUgLyBkICogKHRyYW5zZm9ybS5mbGlwWSA/IC0xIDogMSksIFwiKSBcIik7XG4gICAgdmFsICs9IFwicm90YXRlKFwiLmNvbmNhdCh0cmFuc2Zvcm0ucm90YXRlLCBcImRlZykgXCIpO1xuICAgIHJldHVybiB2YWw7XG4gIH1cblxuICB2YXIgQUxMX1NQQUNFID0ge1xuICAgIHg6IDAsXG4gICAgeTogMCxcbiAgICB3aWR0aDogJzEwMCUnLFxuICAgIGhlaWdodDogJzEwMCUnXG4gIH07XG4gIGZ1bmN0aW9uIG1ha2VJY29uTWFza2luZyAoX3JlZikge1xuICAgIHZhciBjaGlsZHJlbiA9IF9yZWYuY2hpbGRyZW4sXG4gICAgICAgIGF0dHJpYnV0ZXMgPSBfcmVmLmF0dHJpYnV0ZXMsXG4gICAgICAgIG1haW4gPSBfcmVmLm1haW4sXG4gICAgICAgIG1hc2sgPSBfcmVmLm1hc2ssXG4gICAgICAgIHRyYW5zZm9ybSA9IF9yZWYudHJhbnNmb3JtO1xuICAgIHZhciBtYWluV2lkdGggPSBtYWluLndpZHRoLFxuICAgICAgICBtYWluUGF0aCA9IG1haW4uaWNvbjtcbiAgICB2YXIgbWFza1dpZHRoID0gbWFzay53aWR0aCxcbiAgICAgICAgbWFza1BhdGggPSBtYXNrLmljb247XG4gICAgdmFyIHRyYW5zID0gdHJhbnNmb3JtRm9yU3ZnKHtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtLFxuICAgICAgY29udGFpbmVyV2lkdGg6IG1hc2tXaWR0aCxcbiAgICAgIGljb25XaWR0aDogbWFpbldpZHRoXG4gICAgfSk7XG4gICAgdmFyIG1hc2tSZWN0ID0ge1xuICAgICAgdGFnOiAncmVjdCcsXG4gICAgICBhdHRyaWJ1dGVzOiBfb2JqZWN0U3ByZWFkKHt9LCBBTExfU1BBQ0UsIHtcbiAgICAgICAgZmlsbDogJ3doaXRlJ1xuICAgICAgfSlcbiAgICB9O1xuICAgIHZhciBtYXNrSW5uZXJHcm91cCA9IHtcbiAgICAgIHRhZzogJ2cnLFxuICAgICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7fSwgdHJhbnMuaW5uZXIpLFxuICAgICAgY2hpbGRyZW46IFt7XG4gICAgICAgIHRhZzogJ3BhdGgnLFxuICAgICAgICBhdHRyaWJ1dGVzOiBfb2JqZWN0U3ByZWFkKHt9LCBtYWluUGF0aC5hdHRyaWJ1dGVzLCB0cmFucy5wYXRoLCB7XG4gICAgICAgICAgZmlsbDogJ2JsYWNrJ1xuICAgICAgICB9KVxuICAgICAgfV1cbiAgICB9O1xuICAgIHZhciBtYXNrT3V0ZXJHcm91cCA9IHtcbiAgICAgIHRhZzogJ2cnLFxuICAgICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7fSwgdHJhbnMub3V0ZXIpLFxuICAgICAgY2hpbGRyZW46IFttYXNrSW5uZXJHcm91cF1cbiAgICB9O1xuICAgIHZhciBtYXNrSWQgPSBcIm1hc2stXCIuY29uY2F0KG5leHRVbmlxdWVJZCgpKTtcbiAgICB2YXIgY2xpcElkID0gXCJjbGlwLVwiLmNvbmNhdChuZXh0VW5pcXVlSWQoKSk7XG4gICAgdmFyIG1hc2tUYWcgPSB7XG4gICAgICB0YWc6ICdtYXNrJyxcbiAgICAgIGF0dHJpYnV0ZXM6IF9vYmplY3RTcHJlYWQoe30sIEFMTF9TUEFDRSwge1xuICAgICAgICBpZDogbWFza0lkLFxuICAgICAgICBtYXNrVW5pdHM6ICd1c2VyU3BhY2VPblVzZScsXG4gICAgICAgIG1hc2tDb250ZW50VW5pdHM6ICd1c2VyU3BhY2VPblVzZSdcbiAgICAgIH0pLFxuICAgICAgY2hpbGRyZW46IFttYXNrUmVjdCwgbWFza091dGVyR3JvdXBdXG4gICAgfTtcbiAgICB2YXIgZGVmcyA9IHtcbiAgICAgIHRhZzogJ2RlZnMnLFxuICAgICAgY2hpbGRyZW46IFt7XG4gICAgICAgIHRhZzogJ2NsaXBQYXRoJyxcbiAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgIGlkOiBjbGlwSWRcbiAgICAgICAgfSxcbiAgICAgICAgY2hpbGRyZW46IFttYXNrUGF0aF1cbiAgICAgIH0sIG1hc2tUYWddXG4gICAgfTtcbiAgICBjaGlsZHJlbi5wdXNoKGRlZnMsIHtcbiAgICAgIHRhZzogJ3JlY3QnLFxuICAgICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7XG4gICAgICAgIGZpbGw6ICdjdXJyZW50Q29sb3InLFxuICAgICAgICAnY2xpcC1wYXRoJzogXCJ1cmwoI1wiLmNvbmNhdChjbGlwSWQsIFwiKVwiKSxcbiAgICAgICAgbWFzazogXCJ1cmwoI1wiLmNvbmNhdChtYXNrSWQsIFwiKVwiKVxuICAgICAgfSwgQUxMX1NQQUNFKVxuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICBjaGlsZHJlbjogY2hpbGRyZW4sXG4gICAgICBhdHRyaWJ1dGVzOiBhdHRyaWJ1dGVzXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1ha2VJY29uU3RhbmRhcmQgKF9yZWYpIHtcbiAgICB2YXIgY2hpbGRyZW4gPSBfcmVmLmNoaWxkcmVuLFxuICAgICAgICBhdHRyaWJ1dGVzID0gX3JlZi5hdHRyaWJ1dGVzLFxuICAgICAgICBtYWluID0gX3JlZi5tYWluLFxuICAgICAgICB0cmFuc2Zvcm0gPSBfcmVmLnRyYW5zZm9ybSxcbiAgICAgICAgc3R5bGVzID0gX3JlZi5zdHlsZXM7XG4gICAgdmFyIHN0eWxlU3RyaW5nID0gam9pblN0eWxlcyhzdHlsZXMpO1xuXG4gICAgaWYgKHN0eWxlU3RyaW5nLmxlbmd0aCA+IDApIHtcbiAgICAgIGF0dHJpYnV0ZXNbJ3N0eWxlJ10gPSBzdHlsZVN0cmluZztcbiAgICB9XG5cbiAgICBpZiAodHJhbnNmb3JtSXNNZWFuaW5nZnVsKHRyYW5zZm9ybSkpIHtcbiAgICAgIHZhciB0cmFucyA9IHRyYW5zZm9ybUZvclN2Zyh7XG4gICAgICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtLFxuICAgICAgICBjb250YWluZXJXaWR0aDogbWFpbi53aWR0aCxcbiAgICAgICAgaWNvbldpZHRoOiBtYWluLndpZHRoXG4gICAgICB9KTtcbiAgICAgIGNoaWxkcmVuLnB1c2goe1xuICAgICAgICB0YWc6ICdnJyxcbiAgICAgICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7fSwgdHJhbnMub3V0ZXIpLFxuICAgICAgICBjaGlsZHJlbjogW3tcbiAgICAgICAgICB0YWc6ICdnJyxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiBfb2JqZWN0U3ByZWFkKHt9LCB0cmFucy5pbm5lciksXG4gICAgICAgICAgY2hpbGRyZW46IFt7XG4gICAgICAgICAgICB0YWc6IG1haW4uaWNvbi50YWcsXG4gICAgICAgICAgICBjaGlsZHJlbjogbWFpbi5pY29uLmNoaWxkcmVuLFxuICAgICAgICAgICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7fSwgbWFpbi5pY29uLmF0dHJpYnV0ZXMsIHRyYW5zLnBhdGgpXG4gICAgICAgICAgfV1cbiAgICAgICAgfV1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjaGlsZHJlbi5wdXNoKG1haW4uaWNvbik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbixcbiAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXNcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gYXNJY29uIChfcmVmKSB7XG4gICAgdmFyIGNoaWxkcmVuID0gX3JlZi5jaGlsZHJlbixcbiAgICAgICAgbWFpbiA9IF9yZWYubWFpbixcbiAgICAgICAgbWFzayA9IF9yZWYubWFzayxcbiAgICAgICAgYXR0cmlidXRlcyA9IF9yZWYuYXR0cmlidXRlcyxcbiAgICAgICAgc3R5bGVzID0gX3JlZi5zdHlsZXMsXG4gICAgICAgIHRyYW5zZm9ybSA9IF9yZWYudHJhbnNmb3JtO1xuXG4gICAgaWYgKHRyYW5zZm9ybUlzTWVhbmluZ2Z1bCh0cmFuc2Zvcm0pICYmIG1haW4uZm91bmQgJiYgIW1hc2suZm91bmQpIHtcbiAgICAgIHZhciB3aWR0aCA9IG1haW4ud2lkdGgsXG4gICAgICAgICAgaGVpZ2h0ID0gbWFpbi5oZWlnaHQ7XG4gICAgICB2YXIgb2Zmc2V0ID0ge1xuICAgICAgICB4OiB3aWR0aCAvIGhlaWdodCAvIDIsXG4gICAgICAgIHk6IDAuNVxuICAgICAgfTtcbiAgICAgIGF0dHJpYnV0ZXNbJ3N0eWxlJ10gPSBqb2luU3R5bGVzKF9vYmplY3RTcHJlYWQoe30sIHN0eWxlcywge1xuICAgICAgICAndHJhbnNmb3JtLW9yaWdpbic6IFwiXCIuY29uY2F0KG9mZnNldC54ICsgdHJhbnNmb3JtLnggLyAxNiwgXCJlbSBcIikuY29uY2F0KG9mZnNldC55ICsgdHJhbnNmb3JtLnkgLyAxNiwgXCJlbVwiKVxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIHJldHVybiBbe1xuICAgICAgdGFnOiAnc3ZnJyxcbiAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXMsXG4gICAgICBjaGlsZHJlbjogY2hpbGRyZW5cbiAgICB9XTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFzU3ltYm9sIChfcmVmKSB7XG4gICAgdmFyIHByZWZpeCA9IF9yZWYucHJlZml4LFxuICAgICAgICBpY29uTmFtZSA9IF9yZWYuaWNvbk5hbWUsXG4gICAgICAgIGNoaWxkcmVuID0gX3JlZi5jaGlsZHJlbixcbiAgICAgICAgYXR0cmlidXRlcyA9IF9yZWYuYXR0cmlidXRlcyxcbiAgICAgICAgc3ltYm9sID0gX3JlZi5zeW1ib2w7XG4gICAgdmFyIGlkID0gc3ltYm9sID09PSB0cnVlID8gXCJcIi5jb25jYXQocHJlZml4LCBcIi1cIikuY29uY2F0KGNvbmZpZy5mYW1pbHlQcmVmaXgsIFwiLVwiKS5jb25jYXQoaWNvbk5hbWUpIDogc3ltYm9sO1xuICAgIHJldHVybiBbe1xuICAgICAgdGFnOiAnc3ZnJyxcbiAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgc3R5bGU6ICdkaXNwbGF5OiBub25lOydcbiAgICAgIH0sXG4gICAgICBjaGlsZHJlbjogW3tcbiAgICAgICAgdGFnOiAnc3ltYm9sJyxcbiAgICAgICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7fSwgYXR0cmlidXRlcywge1xuICAgICAgICAgIGlkOiBpZFxuICAgICAgICB9KSxcbiAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuXG4gICAgICB9XVxuICAgIH1dO1xuICB9XG5cbiAgZnVuY3Rpb24gbWFrZUlubGluZVN2Z0Fic3RyYWN0KHBhcmFtcykge1xuICAgIHZhciBfcGFyYW1zJGljb25zID0gcGFyYW1zLmljb25zLFxuICAgICAgICBtYWluID0gX3BhcmFtcyRpY29ucy5tYWluLFxuICAgICAgICBtYXNrID0gX3BhcmFtcyRpY29ucy5tYXNrLFxuICAgICAgICBwcmVmaXggPSBwYXJhbXMucHJlZml4LFxuICAgICAgICBpY29uTmFtZSA9IHBhcmFtcy5pY29uTmFtZSxcbiAgICAgICAgdHJhbnNmb3JtID0gcGFyYW1zLnRyYW5zZm9ybSxcbiAgICAgICAgc3ltYm9sID0gcGFyYW1zLnN5bWJvbCxcbiAgICAgICAgdGl0bGUgPSBwYXJhbXMudGl0bGUsXG4gICAgICAgIGV4dHJhID0gcGFyYW1zLmV4dHJhLFxuICAgICAgICBfcGFyYW1zJHdhdGNoYWJsZSA9IHBhcmFtcy53YXRjaGFibGUsXG4gICAgICAgIHdhdGNoYWJsZSA9IF9wYXJhbXMkd2F0Y2hhYmxlID09PSB2b2lkIDAgPyBmYWxzZSA6IF9wYXJhbXMkd2F0Y2hhYmxlO1xuXG4gICAgdmFyIF9yZWYgPSBtYXNrLmZvdW5kID8gbWFzayA6IG1haW4sXG4gICAgICAgIHdpZHRoID0gX3JlZi53aWR0aCxcbiAgICAgICAgaGVpZ2h0ID0gX3JlZi5oZWlnaHQ7XG5cbiAgICB2YXIgd2lkdGhDbGFzcyA9IFwiZmEtdy1cIi5jb25jYXQoTWF0aC5jZWlsKHdpZHRoIC8gaGVpZ2h0ICogMTYpKTtcbiAgICB2YXIgYXR0ckNsYXNzID0gW2NvbmZpZy5yZXBsYWNlbWVudENsYXNzLCBpY29uTmFtZSA/IFwiXCIuY29uY2F0KGNvbmZpZy5mYW1pbHlQcmVmaXgsIFwiLVwiKS5jb25jYXQoaWNvbk5hbWUpIDogJycsIHdpZHRoQ2xhc3NdLmZpbHRlcihmdW5jdGlvbiAoYykge1xuICAgICAgcmV0dXJuIGV4dHJhLmNsYXNzZXMuaW5kZXhPZihjKSA9PT0gLTE7XG4gICAgfSkuY29uY2F0KGV4dHJhLmNsYXNzZXMpLmpvaW4oJyAnKTtcbiAgICB2YXIgY29udGVudCA9IHtcbiAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICAgIGF0dHJpYnV0ZXM6IF9vYmplY3RTcHJlYWQoe30sIGV4dHJhLmF0dHJpYnV0ZXMsIHtcbiAgICAgICAgJ2RhdGEtcHJlZml4JzogcHJlZml4LFxuICAgICAgICAnZGF0YS1pY29uJzogaWNvbk5hbWUsXG4gICAgICAgICdjbGFzcyc6IGF0dHJDbGFzcyxcbiAgICAgICAgJ3JvbGUnOiAnaW1nJyxcbiAgICAgICAgJ3htbG5zJzogJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcbiAgICAgICAgJ3ZpZXdCb3gnOiBcIjAgMCBcIi5jb25jYXQod2lkdGgsIFwiIFwiKS5jb25jYXQoaGVpZ2h0KVxuICAgICAgfSlcbiAgICB9O1xuXG4gICAgaWYgKHdhdGNoYWJsZSkge1xuICAgICAgY29udGVudC5hdHRyaWJ1dGVzW0RBVEFfRkFfSTJTVkddID0gJyc7XG4gICAgfVxuXG4gICAgaWYgKHRpdGxlKSBjb250ZW50LmNoaWxkcmVuLnB1c2goe1xuICAgICAgdGFnOiAndGl0bGUnLFxuICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICBpZDogY29udGVudC5hdHRyaWJ1dGVzWydhcmlhLWxhYmVsbGVkYnknXSB8fCBcInRpdGxlLVwiLmNvbmNhdChuZXh0VW5pcXVlSWQoKSlcbiAgICAgIH0sXG4gICAgICBjaGlsZHJlbjogW3RpdGxlXVxuICAgIH0pO1xuXG4gICAgdmFyIGFyZ3MgPSBfb2JqZWN0U3ByZWFkKHt9LCBjb250ZW50LCB7XG4gICAgICBwcmVmaXg6IHByZWZpeCxcbiAgICAgIGljb25OYW1lOiBpY29uTmFtZSxcbiAgICAgIG1haW46IG1haW4sXG4gICAgICBtYXNrOiBtYXNrLFxuICAgICAgdHJhbnNmb3JtOiB0cmFuc2Zvcm0sXG4gICAgICBzeW1ib2w6IHN5bWJvbCxcbiAgICAgIHN0eWxlczogZXh0cmEuc3R5bGVzXG4gICAgfSk7XG5cbiAgICB2YXIgX3JlZjIgPSBtYXNrLmZvdW5kICYmIG1haW4uZm91bmQgPyBtYWtlSWNvbk1hc2tpbmcoYXJncykgOiBtYWtlSWNvblN0YW5kYXJkKGFyZ3MpLFxuICAgICAgICBjaGlsZHJlbiA9IF9yZWYyLmNoaWxkcmVuLFxuICAgICAgICBhdHRyaWJ1dGVzID0gX3JlZjIuYXR0cmlidXRlcztcblxuICAgIGFyZ3MuY2hpbGRyZW4gPSBjaGlsZHJlbjtcbiAgICBhcmdzLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzO1xuXG4gICAgaWYgKHN5bWJvbCkge1xuICAgICAgcmV0dXJuIGFzU3ltYm9sKGFyZ3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYXNJY29uKGFyZ3MpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBtYWtlTGF5ZXJzVGV4dEFic3RyYWN0KHBhcmFtcykge1xuICAgIHZhciBjb250ZW50ID0gcGFyYW1zLmNvbnRlbnQsXG4gICAgICAgIHdpZHRoID0gcGFyYW1zLndpZHRoLFxuICAgICAgICBoZWlnaHQgPSBwYXJhbXMuaGVpZ2h0LFxuICAgICAgICB0cmFuc2Zvcm0gPSBwYXJhbXMudHJhbnNmb3JtLFxuICAgICAgICB0aXRsZSA9IHBhcmFtcy50aXRsZSxcbiAgICAgICAgZXh0cmEgPSBwYXJhbXMuZXh0cmEsXG4gICAgICAgIF9wYXJhbXMkd2F0Y2hhYmxlMiA9IHBhcmFtcy53YXRjaGFibGUsXG4gICAgICAgIHdhdGNoYWJsZSA9IF9wYXJhbXMkd2F0Y2hhYmxlMiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcGFyYW1zJHdhdGNoYWJsZTI7XG5cbiAgICB2YXIgYXR0cmlidXRlcyA9IF9vYmplY3RTcHJlYWQoe30sIGV4dHJhLmF0dHJpYnV0ZXMsIHRpdGxlID8ge1xuICAgICAgJ3RpdGxlJzogdGl0bGVcbiAgICB9IDoge30sIHtcbiAgICAgICdjbGFzcyc6IGV4dHJhLmNsYXNzZXMuam9pbignICcpXG4gICAgfSk7XG5cbiAgICBpZiAod2F0Y2hhYmxlKSB7XG4gICAgICBhdHRyaWJ1dGVzW0RBVEFfRkFfSTJTVkddID0gJyc7XG4gICAgfVxuXG4gICAgdmFyIHN0eWxlcyA9IF9vYmplY3RTcHJlYWQoe30sIGV4dHJhLnN0eWxlcyk7XG5cbiAgICBpZiAodHJhbnNmb3JtSXNNZWFuaW5nZnVsKHRyYW5zZm9ybSkpIHtcbiAgICAgIHN0eWxlc1sndHJhbnNmb3JtJ10gPSB0cmFuc2Zvcm1Gb3JDc3Moe1xuICAgICAgICB0cmFuc2Zvcm06IHRyYW5zZm9ybSxcbiAgICAgICAgc3RhcnRDZW50ZXJlZDogdHJ1ZSxcbiAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICBoZWlnaHQ6IGhlaWdodFxuICAgICAgfSk7XG4gICAgICBzdHlsZXNbJy13ZWJraXQtdHJhbnNmb3JtJ10gPSBzdHlsZXNbJ3RyYW5zZm9ybSddO1xuICAgIH1cblxuICAgIHZhciBzdHlsZVN0cmluZyA9IGpvaW5TdHlsZXMoc3R5bGVzKTtcblxuICAgIGlmIChzdHlsZVN0cmluZy5sZW5ndGggPiAwKSB7XG4gICAgICBhdHRyaWJ1dGVzWydzdHlsZSddID0gc3R5bGVTdHJpbmc7XG4gICAgfVxuXG4gICAgdmFyIHZhbCA9IFtdO1xuICAgIHZhbC5wdXNoKHtcbiAgICAgIHRhZzogJ3NwYW4nLFxuICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlcyxcbiAgICAgIGNoaWxkcmVuOiBbY29udGVudF1cbiAgICB9KTtcblxuICAgIGlmICh0aXRsZSkge1xuICAgICAgdmFsLnB1c2goe1xuICAgICAgICB0YWc6ICdzcGFuJyxcbiAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgIGNsYXNzOiAnc3Itb25seSdcbiAgICAgICAgfSxcbiAgICAgICAgY2hpbGRyZW46IFt0aXRsZV1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB2YWw7XG4gIH1cbiAgZnVuY3Rpb24gbWFrZUxheWVyc0NvdW50ZXJBYnN0cmFjdChwYXJhbXMpIHtcbiAgICB2YXIgY29udGVudCA9IHBhcmFtcy5jb250ZW50LFxuICAgICAgICB0aXRsZSA9IHBhcmFtcy50aXRsZSxcbiAgICAgICAgZXh0cmEgPSBwYXJhbXMuZXh0cmE7XG5cbiAgICB2YXIgYXR0cmlidXRlcyA9IF9vYmplY3RTcHJlYWQoe30sIGV4dHJhLmF0dHJpYnV0ZXMsIHRpdGxlID8ge1xuICAgICAgJ3RpdGxlJzogdGl0bGVcbiAgICB9IDoge30sIHtcbiAgICAgICdjbGFzcyc6IGV4dHJhLmNsYXNzZXMuam9pbignICcpXG4gICAgfSk7XG5cbiAgICB2YXIgc3R5bGVTdHJpbmcgPSBqb2luU3R5bGVzKGV4dHJhLnN0eWxlcyk7XG5cbiAgICBpZiAoc3R5bGVTdHJpbmcubGVuZ3RoID4gMCkge1xuICAgICAgYXR0cmlidXRlc1snc3R5bGUnXSA9IHN0eWxlU3RyaW5nO1xuICAgIH1cblxuICAgIHZhciB2YWwgPSBbXTtcbiAgICB2YWwucHVzaCh7XG4gICAgICB0YWc6ICdzcGFuJyxcbiAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXMsXG4gICAgICBjaGlsZHJlbjogW2NvbnRlbnRdXG4gICAgfSk7XG5cbiAgICBpZiAodGl0bGUpIHtcbiAgICAgIHZhbC5wdXNoKHtcbiAgICAgICAgdGFnOiAnc3BhbicsXG4gICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICBjbGFzczogJ3NyLW9ubHknXG4gICAgICAgIH0sXG4gICAgICAgIGNoaWxkcmVuOiBbdGl0bGVdXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsO1xuICB9XG5cbiAgdmFyIG5vb3AkMSA9IGZ1bmN0aW9uIG5vb3AoKSB7fTtcblxuICB2YXIgcCA9IGNvbmZpZy5tZWFzdXJlUGVyZm9ybWFuY2UgJiYgUEVSRk9STUFOQ0UgJiYgUEVSRk9STUFOQ0UubWFyayAmJiBQRVJGT1JNQU5DRS5tZWFzdXJlID8gUEVSRk9STUFOQ0UgOiB7XG4gICAgbWFyazogbm9vcCQxLFxuICAgIG1lYXN1cmU6IG5vb3AkMVxuICB9O1xuICB2YXIgcHJlYW1ibGUgPSBcIkZBIFxcXCI1LjYuMVxcXCJcIjtcblxuICB2YXIgYmVnaW4gPSBmdW5jdGlvbiBiZWdpbihuYW1lKSB7XG4gICAgcC5tYXJrKFwiXCIuY29uY2F0KHByZWFtYmxlLCBcIiBcIikuY29uY2F0KG5hbWUsIFwiIGJlZ2luc1wiKSk7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBlbmQobmFtZSk7XG4gICAgfTtcbiAgfTtcblxuICB2YXIgZW5kID0gZnVuY3Rpb24gZW5kKG5hbWUpIHtcbiAgICBwLm1hcmsoXCJcIi5jb25jYXQocHJlYW1ibGUsIFwiIFwiKS5jb25jYXQobmFtZSwgXCIgZW5kc1wiKSk7XG4gICAgcC5tZWFzdXJlKFwiXCIuY29uY2F0KHByZWFtYmxlLCBcIiBcIikuY29uY2F0KG5hbWUpLCBcIlwiLmNvbmNhdChwcmVhbWJsZSwgXCIgXCIpLmNvbmNhdChuYW1lLCBcIiBiZWdpbnNcIiksIFwiXCIuY29uY2F0KHByZWFtYmxlLCBcIiBcIikuY29uY2F0KG5hbWUsIFwiIGVuZHNcIikpO1xuICB9O1xuXG4gIHZhciBwZXJmID0ge1xuICAgIGJlZ2luOiBiZWdpbixcbiAgICBlbmQ6IGVuZFxuICB9O1xuXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBoZWxwZXIgdG8gYmluZCBhIGZ1bmN0aW9uIGtub3duIHRvIGhhdmUgNCBhcmd1bWVudHNcbiAgICogdG8gYSBnaXZlbiBjb250ZXh0LlxuICAgKi9cblxuICB2YXIgYmluZEludGVybmFsNCA9IGZ1bmN0aW9uIGJpbmRJbnRlcm5hbDQoZnVuYywgdGhpc0NvbnRleHQpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHtcbiAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0NvbnRleHQsIGEsIGIsIGMsIGQpO1xuICAgIH07XG4gIH07XG5cbiAgLyoqXG4gICAqICMgUmVkdWNlXG4gICAqXG4gICAqIEEgZmFzdCBvYmplY3QgYC5yZWR1Y2UoKWAgaW1wbGVtZW50YXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSAge09iamVjdH0gICBzdWJqZWN0ICAgICAgVGhlIG9iamVjdCB0byByZWR1Y2Ugb3Zlci5cbiAgICogQHBhcmFtICB7RnVuY3Rpb259IGZuICAgICAgICAgICBUaGUgcmVkdWNlciBmdW5jdGlvbi5cbiAgICogQHBhcmFtICB7bWl4ZWR9ICAgIGluaXRpYWxWYWx1ZSBUaGUgaW5pdGlhbCB2YWx1ZSBmb3IgdGhlIHJlZHVjZXIsIGRlZmF1bHRzIHRvIHN1YmplY3RbMF0uXG4gICAqIEBwYXJhbSAge09iamVjdH0gICB0aGlzQ29udGV4dCAgVGhlIGNvbnRleHQgZm9yIHRoZSByZWR1Y2VyLlxuICAgKiBAcmV0dXJuIHttaXhlZH0gICAgICAgICAgICAgICAgIFRoZSBmaW5hbCByZXN1bHQuXG4gICAqL1xuXG5cbiAgdmFyIHJlZHVjZSA9IGZ1bmN0aW9uIGZhc3RSZWR1Y2VPYmplY3Qoc3ViamVjdCwgZm4sIGluaXRpYWxWYWx1ZSwgdGhpc0NvbnRleHQpIHtcbiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHN1YmplY3QpLFxuICAgICAgICBsZW5ndGggPSBrZXlzLmxlbmd0aCxcbiAgICAgICAgaXRlcmF0b3IgPSB0aGlzQ29udGV4dCAhPT0gdW5kZWZpbmVkID8gYmluZEludGVybmFsNChmbiwgdGhpc0NvbnRleHQpIDogZm4sXG4gICAgICAgIGksXG4gICAgICAgIGtleSxcbiAgICAgICAgcmVzdWx0O1xuXG4gICAgaWYgKGluaXRpYWxWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpID0gMTtcbiAgICAgIHJlc3VsdCA9IHN1YmplY3Rba2V5c1swXV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGkgPSAwO1xuICAgICAgcmVzdWx0ID0gaW5pdGlhbFZhbHVlO1xuICAgIH1cblxuICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGtleSA9IGtleXNbaV07XG4gICAgICByZXN1bHQgPSBpdGVyYXRvcihyZXN1bHQsIHN1YmplY3Rba2V5XSwga2V5LCBzdWJqZWN0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIHZhciBzdHlsZXMgPSBuYW1lc3BhY2Uuc3R5bGVzLFxuICAgICAgc2hpbXMgPSBuYW1lc3BhY2Uuc2hpbXM7XG4gIHZhciBfYnlVbmljb2RlID0ge307XG4gIHZhciBfYnlMaWdhdHVyZSA9IHt9O1xuICB2YXIgX2J5T2xkTmFtZSA9IHt9O1xuICB2YXIgYnVpbGQgPSBmdW5jdGlvbiBidWlsZCgpIHtcbiAgICB2YXIgbG9va3VwID0gZnVuY3Rpb24gbG9va3VwKHJlZHVjZXIpIHtcbiAgICAgIHJldHVybiByZWR1Y2Uoc3R5bGVzLCBmdW5jdGlvbiAobywgc3R5bGUsIHByZWZpeCkge1xuICAgICAgICBvW3ByZWZpeF0gPSByZWR1Y2Uoc3R5bGUsIHJlZHVjZXIsIHt9KTtcbiAgICAgICAgcmV0dXJuIG87XG4gICAgICB9LCB7fSk7XG4gICAgfTtcblxuICAgIF9ieVVuaWNvZGUgPSBsb29rdXAoZnVuY3Rpb24gKGFjYywgaWNvbiwgaWNvbk5hbWUpIHtcbiAgICAgIGFjY1tpY29uWzNdXSA9IGljb25OYW1lO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9KTtcbiAgICBfYnlMaWdhdHVyZSA9IGxvb2t1cChmdW5jdGlvbiAoYWNjLCBpY29uLCBpY29uTmFtZSkge1xuICAgICAgdmFyIGxpZ2F0dXJlcyA9IGljb25bMl07XG4gICAgICBhY2NbaWNvbk5hbWVdID0gaWNvbk5hbWU7XG4gICAgICBsaWdhdHVyZXMuZm9yRWFjaChmdW5jdGlvbiAobGlnYXR1cmUpIHtcbiAgICAgICAgYWNjW2xpZ2F0dXJlXSA9IGljb25OYW1lO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0pO1xuICAgIHZhciBoYXNSZWd1bGFyID0gJ2ZhcicgaW4gc3R5bGVzO1xuICAgIF9ieU9sZE5hbWUgPSByZWR1Y2Uoc2hpbXMsIGZ1bmN0aW9uIChhY2MsIHNoaW0pIHtcbiAgICAgIHZhciBvbGROYW1lID0gc2hpbVswXTtcbiAgICAgIHZhciBwcmVmaXggPSBzaGltWzFdO1xuICAgICAgdmFyIGljb25OYW1lID0gc2hpbVsyXTtcblxuICAgICAgaWYgKHByZWZpeCA9PT0gJ2ZhcicgJiYgIWhhc1JlZ3VsYXIpIHtcbiAgICAgICAgcHJlZml4ID0gJ2Zhcyc7XG4gICAgICB9XG5cbiAgICAgIGFjY1tvbGROYW1lXSA9IHtcbiAgICAgICAgcHJlZml4OiBwcmVmaXgsXG4gICAgICAgIGljb25OYW1lOiBpY29uTmFtZVxuICAgICAgfTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuICB9O1xuICBidWlsZCgpO1xuICBmdW5jdGlvbiBieVVuaWNvZGUocHJlZml4LCB1bmljb2RlKSB7XG4gICAgcmV0dXJuIF9ieVVuaWNvZGVbcHJlZml4XVt1bmljb2RlXTtcbiAgfVxuICBmdW5jdGlvbiBieUxpZ2F0dXJlKHByZWZpeCwgbGlnYXR1cmUpIHtcbiAgICByZXR1cm4gX2J5TGlnYXR1cmVbcHJlZml4XVtsaWdhdHVyZV07XG4gIH1cbiAgZnVuY3Rpb24gYnlPbGROYW1lKG5hbWUpIHtcbiAgICByZXR1cm4gX2J5T2xkTmFtZVtuYW1lXSB8fCB7XG4gICAgICBwcmVmaXg6IG51bGwsXG4gICAgICBpY29uTmFtZTogbnVsbFxuICAgIH07XG4gIH1cblxuICB2YXIgc3R5bGVzJDEgPSBuYW1lc3BhY2Uuc3R5bGVzO1xuICB2YXIgZW1wdHlDYW5vbmljYWxJY29uID0gZnVuY3Rpb24gZW1wdHlDYW5vbmljYWxJY29uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBwcmVmaXg6IG51bGwsXG4gICAgICBpY29uTmFtZTogbnVsbCxcbiAgICAgIHJlc3Q6IFtdXG4gICAgfTtcbiAgfTtcbiAgZnVuY3Rpb24gZ2V0Q2Fub25pY2FsSWNvbih2YWx1ZXMpIHtcbiAgICByZXR1cm4gdmFsdWVzLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBjbHMpIHtcbiAgICAgIHZhciBpY29uTmFtZSA9IGdldEljb25OYW1lKGNvbmZpZy5mYW1pbHlQcmVmaXgsIGNscyk7XG5cbiAgICAgIGlmIChzdHlsZXMkMVtjbHNdKSB7XG4gICAgICAgIGFjYy5wcmVmaXggPSBjbHM7XG4gICAgICB9IGVsc2UgaWYgKGljb25OYW1lKSB7XG4gICAgICAgIHZhciBzaGltID0gYWNjLnByZWZpeCA9PT0gJ2ZhJyA/IGJ5T2xkTmFtZShpY29uTmFtZSkgOiB7fTtcbiAgICAgICAgYWNjLmljb25OYW1lID0gc2hpbS5pY29uTmFtZSB8fCBpY29uTmFtZTtcbiAgICAgICAgYWNjLnByZWZpeCA9IHNoaW0ucHJlZml4IHx8IGFjYy5wcmVmaXg7XG4gICAgICB9IGVsc2UgaWYgKGNscyAhPT0gY29uZmlnLnJlcGxhY2VtZW50Q2xhc3MgJiYgY2xzLmluZGV4T2YoJ2ZhLXctJykgIT09IDApIHtcbiAgICAgICAgYWNjLnJlc3QucHVzaChjbHMpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIGVtcHR5Q2Fub25pY2FsSWNvbigpKTtcbiAgfVxuICBmdW5jdGlvbiBpY29uRnJvbU1hcHBpbmcobWFwcGluZywgcHJlZml4LCBpY29uTmFtZSkge1xuICAgIGlmIChtYXBwaW5nICYmIG1hcHBpbmdbcHJlZml4XSAmJiBtYXBwaW5nW3ByZWZpeF1baWNvbk5hbWVdKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcmVmaXg6IHByZWZpeCxcbiAgICAgICAgaWNvbk5hbWU6IGljb25OYW1lLFxuICAgICAgICBpY29uOiBtYXBwaW5nW3ByZWZpeF1baWNvbk5hbWVdXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHRvSHRtbChhYnN0cmFjdE5vZGVzKSB7XG4gICAgdmFyIHRhZyA9IGFic3RyYWN0Tm9kZXMudGFnLFxuICAgICAgICBfYWJzdHJhY3ROb2RlcyRhdHRyaWIgPSBhYnN0cmFjdE5vZGVzLmF0dHJpYnV0ZXMsXG4gICAgICAgIGF0dHJpYnV0ZXMgPSBfYWJzdHJhY3ROb2RlcyRhdHRyaWIgPT09IHZvaWQgMCA/IHt9IDogX2Fic3RyYWN0Tm9kZXMkYXR0cmliLFxuICAgICAgICBfYWJzdHJhY3ROb2RlcyRjaGlsZHIgPSBhYnN0cmFjdE5vZGVzLmNoaWxkcmVuLFxuICAgICAgICBjaGlsZHJlbiA9IF9hYnN0cmFjdE5vZGVzJGNoaWxkciA9PT0gdm9pZCAwID8gW10gOiBfYWJzdHJhY3ROb2RlcyRjaGlsZHI7XG5cbiAgICBpZiAodHlwZW9mIGFic3RyYWN0Tm9kZXMgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gaHRtbEVzY2FwZShhYnN0cmFjdE5vZGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwiPFwiLmNvbmNhdCh0YWcsIFwiIFwiKS5jb25jYXQoam9pbkF0dHJpYnV0ZXMoYXR0cmlidXRlcyksIFwiPlwiKS5jb25jYXQoY2hpbGRyZW4ubWFwKHRvSHRtbCkuam9pbignJyksIFwiPC9cIikuY29uY2F0KHRhZywgXCI+XCIpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBub29wJDIgPSBmdW5jdGlvbiBub29wKCkge307XG5cbiAgZnVuY3Rpb24gaXNXYXRjaGVkKG5vZGUpIHtcbiAgICB2YXIgaTJzdmcgPSBub2RlLmdldEF0dHJpYnV0ZSA/IG5vZGUuZ2V0QXR0cmlidXRlKERBVEFfRkFfSTJTVkcpIDogbnVsbDtcbiAgICByZXR1cm4gdHlwZW9mIGkyc3ZnID09PSAnc3RyaW5nJztcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE11dGF0b3IoKSB7XG4gICAgaWYgKGNvbmZpZy5hdXRvUmVwbGFjZVN2ZyA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIG11dGF0b3JzLnJlcGxhY2U7XG4gICAgfVxuXG4gICAgdmFyIG11dGF0b3IgPSBtdXRhdG9yc1tjb25maWcuYXV0b1JlcGxhY2VTdmddO1xuICAgIHJldHVybiBtdXRhdG9yIHx8IG11dGF0b3JzLnJlcGxhY2U7XG4gIH1cblxuICB2YXIgbXV0YXRvcnMgPSB7XG4gICAgcmVwbGFjZTogZnVuY3Rpb24gcmVwbGFjZShtdXRhdGlvbikge1xuICAgICAgdmFyIG5vZGUgPSBtdXRhdGlvblswXTtcbiAgICAgIHZhciBhYnN0cmFjdCA9IG11dGF0aW9uWzFdO1xuICAgICAgdmFyIG5ld091dGVySFRNTCA9IGFic3RyYWN0Lm1hcChmdW5jdGlvbiAoYSkge1xuICAgICAgICByZXR1cm4gdG9IdG1sKGEpO1xuICAgICAgfSkuam9pbignXFxuJyk7XG5cbiAgICAgIGlmIChub2RlLnBhcmVudE5vZGUgJiYgbm9kZS5vdXRlckhUTUwpIHtcbiAgICAgICAgbm9kZS5vdXRlckhUTUwgPSBuZXdPdXRlckhUTUwgKyAoY29uZmlnLmtlZXBPcmlnaW5hbFNvdXJjZSAmJiBub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKSAhPT0gJ3N2ZycgPyBcIjwhLS0gXCIuY29uY2F0KG5vZGUub3V0ZXJIVE1MLCBcIiAtLT5cIikgOiAnJyk7XG4gICAgICB9IGVsc2UgaWYgKG5vZGUucGFyZW50Tm9kZSkge1xuICAgICAgICB2YXIgbmV3Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChuZXdOb2RlLCBub2RlKTtcbiAgICAgICAgbmV3Tm9kZS5vdXRlckhUTUwgPSBuZXdPdXRlckhUTUw7XG4gICAgICB9XG4gICAgfSxcbiAgICBuZXN0OiBmdW5jdGlvbiBuZXN0KG11dGF0aW9uKSB7XG4gICAgICB2YXIgbm9kZSA9IG11dGF0aW9uWzBdO1xuICAgICAgdmFyIGFic3RyYWN0ID0gbXV0YXRpb25bMV07IC8vIElmIHdlIGFscmVhZHkgaGF2ZSBhIHJlcGxhY2VkIG5vZGUgd2UgZG8gbm90IHdhbnQgdG8gY29udGludWUgbmVzdGluZyB3aXRoaW4gaXQuXG4gICAgICAvLyBTaG9ydC1jaXJjdWl0IHRvIHRoZSBzdGFuZGFyZCByZXBsYWNlbWVudFxuXG4gICAgICBpZiAofmNsYXNzQXJyYXkobm9kZSkuaW5kZXhPZihjb25maWcucmVwbGFjZW1lbnRDbGFzcykpIHtcbiAgICAgICAgcmV0dXJuIG11dGF0b3JzLnJlcGxhY2UobXV0YXRpb24pO1xuICAgICAgfVxuXG4gICAgICB2YXIgZm9yU3ZnID0gbmV3IFJlZ0V4cChcIlwiLmNvbmNhdChjb25maWcuZmFtaWx5UHJlZml4LCBcIi0uKlwiKSk7XG4gICAgICBkZWxldGUgYWJzdHJhY3RbMF0uYXR0cmlidXRlcy5zdHlsZTtcbiAgICAgIHZhciBzcGxpdENsYXNzZXMgPSBhYnN0cmFjdFswXS5hdHRyaWJ1dGVzLmNsYXNzLnNwbGl0KCcgJykucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGNscykge1xuICAgICAgICBpZiAoY2xzID09PSBjb25maWcucmVwbGFjZW1lbnRDbGFzcyB8fCBjbHMubWF0Y2goZm9yU3ZnKSkge1xuICAgICAgICAgIGFjYy50b1N2Zy5wdXNoKGNscyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWNjLnRvTm9kZS5wdXNoKGNscyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfSwge1xuICAgICAgICB0b05vZGU6IFtdLFxuICAgICAgICB0b1N2ZzogW11cbiAgICAgIH0pO1xuICAgICAgYWJzdHJhY3RbMF0uYXR0cmlidXRlcy5jbGFzcyA9IHNwbGl0Q2xhc3Nlcy50b1N2Zy5qb2luKCcgJyk7XG4gICAgICB2YXIgbmV3SW5uZXJIVE1MID0gYWJzdHJhY3QubWFwKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIHJldHVybiB0b0h0bWwoYSk7XG4gICAgICB9KS5qb2luKCdcXG4nKTtcbiAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCdjbGFzcycsIHNwbGl0Q2xhc3Nlcy50b05vZGUuam9pbignICcpKTtcbiAgICAgIG5vZGUuc2V0QXR0cmlidXRlKERBVEFfRkFfSTJTVkcsICcnKTtcbiAgICAgIG5vZGUuaW5uZXJIVE1MID0gbmV3SW5uZXJIVE1MO1xuICAgIH1cbiAgfTtcbiAgZnVuY3Rpb24gcGVyZm9ybShtdXRhdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGNhbGxiYWNrRnVuY3Rpb24gPSB0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicgPyBjYWxsYmFjayA6IG5vb3AkMjtcblxuICAgIGlmIChtdXRhdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjYWxsYmFja0Z1bmN0aW9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBmcmFtZSA9IFdJTkRPVy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgZnVuY3Rpb24gKG9wKSB7XG4gICAgICAgIHJldHVybiBvcCgpO1xuICAgICAgfTtcblxuICAgICAgZnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbXV0YXRvciA9IGdldE11dGF0b3IoKTtcbiAgICAgICAgdmFyIG1hcmsgPSBwZXJmLmJlZ2luKCdtdXRhdGUnKTtcbiAgICAgICAgbXV0YXRpb25zLm1hcChtdXRhdG9yKTtcbiAgICAgICAgbWFyaygpO1xuICAgICAgICBjYWxsYmFja0Z1bmN0aW9uKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgdmFyIGRpc2FibGVkID0gZmFsc2U7XG4gIGZ1bmN0aW9uIGRpc2FibGVPYnNlcnZhdGlvbihvcGVyYXRpb24pIHtcbiAgICBkaXNhYmxlZCA9IHRydWU7XG4gICAgb3BlcmF0aW9uKCk7XG4gICAgZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuICB2YXIgbW8gPSBudWxsO1xuICBmdW5jdGlvbiBvYnNlcnZlKG9wdGlvbnMpIHtcbiAgICBpZiAoIU1VVEFUSU9OX09CU0VSVkVSKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFjb25maWcub2JzZXJ2ZU11dGF0aW9ucykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciB0cmVlQ2FsbGJhY2sgPSBvcHRpb25zLnRyZWVDYWxsYmFjayxcbiAgICAgICAgbm9kZUNhbGxiYWNrID0gb3B0aW9ucy5ub2RlQ2FsbGJhY2ssXG4gICAgICAgIHBzZXVkb0VsZW1lbnRzQ2FsbGJhY2sgPSBvcHRpb25zLnBzZXVkb0VsZW1lbnRzQ2FsbGJhY2ssXG4gICAgICAgIF9vcHRpb25zJG9ic2VydmVNdXRhdCA9IG9wdGlvbnMub2JzZXJ2ZU11dGF0aW9uc1Jvb3QsXG4gICAgICAgIG9ic2VydmVNdXRhdGlvbnNSb290ID0gX29wdGlvbnMkb2JzZXJ2ZU11dGF0ID09PSB2b2lkIDAgPyBET0NVTUVOVC5ib2R5IDogX29wdGlvbnMkb2JzZXJ2ZU11dGF0O1xuICAgIG1vID0gbmV3IE1VVEFUSU9OX09CU0VSVkVSKGZ1bmN0aW9uIChvYmplY3RzKSB7XG4gICAgICBpZiAoZGlzYWJsZWQpIHJldHVybjtcbiAgICAgIHRvQXJyYXkob2JqZWN0cykuZm9yRWFjaChmdW5jdGlvbiAobXV0YXRpb25SZWNvcmQpIHtcbiAgICAgICAgaWYgKG11dGF0aW9uUmVjb3JkLnR5cGUgPT09ICdjaGlsZExpc3QnICYmIG11dGF0aW9uUmVjb3JkLmFkZGVkTm9kZXMubGVuZ3RoID4gMCAmJiAhaXNXYXRjaGVkKG11dGF0aW9uUmVjb3JkLmFkZGVkTm9kZXNbMF0pKSB7XG4gICAgICAgICAgaWYgKGNvbmZpZy5zZWFyY2hQc2V1ZG9FbGVtZW50cykge1xuICAgICAgICAgICAgcHNldWRvRWxlbWVudHNDYWxsYmFjayhtdXRhdGlvblJlY29yZC50YXJnZXQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRyZWVDYWxsYmFjayhtdXRhdGlvblJlY29yZC50YXJnZXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG11dGF0aW9uUmVjb3JkLnR5cGUgPT09ICdhdHRyaWJ1dGVzJyAmJiBtdXRhdGlvblJlY29yZC50YXJnZXQucGFyZW50Tm9kZSAmJiBjb25maWcuc2VhcmNoUHNldWRvRWxlbWVudHMpIHtcbiAgICAgICAgICBwc2V1ZG9FbGVtZW50c0NhbGxiYWNrKG11dGF0aW9uUmVjb3JkLnRhcmdldC5wYXJlbnROb2RlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtdXRhdGlvblJlY29yZC50eXBlID09PSAnYXR0cmlidXRlcycgJiYgaXNXYXRjaGVkKG11dGF0aW9uUmVjb3JkLnRhcmdldCkgJiYgfkFUVFJJQlVURVNfV0FUQ0hFRF9GT1JfTVVUQVRJT04uaW5kZXhPZihtdXRhdGlvblJlY29yZC5hdHRyaWJ1dGVOYW1lKSkge1xuICAgICAgICAgIGlmIChtdXRhdGlvblJlY29yZC5hdHRyaWJ1dGVOYW1lID09PSAnY2xhc3MnKSB7XG4gICAgICAgICAgICB2YXIgX2dldENhbm9uaWNhbEljb24gPSBnZXRDYW5vbmljYWxJY29uKGNsYXNzQXJyYXkobXV0YXRpb25SZWNvcmQudGFyZ2V0KSksXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gX2dldENhbm9uaWNhbEljb24ucHJlZml4LFxuICAgICAgICAgICAgICAgIGljb25OYW1lID0gX2dldENhbm9uaWNhbEljb24uaWNvbk5hbWU7XG5cbiAgICAgICAgICAgIGlmIChwcmVmaXgpIG11dGF0aW9uUmVjb3JkLnRhcmdldC5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJlZml4JywgcHJlZml4KTtcbiAgICAgICAgICAgIGlmIChpY29uTmFtZSkgbXV0YXRpb25SZWNvcmQudGFyZ2V0LnNldEF0dHJpYnV0ZSgnZGF0YS1pY29uJywgaWNvbk5hbWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub2RlQ2FsbGJhY2sobXV0YXRpb25SZWNvcmQudGFyZ2V0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGlmICghSVNfRE9NKSByZXR1cm47XG4gICAgbW8ub2JzZXJ2ZShvYnNlcnZlTXV0YXRpb25zUm9vdCwge1xuICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgYXR0cmlidXRlczogdHJ1ZSxcbiAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUsXG4gICAgICBzdWJ0cmVlOiB0cnVlXG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gZGlzY29ubmVjdCgpIHtcbiAgICBpZiAoIW1vKSByZXR1cm47XG4gICAgbW8uZGlzY29ubmVjdCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3R5bGVQYXJzZXIgKG5vZGUpIHtcbiAgICB2YXIgc3R5bGUgPSBub2RlLmdldEF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgICB2YXIgdmFsID0gW107XG5cbiAgICBpZiAoc3R5bGUpIHtcbiAgICAgIHZhbCA9IHN0eWxlLnNwbGl0KCc7JykucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHN0eWxlKSB7XG4gICAgICAgIHZhciBzdHlsZXMgPSBzdHlsZS5zcGxpdCgnOicpO1xuICAgICAgICB2YXIgcHJvcCA9IHN0eWxlc1swXTtcbiAgICAgICAgdmFyIHZhbHVlID0gc3R5bGVzLnNsaWNlKDEpO1xuXG4gICAgICAgIGlmIChwcm9wICYmIHZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBhY2NbcHJvcF0gPSB2YWx1ZS5qb2luKCc6JykudHJpbSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH0sIHt9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsO1xuICB9XG5cbiAgZnVuY3Rpb24gdG9IZXgodW5pY29kZSkge1xuICAgIHZhciByZXN1bHQgPSAnJztcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdW5pY29kZS5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGhleCA9IHVuaWNvZGUuY2hhckNvZGVBdChpKS50b1N0cmluZygxNik7XG4gICAgICByZXN1bHQgKz0gKCcwMDAnICsgaGV4KS5zbGljZSgtNCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsYXNzUGFyc2VyIChub2RlKSB7XG4gICAgdmFyIGV4aXN0aW5nUHJlZml4ID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJlZml4Jyk7XG4gICAgdmFyIGV4aXN0aW5nSWNvbk5hbWUgPSBub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1pY29uJyk7XG4gICAgdmFyIGlubmVyVGV4dCA9IG5vZGUuaW5uZXJUZXh0ICE9PSB1bmRlZmluZWQgPyBub2RlLmlubmVyVGV4dC50cmltKCkgOiAnJztcbiAgICB2YXIgdmFsID0gZ2V0Q2Fub25pY2FsSWNvbihjbGFzc0FycmF5KG5vZGUpKTtcblxuICAgIGlmIChleGlzdGluZ1ByZWZpeCAmJiBleGlzdGluZ0ljb25OYW1lKSB7XG4gICAgICB2YWwucHJlZml4ID0gZXhpc3RpbmdQcmVmaXg7XG4gICAgICB2YWwuaWNvbk5hbWUgPSBleGlzdGluZ0ljb25OYW1lO1xuICAgIH1cblxuICAgIGlmICh2YWwucHJlZml4ICYmIGlubmVyVGV4dC5sZW5ndGggPiAxKSB7XG4gICAgICB2YWwuaWNvbk5hbWUgPSBieUxpZ2F0dXJlKHZhbC5wcmVmaXgsIG5vZGUuaW5uZXJUZXh0KTtcbiAgICB9IGVsc2UgaWYgKHZhbC5wcmVmaXggJiYgaW5uZXJUZXh0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgdmFsLmljb25OYW1lID0gYnlVbmljb2RlKHZhbC5wcmVmaXgsIHRvSGV4KG5vZGUuaW5uZXJUZXh0KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbDtcbiAgfVxuXG4gIHZhciBwYXJzZVRyYW5zZm9ybVN0cmluZyA9IGZ1bmN0aW9uIHBhcnNlVHJhbnNmb3JtU3RyaW5nKHRyYW5zZm9ybVN0cmluZykge1xuICAgIHZhciB0cmFuc2Zvcm0gPSB7XG4gICAgICBzaXplOiAxNixcbiAgICAgIHg6IDAsXG4gICAgICB5OiAwLFxuICAgICAgZmxpcFg6IGZhbHNlLFxuICAgICAgZmxpcFk6IGZhbHNlLFxuICAgICAgcm90YXRlOiAwXG4gICAgfTtcblxuICAgIGlmICghdHJhbnNmb3JtU3RyaW5nKSB7XG4gICAgICByZXR1cm4gdHJhbnNmb3JtO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdHJhbnNmb3JtU3RyaW5nLnRvTG93ZXJDYXNlKCkuc3BsaXQoJyAnKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgbikge1xuICAgICAgICB2YXIgcGFydHMgPSBuLnRvTG93ZXJDYXNlKCkuc3BsaXQoJy0nKTtcbiAgICAgICAgdmFyIGZpcnN0ID0gcGFydHNbMF07XG4gICAgICAgIHZhciByZXN0ID0gcGFydHMuc2xpY2UoMSkuam9pbignLScpO1xuXG4gICAgICAgIGlmIChmaXJzdCAmJiByZXN0ID09PSAnaCcpIHtcbiAgICAgICAgICBhY2MuZmxpcFggPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZmlyc3QgJiYgcmVzdCA9PT0gJ3YnKSB7XG4gICAgICAgICAgYWNjLmZsaXBZID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzdCA9IHBhcnNlRmxvYXQocmVzdCk7XG5cbiAgICAgICAgaWYgKGlzTmFOKHJlc3QpKSB7XG4gICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfVxuXG4gICAgICAgIHN3aXRjaCAoZmlyc3QpIHtcbiAgICAgICAgICBjYXNlICdncm93JzpcbiAgICAgICAgICAgIGFjYy5zaXplID0gYWNjLnNpemUgKyByZXN0O1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdzaHJpbmsnOlxuICAgICAgICAgICAgYWNjLnNpemUgPSBhY2Muc2l6ZSAtIHJlc3Q7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgYWNjLnggPSBhY2MueCAtIHJlc3Q7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgIGFjYy54ID0gYWNjLnggKyByZXN0O1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICd1cCc6XG4gICAgICAgICAgICBhY2MueSA9IGFjYy55IC0gcmVzdDtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAnZG93bic6XG4gICAgICAgICAgICBhY2MueSA9IGFjYy55ICsgcmVzdDtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAncm90YXRlJzpcbiAgICAgICAgICAgIGFjYy5yb3RhdGUgPSBhY2Mucm90YXRlICsgcmVzdDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH0sIHRyYW5zZm9ybSk7XG4gICAgfVxuICB9O1xuICBmdW5jdGlvbiB0cmFuc2Zvcm1QYXJzZXIgKG5vZGUpIHtcbiAgICByZXR1cm4gcGFyc2VUcmFuc2Zvcm1TdHJpbmcobm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZmEtdHJhbnNmb3JtJykpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3ltYm9sUGFyc2VyIChub2RlKSB7XG4gICAgdmFyIHN5bWJvbCA9IG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLWZhLXN5bWJvbCcpO1xuICAgIHJldHVybiBzeW1ib2wgPT09IG51bGwgPyBmYWxzZSA6IHN5bWJvbCA9PT0gJycgPyB0cnVlIDogc3ltYm9sO1xuICB9XG5cbiAgZnVuY3Rpb24gYXR0cmlidXRlc1BhcnNlciAobm9kZSkge1xuICAgIHZhciBleHRyYUF0dHJpYnV0ZXMgPSB0b0FycmF5KG5vZGUuYXR0cmlidXRlcykucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGF0dHIpIHtcbiAgICAgIGlmIChhY2MubmFtZSAhPT0gJ2NsYXNzJyAmJiBhY2MubmFtZSAhPT0gJ3N0eWxlJykge1xuICAgICAgICBhY2NbYXR0ci5uYW1lXSA9IGF0dHIudmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuICAgIHZhciB0aXRsZSA9IG5vZGUuZ2V0QXR0cmlidXRlKCd0aXRsZScpO1xuXG4gICAgaWYgKGNvbmZpZy5hdXRvQTExeSkge1xuICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgIGV4dHJhQXR0cmlidXRlc1snYXJpYS1sYWJlbGxlZGJ5J10gPSBcIlwiLmNvbmNhdChjb25maWcucmVwbGFjZW1lbnRDbGFzcywgXCItdGl0bGUtXCIpLmNvbmNhdChuZXh0VW5pcXVlSWQoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBleHRyYUF0dHJpYnV0ZXNbJ2FyaWEtaGlkZGVuJ10gPSAndHJ1ZSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGV4dHJhQXR0cmlidXRlcztcbiAgfVxuXG4gIGZ1bmN0aW9uIG1hc2tQYXJzZXIgKG5vZGUpIHtcbiAgICB2YXIgbWFzayA9IG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLWZhLW1hc2snKTtcblxuICAgIGlmICghbWFzaykge1xuICAgICAgcmV0dXJuIGVtcHR5Q2Fub25pY2FsSWNvbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZ2V0Q2Fub25pY2FsSWNvbihtYXNrLnNwbGl0KCcgJykubWFwKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIHJldHVybiBpLnRyaW0oKTtcbiAgICAgIH0pKTtcbiAgICB9XG4gIH1cblxuICB2YXIgYmxhbmtNZXRhID0ge1xuICAgIGljb25OYW1lOiBudWxsLFxuICAgIHRpdGxlOiBudWxsLFxuICAgIHByZWZpeDogbnVsbCxcbiAgICB0cmFuc2Zvcm06IG1lYW5pbmdsZXNzVHJhbnNmb3JtLFxuICAgIHN5bWJvbDogZmFsc2UsXG4gICAgbWFzazogbnVsbCxcbiAgICBleHRyYToge1xuICAgICAgY2xhc3NlczogW10sXG4gICAgICBzdHlsZXM6IHt9LFxuICAgICAgYXR0cmlidXRlczoge31cbiAgICB9XG4gIH07XG4gIGZ1bmN0aW9uIHBhcnNlTWV0YShub2RlKSB7XG4gICAgdmFyIF9jbGFzc1BhcnNlciA9IGNsYXNzUGFyc2VyKG5vZGUpLFxuICAgICAgICBpY29uTmFtZSA9IF9jbGFzc1BhcnNlci5pY29uTmFtZSxcbiAgICAgICAgcHJlZml4ID0gX2NsYXNzUGFyc2VyLnByZWZpeCxcbiAgICAgICAgZXh0cmFDbGFzc2VzID0gX2NsYXNzUGFyc2VyLnJlc3Q7XG5cbiAgICB2YXIgZXh0cmFTdHlsZXMgPSBzdHlsZVBhcnNlcihub2RlKTtcbiAgICB2YXIgdHJhbnNmb3JtID0gdHJhbnNmb3JtUGFyc2VyKG5vZGUpO1xuICAgIHZhciBzeW1ib2wgPSBzeW1ib2xQYXJzZXIobm9kZSk7XG4gICAgdmFyIGV4dHJhQXR0cmlidXRlcyA9IGF0dHJpYnV0ZXNQYXJzZXIobm9kZSk7XG4gICAgdmFyIG1hc2sgPSBtYXNrUGFyc2VyKG5vZGUpO1xuICAgIHJldHVybiB7XG4gICAgICBpY29uTmFtZTogaWNvbk5hbWUsXG4gICAgICB0aXRsZTogbm9kZS5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyksXG4gICAgICBwcmVmaXg6IHByZWZpeCxcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtLFxuICAgICAgc3ltYm9sOiBzeW1ib2wsXG4gICAgICBtYXNrOiBtYXNrLFxuICAgICAgZXh0cmE6IHtcbiAgICAgICAgY2xhc3NlczogZXh0cmFDbGFzc2VzLFxuICAgICAgICBzdHlsZXM6IGV4dHJhU3R5bGVzLFxuICAgICAgICBhdHRyaWJ1dGVzOiBleHRyYUF0dHJpYnV0ZXNcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gTWlzc2luZ0ljb24oZXJyb3IpIHtcbiAgICB0aGlzLm5hbWUgPSAnTWlzc2luZ0ljb24nO1xuICAgIHRoaXMubWVzc2FnZSA9IGVycm9yIHx8ICdJY29uIHVuYXZhaWxhYmxlJztcbiAgICB0aGlzLnN0YWNrID0gbmV3IEVycm9yKCkuc3RhY2s7XG4gIH1cbiAgTWlzc2luZ0ljb24ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuICBNaXNzaW5nSWNvbi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNaXNzaW5nSWNvbjtcblxuICB2YXIgRklMTCA9IHtcbiAgICBmaWxsOiAnY3VycmVudENvbG9yJ1xuICB9O1xuICB2YXIgQU5JTUFUSU9OX0JBU0UgPSB7XG4gICAgYXR0cmlidXRlVHlwZTogJ1hNTCcsXG4gICAgcmVwZWF0Q291bnQ6ICdpbmRlZmluaXRlJyxcbiAgICBkdXI6ICcycydcbiAgfTtcbiAgdmFyIFJJTkcgPSB7XG4gICAgdGFnOiAncGF0aCcsXG4gICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7fSwgRklMTCwge1xuICAgICAgZDogJ00xNTYuNSw0NDcuN2wtMTIuNiwyOS41Yy0xOC43LTkuNS0zNS45LTIxLjItNTEuNS0zNC45bDIyLjctMjIuN0MxMjcuNiw0MzAuNSwxNDEuNSw0NDAsMTU2LjUsNDQ3Ljd6IE00MC42LDI3Mkg4LjUgYzEuNCwyMS4yLDUuNCw0MS43LDExLjcsNjEuMUw1MCwzMjEuMkM0NS4xLDMwNS41LDQxLjgsMjg5LDQwLjYsMjcyeiBNNDAuNiwyNDBjMS40LTE4LjgsNS4yLTM3LDExLjEtNTQuMWwtMjkuNS0xMi42IEMxNC43LDE5NC4zLDEwLDIxNi43LDguNSwyNDBINDAuNnogTTY0LjMsMTU2LjVjNy44LTE0LjksMTcuMi0yOC44LDI4LjEtNDEuNUw2OS43LDkyLjNjLTEzLjcsMTUuNi0yNS41LDMyLjgtMzQuOSw1MS41IEw2NC4zLDE1Ni41eiBNMzk3LDQxOS42Yy0xMy45LDEyLTI5LjQsMjIuMy00Ni4xLDMwLjRsMTEuOSwyOS44YzIwLjctOS45LDM5LjgtMjIuNiw1Ni45LTM3LjZMMzk3LDQxOS42eiBNMTE1LDkyLjQgYzEzLjktMTIsMjkuNC0yMi4zLDQ2LjEtMzAuNGwtMTEuOS0yOS44Yy0yMC43LDkuOS0zOS44LDIyLjYtNTYuOCwzNy42TDExNSw5Mi40eiBNNDQ3LjcsMzU1LjVjLTcuOCwxNC45LTE3LjIsMjguOC0yOC4xLDQxLjUgbDIyLjcsMjIuN2MxMy43LTE1LjYsMjUuNS0zMi45LDM0LjktNTEuNUw0NDcuNywzNTUuNXogTTQ3MS40LDI3MmMtMS40LDE4LjgtNS4yLDM3LTExLjEsNTQuMWwyOS41LDEyLjYgYzcuNS0yMS4xLDEyLjItNDMuNSwxMy42LTY2LjhINDcxLjR6IE0zMjEuMiw0NjJjLTE1LjcsNS0zMi4yLDguMi00OS4yLDkuNHYzMi4xYzIxLjItMS40LDQxLjctNS40LDYxLjEtMTEuN0wzMjEuMiw0NjJ6IE0yNDAsNDcxLjRjLTE4LjgtMS40LTM3LTUuMi01NC4xLTExLjFsLTEyLjYsMjkuNWMyMS4xLDcuNSw0My41LDEyLjIsNjYuOCwxMy42VjQ3MS40eiBNNDYyLDE5MC44YzUsMTUuNyw4LjIsMzIuMiw5LjQsNDkuMmgzMi4xIGMtMS40LTIxLjItNS40LTQxLjctMTEuNy02MS4xTDQ2MiwxOTAuOHogTTkyLjQsMzk3Yy0xMi0xMy45LTIyLjMtMjkuNC0zMC40LTQ2LjFsLTI5LjgsMTEuOWM5LjksMjAuNywyMi42LDM5LjgsMzcuNiw1Ni45IEw5Mi40LDM5N3ogTTI3Miw0MC42YzE4LjgsMS40LDM2LjksNS4yLDU0LjEsMTEuMWwxMi42LTI5LjVDMzE3LjcsMTQuNywyOTUuMywxMCwyNzIsOC41VjQwLjZ6IE0xOTAuOCw1MCBjMTUuNy01LDMyLjItOC4yLDQ5LjItOS40VjguNWMtMjEuMiwxLjQtNDEuNyw1LjQtNjEuMSwxMS43TDE5MC44LDUweiBNNDQyLjMsOTIuM0w0MTkuNiwxMTVjMTIsMTMuOSwyMi4zLDI5LjQsMzAuNSw0Ni4xIGwyOS44LTExLjlDNDcwLDEyOC41LDQ1Ny4zLDEwOS40LDQ0Mi4zLDkyLjN6IE0zOTcsOTIuNGwyMi43LTIyLjdjLTE1LjYtMTMuNy0zMi44LTI1LjUtNTEuNS0zNC45bC0xMi42LDI5LjUgQzM3MC40LDcyLjEsMzg0LjQsODEuNSwzOTcsOTIuNHonXG4gICAgfSlcbiAgfTtcblxuICB2YXIgT1BBQ0lUWV9BTklNQVRFID0gX29iamVjdFNwcmVhZCh7fSwgQU5JTUFUSU9OX0JBU0UsIHtcbiAgICBhdHRyaWJ1dGVOYW1lOiAnb3BhY2l0eSdcbiAgfSk7XG5cbiAgdmFyIERPVCA9IHtcbiAgICB0YWc6ICdjaXJjbGUnLFxuICAgIGF0dHJpYnV0ZXM6IF9vYmplY3RTcHJlYWQoe30sIEZJTEwsIHtcbiAgICAgIGN4OiAnMjU2JyxcbiAgICAgIGN5OiAnMzY0JyxcbiAgICAgIHI6ICcyOCdcbiAgICB9KSxcbiAgICBjaGlsZHJlbjogW3tcbiAgICAgIHRhZzogJ2FuaW1hdGUnLFxuICAgICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7fSwgQU5JTUFUSU9OX0JBU0UsIHtcbiAgICAgICAgYXR0cmlidXRlTmFtZTogJ3InLFxuICAgICAgICB2YWx1ZXM6ICcyODsxNDsyODsyODsxNDsyODsnXG4gICAgICB9KVxuICAgIH0sIHtcbiAgICAgIHRhZzogJ2FuaW1hdGUnLFxuICAgICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7fSwgT1BBQ0lUWV9BTklNQVRFLCB7XG4gICAgICAgIHZhbHVlczogJzE7MDsxOzE7MDsxOydcbiAgICAgIH0pXG4gICAgfV1cbiAgfTtcbiAgdmFyIFFVRVNUSU9OID0ge1xuICAgIHRhZzogJ3BhdGgnLFxuICAgIGF0dHJpYnV0ZXM6IF9vYmplY3RTcHJlYWQoe30sIEZJTEwsIHtcbiAgICAgIG9wYWNpdHk6ICcxJyxcbiAgICAgIGQ6ICdNMjYzLjcsMzEyaC0xNmMtNi42LDAtMTItNS40LTEyLTEyYzAtNzEsNzcuNC02My45LDc3LjQtMTA3LjhjMC0yMC0xNy44LTQwLjItNTcuNC00MC4yYy0yOS4xLDAtNDQuMyw5LjYtNTkuMiwyOC43IGMtMy45LDUtMTEuMSw2LTE2LjIsMi40bC0xMy4xLTkuMmMtNS42LTMuOS02LjktMTEuOC0yLjYtMTcuMmMyMS4yLTI3LjIsNDYuNC00NC43LDkxLjItNDQuN2M1Mi4zLDAsOTcuNCwyOS44LDk3LjQsODAuMiBjMCw2Ny42LTc3LjQsNjMuNS03Ny40LDEwNy44QzI3NS43LDMwNi42LDI3MC4zLDMxMiwyNjMuNywzMTJ6J1xuICAgIH0pLFxuICAgIGNoaWxkcmVuOiBbe1xuICAgICAgdGFnOiAnYW5pbWF0ZScsXG4gICAgICBhdHRyaWJ1dGVzOiBfb2JqZWN0U3ByZWFkKHt9LCBPUEFDSVRZX0FOSU1BVEUsIHtcbiAgICAgICAgdmFsdWVzOiAnMTswOzA7MDswOzE7J1xuICAgICAgfSlcbiAgICB9XVxuICB9O1xuICB2YXIgRVhDTEFNQVRJT04gPSB7XG4gICAgdGFnOiAncGF0aCcsXG4gICAgYXR0cmlidXRlczogX29iamVjdFNwcmVhZCh7fSwgRklMTCwge1xuICAgICAgb3BhY2l0eTogJzAnLFxuICAgICAgZDogJ00yMzIuNSwxMzQuNWw3LDE2OGMwLjMsNi40LDUuNiwxMS41LDEyLDExLjVoOWM2LjQsMCwxMS43LTUuMSwxMi0xMS41bDctMTY4YzAuMy02LjgtNS4yLTEyLjUtMTItMTIuNWgtMjMgQzIzNy43LDEyMiwyMzIuMiwxMjcuNywyMzIuNSwxMzQuNXonXG4gICAgfSksXG4gICAgY2hpbGRyZW46IFt7XG4gICAgICB0YWc6ICdhbmltYXRlJyxcbiAgICAgIGF0dHJpYnV0ZXM6IF9vYmplY3RTcHJlYWQoe30sIE9QQUNJVFlfQU5JTUFURSwge1xuICAgICAgICB2YWx1ZXM6ICcwOzA7MTsxOzA7MDsnXG4gICAgICB9KVxuICAgIH1dXG4gIH07XG4gIHZhciBtaXNzaW5nID0ge1xuICAgIHRhZzogJ2cnLFxuICAgIGNoaWxkcmVuOiBbUklORywgRE9ULCBRVUVTVElPTiwgRVhDTEFNQVRJT05dXG4gIH07XG5cbiAgdmFyIHN0eWxlcyQyID0gbmFtZXNwYWNlLnN0eWxlcztcbiAgdmFyIExBWUVSU19URVhUX0NMQVNTTkFNRSA9ICdmYS1sYXllcnMtdGV4dCc7XG4gIHZhciBGT05UX0ZBTUlMWV9QQVRURVJOID0gL0ZvbnQgQXdlc29tZSA1IChTb2xpZHxSZWd1bGFyfExpZ2h0fEJyYW5kc3xGcmVlfFBybykvO1xuICB2YXIgU1RZTEVfVE9fUFJFRklYID0ge1xuICAgICdTb2xpZCc6ICdmYXMnLFxuICAgICdSZWd1bGFyJzogJ2ZhcicsXG4gICAgJ0xpZ2h0JzogJ2ZhbCcsXG4gICAgJ0JyYW5kcyc6ICdmYWInXG4gIH07XG4gIHZhciBGT05UX1dFSUdIVF9UT19QUkVGSVggPSB7XG4gICAgJzkwMCc6ICdmYXMnLFxuICAgICc0MDAnOiAnZmFyJyxcbiAgICAnMzAwJzogJ2ZhbCdcbiAgfTtcblxuICBmdW5jdGlvbiBmaW5kSWNvbihpY29uTmFtZSwgcHJlZml4KSB7XG4gICAgdmFyIHZhbCA9IHtcbiAgICAgIGZvdW5kOiBmYWxzZSxcbiAgICAgIHdpZHRoOiA1MTIsXG4gICAgICBoZWlnaHQ6IDUxMixcbiAgICAgIGljb246IG1pc3NpbmdcbiAgICB9O1xuXG4gICAgaWYgKGljb25OYW1lICYmIHByZWZpeCAmJiBzdHlsZXMkMltwcmVmaXhdICYmIHN0eWxlcyQyW3ByZWZpeF1baWNvbk5hbWVdKSB7XG4gICAgICB2YXIgaWNvbiA9IHN0eWxlcyQyW3ByZWZpeF1baWNvbk5hbWVdO1xuICAgICAgdmFyIHdpZHRoID0gaWNvblswXTtcbiAgICAgIHZhciBoZWlnaHQgPSBpY29uWzFdO1xuICAgICAgdmFyIHZlY3RvckRhdGEgPSBpY29uLnNsaWNlKDQpO1xuICAgICAgdmFsID0ge1xuICAgICAgICBmb3VuZDogdHJ1ZSxcbiAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgaWNvbjoge1xuICAgICAgICAgIHRhZzogJ3BhdGgnLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgIGZpbGw6ICdjdXJyZW50Q29sb3InLFxuICAgICAgICAgICAgZDogdmVjdG9yRGF0YVswXVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGljb25OYW1lICYmIHByZWZpeCAmJiAhY29uZmlnLnNob3dNaXNzaW5nSWNvbnMpIHtcbiAgICAgIHRocm93IG5ldyBNaXNzaW5nSWNvbihcIkljb24gaXMgbWlzc2luZyBmb3IgcHJlZml4IFwiLmNvbmNhdChwcmVmaXgsIFwiIHdpdGggaWNvbiBuYW1lIFwiKS5jb25jYXQoaWNvbk5hbWUpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2VuZXJhdGVTdmdSZXBsYWNlbWVudE11dGF0aW9uKG5vZGUsIG5vZGVNZXRhKSB7XG4gICAgdmFyIGljb25OYW1lID0gbm9kZU1ldGEuaWNvbk5hbWUsXG4gICAgICAgIHRpdGxlID0gbm9kZU1ldGEudGl0bGUsXG4gICAgICAgIHByZWZpeCA9IG5vZGVNZXRhLnByZWZpeCxcbiAgICAgICAgdHJhbnNmb3JtID0gbm9kZU1ldGEudHJhbnNmb3JtLFxuICAgICAgICBzeW1ib2wgPSBub2RlTWV0YS5zeW1ib2wsXG4gICAgICAgIG1hc2sgPSBub2RlTWV0YS5tYXNrLFxuICAgICAgICBleHRyYSA9IG5vZGVNZXRhLmV4dHJhO1xuICAgIHJldHVybiBbbm9kZSwgbWFrZUlubGluZVN2Z0Fic3RyYWN0KHtcbiAgICAgIGljb25zOiB7XG4gICAgICAgIG1haW46IGZpbmRJY29uKGljb25OYW1lLCBwcmVmaXgpLFxuICAgICAgICBtYXNrOiBmaW5kSWNvbihtYXNrLmljb25OYW1lLCBtYXNrLnByZWZpeClcbiAgICAgIH0sXG4gICAgICBwcmVmaXg6IHByZWZpeCxcbiAgICAgIGljb25OYW1lOiBpY29uTmFtZSxcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtLFxuICAgICAgc3ltYm9sOiBzeW1ib2wsXG4gICAgICBtYXNrOiBtYXNrLFxuICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgZXh0cmE6IGV4dHJhLFxuICAgICAgd2F0Y2hhYmxlOiB0cnVlXG4gICAgfSldO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2VuZXJhdGVMYXllcnNUZXh0KG5vZGUsIG5vZGVNZXRhKSB7XG4gICAgdmFyIHRpdGxlID0gbm9kZU1ldGEudGl0bGUsXG4gICAgICAgIHRyYW5zZm9ybSA9IG5vZGVNZXRhLnRyYW5zZm9ybSxcbiAgICAgICAgZXh0cmEgPSBub2RlTWV0YS5leHRyYTtcbiAgICB2YXIgd2lkdGggPSBudWxsO1xuICAgIHZhciBoZWlnaHQgPSBudWxsO1xuXG4gICAgaWYgKElTX0lFKSB7XG4gICAgICB2YXIgY29tcHV0ZWRGb250U2l6ZSA9IHBhcnNlSW50KGdldENvbXB1dGVkU3R5bGUobm9kZSkuZm9udFNpemUsIDEwKTtcbiAgICAgIHZhciBib3VuZGluZ0NsaWVudFJlY3QgPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgd2lkdGggPSBib3VuZGluZ0NsaWVudFJlY3Qud2lkdGggLyBjb21wdXRlZEZvbnRTaXplO1xuICAgICAgaGVpZ2h0ID0gYm91bmRpbmdDbGllbnRSZWN0LmhlaWdodCAvIGNvbXB1dGVkRm9udFNpemU7XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5hdXRvQTExeSAmJiAhdGl0bGUpIHtcbiAgICAgIGV4dHJhLmF0dHJpYnV0ZXNbJ2FyaWEtaGlkZGVuJ10gPSAndHJ1ZSc7XG4gICAgfVxuXG4gICAgcmV0dXJuIFtub2RlLCBtYWtlTGF5ZXJzVGV4dEFic3RyYWN0KHtcbiAgICAgIGNvbnRlbnQ6IG5vZGUuaW5uZXJIVE1MLFxuICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICB0cmFuc2Zvcm06IHRyYW5zZm9ybSxcbiAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgIGV4dHJhOiBleHRyYSxcbiAgICAgIHdhdGNoYWJsZTogdHJ1ZVxuICAgIH0pXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdlbmVyYXRlTXV0YXRpb24obm9kZSkge1xuICAgIHZhciBub2RlTWV0YSA9IHBhcnNlTWV0YShub2RlKTtcblxuICAgIGlmICh+bm9kZU1ldGEuZXh0cmEuY2xhc3Nlcy5pbmRleE9mKExBWUVSU19URVhUX0NMQVNTTkFNRSkpIHtcbiAgICAgIHJldHVybiBnZW5lcmF0ZUxheWVyc1RleHQobm9kZSwgbm9kZU1ldGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZ2VuZXJhdGVTdmdSZXBsYWNlbWVudE11dGF0aW9uKG5vZGUsIG5vZGVNZXRhKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZWFyY2hQc2V1ZG9FbGVtZW50cyhyb290KSB7XG4gICAgaWYgKCFJU19ET00pIHJldHVybjtcbiAgICB2YXIgZW5kID0gcGVyZi5iZWdpbignc2VhcmNoUHNldWRvRWxlbWVudHMnKTtcbiAgICBkaXNhYmxlT2JzZXJ2YXRpb24oZnVuY3Rpb24gKCkge1xuICAgICAgdG9BcnJheShyb290LnF1ZXJ5U2VsZWN0b3JBbGwoJyonKSkuZmlsdGVyKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgIHJldHVybiBuLnBhcmVudE5vZGUgIT09IGRvY3VtZW50LmhlYWQgJiYgIX5UQUdOQU1FU19UT19TS0lQX0ZPUl9QU0VVRE9FTEVNRU5UUy5pbmRleE9mKG4udGFnTmFtZS50b1VwcGVyQ2FzZSgpKSAmJiAhbi5nZXRBdHRyaWJ1dGUoREFUQV9GQV9QU0VVRE9fRUxFTUVOVCkgJiYgKCFuLnBhcmVudE5vZGUgfHwgbi5wYXJlbnROb2RlLnRhZ05hbWUgIT09ICdzdmcnKTtcbiAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgWyc6YmVmb3JlJywgJzphZnRlciddLmZvckVhY2goZnVuY3Rpb24gKHBvcykge1xuICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRvQXJyYXkobm9kZS5jaGlsZHJlbik7XG4gICAgICAgICAgdmFyIGFscmVhZHlQcm9jZXNzZWRQc2V1ZG9FbGVtZW50ID0gY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gYy5nZXRBdHRyaWJ1dGUoREFUQV9GQV9QU0VVRE9fRUxFTUVOVCkgPT09IHBvcztcbiAgICAgICAgICB9KVswXTtcbiAgICAgICAgICB2YXIgc3R5bGVzID0gV0lORE9XLmdldENvbXB1dGVkU3R5bGUobm9kZSwgcG9zKTtcbiAgICAgICAgICB2YXIgZm9udEZhbWlseSA9IHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCdmb250LWZhbWlseScpLm1hdGNoKEZPTlRfRkFNSUxZX1BBVFRFUk4pO1xuICAgICAgICAgIHZhciBmb250V2VpZ2h0ID0gc3R5bGVzLmdldFByb3BlcnR5VmFsdWUoJ2ZvbnQtd2VpZ2h0Jyk7XG5cbiAgICAgICAgICBpZiAoYWxyZWFkeVByb2Nlc3NlZFBzZXVkb0VsZW1lbnQgJiYgIWZvbnRGYW1pbHkpIHtcbiAgICAgICAgICAgIC8vIElmIHdlJ3ZlIGFscmVhZHkgcHJvY2Vzc2VkIGl0IGJ1dCB0aGUgY3VycmVudCBjb21wdXRlZCBzdHlsZSBkb2VzIG5vdCByZXN1bHQgaW4gYSBmb250LWZhbWlseSxcbiAgICAgICAgICAgIC8vIHRoYXQgcHJvYmFibHkgbWVhbnMgdGhhdCBhIGNsYXNzIG5hbWUgdGhhdCB3YXMgcHJldmlvdXNseSBwcmVzZW50IHRvIG1ha2UgdGhlIGljb24gaGFzIGJlZW5cbiAgICAgICAgICAgIC8vIHJlbW92ZWQuIFNvIHdlIG5vdyBzaG91bGQgZGVsZXRlIHRoZSBpY29uLlxuICAgICAgICAgICAgbm9kZS5yZW1vdmVDaGlsZChhbHJlYWR5UHJvY2Vzc2VkUHNldWRvRWxlbWVudCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChmb250RmFtaWx5KSB7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCdjb250ZW50Jyk7XG4gICAgICAgICAgICB2YXIgcHJlZml4ID0gflsnTGlnaHQnLCAnUmVndWxhcicsICdTb2xpZCcsICdCcmFuZHMnXS5pbmRleE9mKGZvbnRGYW1pbHlbMV0pID8gU1RZTEVfVE9fUFJFRklYW2ZvbnRGYW1pbHlbMV1dIDogRk9OVF9XRUlHSFRfVE9fUFJFRklYW2ZvbnRXZWlnaHRdO1xuICAgICAgICAgICAgdmFyIGljb25OYW1lID0gYnlVbmljb2RlKHByZWZpeCwgdG9IZXgoY29udGVudC5sZW5ndGggPT09IDMgPyBjb250ZW50LnN1YnN0cigxLCAxKSA6IGNvbnRlbnQpKTsgLy8gT25seSBjb252ZXJ0IHRoZSBwc2V1ZG8gZWxlbWVudCBpbiB0aGlzIDpiZWZvcmUvOmFmdGVyIHBvc2l0aW9uIGludG8gYW4gaWNvbiBpZiB3ZSBoYXZlbid0XG4gICAgICAgICAgICAvLyBhbHJlYWR5IGRvbmUgc28gd2l0aCB0aGUgc2FtZSBwcmVmaXggYW5kIGljb25OYW1lXG5cbiAgICAgICAgICAgIGlmICghYWxyZWFkeVByb2Nlc3NlZFBzZXVkb0VsZW1lbnQgfHwgYWxyZWFkeVByb2Nlc3NlZFBzZXVkb0VsZW1lbnQuZ2V0QXR0cmlidXRlKERBVEFfUFJFRklYKSAhPT0gcHJlZml4IHx8IGFscmVhZHlQcm9jZXNzZWRQc2V1ZG9FbGVtZW50LmdldEF0dHJpYnV0ZShEQVRBX0lDT04pICE9PSBpY29uTmFtZSkge1xuICAgICAgICAgICAgICBpZiAoYWxyZWFkeVByb2Nlc3NlZFBzZXVkb0VsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAvLyBEZWxldGUgdGhlIG9sZCBvbmUsIHNpbmNlIHdlJ3JlIHJlcGxhY2luZyBpdCB3aXRoIGEgbmV3IG9uZVxuICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQ2hpbGQoYWxyZWFkeVByb2Nlc3NlZFBzZXVkb0VsZW1lbnQpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdmFyIGV4dHJhID0gYmxhbmtNZXRhLmV4dHJhO1xuICAgICAgICAgICAgICBleHRyYS5hdHRyaWJ1dGVzW0RBVEFfRkFfUFNFVURPX0VMRU1FTlRdID0gcG9zO1xuICAgICAgICAgICAgICB2YXIgYWJzdHJhY3QgPSBtYWtlSW5saW5lU3ZnQWJzdHJhY3QoX29iamVjdFNwcmVhZCh7fSwgYmxhbmtNZXRhLCB7XG4gICAgICAgICAgICAgICAgaWNvbnM6IHtcbiAgICAgICAgICAgICAgICAgIG1haW46IGZpbmRJY29uKGljb25OYW1lLCBwcmVmaXgpLFxuICAgICAgICAgICAgICAgICAgbWFzazogZW1wdHlDYW5vbmljYWxJY29uKClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHByZWZpeDogcHJlZml4LFxuICAgICAgICAgICAgICAgIGljb25OYW1lOiBpY29uTmFtZSxcbiAgICAgICAgICAgICAgICBleHRyYTogZXh0cmEsXG4gICAgICAgICAgICAgICAgd2F0Y2hhYmxlOiB0cnVlXG4gICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBET0NVTUVOVC5jcmVhdGVFbGVtZW50KCdzdmcnKTtcblxuICAgICAgICAgICAgICBpZiAocG9zID09PSAnOmJlZm9yZScpIHtcbiAgICAgICAgICAgICAgICBub2RlLmluc2VydEJlZm9yZShlbGVtZW50LCBub2RlLmZpcnN0Q2hpbGQpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBlbGVtZW50Lm91dGVySFRNTCA9IGFic3RyYWN0Lm1hcChmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0b0h0bWwoYSk7XG4gICAgICAgICAgICAgIH0pLmpvaW4oJ1xcbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBlbmQoKTtcbiAgfVxuICBmdW5jdGlvbiBvblRyZWUocm9vdCkge1xuICAgIHZhciBjYWxsYmFjayA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogbnVsbDtcbiAgICBpZiAoIUlTX0RPTSkgcmV0dXJuO1xuICAgIHZhciBodG1sQ2xhc3NMaXN0ID0gRE9DVU1FTlQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdDtcblxuICAgIHZhciBoY2xBZGQgPSBmdW5jdGlvbiBoY2xBZGQoc3VmZml4KSB7XG4gICAgICByZXR1cm4gaHRtbENsYXNzTGlzdC5hZGQoXCJcIi5jb25jYXQoSFRNTF9DTEFTU19JMlNWR19CQVNFX0NMQVNTLCBcIi1cIikuY29uY2F0KHN1ZmZpeCkpO1xuICAgIH07XG5cbiAgICB2YXIgaGNsUmVtb3ZlID0gZnVuY3Rpb24gaGNsUmVtb3ZlKHN1ZmZpeCkge1xuICAgICAgcmV0dXJuIGh0bWxDbGFzc0xpc3QucmVtb3ZlKFwiXCIuY29uY2F0KEhUTUxfQ0xBU1NfSTJTVkdfQkFTRV9DTEFTUywgXCItXCIpLmNvbmNhdChzdWZmaXgpKTtcbiAgICB9O1xuXG4gICAgdmFyIHByZWZpeGVzID0gT2JqZWN0LmtleXMoc3R5bGVzJDIpO1xuICAgIHZhciBwcmVmaXhlc0RvbVF1ZXJ5ID0gW1wiLlwiLmNvbmNhdChMQVlFUlNfVEVYVF9DTEFTU05BTUUsIFwiOm5vdChbXCIpLmNvbmNhdChEQVRBX0ZBX0kyU1ZHLCBcIl0pXCIpXS5jb25jYXQocHJlZml4ZXMubWFwKGZ1bmN0aW9uIChwKSB7XG4gICAgICByZXR1cm4gXCIuXCIuY29uY2F0KHAsIFwiOm5vdChbXCIpLmNvbmNhdChEQVRBX0ZBX0kyU1ZHLCBcIl0pXCIpO1xuICAgIH0pKS5qb2luKCcsICcpO1xuXG4gICAgaWYgKHByZWZpeGVzRG9tUXVlcnkubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGNhbmRpZGF0ZXMgPSB0b0FycmF5KHJvb3QucXVlcnlTZWxlY3RvckFsbChwcmVmaXhlc0RvbVF1ZXJ5KSk7XG5cbiAgICBpZiAoY2FuZGlkYXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICBoY2xBZGQoJ3BlbmRpbmcnKTtcbiAgICAgIGhjbFJlbW92ZSgnY29tcGxldGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBtYXJrID0gcGVyZi5iZWdpbignb25UcmVlJyk7XG4gICAgdmFyIG11dGF0aW9ucyA9IGNhbmRpZGF0ZXMucmVkdWNlKGZ1bmN0aW9uIChhY2MsIG5vZGUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBtdXRhdGlvbiA9IGdlbmVyYXRlTXV0YXRpb24obm9kZSk7XG5cbiAgICAgICAgaWYgKG11dGF0aW9uKSB7XG4gICAgICAgICAgYWNjLnB1c2gobXV0YXRpb24pO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmICghUFJPRFVDVElPTikge1xuICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgTWlzc2luZ0ljb24pIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgW10pO1xuICAgIG1hcmsoKTtcbiAgICBwZXJmb3JtKG11dGF0aW9ucywgZnVuY3Rpb24gKCkge1xuICAgICAgaGNsQWRkKCdhY3RpdmUnKTtcbiAgICAgIGhjbEFkZCgnY29tcGxldGUnKTtcbiAgICAgIGhjbFJlbW92ZSgncGVuZGluZycpO1xuICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBvbk5vZGUobm9kZSkge1xuICAgIHZhciBjYWxsYmFjayA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogbnVsbDtcbiAgICB2YXIgbXV0YXRpb24gPSBnZW5lcmF0ZU11dGF0aW9uKG5vZGUpO1xuXG4gICAgaWYgKG11dGF0aW9uKSB7XG4gICAgICBwZXJmb3JtKFttdXRhdGlvbl0sIGNhbGxiYWNrKTtcbiAgICB9XG4gIH1cblxuICB2YXIgYmFzZVN0eWxlcyA9IFwic3ZnOm5vdCg6cm9vdCkuc3ZnLWlubGluZS0tZmF7b3ZlcmZsb3c6dmlzaWJsZX0uc3ZnLWlubGluZS0tZmF7ZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOmluaGVyaXQ7aGVpZ2h0OjFlbTtvdmVyZmxvdzp2aXNpYmxlO3ZlcnRpY2FsLWFsaWduOi0uMTI1ZW19LnN2Zy1pbmxpbmUtLWZhLmZhLWxne3ZlcnRpY2FsLWFsaWduOi0uMjI1ZW19LnN2Zy1pbmxpbmUtLWZhLmZhLXctMXt3aWR0aDouMDYyNWVtfS5zdmctaW5saW5lLS1mYS5mYS13LTJ7d2lkdGg6LjEyNWVtfS5zdmctaW5saW5lLS1mYS5mYS13LTN7d2lkdGg6LjE4NzVlbX0uc3ZnLWlubGluZS0tZmEuZmEtdy00e3dpZHRoOi4yNWVtfS5zdmctaW5saW5lLS1mYS5mYS13LTV7d2lkdGg6LjMxMjVlbX0uc3ZnLWlubGluZS0tZmEuZmEtdy02e3dpZHRoOi4zNzVlbX0uc3ZnLWlubGluZS0tZmEuZmEtdy03e3dpZHRoOi40Mzc1ZW19LnN2Zy1pbmxpbmUtLWZhLmZhLXctOHt3aWR0aDouNWVtfS5zdmctaW5saW5lLS1mYS5mYS13LTl7d2lkdGg6LjU2MjVlbX0uc3ZnLWlubGluZS0tZmEuZmEtdy0xMHt3aWR0aDouNjI1ZW19LnN2Zy1pbmxpbmUtLWZhLmZhLXctMTF7d2lkdGg6LjY4NzVlbX0uc3ZnLWlubGluZS0tZmEuZmEtdy0xMnt3aWR0aDouNzVlbX0uc3ZnLWlubGluZS0tZmEuZmEtdy0xM3t3aWR0aDouODEyNWVtfS5zdmctaW5saW5lLS1mYS5mYS13LTE0e3dpZHRoOi44NzVlbX0uc3ZnLWlubGluZS0tZmEuZmEtdy0xNXt3aWR0aDouOTM3NWVtfS5zdmctaW5saW5lLS1mYS5mYS13LTE2e3dpZHRoOjFlbX0uc3ZnLWlubGluZS0tZmEuZmEtdy0xN3t3aWR0aDoxLjA2MjVlbX0uc3ZnLWlubGluZS0tZmEuZmEtdy0xOHt3aWR0aDoxLjEyNWVtfS5zdmctaW5saW5lLS1mYS5mYS13LTE5e3dpZHRoOjEuMTg3NWVtfS5zdmctaW5saW5lLS1mYS5mYS13LTIwe3dpZHRoOjEuMjVlbX0uc3ZnLWlubGluZS0tZmEuZmEtcHVsbC1sZWZ0e21hcmdpbi1yaWdodDouM2VtO3dpZHRoOmF1dG99LnN2Zy1pbmxpbmUtLWZhLmZhLXB1bGwtcmlnaHR7bWFyZ2luLWxlZnQ6LjNlbTt3aWR0aDphdXRvfS5zdmctaW5saW5lLS1mYS5mYS1ib3JkZXJ7aGVpZ2h0OjEuNWVtfS5zdmctaW5saW5lLS1mYS5mYS1saXt3aWR0aDoyZW19LnN2Zy1pbmxpbmUtLWZhLmZhLWZ3e3dpZHRoOjEuMjVlbX0uZmEtbGF5ZXJzIHN2Zy5zdmctaW5saW5lLS1mYXtib3R0b206MDtsZWZ0OjA7bWFyZ2luOmF1dG87cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MDt0b3A6MH0uZmEtbGF5ZXJze2Rpc3BsYXk6aW5saW5lLWJsb2NrO2hlaWdodDoxZW07cG9zaXRpb246cmVsYXRpdmU7dGV4dC1hbGlnbjpjZW50ZXI7dmVydGljYWwtYWxpZ246LS4xMjVlbTt3aWR0aDoxZW19LmZhLWxheWVycyBzdmcuc3ZnLWlubGluZS0tZmF7LXdlYmtpdC10cmFuc2Zvcm0tb3JpZ2luOmNlbnRlciBjZW50ZXI7dHJhbnNmb3JtLW9yaWdpbjpjZW50ZXIgY2VudGVyfS5mYS1sYXllcnMtY291bnRlciwuZmEtbGF5ZXJzLXRleHR7ZGlzcGxheTppbmxpbmUtYmxvY2s7cG9zaXRpb246YWJzb2x1dGU7dGV4dC1hbGlnbjpjZW50ZXJ9LmZhLWxheWVycy10ZXh0e2xlZnQ6NTAlO3RvcDo1MCU7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlKC01MCUsLTUwJSk7dHJhbnNmb3JtOnRyYW5zbGF0ZSgtNTAlLC01MCUpOy13ZWJraXQtdHJhbnNmb3JtLW9yaWdpbjpjZW50ZXIgY2VudGVyO3RyYW5zZm9ybS1vcmlnaW46Y2VudGVyIGNlbnRlcn0uZmEtbGF5ZXJzLWNvdW50ZXJ7YmFja2dyb3VuZC1jb2xvcjojZmYyNTNhO2JvcmRlci1yYWRpdXM6MWVtOy13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94O2JveC1zaXppbmc6Ym9yZGVyLWJveDtjb2xvcjojZmZmO2hlaWdodDoxLjVlbTtsaW5lLWhlaWdodDoxO21heC13aWR0aDo1ZW07bWluLXdpZHRoOjEuNWVtO292ZXJmbG93OmhpZGRlbjtwYWRkaW5nOi4yNWVtO3JpZ2h0OjA7dGV4dC1vdmVyZmxvdzplbGxpcHNpczt0b3A6MDstd2Via2l0LXRyYW5zZm9ybTpzY2FsZSguMjUpO3RyYW5zZm9ybTpzY2FsZSguMjUpOy13ZWJraXQtdHJhbnNmb3JtLW9yaWdpbjp0b3AgcmlnaHQ7dHJhbnNmb3JtLW9yaWdpbjp0b3AgcmlnaHR9LmZhLWxheWVycy1ib3R0b20tcmlnaHR7Ym90dG9tOjA7cmlnaHQ6MDt0b3A6YXV0bzstd2Via2l0LXRyYW5zZm9ybTpzY2FsZSguMjUpO3RyYW5zZm9ybTpzY2FsZSguMjUpOy13ZWJraXQtdHJhbnNmb3JtLW9yaWdpbjpib3R0b20gcmlnaHQ7dHJhbnNmb3JtLW9yaWdpbjpib3R0b20gcmlnaHR9LmZhLWxheWVycy1ib3R0b20tbGVmdHtib3R0b206MDtsZWZ0OjA7cmlnaHQ6YXV0bzt0b3A6YXV0bzstd2Via2l0LXRyYW5zZm9ybTpzY2FsZSguMjUpO3RyYW5zZm9ybTpzY2FsZSguMjUpOy13ZWJraXQtdHJhbnNmb3JtLW9yaWdpbjpib3R0b20gbGVmdDt0cmFuc2Zvcm0tb3JpZ2luOmJvdHRvbSBsZWZ0fS5mYS1sYXllcnMtdG9wLXJpZ2h0e3JpZ2h0OjA7dG9wOjA7LXdlYmtpdC10cmFuc2Zvcm06c2NhbGUoLjI1KTt0cmFuc2Zvcm06c2NhbGUoLjI1KTstd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46dG9wIHJpZ2h0O3RyYW5zZm9ybS1vcmlnaW46dG9wIHJpZ2h0fS5mYS1sYXllcnMtdG9wLWxlZnR7bGVmdDowO3JpZ2h0OmF1dG87dG9wOjA7LXdlYmtpdC10cmFuc2Zvcm06c2NhbGUoLjI1KTt0cmFuc2Zvcm06c2NhbGUoLjI1KTstd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46dG9wIGxlZnQ7dHJhbnNmb3JtLW9yaWdpbjp0b3AgbGVmdH0uZmEtbGd7Zm9udC1zaXplOjEuMzMzMzMzMzMzM2VtO2xpbmUtaGVpZ2h0Oi43NWVtO3ZlcnRpY2FsLWFsaWduOi0uMDY2N2VtfS5mYS14c3tmb250LXNpemU6Ljc1ZW19LmZhLXNte2ZvbnQtc2l6ZTouODc1ZW19LmZhLTF4e2ZvbnQtc2l6ZToxZW19LmZhLTJ4e2ZvbnQtc2l6ZToyZW19LmZhLTN4e2ZvbnQtc2l6ZTozZW19LmZhLTR4e2ZvbnQtc2l6ZTo0ZW19LmZhLTV4e2ZvbnQtc2l6ZTo1ZW19LmZhLTZ4e2ZvbnQtc2l6ZTo2ZW19LmZhLTd4e2ZvbnQtc2l6ZTo3ZW19LmZhLTh4e2ZvbnQtc2l6ZTo4ZW19LmZhLTl4e2ZvbnQtc2l6ZTo5ZW19LmZhLTEweHtmb250LXNpemU6MTBlbX0uZmEtZnd7dGV4dC1hbGlnbjpjZW50ZXI7d2lkdGg6MS4yNWVtfS5mYS11bHtsaXN0LXN0eWxlLXR5cGU6bm9uZTttYXJnaW4tbGVmdDoyLjVlbTtwYWRkaW5nLWxlZnQ6MH0uZmEtdWw+bGl7cG9zaXRpb246cmVsYXRpdmV9LmZhLWxpe2xlZnQ6LTJlbTtwb3NpdGlvbjphYnNvbHV0ZTt0ZXh0LWFsaWduOmNlbnRlcjt3aWR0aDoyZW07bGluZS1oZWlnaHQ6aW5oZXJpdH0uZmEtYm9yZGVye2JvcmRlcjpzb2xpZCAuMDhlbSAjZWVlO2JvcmRlci1yYWRpdXM6LjFlbTtwYWRkaW5nOi4yZW0gLjI1ZW0gLjE1ZW19LmZhLXB1bGwtbGVmdHtmbG9hdDpsZWZ0fS5mYS1wdWxsLXJpZ2h0e2Zsb2F0OnJpZ2h0fS5mYS5mYS1wdWxsLWxlZnQsLmZhYi5mYS1wdWxsLWxlZnQsLmZhbC5mYS1wdWxsLWxlZnQsLmZhci5mYS1wdWxsLWxlZnQsLmZhcy5mYS1wdWxsLWxlZnR7bWFyZ2luLXJpZ2h0Oi4zZW19LmZhLmZhLXB1bGwtcmlnaHQsLmZhYi5mYS1wdWxsLXJpZ2h0LC5mYWwuZmEtcHVsbC1yaWdodCwuZmFyLmZhLXB1bGwtcmlnaHQsLmZhcy5mYS1wdWxsLXJpZ2h0e21hcmdpbi1sZWZ0Oi4zZW19LmZhLXNwaW57LXdlYmtpdC1hbmltYXRpb246ZmEtc3BpbiAycyBpbmZpbml0ZSBsaW5lYXI7YW5pbWF0aW9uOmZhLXNwaW4gMnMgaW5maW5pdGUgbGluZWFyfS5mYS1wdWxzZXstd2Via2l0LWFuaW1hdGlvbjpmYS1zcGluIDFzIGluZmluaXRlIHN0ZXBzKDgpO2FuaW1hdGlvbjpmYS1zcGluIDFzIGluZmluaXRlIHN0ZXBzKDgpfUAtd2Via2l0LWtleWZyYW1lcyBmYS1zcGluezAley13ZWJraXQtdHJhbnNmb3JtOnJvdGF0ZSgwKTt0cmFuc2Zvcm06cm90YXRlKDApfTEwMCV7LXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDM2MGRlZyk7dHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpfX1Aa2V5ZnJhbWVzIGZhLXNwaW57MCV7LXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDApO3RyYW5zZm9ybTpyb3RhdGUoMCl9MTAwJXstd2Via2l0LXRyYW5zZm9ybTpyb3RhdGUoMzYwZGVnKTt0cmFuc2Zvcm06cm90YXRlKDM2MGRlZyl9fS5mYS1yb3RhdGUtOTB7LXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDkwZGVnKTt0cmFuc2Zvcm06cm90YXRlKDkwZGVnKX0uZmEtcm90YXRlLTE4MHstd2Via2l0LXRyYW5zZm9ybTpyb3RhdGUoMTgwZGVnKTt0cmFuc2Zvcm06cm90YXRlKDE4MGRlZyl9LmZhLXJvdGF0ZS0yNzB7LXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDI3MGRlZyk7dHJhbnNmb3JtOnJvdGF0ZSgyNzBkZWcpfS5mYS1mbGlwLWhvcml6b250YWx7LXdlYmtpdC10cmFuc2Zvcm06c2NhbGUoLTEsMSk7dHJhbnNmb3JtOnNjYWxlKC0xLDEpfS5mYS1mbGlwLXZlcnRpY2Fsey13ZWJraXQtdHJhbnNmb3JtOnNjYWxlKDEsLTEpO3RyYW5zZm9ybTpzY2FsZSgxLC0xKX0uZmEtZmxpcC1ob3Jpem9udGFsLmZhLWZsaXAtdmVydGljYWx7LXdlYmtpdC10cmFuc2Zvcm06c2NhbGUoLTEsLTEpO3RyYW5zZm9ybTpzY2FsZSgtMSwtMSl9OnJvb3QgLmZhLWZsaXAtaG9yaXpvbnRhbCw6cm9vdCAuZmEtZmxpcC12ZXJ0aWNhbCw6cm9vdCAuZmEtcm90YXRlLTE4MCw6cm9vdCAuZmEtcm90YXRlLTI3MCw6cm9vdCAuZmEtcm90YXRlLTkwey13ZWJraXQtZmlsdGVyOm5vbmU7ZmlsdGVyOm5vbmV9LmZhLXN0YWNre2Rpc3BsYXk6aW5saW5lLWJsb2NrO2hlaWdodDoyZW07cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6Mi41ZW19LmZhLXN0YWNrLTF4LC5mYS1zdGFjay0yeHtib3R0b206MDtsZWZ0OjA7bWFyZ2luOmF1dG87cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MDt0b3A6MH0uc3ZnLWlubGluZS0tZmEuZmEtc3RhY2stMXh7aGVpZ2h0OjFlbTt3aWR0aDoxLjI1ZW19LnN2Zy1pbmxpbmUtLWZhLmZhLXN0YWNrLTJ4e2hlaWdodDoyZW07d2lkdGg6Mi41ZW19LmZhLWludmVyc2V7Y29sb3I6I2ZmZn0uc3Itb25seXtib3JkZXI6MDtjbGlwOnJlY3QoMCwwLDAsMCk7aGVpZ2h0OjFweDttYXJnaW46LTFweDtvdmVyZmxvdzpoaWRkZW47cGFkZGluZzowO3Bvc2l0aW9uOmFic29sdXRlO3dpZHRoOjFweH0uc3Itb25seS1mb2N1c2FibGU6YWN0aXZlLC5zci1vbmx5LWZvY3VzYWJsZTpmb2N1c3tjbGlwOmF1dG87aGVpZ2h0OmF1dG87bWFyZ2luOjA7b3ZlcmZsb3c6dmlzaWJsZTtwb3NpdGlvbjpzdGF0aWM7d2lkdGg6YXV0b31cIjtcblxuICBmdW5jdGlvbiBjc3MgKCkge1xuICAgIHZhciBkZnAgPSBERUZBVUxUX0ZBTUlMWV9QUkVGSVg7XG4gICAgdmFyIGRyYyA9IERFRkFVTFRfUkVQTEFDRU1FTlRfQ0xBU1M7XG4gICAgdmFyIGZwID0gY29uZmlnLmZhbWlseVByZWZpeDtcbiAgICB2YXIgcmMgPSBjb25maWcucmVwbGFjZW1lbnRDbGFzcztcbiAgICB2YXIgcyA9IGJhc2VTdHlsZXM7XG5cbiAgICBpZiAoZnAgIT09IGRmcCB8fCByYyAhPT0gZHJjKSB7XG4gICAgICB2YXIgZFBhdHQgPSBuZXcgUmVnRXhwKFwiXFxcXC5cIi5jb25jYXQoZGZwLCBcIlxcXFwtXCIpLCAnZycpO1xuICAgICAgdmFyIHJQYXR0ID0gbmV3IFJlZ0V4cChcIlxcXFwuXCIuY29uY2F0KGRyYyksICdnJyk7XG4gICAgICBzID0gcy5yZXBsYWNlKGRQYXR0LCBcIi5cIi5jb25jYXQoZnAsIFwiLVwiKSkucmVwbGFjZShyUGF0dCwgXCIuXCIuY29uY2F0KHJjKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHM7XG4gIH1cblxuICBmdW5jdGlvbiBkZWZpbmUocHJlZml4LCBpY29ucykge1xuICAgIHZhciBub3JtYWxpemVkID0gT2JqZWN0LmtleXMoaWNvbnMpLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBpY29uTmFtZSkge1xuICAgICAgdmFyIGljb24gPSBpY29uc1tpY29uTmFtZV07XG4gICAgICB2YXIgZXhwYW5kZWQgPSAhIWljb24uaWNvbjtcblxuICAgICAgaWYgKGV4cGFuZGVkKSB7XG4gICAgICAgIGFjY1tpY29uLmljb25OYW1lXSA9IGljb24uaWNvbjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFjY1tpY29uTmFtZV0gPSBpY29uO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KTtcblxuICAgIGlmICh0eXBlb2YgbmFtZXNwYWNlLmhvb2tzLmFkZFBhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIG5hbWVzcGFjZS5ob29rcy5hZGRQYWNrKHByZWZpeCwgbm9ybWFsaXplZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5hbWVzcGFjZS5zdHlsZXNbcHJlZml4XSA9IF9vYmplY3RTcHJlYWQoe30sIG5hbWVzcGFjZS5zdHlsZXNbcHJlZml4XSB8fCB7fSwgbm9ybWFsaXplZCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZvbnQgQXdlc29tZSA0IHVzZWQgdGhlIHByZWZpeCBvZiBgZmFgIGZvciBhbGwgaWNvbnMuIFdpdGggdGhlIGludHJvZHVjdGlvblxuICAgICAqIG9mIG5ldyBzdHlsZXMgd2UgbmVlZGVkIHRvIGRpZmZlcmVudGlhdGUgYmV0d2VlbiB0aGVtLiBQcmVmaXggYGZhYCBpcyBub3cgYW4gYWxpYXNcbiAgICAgKiBmb3IgYGZhc2Agc28gd2UnbGwgZWFzeSB0aGUgdXBncmFkZSBwcm9jZXNzIGZvciBvdXIgdXNlcnMgYnkgYXV0b21hdGljYWxseSBkZWZpbmluZ1xuICAgICAqIHRoaXMgYXMgd2VsbC5cbiAgICAgKi9cblxuXG4gICAgaWYgKHByZWZpeCA9PT0gJ2ZhcycpIHtcbiAgICAgIGRlZmluZSgnZmEnLCBpY29ucyk7XG4gICAgfVxuICB9XG5cbiAgdmFyIExpYnJhcnkgPVxuICAvKiNfX1BVUkVfXyovXG4gIGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBMaWJyYXJ5KCkge1xuICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExpYnJhcnkpO1xuXG4gICAgICB0aGlzLmRlZmluaXRpb25zID0ge307XG4gICAgfVxuXG4gICAgX2NyZWF0ZUNsYXNzKExpYnJhcnksIFt7XG4gICAgICBrZXk6IFwiYWRkXCIsXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gYWRkKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBkZWZpbml0aW9ucyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgICAgICBkZWZpbml0aW9uc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhZGRpdGlvbnMgPSBkZWZpbml0aW9ucy5yZWR1Y2UodGhpcy5fcHVsbERlZmluaXRpb25zLCB7fSk7XG4gICAgICAgIE9iamVjdC5rZXlzKGFkZGl0aW9ucykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgX3RoaXMuZGVmaW5pdGlvbnNba2V5XSA9IF9vYmplY3RTcHJlYWQoe30sIF90aGlzLmRlZmluaXRpb25zW2tleV0gfHwge30sIGFkZGl0aW9uc1trZXldKTtcbiAgICAgICAgICBkZWZpbmUoa2V5LCBhZGRpdGlvbnNba2V5XSk7XG4gICAgICAgICAgYnVpbGQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAga2V5OiBcInJlc2V0XCIsXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuZGVmaW5pdGlvbnMgPSB7fTtcbiAgICAgIH1cbiAgICB9LCB7XG4gICAgICBrZXk6IFwiX3B1bGxEZWZpbml0aW9uc1wiLFxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wdWxsRGVmaW5pdGlvbnMoYWRkaXRpb25zLCBkZWZpbml0aW9uKSB7XG4gICAgICAgIHZhciBub3JtYWxpemVkID0gZGVmaW5pdGlvbi5wcmVmaXggJiYgZGVmaW5pdGlvbi5pY29uTmFtZSAmJiBkZWZpbml0aW9uLmljb24gPyB7XG4gICAgICAgICAgMDogZGVmaW5pdGlvblxuICAgICAgICB9IDogZGVmaW5pdGlvbjtcbiAgICAgICAgT2JqZWN0LmtleXMobm9ybWFsaXplZCkubWFwKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICB2YXIgX25vcm1hbGl6ZWQka2V5ID0gbm9ybWFsaXplZFtrZXldLFxuICAgICAgICAgICAgICBwcmVmaXggPSBfbm9ybWFsaXplZCRrZXkucHJlZml4LFxuICAgICAgICAgICAgICBpY29uTmFtZSA9IF9ub3JtYWxpemVkJGtleS5pY29uTmFtZSxcbiAgICAgICAgICAgICAgaWNvbiA9IF9ub3JtYWxpemVkJGtleS5pY29uO1xuICAgICAgICAgIGlmICghYWRkaXRpb25zW3ByZWZpeF0pIGFkZGl0aW9uc1twcmVmaXhdID0ge307XG4gICAgICAgICAgYWRkaXRpb25zW3ByZWZpeF1baWNvbk5hbWVdID0gaWNvbjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBhZGRpdGlvbnM7XG4gICAgICB9XG4gICAgfV0pO1xuXG4gICAgcmV0dXJuIExpYnJhcnk7XG4gIH0oKTtcblxuICBmdW5jdGlvbiBwcmVwSWNvbihpY29uKSB7XG4gICAgdmFyIHdpZHRoID0gaWNvblswXTtcbiAgICB2YXIgaGVpZ2h0ID0gaWNvblsxXTtcbiAgICB2YXIgdmVjdG9yRGF0YSA9IGljb24uc2xpY2UoNCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZvdW5kOiB0cnVlLFxuICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICBpY29uOiB7XG4gICAgICAgIHRhZzogJ3BhdGgnLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgZmlsbDogJ2N1cnJlbnRDb2xvcicsXG4gICAgICAgICAgZDogdmVjdG9yRGF0YVswXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVuc3VyZUNzcygpIHtcbiAgICBpZiAoY29uZmlnLmF1dG9BZGRDc3MgJiYgIV9jc3NJbnNlcnRlZCkge1xuICAgICAgaW5zZXJ0Q3NzKGNzcygpKTtcblxuICAgICAgX2Nzc0luc2VydGVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBhcGlPYmplY3QodmFsLCBhYnN0cmFjdENyZWF0b3IpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodmFsLCAnYWJzdHJhY3QnLCB7XG4gICAgICBnZXQ6IGFic3RyYWN0Q3JlYXRvclxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh2YWwsICdodG1sJywge1xuICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiB2YWwuYWJzdHJhY3QubWFwKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgcmV0dXJuIHRvSHRtbChhKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHZhbCwgJ25vZGUnLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgaWYgKCFJU19ET00pIHJldHVybjtcbiAgICAgICAgdmFyIGNvbnRhaW5lciA9IERPQ1VNRU5ULmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gdmFsLmh0bWw7XG4gICAgICAgIHJldHVybiBjb250YWluZXIuY2hpbGRyZW47XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHZhbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRJY29uRGVmaW5pdGlvbihwYXJhbXMpIHtcbiAgICB2YXIgX3BhcmFtcyRwcmVmaXggPSBwYXJhbXMucHJlZml4LFxuICAgICAgICBwcmVmaXggPSBfcGFyYW1zJHByZWZpeCA9PT0gdm9pZCAwID8gJ2ZhJyA6IF9wYXJhbXMkcHJlZml4LFxuICAgICAgICBpY29uTmFtZSA9IHBhcmFtcy5pY29uTmFtZTtcbiAgICBpZiAoIWljb25OYW1lKSByZXR1cm47XG4gICAgcmV0dXJuIGljb25Gcm9tTWFwcGluZyhsaWJyYXJ5LmRlZmluaXRpb25zLCBwcmVmaXgsIGljb25OYW1lKSB8fCBpY29uRnJvbU1hcHBpbmcobmFtZXNwYWNlLnN0eWxlcywgcHJlZml4LCBpY29uTmFtZSk7XG4gIH1cblxuICBmdW5jdGlvbiByZXNvbHZlSWNvbnMobmV4dCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAobWF5YmVJY29uRGVmaW5pdGlvbikge1xuICAgICAgdmFyIHBhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG4gICAgICB2YXIgaWNvbkRlZmluaXRpb24gPSAobWF5YmVJY29uRGVmaW5pdGlvbiB8fCB7fSkuaWNvbiA/IG1heWJlSWNvbkRlZmluaXRpb24gOiBmaW5kSWNvbkRlZmluaXRpb24obWF5YmVJY29uRGVmaW5pdGlvbiB8fCB7fSk7XG4gICAgICB2YXIgbWFzayA9IHBhcmFtcy5tYXNrO1xuXG4gICAgICBpZiAobWFzaykge1xuICAgICAgICBtYXNrID0gKG1hc2sgfHwge30pLmljb24gPyBtYXNrIDogZmluZEljb25EZWZpbml0aW9uKG1hc2sgfHwge30pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV4dChpY29uRGVmaW5pdGlvbiwgX29iamVjdFNwcmVhZCh7fSwgcGFyYW1zLCB7XG4gICAgICAgIG1hc2s6IG1hc2tcbiAgICAgIH0pKTtcbiAgICB9O1xuICB9XG5cbiAgdmFyIGxpYnJhcnkgPSBuZXcgTGlicmFyeSgpO1xuICB2YXIgbm9BdXRvID0gZnVuY3Rpb24gbm9BdXRvKCkge1xuICAgIGNvbmZpZy5hdXRvUmVwbGFjZVN2ZyA9IGZhbHNlO1xuICAgIGNvbmZpZy5vYnNlcnZlTXV0YXRpb25zID0gZmFsc2U7XG4gICAgZGlzY29ubmVjdCgpO1xuICB9O1xuICB2YXIgX2Nzc0luc2VydGVkID0gZmFsc2U7XG4gIHZhciBkb20gPSB7XG4gICAgaTJzdmc6IGZ1bmN0aW9uIGkyc3ZnKCkge1xuICAgICAgdmFyIHBhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG5cbiAgICAgIGlmIChJU19ET00pIHtcbiAgICAgICAgZW5zdXJlQ3NzKCk7XG4gICAgICAgIHZhciBfcGFyYW1zJG5vZGUgPSBwYXJhbXMubm9kZSxcbiAgICAgICAgICAgIG5vZGUgPSBfcGFyYW1zJG5vZGUgPT09IHZvaWQgMCA/IERPQ1VNRU5UIDogX3BhcmFtcyRub2RlLFxuICAgICAgICAgICAgX3BhcmFtcyRjYWxsYmFjayA9IHBhcmFtcy5jYWxsYmFjayxcbiAgICAgICAgICAgIGNhbGxiYWNrID0gX3BhcmFtcyRjYWxsYmFjayA9PT0gdm9pZCAwID8gZnVuY3Rpb24gKCkge30gOiBfcGFyYW1zJGNhbGxiYWNrO1xuXG4gICAgICAgIGlmIChjb25maWcuc2VhcmNoUHNldWRvRWxlbWVudHMpIHtcbiAgICAgICAgICBzZWFyY2hQc2V1ZG9FbGVtZW50cyhub2RlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9uVHJlZShub2RlLCBjYWxsYmFjayk7XG4gICAgICB9XG4gICAgfSxcbiAgICBjc3M6IGNzcyxcbiAgICBpbnNlcnRDc3M6IGZ1bmN0aW9uIGluc2VydENzcyQkMSgpIHtcbiAgICAgIGlmICghX2Nzc0luc2VydGVkKSB7XG4gICAgICAgIGluc2VydENzcyhjc3MoKSk7XG5cbiAgICAgICAgX2Nzc0luc2VydGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHdhdGNoOiBmdW5jdGlvbiB3YXRjaCgpIHtcbiAgICAgIHZhciBwYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICAgICAgdmFyIGF1dG9SZXBsYWNlU3ZnUm9vdCA9IHBhcmFtcy5hdXRvUmVwbGFjZVN2Z1Jvb3QsXG4gICAgICAgICAgb2JzZXJ2ZU11dGF0aW9uc1Jvb3QgPSBwYXJhbXMub2JzZXJ2ZU11dGF0aW9uc1Jvb3Q7XG5cbiAgICAgIGlmIChjb25maWcuYXV0b1JlcGxhY2VTdmcgPT09IGZhbHNlKSB7XG4gICAgICAgIGNvbmZpZy5hdXRvUmVwbGFjZVN2ZyA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGNvbmZpZy5vYnNlcnZlTXV0YXRpb25zID0gdHJ1ZTtcbiAgICAgIGRvbXJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYXV0b1JlcGxhY2Uoe1xuICAgICAgICAgIGF1dG9SZXBsYWNlU3ZnUm9vdDogYXV0b1JlcGxhY2VTdmdSb290XG4gICAgICAgIH0pO1xuICAgICAgICBvYnNlcnZlKHtcbiAgICAgICAgICB0cmVlQ2FsbGJhY2s6IG9uVHJlZSxcbiAgICAgICAgICBub2RlQ2FsbGJhY2s6IG9uTm9kZSxcbiAgICAgICAgICBwc2V1ZG9FbGVtZW50c0NhbGxiYWNrOiBzZWFyY2hQc2V1ZG9FbGVtZW50cyxcbiAgICAgICAgICBvYnNlcnZlTXV0YXRpb25zUm9vdDogb2JzZXJ2ZU11dGF0aW9uc1Jvb3RcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG4gIHZhciBwYXJzZSA9IHtcbiAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uIHRyYW5zZm9ybSh0cmFuc2Zvcm1TdHJpbmcpIHtcbiAgICAgIHJldHVybiBwYXJzZVRyYW5zZm9ybVN0cmluZyh0cmFuc2Zvcm1TdHJpbmcpO1xuICAgIH1cbiAgfTtcbiAgdmFyIGljb24gPSByZXNvbHZlSWNvbnMoZnVuY3Rpb24gKGljb25EZWZpbml0aW9uKSB7XG4gICAgdmFyIHBhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG4gICAgdmFyIF9wYXJhbXMkdHJhbnNmb3JtID0gcGFyYW1zLnRyYW5zZm9ybSxcbiAgICAgICAgdHJhbnNmb3JtID0gX3BhcmFtcyR0cmFuc2Zvcm0gPT09IHZvaWQgMCA/IG1lYW5pbmdsZXNzVHJhbnNmb3JtIDogX3BhcmFtcyR0cmFuc2Zvcm0sXG4gICAgICAgIF9wYXJhbXMkc3ltYm9sID0gcGFyYW1zLnN5bWJvbCxcbiAgICAgICAgc3ltYm9sID0gX3BhcmFtcyRzeW1ib2wgPT09IHZvaWQgMCA/IGZhbHNlIDogX3BhcmFtcyRzeW1ib2wsXG4gICAgICAgIF9wYXJhbXMkbWFzayA9IHBhcmFtcy5tYXNrLFxuICAgICAgICBtYXNrID0gX3BhcmFtcyRtYXNrID09PSB2b2lkIDAgPyBudWxsIDogX3BhcmFtcyRtYXNrLFxuICAgICAgICBfcGFyYW1zJHRpdGxlID0gcGFyYW1zLnRpdGxlLFxuICAgICAgICB0aXRsZSA9IF9wYXJhbXMkdGl0bGUgPT09IHZvaWQgMCA/IG51bGwgOiBfcGFyYW1zJHRpdGxlLFxuICAgICAgICBfcGFyYW1zJGNsYXNzZXMgPSBwYXJhbXMuY2xhc3NlcyxcbiAgICAgICAgY2xhc3NlcyA9IF9wYXJhbXMkY2xhc3NlcyA9PT0gdm9pZCAwID8gW10gOiBfcGFyYW1zJGNsYXNzZXMsXG4gICAgICAgIF9wYXJhbXMkYXR0cmlidXRlcyA9IHBhcmFtcy5hdHRyaWJ1dGVzLFxuICAgICAgICBhdHRyaWJ1dGVzID0gX3BhcmFtcyRhdHRyaWJ1dGVzID09PSB2b2lkIDAgPyB7fSA6IF9wYXJhbXMkYXR0cmlidXRlcyxcbiAgICAgICAgX3BhcmFtcyRzdHlsZXMgPSBwYXJhbXMuc3R5bGVzLFxuICAgICAgICBzdHlsZXMgPSBfcGFyYW1zJHN0eWxlcyA9PT0gdm9pZCAwID8ge30gOiBfcGFyYW1zJHN0eWxlcztcbiAgICBpZiAoIWljb25EZWZpbml0aW9uKSByZXR1cm47XG4gICAgdmFyIHByZWZpeCA9IGljb25EZWZpbml0aW9uLnByZWZpeCxcbiAgICAgICAgaWNvbk5hbWUgPSBpY29uRGVmaW5pdGlvbi5pY29uTmFtZSxcbiAgICAgICAgaWNvbiA9IGljb25EZWZpbml0aW9uLmljb247XG4gICAgcmV0dXJuIGFwaU9iamVjdChfb2JqZWN0U3ByZWFkKHtcbiAgICAgIHR5cGU6ICdpY29uJ1xuICAgIH0sIGljb25EZWZpbml0aW9uKSwgZnVuY3Rpb24gKCkge1xuICAgICAgZW5zdXJlQ3NzKCk7XG5cbiAgICAgIGlmIChjb25maWcuYXV0b0ExMXkpIHtcbiAgICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgICAgYXR0cmlidXRlc1snYXJpYS1sYWJlbGxlZGJ5J10gPSBcIlwiLmNvbmNhdChjb25maWcucmVwbGFjZW1lbnRDbGFzcywgXCItdGl0bGUtXCIpLmNvbmNhdChuZXh0VW5pcXVlSWQoKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXR0cmlidXRlc1snYXJpYS1oaWRkZW4nXSA9ICd0cnVlJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbWFrZUlubGluZVN2Z0Fic3RyYWN0KHtcbiAgICAgICAgaWNvbnM6IHtcbiAgICAgICAgICBtYWluOiBwcmVwSWNvbihpY29uKSxcbiAgICAgICAgICBtYXNrOiBtYXNrID8gcHJlcEljb24obWFzay5pY29uKSA6IHtcbiAgICAgICAgICAgIGZvdW5kOiBmYWxzZSxcbiAgICAgICAgICAgIHdpZHRoOiBudWxsLFxuICAgICAgICAgICAgaGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgaWNvbjoge31cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHByZWZpeDogcHJlZml4LFxuICAgICAgICBpY29uTmFtZTogaWNvbk5hbWUsXG4gICAgICAgIHRyYW5zZm9ybTogX29iamVjdFNwcmVhZCh7fSwgbWVhbmluZ2xlc3NUcmFuc2Zvcm0sIHRyYW5zZm9ybSksXG4gICAgICAgIHN5bWJvbDogc3ltYm9sLFxuICAgICAgICB0aXRsZTogdGl0bGUsXG4gICAgICAgIGV4dHJhOiB7XG4gICAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlcyxcbiAgICAgICAgICBzdHlsZXM6IHN0eWxlcyxcbiAgICAgICAgICBjbGFzc2VzOiBjbGFzc2VzXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbiAgdmFyIHRleHQgPSBmdW5jdGlvbiB0ZXh0KGNvbnRlbnQpIHtcbiAgICB2YXIgcGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTtcbiAgICB2YXIgX3BhcmFtcyR0cmFuc2Zvcm0yID0gcGFyYW1zLnRyYW5zZm9ybSxcbiAgICAgICAgdHJhbnNmb3JtID0gX3BhcmFtcyR0cmFuc2Zvcm0yID09PSB2b2lkIDAgPyBtZWFuaW5nbGVzc1RyYW5zZm9ybSA6IF9wYXJhbXMkdHJhbnNmb3JtMixcbiAgICAgICAgX3BhcmFtcyR0aXRsZTIgPSBwYXJhbXMudGl0bGUsXG4gICAgICAgIHRpdGxlID0gX3BhcmFtcyR0aXRsZTIgPT09IHZvaWQgMCA/IG51bGwgOiBfcGFyYW1zJHRpdGxlMixcbiAgICAgICAgX3BhcmFtcyRjbGFzc2VzMiA9IHBhcmFtcy5jbGFzc2VzLFxuICAgICAgICBjbGFzc2VzID0gX3BhcmFtcyRjbGFzc2VzMiA9PT0gdm9pZCAwID8gW10gOiBfcGFyYW1zJGNsYXNzZXMyLFxuICAgICAgICBfcGFyYW1zJGF0dHJpYnV0ZXMyID0gcGFyYW1zLmF0dHJpYnV0ZXMsXG4gICAgICAgIGF0dHJpYnV0ZXMgPSBfcGFyYW1zJGF0dHJpYnV0ZXMyID09PSB2b2lkIDAgPyB7fSA6IF9wYXJhbXMkYXR0cmlidXRlczIsXG4gICAgICAgIF9wYXJhbXMkc3R5bGVzMiA9IHBhcmFtcy5zdHlsZXMsXG4gICAgICAgIHN0eWxlcyA9IF9wYXJhbXMkc3R5bGVzMiA9PT0gdm9pZCAwID8ge30gOiBfcGFyYW1zJHN0eWxlczI7XG4gICAgcmV0dXJuIGFwaU9iamVjdCh7XG4gICAgICB0eXBlOiAndGV4dCcsXG4gICAgICBjb250ZW50OiBjb250ZW50XG4gICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgZW5zdXJlQ3NzKCk7XG4gICAgICByZXR1cm4gbWFrZUxheWVyc1RleHRBYnN0cmFjdCh7XG4gICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsXG4gICAgICAgIHRyYW5zZm9ybTogX29iamVjdFNwcmVhZCh7fSwgbWVhbmluZ2xlc3NUcmFuc2Zvcm0sIHRyYW5zZm9ybSksXG4gICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgZXh0cmE6IHtcbiAgICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyaWJ1dGVzLFxuICAgICAgICAgIHN0eWxlczogc3R5bGVzLFxuICAgICAgICAgIGNsYXNzZXM6IFtcIlwiLmNvbmNhdChjb25maWcuZmFtaWx5UHJlZml4LCBcIi1sYXllcnMtdGV4dFwiKV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShjbGFzc2VzKSlcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIHZhciBjb3VudGVyID0gZnVuY3Rpb24gY291bnRlcihjb250ZW50KSB7XG4gICAgdmFyIHBhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG4gICAgdmFyIF9wYXJhbXMkdGl0bGUzID0gcGFyYW1zLnRpdGxlLFxuICAgICAgICB0aXRsZSA9IF9wYXJhbXMkdGl0bGUzID09PSB2b2lkIDAgPyBudWxsIDogX3BhcmFtcyR0aXRsZTMsXG4gICAgICAgIF9wYXJhbXMkY2xhc3NlczMgPSBwYXJhbXMuY2xhc3NlcyxcbiAgICAgICAgY2xhc3NlcyA9IF9wYXJhbXMkY2xhc3NlczMgPT09IHZvaWQgMCA/IFtdIDogX3BhcmFtcyRjbGFzc2VzMyxcbiAgICAgICAgX3BhcmFtcyRhdHRyaWJ1dGVzMyA9IHBhcmFtcy5hdHRyaWJ1dGVzLFxuICAgICAgICBhdHRyaWJ1dGVzID0gX3BhcmFtcyRhdHRyaWJ1dGVzMyA9PT0gdm9pZCAwID8ge30gOiBfcGFyYW1zJGF0dHJpYnV0ZXMzLFxuICAgICAgICBfcGFyYW1zJHN0eWxlczMgPSBwYXJhbXMuc3R5bGVzLFxuICAgICAgICBzdHlsZXMgPSBfcGFyYW1zJHN0eWxlczMgPT09IHZvaWQgMCA/IHt9IDogX3BhcmFtcyRzdHlsZXMzO1xuICAgIHJldHVybiBhcGlPYmplY3Qoe1xuICAgICAgdHlwZTogJ2NvdW50ZXInLFxuICAgICAgY29udGVudDogY29udGVudFxuICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgIGVuc3VyZUNzcygpO1xuICAgICAgcmV0dXJuIG1ha2VMYXllcnNDb3VudGVyQWJzdHJhY3Qoe1xuICAgICAgICBjb250ZW50OiBjb250ZW50LnRvU3RyaW5nKCksXG4gICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgZXh0cmE6IHtcbiAgICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyaWJ1dGVzLFxuICAgICAgICAgIHN0eWxlczogc3R5bGVzLFxuICAgICAgICAgIGNsYXNzZXM6IFtcIlwiLmNvbmNhdChjb25maWcuZmFtaWx5UHJlZml4LCBcIi1sYXllcnMtY291bnRlclwiKV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShjbGFzc2VzKSlcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIHZhciBsYXllciA9IGZ1bmN0aW9uIGxheWVyKGFzc2VtYmxlcikge1xuICAgIHJldHVybiBhcGlPYmplY3Qoe1xuICAgICAgdHlwZTogJ2xheWVyJ1xuICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgIGVuc3VyZUNzcygpO1xuICAgICAgdmFyIGNoaWxkcmVuID0gW107XG4gICAgICBhc3NlbWJsZXIoZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgQXJyYXkuaXNBcnJheShhcmdzKSA/IGFyZ3MubWFwKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5jb25jYXQoYS5hYnN0cmFjdCk7XG4gICAgICAgIH0pIDogY2hpbGRyZW4gPSBjaGlsZHJlbi5jb25jYXQoYXJncy5hYnN0cmFjdCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbe1xuICAgICAgICB0YWc6ICdzcGFuJyxcbiAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgIGNsYXNzOiBcIlwiLmNvbmNhdChjb25maWcuZmFtaWx5UHJlZml4LCBcIi1sYXllcnNcIilcbiAgICAgICAgfSxcbiAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuXG4gICAgICB9XTtcbiAgICB9KTtcbiAgfTtcbiAgdmFyIGFwaSA9IHtcbiAgICBub0F1dG86IG5vQXV0byxcbiAgICBjb25maWc6IGNvbmZpZyxcbiAgICBkb206IGRvbSxcbiAgICBsaWJyYXJ5OiBsaWJyYXJ5LFxuICAgIHBhcnNlOiBwYXJzZSxcbiAgICBmaW5kSWNvbkRlZmluaXRpb246IGZpbmRJY29uRGVmaW5pdGlvbixcbiAgICBpY29uOiBpY29uLFxuICAgIHRleHQ6IHRleHQsXG4gICAgY291bnRlcjogY291bnRlcixcbiAgICBsYXllcjogbGF5ZXIsXG4gICAgdG9IdG1sOiB0b0h0bWxcbiAgfTtcblxuICB2YXIgYXV0b1JlcGxhY2UgPSBmdW5jdGlvbiBhdXRvUmVwbGFjZSgpIHtcbiAgICB2YXIgcGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTtcbiAgICB2YXIgX3BhcmFtcyRhdXRvUmVwbGFjZVN2ID0gcGFyYW1zLmF1dG9SZXBsYWNlU3ZnUm9vdCxcbiAgICAgICAgYXV0b1JlcGxhY2VTdmdSb290ID0gX3BhcmFtcyRhdXRvUmVwbGFjZVN2ID09PSB2b2lkIDAgPyBET0NVTUVOVCA6IF9wYXJhbXMkYXV0b1JlcGxhY2VTdjtcbiAgICBpZiAoT2JqZWN0LmtleXMobmFtZXNwYWNlLnN0eWxlcykubGVuZ3RoID4gMCAmJiBJU19ET00gJiYgY29uZmlnLmF1dG9SZXBsYWNlU3ZnKSBhcGkuZG9tLmkyc3ZnKHtcbiAgICAgIG5vZGU6IGF1dG9SZXBsYWNlU3ZnUm9vdFxuICAgIH0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGJvb3RzdHJhcCgpIHtcbiAgICBpZiAoSVNfQlJPV1NFUikge1xuICAgICAgaWYgKCFXSU5ET1cuRm9udEF3ZXNvbWUpIHtcbiAgICAgICAgV0lORE9XLkZvbnRBd2Vzb21lID0gYXBpO1xuICAgICAgfVxuXG4gICAgICBkb21yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGF1dG9SZXBsYWNlKCk7XG4gICAgICAgIG9ic2VydmUoe1xuICAgICAgICAgIHRyZWVDYWxsYmFjazogb25UcmVlLFxuICAgICAgICAgIG5vZGVDYWxsYmFjazogb25Ob2RlLFxuICAgICAgICAgIHBzZXVkb0VsZW1lbnRzQ2FsbGJhY2s6IHNlYXJjaFBzZXVkb0VsZW1lbnRzXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmFtZXNwYWNlLmhvb2tzID0gX29iamVjdFNwcmVhZCh7fSwgbmFtZXNwYWNlLmhvb2tzLCB7XG4gICAgICBhZGRQYWNrOiBmdW5jdGlvbiBhZGRQYWNrKHByZWZpeCwgaWNvbnMpIHtcbiAgICAgICAgbmFtZXNwYWNlLnN0eWxlc1twcmVmaXhdID0gX29iamVjdFNwcmVhZCh7fSwgbmFtZXNwYWNlLnN0eWxlc1twcmVmaXhdIHx8IHt9LCBpY29ucyk7XG4gICAgICAgIGJ1aWxkKCk7XG4gICAgICAgIGF1dG9SZXBsYWNlKCk7XG4gICAgICB9LFxuICAgICAgYWRkU2hpbXM6IGZ1bmN0aW9uIGFkZFNoaW1zKHNoaW1zKSB7XG4gICAgICAgIHZhciBfbmFtZXNwYWNlJHNoaW1zO1xuXG4gICAgICAgIChfbmFtZXNwYWNlJHNoaW1zID0gbmFtZXNwYWNlLnNoaW1zKS5wdXNoLmFwcGx5KF9uYW1lc3BhY2Ukc2hpbXMsIF90b0NvbnN1bWFibGVBcnJheShzaGltcykpO1xuXG4gICAgICAgIGJ1aWxkKCk7XG4gICAgICAgIGF1dG9SZXBsYWNlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBidW5rZXIoYm9vdHN0cmFwKTtcblxufSgpKTtcbiIsIi8vIGV4dHJhY3RlZCBieSBtaW5pLWNzcy1leHRyYWN0LXBsdWdpbiIsIi8vIEZpbmUgVXBsb2FkZXIgNS4xNi4yIC0gTUlUIGxpY2Vuc2VkLiBodHRwOi8vZmluZXVwbG9hZGVyLmNvbVxuKGZ1bmN0aW9uKGdsb2JhbCkge1xuICAgIHZhciBxcSA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhdHRhY2g6IGZ1bmN0aW9uKHR5cGUsIGZuKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZm4sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuYXR0YWNoRXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRhY2hFdmVudChcIm9uXCIgKyB0eXBlLCBmbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoZWxlbWVudCkuZGV0YWNoKHR5cGUsIGZuKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRldGFjaDogZnVuY3Rpb24odHlwZSwgZm4pIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmbiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5hdHRhY2hFdmVudCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmRldGFjaEV2ZW50KFwib25cIiArIHR5cGUsIGZuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udGFpbnM6IGZ1bmN0aW9uKGRlc2NlbmRhbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWRlc2NlbmRhbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCA9PT0gZGVzY2VuZGFudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY29udGFpbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuY29udGFpbnMoZGVzY2VuZGFudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhKGRlc2NlbmRhbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24oZWxlbWVudCkgJiA4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5zZXJ0QmVmb3JlOiBmdW5jdGlvbihlbGVtZW50Qikge1xuICAgICAgICAgICAgICAgIGVsZW1lbnRCLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW1lbnQsIGVsZW1lbnRCKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjc3M6IGZ1bmN0aW9uKHN0eWxlcykge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnN0eWxlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHFxLkVycm9yKFwiQ2FuJ3QgYXBwbHkgc3R5bGUgdG8gbm9kZSBhcyBpdCBpcyBub3Qgb24gdGhlIEhUTUxFbGVtZW50IHByb3RvdHlwZSBjaGFpbiFcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzdHlsZXMub3BhY2l0eSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWxlbWVudC5zdHlsZS5vcGFjaXR5ICE9PSBcInN0cmluZ1wiICYmIHR5cGVvZiBlbGVtZW50LmZpbHRlcnMgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcy5maWx0ZXIgPSBcImFscGhhKG9wYWNpdHk9XCIgKyBNYXRoLnJvdW5kKDEwMCAqIHN0eWxlcy5vcGFjaXR5KSArIFwiKVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHFxLmV4dGVuZChlbGVtZW50LnN0eWxlLCBzdHlsZXMpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhc0NsYXNzOiBmdW5jdGlvbihuYW1lLCBjb25zaWRlclBhcmVudCkge1xuICAgICAgICAgICAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAoXCIoXnwgKVwiICsgbmFtZSArIFwiKCB8JClcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlLnRlc3QoZWxlbWVudC5jbGFzc05hbWUpIHx8ICEhKGNvbnNpZGVyUGFyZW50ICYmIHJlLnRlc3QoZWxlbWVudC5wYXJlbnROb2RlLmNsYXNzTmFtZSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZENsYXNzOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFxcShlbGVtZW50KS5oYXNDbGFzcyhuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSArPSBcIiBcIiArIG5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbW92ZUNsYXNzOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChcIihefCApXCIgKyBuYW1lICsgXCIoIHwkKVwiKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGVsZW1lbnQuY2xhc3NOYW1lLnJlcGxhY2UocmUsIFwiIFwiKS5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCBcIlwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRCeUNsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUsIGZpcnN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhbmRpZGF0ZXMsIHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgICAgIGlmIChmaXJzdCAmJiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5cIiArIGNsYXNzTmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5cIiArIGNsYXNzTmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhbmRpZGF0ZXMgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGNhbmRpZGF0ZXMsIGZ1bmN0aW9uKGlkeCwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcSh2YWwpLmhhc0NsYXNzKGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyc3QgPyByZXN1bHRbMF0gOiByZXN1bHQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Rmlyc3RCeUNsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWxlbWVudCkuZ2V0QnlDbGFzcyhjbGFzc05hbWUsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBbXSwgY2hpbGQgPSBlbGVtZW50LmZpcnN0Q2hpbGQ7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGNoaWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBjaGlsZC5uZXh0U2libGluZztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVuO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFRleHQ6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVyVGV4dCA9IHRleHQ7XG4gICAgICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xlYXJUZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWxlbWVudCkuc2V0VGV4dChcIlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXNBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJOYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJWYWw7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuaGFzQXR0cmlidXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZWxlbWVudC5oYXNBdHRyaWJ1dGUoYXR0ck5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC9eZmFsc2UkL2kuZXhlYyhlbGVtZW50LmdldEF0dHJpYnV0ZShhdHRyTmFtZSkpID09IG51bGw7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYXR0clZhbCA9IGVsZW1lbnRbYXR0ck5hbWVdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXR0clZhbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC9eZmFsc2UkL2kuZXhlYyhhdHRyVmFsKSA9PSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHFxLmNhbnZhc1RvQmxvYiA9IGZ1bmN0aW9uKGNhbnZhcywgbWltZSwgcXVhbGl0eSkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmRhdGFVcmlUb0Jsb2IoY2FudmFzLnRvRGF0YVVSTChtaW1lLCBxdWFsaXR5KSk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmRhdGFVcmlUb0Jsb2IgPSBmdW5jdGlvbihkYXRhVXJpKSB7XG4gICAgICAgICAgICB2YXIgYXJyYXlCdWZmZXIsIGJ5dGVTdHJpbmcsIGNyZWF0ZUJsb2IgPSBmdW5jdGlvbihkYXRhLCBtaW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIEJsb2JCdWlsZGVyID0gd2luZG93LkJsb2JCdWlsZGVyIHx8IHdpbmRvdy5XZWJLaXRCbG9iQnVpbGRlciB8fCB3aW5kb3cuTW96QmxvYkJ1aWxkZXIgfHwgd2luZG93Lk1TQmxvYkJ1aWxkZXIsIGJsb2JCdWlsZGVyID0gQmxvYkJ1aWxkZXIgJiYgbmV3IEJsb2JCdWlsZGVyKCk7XG4gICAgICAgICAgICAgICAgaWYgKGJsb2JCdWlsZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2JCdWlsZGVyLmFwcGVuZChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJsb2JCdWlsZGVyLmdldEJsb2IobWltZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9iKFsgZGF0YSBdLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBtaW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGludEFycmF5LCBtaW1lU3RyaW5nO1xuICAgICAgICAgICAgaWYgKGRhdGFVcmkuc3BsaXQoXCIsXCIpWzBdLmluZGV4T2YoXCJiYXNlNjRcIikgPj0gMCkge1xuICAgICAgICAgICAgICAgIGJ5dGVTdHJpbmcgPSBhdG9iKGRhdGFVcmkuc3BsaXQoXCIsXCIpWzFdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYnl0ZVN0cmluZyA9IGRlY29kZVVSSShkYXRhVXJpLnNwbGl0KFwiLFwiKVsxXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtaW1lU3RyaW5nID0gZGF0YVVyaS5zcGxpdChcIixcIilbMF0uc3BsaXQoXCI6XCIpWzFdLnNwbGl0KFwiO1wiKVswXTtcbiAgICAgICAgICAgIGFycmF5QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKGJ5dGVTdHJpbmcubGVuZ3RoKTtcbiAgICAgICAgICAgIGludEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpO1xuICAgICAgICAgICAgcXEuZWFjaChieXRlU3RyaW5nLCBmdW5jdGlvbihpZHgsIGNoYXJhY3Rlcikge1xuICAgICAgICAgICAgICAgIGludEFycmF5W2lkeF0gPSBjaGFyYWN0ZXIuY2hhckNvZGVBdCgwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUJsb2IoYXJyYXlCdWZmZXIsIG1pbWVTdHJpbmcpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5sb2cgPSBmdW5jdGlvbihtZXNzYWdlLCBsZXZlbCkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5jb25zb2xlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFsZXZlbCB8fCBsZXZlbCA9PT0gXCJpbmZvXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuY29uc29sZVtsZXZlbF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlW2xldmVsXShtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhcIjxcIiArIGxldmVsICsgXCI+IFwiICsgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzT2JqZWN0ID0gZnVuY3Rpb24odmFyaWFibGUpIHtcbiAgICAgICAgICAgIHJldHVybiB2YXJpYWJsZSAmJiAhdmFyaWFibGUubm9kZVR5cGUgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhcmlhYmxlKSA9PT0gXCJbb2JqZWN0IE9iamVjdF1cIjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNGdW5jdGlvbiA9IGZ1bmN0aW9uKHZhcmlhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIHZhcmlhYmxlID09PSBcImZ1bmN0aW9uXCI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzQXJyYXkgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09IFwiW29iamVjdCBBcnJheV1cIiB8fCB2YWx1ZSAmJiB3aW5kb3cuQXJyYXlCdWZmZXIgJiYgdmFsdWUuYnVmZmVyICYmIHZhbHVlLmJ1ZmZlci5jb25zdHJ1Y3RvciA9PT0gQXJyYXlCdWZmZXI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzSXRlbUxpc3QgPSBmdW5jdGlvbihtYXliZUl0ZW1MaXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1heWJlSXRlbUxpc3QpID09PSBcIltvYmplY3QgRGF0YVRyYW5zZmVySXRlbUxpc3RdXCI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzTm9kZUxpc3QgPSBmdW5jdGlvbihtYXliZU5vZGVMaXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1heWJlTm9kZUxpc3QpID09PSBcIltvYmplY3QgTm9kZUxpc3RdXCIgfHwgbWF5YmVOb2RlTGlzdC5pdGVtICYmIG1heWJlTm9kZUxpc3QubmFtZWRJdGVtO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc1N0cmluZyA9IGZ1bmN0aW9uKG1heWJlU3RyaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1heWJlU3RyaW5nKSA9PT0gXCJbb2JqZWN0IFN0cmluZ11cIjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEudHJpbVN0ciA9IGZ1bmN0aW9uKHN0cmluZykge1xuICAgICAgICAgICAgaWYgKFN0cmluZy5wcm90b3R5cGUudHJpbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmcudHJpbSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCBcIlwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZm9ybWF0ID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIG5ld1N0ciA9IHN0ciwgbmV4dElkeFRvUmVwbGFjZSA9IG5ld1N0ci5pbmRleE9mKFwie31cIik7XG4gICAgICAgICAgICBxcS5lYWNoKGFyZ3MsIGZ1bmN0aW9uKGlkeCwgdmFsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0ckJlZm9yZSA9IG5ld1N0ci5zdWJzdHJpbmcoMCwgbmV4dElkeFRvUmVwbGFjZSksIHN0ckFmdGVyID0gbmV3U3RyLnN1YnN0cmluZyhuZXh0SWR4VG9SZXBsYWNlICsgMik7XG4gICAgICAgICAgICAgICAgbmV3U3RyID0gc3RyQmVmb3JlICsgdmFsICsgc3RyQWZ0ZXI7XG4gICAgICAgICAgICAgICAgbmV4dElkeFRvUmVwbGFjZSA9IG5ld1N0ci5pbmRleE9mKFwie31cIiwgbmV4dElkeFRvUmVwbGFjZSArIHZhbC5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0SWR4VG9SZXBsYWNlIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3U3RyO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc0ZpbGUgPSBmdW5jdGlvbihtYXliZUZpbGUpIHtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuRmlsZSAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWF5YmVGaWxlKSA9PT0gXCJbb2JqZWN0IEZpbGVdXCI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzRmlsZUxpc3QgPSBmdW5jdGlvbihtYXliZUZpbGVMaXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93LkZpbGVMaXN0ICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtYXliZUZpbGVMaXN0KSA9PT0gXCJbb2JqZWN0IEZpbGVMaXN0XVwiO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc0ZpbGVPcklucHV0ID0gZnVuY3Rpb24obWF5YmVGaWxlT3JJbnB1dCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmlzRmlsZShtYXliZUZpbGVPcklucHV0KSB8fCBxcS5pc0lucHV0KG1heWJlRmlsZU9ySW5wdXQpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc0lucHV0ID0gZnVuY3Rpb24obWF5YmVJbnB1dCwgbm90RmlsZSkge1xuICAgICAgICAgICAgdmFyIGV2YWx1YXRlVHlwZSA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbm9ybWFsaXplZFR5cGUgPSB0eXBlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKG5vdEZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRUeXBlICE9PSBcImZpbGVcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRUeXBlID09PSBcImZpbGVcIjtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAod2luZG93LkhUTUxJbnB1dEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1heWJlSW5wdXQpID09PSBcIltvYmplY3QgSFRNTElucHV0RWxlbWVudF1cIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAobWF5YmVJbnB1dC50eXBlICYmIGV2YWx1YXRlVHlwZShtYXliZUlucHV0LnR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtYXliZUlucHV0LnRhZ05hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAobWF5YmVJbnB1dC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiaW5wdXRcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAobWF5YmVJbnB1dC50eXBlICYmIGV2YWx1YXRlVHlwZShtYXliZUlucHV0LnR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNCbG9iID0gZnVuY3Rpb24obWF5YmVCbG9iKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LkJsb2IgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1heWJlQmxvYikgPT09IFwiW29iamVjdCBCbG9iXVwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzWGhyVXBsb2FkU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgICAgICAgICBpbnB1dC50eXBlID0gXCJmaWxlXCI7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQubXVsdGlwbGUgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgRmlsZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgRm9ybURhdGEgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIHFxLmNyZWF0ZVhockluc3RhbmNlKCkudXBsb2FkICE9PSBcInVuZGVmaW5lZFwiO1xuICAgICAgICB9O1xuICAgICAgICBxcS5jcmVhdGVYaHJJbnN0YW5jZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KFwiTVNYTUwyLlhNTEhUVFAuMy4wXCIpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBxcS5sb2coXCJOZWl0aGVyIFhIUiBvciBBY3RpdmVYIGFyZSBzdXBwb3J0ZWQhXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzRm9sZGVyRHJvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uKGRhdGFUcmFuc2Zlcikge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGFUcmFuc2Zlci5pdGVtcyAmJiBkYXRhVHJhbnNmZXIuaXRlbXMubGVuZ3RoID4gMCAmJiBkYXRhVHJhbnNmZXIuaXRlbXNbMF0ud2Via2l0R2V0QXNFbnRyeTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNGaWxlQ2h1bmtpbmdTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAhcXEuYW5kcm9pZFN0b2NrKCkgJiYgcXEuaXNYaHJVcGxvYWRTdXBwb3J0ZWQoKSAmJiAoRmlsZS5wcm90b3R5cGUuc2xpY2UgIT09IHVuZGVmaW5lZCB8fCBGaWxlLnByb3RvdHlwZS53ZWJraXRTbGljZSAhPT0gdW5kZWZpbmVkIHx8IEZpbGUucHJvdG90eXBlLm1velNsaWNlICE9PSB1bmRlZmluZWQpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5zbGljZUJsb2IgPSBmdW5jdGlvbihmaWxlT3JCbG9iLCBzdGFydCwgZW5kKSB7XG4gICAgICAgICAgICB2YXIgc2xpY2VyID0gZmlsZU9yQmxvYi5zbGljZSB8fCBmaWxlT3JCbG9iLm1velNsaWNlIHx8IGZpbGVPckJsb2Iud2Via2l0U2xpY2U7XG4gICAgICAgICAgICByZXR1cm4gc2xpY2VyLmNhbGwoZmlsZU9yQmxvYiwgc3RhcnQsIGVuZCk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmFycmF5QnVmZmVyVG9IZXggPSBmdW5jdGlvbihidWZmZXIpIHtcbiAgICAgICAgICAgIHZhciBieXRlc0FzSGV4ID0gXCJcIiwgYnl0ZXMgPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xuICAgICAgICAgICAgcXEuZWFjaChieXRlcywgZnVuY3Rpb24oaWR4LCBieXQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYnl0ZUFzSGV4U3RyID0gYnl0LnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgICAgICBpZiAoYnl0ZUFzSGV4U3RyLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgYnl0ZUFzSGV4U3RyID0gXCIwXCIgKyBieXRlQXNIZXhTdHI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJ5dGVzQXNIZXggKz0gYnl0ZUFzSGV4U3RyO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gYnl0ZXNBc0hleDtcbiAgICAgICAgfTtcbiAgICAgICAgcXEucmVhZEJsb2JUb0hleCA9IGZ1bmN0aW9uKGJsb2IsIHN0YXJ0T2Zmc2V0LCBsZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciBpbml0aWFsQmxvYiA9IHFxLnNsaWNlQmxvYihibG9iLCBzdGFydE9mZnNldCwgc3RhcnRPZmZzZXQgKyBsZW5ndGgpLCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKSwgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhxcS5hcnJheUJ1ZmZlclRvSGV4KGZpbGVSZWFkZXIucmVzdWx0KSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZmlsZVJlYWRlci5vbmVycm9yID0gcHJvbWlzZS5mYWlsdXJlO1xuICAgICAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihpbml0aWFsQmxvYik7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kID0gZnVuY3Rpb24oZmlyc3QsIHNlY29uZCwgZXh0ZW5kTmVzdGVkKSB7XG4gICAgICAgICAgICBxcS5lYWNoKHNlY29uZCwgZnVuY3Rpb24ocHJvcCwgdmFsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGV4dGVuZE5lc3RlZCAmJiBxcS5pc09iamVjdCh2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaXJzdFtwcm9wXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJzdFtwcm9wXSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHFxLmV4dGVuZChmaXJzdFtwcm9wXSwgdmFsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaXJzdFtwcm9wXSA9IHZhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmaXJzdDtcbiAgICAgICAgfTtcbiAgICAgICAgcXEub3ZlcnJpZGUgPSBmdW5jdGlvbih0YXJnZXQsIHNvdXJjZUZuKSB7XG4gICAgICAgICAgICB2YXIgc3VwZXJfID0ge30sIHNvdXJjZSA9IHNvdXJjZUZuKHN1cGVyXyk7XG4gICAgICAgICAgICBxcS5lYWNoKHNvdXJjZSwgZnVuY3Rpb24oc3JjUHJvcE5hbWUsIHNyY1Byb3BWYWwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0W3NyY1Byb3BOYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1cGVyX1tzcmNQcm9wTmFtZV0gPSB0YXJnZXRbc3JjUHJvcE5hbWVdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YXJnZXRbc3JjUHJvcE5hbWVdID0gc3JjUHJvcFZhbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaW5kZXhPZiA9IGZ1bmN0aW9uKGFyciwgZWx0LCBmcm9tKSB7XG4gICAgICAgICAgICBpZiAoYXJyLmluZGV4T2YpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyLmluZGV4T2YoZWx0LCBmcm9tKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZyb20gPSBmcm9tIHx8IDA7XG4gICAgICAgICAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDtcbiAgICAgICAgICAgIGlmIChmcm9tIDwgMCkge1xuICAgICAgICAgICAgICAgIGZyb20gKz0gbGVuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICg7ZnJvbSA8IGxlbjsgZnJvbSArPSAxKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyci5oYXNPd25Qcm9wZXJ0eShmcm9tKSAmJiBhcnJbZnJvbV0gPT09IGVsdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnJvbTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmdldFVuaXF1ZUlkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHhcIi5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IE1hdGgucmFuZG9tKCkgKiAxNiB8IDAsIHYgPSBjID09IFwieFwiID8gciA6IHIgJiAzIHwgODtcbiAgICAgICAgICAgICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaWUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFXCIpICE9PSAtMSB8fCBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJUcmlkZW50XCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaWU3ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRSA3XCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaWU4ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRSA4XCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaWUxMCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUUgMTBcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pZTExID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaWUoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJydjoxMVwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmVkZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJFZGdlXCIpID49IDA7XG4gICAgICAgIH07XG4gICAgICAgIHFxLnNhZmFyaSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci52ZW5kb3IgIT09IHVuZGVmaW5lZCAmJiBuYXZpZ2F0b3IudmVuZG9yLmluZGV4T2YoXCJBcHBsZVwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmNocm9tZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci52ZW5kb3IgIT09IHVuZGVmaW5lZCAmJiBuYXZpZ2F0b3IudmVuZG9yLmluZGV4T2YoXCJHb29nbGVcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5vcGVyYSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci52ZW5kb3IgIT09IHVuZGVmaW5lZCAmJiBuYXZpZ2F0b3IudmVuZG9yLmluZGV4T2YoXCJPcGVyYVwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmZpcmVmb3ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAhcXEuZWRnZSgpICYmICFxcS5pZTExKCkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTW96aWxsYVwiKSAhPT0gLTEgJiYgbmF2aWdhdG9yLnZlbmRvciAhPT0gdW5kZWZpbmVkICYmIG5hdmlnYXRvci52ZW5kb3IgPT09IFwiXCI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLndpbmRvd3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IucGxhdGZvcm0gPT09IFwiV2luMzJcIjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuYW5kcm9pZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiYW5kcm9pZFwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmFuZHJvaWRTdG9jayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmFuZHJvaWQoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImNocm9tZVwiKSA8IDA7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlvczYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pb3MoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCIgT1MgNl9cIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pb3M3ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW9zKCkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiIE9TIDdfXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaW9zOCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmlvcygpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIiBPUyA4X1wiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlvczgwMCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmlvcygpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIiBPUyA4XzAgXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaW9zID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiaVBhZFwiKSAhPT0gLTEgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiaVBvZFwiKSAhPT0gLTEgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiaVBob25lXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaW9zQ2hyb21lID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW9zKCkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiQ3JpT1NcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pb3NTYWZhcmkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pb3MoKSAmJiAhcXEuaW9zQ2hyb21lKCkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiU2FmYXJpXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaW9zU2FmYXJpV2ViVmlldyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmlvcygpICYmICFxcS5pb3NDaHJvbWUoKSAmJiAhcXEuaW9zU2FmYXJpKCk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEudG9FbGVtZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihodG1sKSB7XG4gICAgICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkaXYuZmlyc3RDaGlsZDtcbiAgICAgICAgICAgICAgICBkaXYucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KCk7XG4gICAgICAgIHFxLmVhY2ggPSBmdW5jdGlvbihpdGVyYWJsZUl0ZW0sIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIga2V5T3JJbmRleCwgcmV0VmFsO1xuICAgICAgICAgICAgaWYgKGl0ZXJhYmxlSXRlbSkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuU3RvcmFnZSAmJiBpdGVyYWJsZUl0ZW0uY29uc3RydWN0b3IgPT09IHdpbmRvdy5TdG9yYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoa2V5T3JJbmRleCA9IDA7IGtleU9ySW5kZXggPCBpdGVyYWJsZUl0ZW0ubGVuZ3RoOyBrZXlPckluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IGNhbGxiYWNrKGl0ZXJhYmxlSXRlbS5rZXkoa2V5T3JJbmRleCksIGl0ZXJhYmxlSXRlbS5nZXRJdGVtKGl0ZXJhYmxlSXRlbS5rZXkoa2V5T3JJbmRleCkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRWYWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHFxLmlzQXJyYXkoaXRlcmFibGVJdGVtKSB8fCBxcS5pc0l0ZW1MaXN0KGl0ZXJhYmxlSXRlbSkgfHwgcXEuaXNOb2RlTGlzdChpdGVyYWJsZUl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoa2V5T3JJbmRleCA9IDA7IGtleU9ySW5kZXggPCBpdGVyYWJsZUl0ZW0ubGVuZ3RoOyBrZXlPckluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IGNhbGxiYWNrKGtleU9ySW5kZXgsIGl0ZXJhYmxlSXRlbVtrZXlPckluZGV4XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0VmFsID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxcS5pc1N0cmluZyhpdGVyYWJsZUl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoa2V5T3JJbmRleCA9IDA7IGtleU9ySW5kZXggPCBpdGVyYWJsZUl0ZW0ubGVuZ3RoOyBrZXlPckluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IGNhbGxiYWNrKGtleU9ySW5kZXgsIGl0ZXJhYmxlSXRlbS5jaGFyQXQoa2V5T3JJbmRleCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldFZhbCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoa2V5T3JJbmRleCBpbiBpdGVyYWJsZUl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoaXRlcmFibGVJdGVtLCBrZXlPckluZGV4KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IGNhbGxiYWNrKGtleU9ySW5kZXgsIGl0ZXJhYmxlSXRlbVtrZXlPckluZGV4XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldFZhbCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5iaW5kID0gZnVuY3Rpb24ob2xkRnVuYywgY29udGV4dCkge1xuICAgICAgICAgICAgaWYgKHFxLmlzRnVuY3Rpb24ob2xkRnVuYykpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3QXJncyA9IHFxLmV4dGVuZChbXSwgYXJncyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdBcmdzID0gbmV3QXJncy5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9sZEZ1bmMuYXBwbHkoY29udGV4dCwgbmV3QXJncyk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImZpcnN0IHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24hXCIpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5vYmoydXJsID0gZnVuY3Rpb24ob2JqLCB0ZW1wLCBwcmVmaXhEb25lKSB7XG4gICAgICAgICAgICB2YXIgdXJpc3RyaW5ncyA9IFtdLCBwcmVmaXggPSBcIiZcIiwgYWRkID0gZnVuY3Rpb24obmV4dE9iaiwgaSkge1xuICAgICAgICAgICAgICAgIHZhciBuZXh0VGVtcCA9IHRlbXAgPyAvXFxbXFxdJC8udGVzdCh0ZW1wKSA/IHRlbXAgOiB0ZW1wICsgXCJbXCIgKyBpICsgXCJdXCIgOiBpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0VGVtcCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBpICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHVyaXN0cmluZ3MucHVzaCh0eXBlb2YgbmV4dE9iaiA9PT0gXCJvYmplY3RcIiA/IHFxLm9iajJ1cmwobmV4dE9iaiwgbmV4dFRlbXAsIHRydWUpIDogT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG5leHRPYmopID09PSBcIltvYmplY3QgRnVuY3Rpb25dXCIgPyBlbmNvZGVVUklDb21wb25lbnQobmV4dFRlbXApICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQobmV4dE9iaigpKSA6IGVuY29kZVVSSUNvbXBvbmVudChuZXh0VGVtcCkgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChuZXh0T2JqKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICghcHJlZml4RG9uZSAmJiB0ZW1wKSB7XG4gICAgICAgICAgICAgICAgcHJlZml4ID0gL1xcPy8udGVzdCh0ZW1wKSA/IC9cXD8kLy50ZXN0KHRlbXApID8gXCJcIiA6IFwiJlwiIDogXCI/XCI7XG4gICAgICAgICAgICAgICAgdXJpc3RyaW5ncy5wdXNoKHRlbXApO1xuICAgICAgICAgICAgICAgIHVyaXN0cmluZ3MucHVzaChxcS5vYmoydXJsKG9iaikpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSA9PT0gXCJbb2JqZWN0IEFycmF5XVwiICYmIHR5cGVvZiBvYmogIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKG9iaiwgZnVuY3Rpb24oaWR4LCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkKHZhbCwgaWR4KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9iaiAhPT0gXCJ1bmRlZmluZWRcIiAmJiBvYmogIT09IG51bGwgJiYgdHlwZW9mIG9iaiA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICAgIHFxLmVhY2gob2JqLCBmdW5jdGlvbihwcm9wLCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkKHZhbCwgcHJvcCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHVyaXN0cmluZ3MucHVzaChlbmNvZGVVUklDb21wb25lbnQodGVtcCkgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChvYmopKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0ZW1wKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVyaXN0cmluZ3Muam9pbihwcmVmaXgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXJpc3RyaW5ncy5qb2luKHByZWZpeCkucmVwbGFjZSgvXiYvLCBcIlwiKS5yZXBsYWNlKC8lMjAvZywgXCIrXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5vYmoyRm9ybURhdGEgPSBmdW5jdGlvbihvYmosIGZvcm1EYXRhLCBhcnJheUtleU5hbWUpIHtcbiAgICAgICAgICAgIGlmICghZm9ybURhdGEpIHtcbiAgICAgICAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcXEuZWFjaChvYmosIGZ1bmN0aW9uKGtleSwgdmFsKSB7XG4gICAgICAgICAgICAgICAga2V5ID0gYXJyYXlLZXlOYW1lID8gYXJyYXlLZXlOYW1lICsgXCJbXCIgKyBrZXkgKyBcIl1cIiA6IGtleTtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNPYmplY3QodmFsKSkge1xuICAgICAgICAgICAgICAgICAgICBxcS5vYmoyRm9ybURhdGEodmFsLCBmb3JtRGF0YSwga2V5KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHFxLmlzRnVuY3Rpb24odmFsKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoa2V5LCB2YWwoKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGtleSwgdmFsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmb3JtRGF0YTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEub2JqMklucHV0cyA9IGZ1bmN0aW9uKG9iaiwgZm9ybSkge1xuICAgICAgICAgICAgdmFyIGlucHV0O1xuICAgICAgICAgICAgaWYgKCFmb3JtKSB7XG4gICAgICAgICAgICAgICAgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcXEub2JqMkZvcm1EYXRhKG9iaiwge1xuICAgICAgICAgICAgICAgIGFwcGVuZDogZnVuY3Rpb24oa2V5LCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcIm5hbWVcIiwga2V5KTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwidmFsdWVcIiwgdmFsKTtcbiAgICAgICAgICAgICAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChpbnB1dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZm9ybTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEucGFyc2VKc29uID0gZnVuY3Rpb24oanNvbikge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5KU09OICYmIHFxLmlzRnVuY3Rpb24oSlNPTi5wYXJzZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShqc29uKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwoXCIoXCIgKyBqc29uICsgXCIpXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5nZXRFeHRlbnNpb24gPSBmdW5jdGlvbihmaWxlbmFtZSkge1xuICAgICAgICAgICAgdmFyIGV4dElkeCA9IGZpbGVuYW1lLmxhc3RJbmRleE9mKFwiLlwiKSArIDE7XG4gICAgICAgICAgICBpZiAoZXh0SWR4ID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlbmFtZS5zdWJzdHIoZXh0SWR4LCBmaWxlbmFtZS5sZW5ndGggLSBleHRJZHgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5nZXRGaWxlbmFtZSA9IGZ1bmN0aW9uKGJsb2JPckZpbGVJbnB1dCkge1xuICAgICAgICAgICAgaWYgKHFxLmlzSW5wdXQoYmxvYk9yRmlsZUlucHV0KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBibG9iT3JGaWxlSW5wdXQudmFsdWUucmVwbGFjZSgvLiooXFwvfFxcXFwpLywgXCJcIik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHFxLmlzRmlsZShibG9iT3JGaWxlSW5wdXQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGJsb2JPckZpbGVJbnB1dC5maWxlTmFtZSAhPT0gbnVsbCAmJiBibG9iT3JGaWxlSW5wdXQuZmlsZU5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmxvYk9yRmlsZUlucHV0LmZpbGVOYW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBibG9iT3JGaWxlSW5wdXQubmFtZTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuRGlzcG9zZVN1cHBvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBkaXNwb3NlcnMgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkaXNwb3NlcjtcbiAgICAgICAgICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcG9zZXIgPSBkaXNwb3NlcnMuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXNwb3Nlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3Bvc2VyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKGRpc3Bvc2VyKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGF0dGFjaDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZERpc3Bvc2VyKHFxKGFyZ3NbMF0pLmF0dGFjaC5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhZGREaXNwb3NlcjogZnVuY3Rpb24oZGlzcG9zZUZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3Bvc2Vycy5wdXNoKGRpc3Bvc2VGdW5jdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICB9KSgpO1xuICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICAgICAgZGVmaW5lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gcXE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBnbG9iYWwucXEgPSBxcTtcbiAgICAgICAgfVxuICAgIH0pKCk7XG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcXEuRXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBcIltGaW5lIFVwbG9hZGVyIFwiICsgcXEudmVyc2lvbiArIFwiXSBcIiArIG1lc3NhZ2U7XG4gICAgICAgIH07XG4gICAgICAgIHFxLkVycm9yLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xuICAgIH0pKCk7XG4gICAgcXEudmVyc2lvbiA9IFwiNS4xNi4yXCI7XG4gICAgcXEuc3VwcG9ydGVkRmVhdHVyZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBzdXBwb3J0c1VwbG9hZGluZywgc3VwcG9ydHNVcGxvYWRpbmdCbG9icywgc3VwcG9ydHNGaWxlRHJvcCwgc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZywgc3VwcG9ydHNGb2xkZXJEcm9wLCBzdXBwb3J0c0NodW5raW5nLCBzdXBwb3J0c1Jlc3VtZSwgc3VwcG9ydHNVcGxvYWRWaWFQYXN0ZSwgc3VwcG9ydHNVcGxvYWRDb3JzLCBzdXBwb3J0c0RlbGV0ZUZpbGVYZHIsIHN1cHBvcnRzRGVsZXRlRmlsZUNvcnNYaHIsIHN1cHBvcnRzRGVsZXRlRmlsZUNvcnMsIHN1cHBvcnRzRm9sZGVyU2VsZWN0aW9uLCBzdXBwb3J0c0ltYWdlUHJldmlld3MsIHN1cHBvcnRzVXBsb2FkUHJvZ3Jlc3M7XG4gICAgICAgIGZ1bmN0aW9uIHRlc3RTdXBwb3J0c0ZpbGVJbnB1dEVsZW1lbnQoKSB7XG4gICAgICAgICAgICB2YXIgc3VwcG9ydGVkID0gdHJ1ZSwgdGVtcElucHV0O1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0ZW1wSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgdGVtcElucHV0LnR5cGUgPSBcImZpbGVcIjtcbiAgICAgICAgICAgICAgICBxcSh0ZW1wSW5wdXQpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBpZiAodGVtcElucHV0LmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1cHBvcnRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgICAgICAgICAgc3VwcG9ydGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc3VwcG9ydGVkO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzQ2hyb21lMTRPckhpZ2hlcigpIHtcbiAgICAgICAgICAgIHJldHVybiAocXEuY2hyb21lKCkgfHwgcXEub3BlcmEoKSkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvQ2hyb21lXFwvWzFdWzQtOV18Q2hyb21lXFwvWzItOV1bMC05XS8pICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNDcm9zc09yaWdpblhoclN1cHBvcnRlZCgpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuWE1MSHR0cFJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgeGhyID0gcXEuY3JlYXRlWGhySW5zdGFuY2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4geGhyLndpdGhDcmVkZW50aWFscyAhPT0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzWGRyU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5YRG9tYWluUmVxdWVzdCAhPT0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzQ3Jvc3NPcmlnaW5BamF4U3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgaWYgKGlzQ3Jvc3NPcmlnaW5YaHJTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGlzWGRyU3VwcG9ydGVkKCk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNGb2xkZXJTZWxlY3Rpb25TdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpLndlYmtpdGRpcmVjdG9yeSAhPT0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzTG9jYWxTdG9yYWdlU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISF3aW5kb3cubG9jYWxTdG9yYWdlICYmIHFxLmlzRnVuY3Rpb24od2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzRHJhZ0FuZERyb3BTdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgICAgICAgcmV0dXJuIChcImRyYWdnYWJsZVwiIGluIHNwYW4gfHwgXCJvbmRyYWdzdGFydFwiIGluIHNwYW4gJiYgXCJvbmRyb3BcIiBpbiBzcGFuKSAmJiAhcXEuYW5kcm9pZCgpICYmICFxcS5pb3MoKTtcbiAgICAgICAgfVxuICAgICAgICBzdXBwb3J0c1VwbG9hZGluZyA9IHRlc3RTdXBwb3J0c0ZpbGVJbnB1dEVsZW1lbnQoKTtcbiAgICAgICAgc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyA9IHN1cHBvcnRzVXBsb2FkaW5nICYmIHFxLmlzWGhyVXBsb2FkU3VwcG9ydGVkKCk7XG4gICAgICAgIHN1cHBvcnRzVXBsb2FkaW5nQmxvYnMgPSBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nICYmICFxcS5hbmRyb2lkU3RvY2soKTtcbiAgICAgICAgc3VwcG9ydHNGaWxlRHJvcCA9IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcgJiYgaXNEcmFnQW5kRHJvcFN1cHBvcnRlZCgpO1xuICAgICAgICBzdXBwb3J0c0ZvbGRlckRyb3AgPSBzdXBwb3J0c0ZpbGVEcm9wICYmIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgICAgICAgICAgaW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuICAgICAgICAgICAgcmV0dXJuICEhKFwid2Via2l0ZGlyZWN0b3J5XCIgaW4gKGlucHV0IHx8IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbnB1dFt0eXBlPWZpbGVdXCIpWzBdKSk7XG4gICAgICAgIH0oKTtcbiAgICAgICAgc3VwcG9ydHNDaHVua2luZyA9IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcgJiYgcXEuaXNGaWxlQ2h1bmtpbmdTdXBwb3J0ZWQoKTtcbiAgICAgICAgc3VwcG9ydHNSZXN1bWUgPSBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nICYmIHN1cHBvcnRzQ2h1bmtpbmcgJiYgaXNMb2NhbFN0b3JhZ2VTdXBwb3J0ZWQoKTtcbiAgICAgICAgc3VwcG9ydHNVcGxvYWRWaWFQYXN0ZSA9IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcgJiYgaXNDaHJvbWUxNE9ySGlnaGVyKCk7XG4gICAgICAgIHN1cHBvcnRzVXBsb2FkQ29ycyA9IHN1cHBvcnRzVXBsb2FkaW5nICYmICh3aW5kb3cucG9zdE1lc3NhZ2UgIT09IHVuZGVmaW5lZCB8fCBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nKTtcbiAgICAgICAgc3VwcG9ydHNEZWxldGVGaWxlQ29yc1hociA9IGlzQ3Jvc3NPcmlnaW5YaHJTdXBwb3J0ZWQoKTtcbiAgICAgICAgc3VwcG9ydHNEZWxldGVGaWxlWGRyID0gaXNYZHJTdXBwb3J0ZWQoKTtcbiAgICAgICAgc3VwcG9ydHNEZWxldGVGaWxlQ29ycyA9IGlzQ3Jvc3NPcmlnaW5BamF4U3VwcG9ydGVkKCk7XG4gICAgICAgIHN1cHBvcnRzRm9sZGVyU2VsZWN0aW9uID0gaXNGb2xkZXJTZWxlY3Rpb25TdXBwb3J0ZWQoKTtcbiAgICAgICAgc3VwcG9ydHNJbWFnZVByZXZpZXdzID0gc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyAmJiB3aW5kb3cuRmlsZVJlYWRlciAhPT0gdW5kZWZpbmVkO1xuICAgICAgICBzdXBwb3J0c1VwbG9hZFByb2dyZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZykge1xuICAgICAgICAgICAgICAgIHJldHVybiAhcXEuYW5kcm9pZFN0b2NrKCkgJiYgIXFxLmlvc0Nocm9tZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhamF4VXBsb2FkaW5nOiBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nLFxuICAgICAgICAgICAgYmxvYlVwbG9hZGluZzogc3VwcG9ydHNVcGxvYWRpbmdCbG9icyxcbiAgICAgICAgICAgIGNhbkRldGVybWluZVNpemU6IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcsXG4gICAgICAgICAgICBjaHVua2luZzogc3VwcG9ydHNDaHVua2luZyxcbiAgICAgICAgICAgIGRlbGV0ZUZpbGVDb3JzOiBzdXBwb3J0c0RlbGV0ZUZpbGVDb3JzLFxuICAgICAgICAgICAgZGVsZXRlRmlsZUNvcnNYZHI6IHN1cHBvcnRzRGVsZXRlRmlsZVhkcixcbiAgICAgICAgICAgIGRlbGV0ZUZpbGVDb3JzWGhyOiBzdXBwb3J0c0RlbGV0ZUZpbGVDb3JzWGhyLFxuICAgICAgICAgICAgZGlhbG9nRWxlbWVudDogISF3aW5kb3cuSFRNTERpYWxvZ0VsZW1lbnQsXG4gICAgICAgICAgICBmaWxlRHJvcDogc3VwcG9ydHNGaWxlRHJvcCxcbiAgICAgICAgICAgIGZvbGRlckRyb3A6IHN1cHBvcnRzRm9sZGVyRHJvcCxcbiAgICAgICAgICAgIGZvbGRlclNlbGVjdGlvbjogc3VwcG9ydHNGb2xkZXJTZWxlY3Rpb24sXG4gICAgICAgICAgICBpbWFnZVByZXZpZXdzOiBzdXBwb3J0c0ltYWdlUHJldmlld3MsXG4gICAgICAgICAgICBpbWFnZVZhbGlkYXRpb246IHN1cHBvcnRzSW1hZ2VQcmV2aWV3cyxcbiAgICAgICAgICAgIGl0ZW1TaXplVmFsaWRhdGlvbjogc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyxcbiAgICAgICAgICAgIHBhdXNlOiBzdXBwb3J0c0NodW5raW5nLFxuICAgICAgICAgICAgcHJvZ3Jlc3NCYXI6IHN1cHBvcnRzVXBsb2FkUHJvZ3Jlc3MsXG4gICAgICAgICAgICByZXN1bWU6IHN1cHBvcnRzUmVzdW1lLFxuICAgICAgICAgICAgc2NhbGluZzogc3VwcG9ydHNJbWFnZVByZXZpZXdzICYmIHN1cHBvcnRzVXBsb2FkaW5nQmxvYnMsXG4gICAgICAgICAgICB0aWZmUHJldmlld3M6IHFxLnNhZmFyaSgpLFxuICAgICAgICAgICAgdW5saW1pdGVkU2NhbGVkSW1hZ2VTaXplOiAhcXEuaW9zKCksXG4gICAgICAgICAgICB1cGxvYWRpbmc6IHN1cHBvcnRzVXBsb2FkaW5nLFxuICAgICAgICAgICAgdXBsb2FkQ29yczogc3VwcG9ydHNVcGxvYWRDb3JzLFxuICAgICAgICAgICAgdXBsb2FkQ3VzdG9tSGVhZGVyczogc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyxcbiAgICAgICAgICAgIHVwbG9hZE5vbk11bHRpcGFydDogc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyxcbiAgICAgICAgICAgIHVwbG9hZFZpYVBhc3RlOiBzdXBwb3J0c1VwbG9hZFZpYVBhc3RlXG4gICAgICAgIH07XG4gICAgfSgpO1xuICAgIHFxLmlzR2VuZXJpY1Byb21pc2UgPSBmdW5jdGlvbihtYXliZVByb21pc2UpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHJldHVybiAhIShtYXliZVByb21pc2UgJiYgbWF5YmVQcm9taXNlLnRoZW4gJiYgcXEuaXNGdW5jdGlvbihtYXliZVByb21pc2UudGhlbikpO1xuICAgIH07XG4gICAgcXEuUHJvbWlzZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHN1Y2Nlc3NBcmdzLCBmYWlsdXJlQXJncywgc3VjY2Vzc0NhbGxiYWNrcyA9IFtdLCBmYWlsdXJlQ2FsbGJhY2tzID0gW10sIGRvbmVDYWxsYmFja3MgPSBbXSwgc3RhdGUgPSAwO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgdGhlbjogZnVuY3Rpb24ob25TdWNjZXNzLCBvbkZhaWx1cmUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9uU3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrcy5wdXNoKG9uU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9uRmFpbHVyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbHVyZUNhbGxiYWNrcy5wdXNoKG9uRmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmUgJiYgb25GYWlsdXJlLmFwcGx5KG51bGwsIGZhaWx1cmVBcmdzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9uU3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3MuYXBwbHkobnVsbCwgc3VjY2Vzc0FyZ3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkb25lOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBkb25lQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIGZhaWx1cmVBcmdzID09PSB1bmRlZmluZWQgPyBzdWNjZXNzQXJncyA6IGZhaWx1cmVBcmdzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc3RhdGUgPSAxO1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3NBcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzQ2FsbGJhY2tzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKHN1Y2Nlc3NDYWxsYmFja3MsIGZ1bmN0aW9uKGlkeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIHN1Y2Nlc3NBcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChkb25lQ2FsbGJhY2tzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGRvbmVDYWxsYmFja3MsIGZ1bmN0aW9uKGlkeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIHN1Y2Nlc3NBcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZhaWx1cmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHN0YXRlID0gLTE7XG4gICAgICAgICAgICAgICAgZmFpbHVyZUFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVDYWxsYmFja3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZmFpbHVyZUNhbGxiYWNrcywgZnVuY3Rpb24oaWR4LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkobnVsbCwgZmFpbHVyZUFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRvbmVDYWxsYmFja3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZG9uZUNhbGxiYWNrcywgZnVuY3Rpb24oaWR4LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkobnVsbCwgZmFpbHVyZUFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuQmxvYlByb3h5ID0gZnVuY3Rpb24ocmVmZXJlbmNlQmxvYiwgb25DcmVhdGUpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICByZWZlcmVuY2VCbG9iOiByZWZlcmVuY2VCbG9iLFxuICAgICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb25DcmVhdGUocmVmZXJlbmNlQmxvYik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuVXBsb2FkQnV0dG9uID0gZnVuY3Rpb24obykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBkaXNwb3NlU3VwcG9ydCA9IG5ldyBxcS5EaXNwb3NlU3VwcG9ydCgpLCBvcHRpb25zID0ge1xuICAgICAgICAgICAgYWNjZXB0RmlsZXM6IG51bGwsXG4gICAgICAgICAgICBlbGVtZW50OiBudWxsLFxuICAgICAgICAgICAgZm9jdXNDbGFzczogXCJxcS11cGxvYWQtYnV0dG9uLWZvY3VzXCIsXG4gICAgICAgICAgICBmb2xkZXJzOiBmYWxzZSxcbiAgICAgICAgICAgIGhvdmVyQ2xhc3M6IFwicXEtdXBsb2FkLWJ1dHRvbi1ob3ZlclwiLFxuICAgICAgICAgICAgaW9zOEJyb3dzZXJDcmFzaFdvcmthcm91bmQ6IGZhbHNlLFxuICAgICAgICAgICAgbXVsdGlwbGU6IGZhbHNlLFxuICAgICAgICAgICAgbmFtZTogXCJxcWZpbGVcIixcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbihpbnB1dCkge30sXG4gICAgICAgICAgICB0aXRsZTogbnVsbFxuICAgICAgICB9LCBpbnB1dCwgYnV0dG9uSWQ7XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBvKTtcbiAgICAgICAgYnV0dG9uSWQgPSBxcS5nZXRVbmlxdWVJZCgpO1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVJbnB1dCgpIHtcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShxcS5VcGxvYWRCdXR0b24uQlVUVE9OX0lEX0FUVFJfTkFNRSwgYnV0dG9uSWQpO1xuICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgb3B0aW9ucy50aXRsZSk7XG4gICAgICAgICAgICBzZWxmLnNldE11bHRpcGxlKG9wdGlvbnMubXVsdGlwbGUsIGlucHV0KTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmZvbGRlcnMgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuZm9sZGVyU2VsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwid2Via2l0ZGlyZWN0b3J5XCIsIFwiXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuYWNjZXB0RmlsZXMpIHtcbiAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJhY2NlcHRcIiwgb3B0aW9ucy5hY2NlcHRGaWxlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiZmlsZVwiKTtcbiAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgb3B0aW9ucy5uYW1lKTtcbiAgICAgICAgICAgIHFxKGlucHV0KS5jc3Moe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiQXJpYWxcIixcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogcXEuaWUoKSAmJiAhcXEuaWU4KCkgPyBcIjM1MDBweFwiIDogXCIxMThweFwiLFxuICAgICAgICAgICAgICAgIG1hcmdpbjogMCxcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwLFxuICAgICAgICAgICAgICAgIGN1cnNvcjogXCJwb2ludGVyXCIsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAhcXEuaWU3KCkgJiYgcXEoaW5wdXQpLmNzcyh7XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBcIjEwMCVcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBvcHRpb25zLmVsZW1lbnQuYXBwZW5kQ2hpbGQoaW5wdXQpO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGlucHV0LCBcImNoYW5nZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLm9uQ2hhbmdlKGlucHV0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGlucHV0LCBcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBxcShvcHRpb25zLmVsZW1lbnQpLmFkZENsYXNzKG9wdGlvbnMuaG92ZXJDbGFzcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChpbnB1dCwgXCJtb3VzZW91dFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBxcShvcHRpb25zLmVsZW1lbnQpLnJlbW92ZUNsYXNzKG9wdGlvbnMuaG92ZXJDbGFzcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChpbnB1dCwgXCJmb2N1c1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBxcShvcHRpb25zLmVsZW1lbnQpLmFkZENsYXNzKG9wdGlvbnMuZm9jdXNDbGFzcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChpbnB1dCwgXCJibHVyXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHFxKG9wdGlvbnMuZWxlbWVudCkucmVtb3ZlQ2xhc3Mob3B0aW9ucy5mb2N1c0NsYXNzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xuICAgICAgICB9XG4gICAgICAgIHFxKG9wdGlvbnMuZWxlbWVudCkuY3NzKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBcInJlbGF0aXZlXCIsXG4gICAgICAgICAgICBvdmVyZmxvdzogXCJoaWRkZW5cIixcbiAgICAgICAgICAgIGRpcmVjdGlvbjogXCJsdHJcIlxuICAgICAgICB9KTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGdldElucHV0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0QnV0dG9uSWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBidXR0b25JZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRNdWx0aXBsZTogZnVuY3Rpb24oaXNNdWx0aXBsZSwgb3B0SW5wdXQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5wdXQgPSBvcHRJbnB1dCB8fCB0aGlzLmdldElucHV0KCk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuaW9zOEJyb3dzZXJDcmFzaFdvcmthcm91bmQgJiYgcXEuaW9zOCgpICYmIChxcS5pb3NDaHJvbWUoKSB8fCBxcS5pb3NTYWZhcmlXZWJWaWV3KCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcIm11bHRpcGxlXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc011bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJtdWx0aXBsZVwiLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LnJlbW92ZUF0dHJpYnV0ZShcIm11bHRpcGxlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEFjY2VwdEZpbGVzOiBmdW5jdGlvbihhY2NlcHRGaWxlcykge1xuICAgICAgICAgICAgICAgIGlmIChhY2NlcHRGaWxlcyAhPT0gb3B0aW9ucy5hY2NlcHRGaWxlcykge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJhY2NlcHRcIiwgYWNjZXB0RmlsZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlucHV0LnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoaW5wdXQpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxcShvcHRpb25zLmVsZW1lbnQpLnJlbW92ZUNsYXNzKG9wdGlvbnMuZm9jdXNDbGFzcyk7XG4gICAgICAgICAgICAgICAgaW5wdXQgPSBudWxsO1xuICAgICAgICAgICAgICAgIGlucHV0ID0gY3JlYXRlSW5wdXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlucHV0ID0gY3JlYXRlSW5wdXQoKTtcbiAgICB9O1xuICAgIHFxLlVwbG9hZEJ1dHRvbi5CVVRUT05fSURfQVRUUl9OQU1FID0gXCJxcS1idXR0b24taWRcIjtcbiAgICBxcS5VcGxvYWREYXRhID0gZnVuY3Rpb24odXBsb2FkZXJQcm94eSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGRhdGEgPSBbXSwgYnlVdWlkID0ge30sIGJ5U3RhdHVzID0ge30sIGJ5UHJveHlHcm91cElkID0ge30sIGJ5QmF0Y2hJZCA9IHt9O1xuICAgICAgICBmdW5jdGlvbiBnZXREYXRhQnlJZHMoaWRPcklkcykge1xuICAgICAgICAgICAgaWYgKHFxLmlzQXJyYXkoaWRPcklkcykpIHtcbiAgICAgICAgICAgICAgICB2YXIgZW50cmllcyA9IFtdO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goaWRPcklkcywgZnVuY3Rpb24oaWR4LCBpZCkge1xuICAgICAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2goZGF0YVtpZF0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBlbnRyaWVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRhdGFbaWRPcklkc107XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YUJ5VXVpZHModXVpZHMpIHtcbiAgICAgICAgICAgIGlmIChxcS5pc0FycmF5KHV1aWRzKSkge1xuICAgICAgICAgICAgICAgIHZhciBlbnRyaWVzID0gW107XG4gICAgICAgICAgICAgICAgcXEuZWFjaCh1dWlkcywgZnVuY3Rpb24oaWR4LCB1dWlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaChkYXRhW2J5VXVpZFt1dWlkXV0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBlbnRyaWVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRhdGFbYnlVdWlkW3V1aWRzXV07XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YUJ5U3RhdHVzKHN0YXR1cykge1xuICAgICAgICAgICAgdmFyIHN0YXR1c1Jlc3VsdHMgPSBbXSwgc3RhdHVzZXMgPSBbXS5jb25jYXQoc3RhdHVzKTtcbiAgICAgICAgICAgIHFxLmVhY2goc3RhdHVzZXMsIGZ1bmN0aW9uKGluZGV4LCBzdGF0dXNFbnVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1c1Jlc3VsdEluZGV4ZXMgPSBieVN0YXR1c1tzdGF0dXNFbnVtXTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzUmVzdWx0SW5kZXhlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goc3RhdHVzUmVzdWx0SW5kZXhlcywgZnVuY3Rpb24oaSwgZGF0YUluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNSZXN1bHRzLnB1c2goZGF0YVtkYXRhSW5kZXhdKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gc3RhdHVzUmVzdWx0cztcbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgYWRkRmlsZTogZnVuY3Rpb24oc3BlYykge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBzcGVjLnN0YXR1cyB8fCBxcS5zdGF0dXMuU1VCTUlUVElORywgaWQgPSBkYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBzcGVjLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsTmFtZTogc3BlYy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICB1dWlkOiBzcGVjLnV1aWQsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IHNwZWMuc2l6ZSA9PSBudWxsID8gLTEgOiBzcGVjLnNpemUsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBmaWxlOiBzcGVjLmZpbGVcbiAgICAgICAgICAgICAgICB9KSAtIDE7XG4gICAgICAgICAgICAgICAgaWYgKHNwZWMuYmF0Y2hJZCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2lkXS5iYXRjaElkID0gc3BlYy5iYXRjaElkO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYnlCYXRjaElkW3NwZWMuYmF0Y2hJZF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnlCYXRjaElkW3NwZWMuYmF0Y2hJZF0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBieUJhdGNoSWRbc3BlYy5iYXRjaElkXS5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNwZWMucHJveHlHcm91cElkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaWRdLnByb3h5R3JvdXBJZCA9IHNwZWMucHJveHlHcm91cElkO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYnlQcm94eUdyb3VwSWRbc3BlYy5wcm94eUdyb3VwSWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ5UHJveHlHcm91cElkW3NwZWMucHJveHlHcm91cElkXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJ5UHJveHlHcm91cElkW3NwZWMucHJveHlHcm91cElkXS5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGF0YVtpZF0uaWQgPSBpZDtcbiAgICAgICAgICAgICAgICBieVV1aWRbc3BlYy51dWlkXSA9IGlkO1xuICAgICAgICAgICAgICAgIGlmIChieVN0YXR1c1tzdGF0dXNdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnlTdGF0dXNbc3RhdHVzXSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBieVN0YXR1c1tzdGF0dXNdLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgIHNwZWMub25CZWZvcmVTdGF0dXNDaGFuZ2UgJiYgc3BlYy5vbkJlZm9yZVN0YXR1c0NoYW5nZShpZCk7XG4gICAgICAgICAgICAgICAgdXBsb2FkZXJQcm94eS5vblN0YXR1c0NoYW5nZShpZCwgbnVsbCwgc3RhdHVzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0cmlldmU6IGZ1bmN0aW9uKG9wdGlvbmFsRmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzT2JqZWN0KG9wdGlvbmFsRmlsdGVyKSAmJiBkYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uYWxGaWx0ZXIuaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldERhdGFCeUlkcyhvcHRpb25hbEZpbHRlci5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9uYWxGaWx0ZXIudXVpZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RGF0YUJ5VXVpZHMob3B0aW9uYWxGaWx0ZXIudXVpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9uYWxGaWx0ZXIuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RGF0YUJ5U3RhdHVzKG9wdGlvbmFsRmlsdGVyLnN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXEuZXh0ZW5kKFtdLCBkYXRhLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlRmlsZVJlZjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVjb3JkID0gZ2V0RGF0YUJ5SWRzKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAocmVjb3JkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSByZWNvcmQuZmlsZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICBieVV1aWQgPSB7fTtcbiAgICAgICAgICAgICAgICBieVN0YXR1cyA9IHt9O1xuICAgICAgICAgICAgICAgIGJ5QmF0Y2hJZCA9IHt9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFN0YXR1czogZnVuY3Rpb24oaWQsIG5ld1N0YXR1cykge1xuICAgICAgICAgICAgICAgIHZhciBvbGRTdGF0dXMgPSBkYXRhW2lkXS5zdGF0dXMsIGJ5U3RhdHVzT2xkU3RhdHVzSW5kZXggPSBxcS5pbmRleE9mKGJ5U3RhdHVzW29sZFN0YXR1c10sIGlkKTtcbiAgICAgICAgICAgICAgICBieVN0YXR1c1tvbGRTdGF0dXNdLnNwbGljZShieVN0YXR1c09sZFN0YXR1c0luZGV4LCAxKTtcbiAgICAgICAgICAgICAgICBkYXRhW2lkXS5zdGF0dXMgPSBuZXdTdGF0dXM7XG4gICAgICAgICAgICAgICAgaWYgKGJ5U3RhdHVzW25ld1N0YXR1c10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBieVN0YXR1c1tuZXdTdGF0dXNdID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJ5U3RhdHVzW25ld1N0YXR1c10ucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgdXBsb2FkZXJQcm94eS5vblN0YXR1c0NoYW5nZShpZCwgb2xkU3RhdHVzLCBuZXdTdGF0dXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHV1aWRDaGFuZ2VkOiBmdW5jdGlvbihpZCwgbmV3VXVpZCkge1xuICAgICAgICAgICAgICAgIHZhciBvbGRVdWlkID0gZGF0YVtpZF0udXVpZDtcbiAgICAgICAgICAgICAgICBkYXRhW2lkXS51dWlkID0gbmV3VXVpZDtcbiAgICAgICAgICAgICAgICBieVV1aWRbbmV3VXVpZF0gPSBpZDtcbiAgICAgICAgICAgICAgICBkZWxldGUgYnlVdWlkW29sZFV1aWRdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZU5hbWU6IGZ1bmN0aW9uKGlkLCBuZXdOYW1lKSB7XG4gICAgICAgICAgICAgICAgZGF0YVtpZF0ubmFtZSA9IG5ld05hbWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlU2l6ZTogZnVuY3Rpb24oaWQsIG5ld1NpemUpIHtcbiAgICAgICAgICAgICAgICBkYXRhW2lkXS5zaXplID0gbmV3U2l6ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRQYXJlbnRJZDogZnVuY3Rpb24odGFyZ2V0SWQsIHBhcmVudElkKSB7XG4gICAgICAgICAgICAgICAgZGF0YVt0YXJnZXRJZF0ucGFyZW50SWQgPSBwYXJlbnRJZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJZHNJblByb3h5R3JvdXA6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb3h5R3JvdXBJZCA9IGRhdGFbaWRdLnByb3h5R3JvdXBJZDtcbiAgICAgICAgICAgICAgICBpZiAocHJveHlHcm91cElkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBieVByb3h5R3JvdXBJZFtwcm94eUdyb3VwSWRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SWRzSW5CYXRjaDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYmF0Y2hJZCA9IGRhdGFbaWRdLmJhdGNoSWQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ5QmF0Y2hJZFtiYXRjaElkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5zdGF0dXMgPSB7XG4gICAgICAgIFNVQk1JVFRJTkc6IFwic3VibWl0dGluZ1wiLFxuICAgICAgICBTVUJNSVRURUQ6IFwic3VibWl0dGVkXCIsXG4gICAgICAgIFJFSkVDVEVEOiBcInJlamVjdGVkXCIsXG4gICAgICAgIFFVRVVFRDogXCJxdWV1ZWRcIixcbiAgICAgICAgQ0FOQ0VMRUQ6IFwiY2FuY2VsZWRcIixcbiAgICAgICAgUEFVU0VEOiBcInBhdXNlZFwiLFxuICAgICAgICBVUExPQURJTkc6IFwidXBsb2FkaW5nXCIsXG4gICAgICAgIFVQTE9BRF9GSU5BTElaSU5HOiBcInVwbG9hZCBmaW5hbGl6aW5nXCIsXG4gICAgICAgIFVQTE9BRF9SRVRSWUlORzogXCJyZXRyeWluZyB1cGxvYWRcIixcbiAgICAgICAgVVBMT0FEX1NVQ0NFU1NGVUw6IFwidXBsb2FkIHN1Y2Nlc3NmdWxcIixcbiAgICAgICAgVVBMT0FEX0ZBSUxFRDogXCJ1cGxvYWQgZmFpbGVkXCIsXG4gICAgICAgIERFTEVURV9GQUlMRUQ6IFwiZGVsZXRlIGZhaWxlZFwiLFxuICAgICAgICBERUxFVElORzogXCJkZWxldGluZ1wiLFxuICAgICAgICBERUxFVEVEOiBcImRlbGV0ZWRcIlxuICAgIH07XG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcXEuYmFzZVB1YmxpY0FwaSA9IHtcbiAgICAgICAgICAgIGFkZEJsb2JzOiBmdW5jdGlvbihibG9iRGF0YU9yQXJyYXksIHBhcmFtcywgZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEZpbGVzKGJsb2JEYXRhT3JBcnJheSwgcGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWRkSW5pdGlhbEZpbGVzOiBmdW5jdGlvbihjYW5uZWRGaWxlTGlzdCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGNhbm5lZEZpbGVMaXN0LCBmdW5jdGlvbihpbmRleCwgY2FubmVkRmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9hZGRDYW5uZWRGaWxlKGNhbm5lZEZpbGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZEZpbGVzOiBmdW5jdGlvbihkYXRhLCBwYXJhbXMsIGVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWF5YmVIYW5kbGVJb3M4U2FmYXJpV29ya2Fyb3VuZCgpO1xuICAgICAgICAgICAgICAgIHZhciBiYXRjaElkID0gdGhpcy5fc3RvcmVkSWRzLmxlbmd0aCA9PT0gMCA/IHFxLmdldFVuaXF1ZUlkKCkgOiB0aGlzLl9jdXJyZW50QmF0Y2hJZCwgcHJvY2Vzc0Jsb2IgPSBxcS5iaW5kKGZ1bmN0aW9uKGJsb2IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlTmV3RmlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9iOiBibG9iLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5fb3B0aW9ucy5ibG9icy5kZWZhdWx0TmFtZVxuICAgICAgICAgICAgICAgICAgICB9LCBiYXRjaElkLCB2ZXJpZmllZEZpbGVzKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSwgcHJvY2Vzc0Jsb2JEYXRhID0gcXEuYmluZChmdW5jdGlvbihibG9iRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVOZXdGaWxlKGJsb2JEYXRhLCBiYXRjaElkLCB2ZXJpZmllZEZpbGVzKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSwgcHJvY2Vzc0NhbnZhcyA9IHFxLmJpbmQoZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gcXEuY2FudmFzVG9CbG9iKGNhbnZhcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZU5ld0ZpbGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmxvYjogYmxvYixcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuX29wdGlvbnMuYmxvYnMuZGVmYXVsdE5hbWUgKyBcIi5wbmdcIlxuICAgICAgICAgICAgICAgICAgICB9LCBiYXRjaElkLCB2ZXJpZmllZEZpbGVzKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSwgcHJvY2Vzc0NhbnZhc0RhdGEgPSBxcS5iaW5kKGZ1bmN0aW9uKGNhbnZhc0RhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vcm1hbGl6ZWRRdWFsaXR5ID0gY2FudmFzRGF0YS5xdWFsaXR5ICYmIGNhbnZhc0RhdGEucXVhbGl0eSAvIDEwMCwgYmxvYiA9IHFxLmNhbnZhc1RvQmxvYihjYW52YXNEYXRhLmNhbnZhcywgY2FudmFzRGF0YS50eXBlLCBub3JtYWxpemVkUXVhbGl0eSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZU5ld0ZpbGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmxvYjogYmxvYixcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGNhbnZhc0RhdGEubmFtZVxuICAgICAgICAgICAgICAgICAgICB9LCBiYXRjaElkLCB2ZXJpZmllZEZpbGVzKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSwgcHJvY2Vzc0ZpbGVPcklucHV0ID0gcXEuYmluZChmdW5jdGlvbihmaWxlT3JJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNJbnB1dChmaWxlT3JJbnB1dCkgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuYWpheFVwbG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZmlsZU9ySW5wdXQuZmlsZXMpLCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZmlsZXMsIGZ1bmN0aW9uKGlkeCwgZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2hhbmRsZU5ld0ZpbGUoZmlsZSwgYmF0Y2hJZCwgdmVyaWZpZWRGaWxlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZU5ld0ZpbGUoZmlsZU9ySW5wdXQsIGJhdGNoSWQsIHZlcmlmaWVkRmlsZXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgdGhpcyksIG5vcm1hbGl6ZURhdGEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzRmlsZUxpc3QoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gW10uY29uY2F0KGRhdGEpO1xuICAgICAgICAgICAgICAgIH0sIHNlbGYgPSB0aGlzLCB2ZXJpZmllZEZpbGVzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEJhdGNoSWQgPSBiYXRjaElkO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZURhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChkYXRhLCBmdW5jdGlvbihpZHgsIGZpbGVDb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc0ZpbGVPcklucHV0KGZpbGVDb250YWluZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0ZpbGVPcklucHV0KGZpbGVDb250YWluZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxcS5pc0Jsb2IoZmlsZUNvbnRhaW5lcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzQmxvYihmaWxlQ29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXEuaXNPYmplY3QoZmlsZUNvbnRhaW5lcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZUNvbnRhaW5lci5ibG9iICYmIGZpbGVDb250YWluZXIubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzQmxvYkRhdGEoZmlsZUNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlQ29udGFpbmVyLmNhbnZhcyAmJiBmaWxlQ29udGFpbmVyLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0NhbnZhc0RhdGEoZmlsZUNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlQ29udGFpbmVyLnRhZ05hbWUgJiYgZmlsZUNvbnRhaW5lci50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiY2FudmFzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzQ2FudmFzKGZpbGVDb250YWluZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhmaWxlQ29udGFpbmVyICsgXCIgaXMgbm90IGEgdmFsaWQgZmlsZSBjb250YWluZXIhICBJZ25vcmluZyFcIiwgXCJ3YXJuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coXCJSZWNlaXZlZCBcIiArIHZlcmlmaWVkRmlsZXMubGVuZ3RoICsgXCIgZmlsZXMuXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcmVwYXJlSXRlbXNGb3JVcGxvYWQodmVyaWZpZWRGaWxlcywgcGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdXBsb2FkRGF0YSA9IHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YSAmJiB1cGxvYWREYXRhLnN0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRF9GSU5BTElaSU5HKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKHFxLmZvcm1hdChcIklnbm9yaW5nIGNhbmNlbCBmb3IgZmlsZSBJRCB7fSAoe30pLiAgRmluYWxpemluZyB1cGxvYWQuXCIsIGlkLCB0aGlzLmdldE5hbWUoaWQpKSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVyLmNhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbmNlbEFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0b3JlZElkc0NvcHkgPSBbXSwgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcXEuZXh0ZW5kKHN0b3JlZElkc0NvcHksIHRoaXMuX3N0b3JlZElkcyk7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChzdG9yZWRJZHNDb3B5LCBmdW5jdGlvbihpZHgsIHN0b3JlZEZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmNhbmNlbChzdG9yZWRGaWxlSWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIuY2FuY2VsQWxsKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xlYXJTdG9yZWRGaWxlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RvcmVkSWRzID0gW107XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udGludWVVcGxvYWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHVwbG9hZERhdGEgPSB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5wYXVzZSB8fCAhdGhpcy5fb3B0aW9ucy5jaHVua2luZy5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHVwbG9hZERhdGEuc3RhdHVzID09PSBxcS5zdGF0dXMuUEFVU0VEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKHFxLmZvcm1hdChcIlBhdXNlZCBmaWxlIElEIHt9ICh7fSkgd2lsbCBiZSBjb250aW51ZWQuICBOb3QgcGF1c2VkLlwiLCBpZCwgdGhpcy5nZXROYW1lKGlkKSkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWRGaWxlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cocXEuZm9ybWF0KFwiSWdub3JpbmcgY29udGludWUgZm9yIGZpbGUgSUQge30gKHt9KS4gIE5vdCBwYXVzZWQuXCIsIGlkLCB0aGlzLmdldE5hbWUoaWQpKSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlbGV0ZUZpbGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29uU3VibWl0RGVsZXRlKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkb2VzRXhpc3Q6IGZ1bmN0aW9uKGZpbGVPckJsb2JJZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVyLmlzVmFsaWQoZmlsZU9yQmxvYklkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkcmF3VGh1bWJuYWlsOiBmdW5jdGlvbihmaWxlSWQsIGltZ09yQ2FudmFzLCBtYXhTaXplLCBmcm9tU2VydmVyLCBjdXN0b21SZXNpemVGdW5jdGlvbikge1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlVG9SZXR1cm4gPSBuZXcgcXEuUHJvbWlzZSgpLCBmaWxlT3JVcmwsIG9wdGlvbnM7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ltYWdlR2VuZXJhdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVPclVybCA9IHRoaXMuX3RodW1ibmFpbFVybHNbZmlsZUlkXTtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uOiBjdXN0b21SZXNpemVGdW5jdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heFNpemU6IG1heFNpemUgPiAwID8gbWF4U2l6ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogbWF4U2l6ZSA+IDBcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmcm9tU2VydmVyICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmltYWdlUHJldmlld3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVPclVybCA9IHRoaXMuZ2V0RmlsZShmaWxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlT3JVcmwgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZVRvUmV0dXJuLmZhaWx1cmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogaW1nT3JDYW52YXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IFwiRmlsZSBvciBVUkwgbm90IGZvdW5kLlwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlR2VuZXJhdG9yLmdlbmVyYXRlKGZpbGVPclVybCwgaW1nT3JDYW52YXMsIG9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gc3VjY2Vzcyhtb2RpZmllZENvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VUb1JldHVybi5zdWNjZXNzKG1vZGlmaWVkQ29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGZhaWx1cmUoY29udGFpbmVyLCByZWFzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlVG9SZXR1cm4uZmFpbHVyZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogcmVhc29uIHx8IFwiUHJvYmxlbSBnZW5lcmF0aW5nIHRodW1ibmFpbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2VUb1JldHVybi5mYWlsdXJlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogaW1nT3JDYW52YXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogXCJNaXNzaW5nIGltYWdlIGdlbmVyYXRvciBtb2R1bGVcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2VUb1JldHVybjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRCdXR0b246IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRCdXR0b24odGhpcy5fYnV0dG9uSWRzRm9yRmlsZUlkc1tmaWxlSWRdKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRFbmRwb2ludDogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuZHBvaW50U3RvcmUuZ2V0KGZpbGVJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RmlsZTogZnVuY3Rpb24oZmlsZU9yQmxvYklkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGUgPSB0aGlzLl9oYW5kbGVyLmdldEZpbGUoZmlsZU9yQmxvYklkKTtcbiAgICAgICAgICAgICAgICB2YXIgdXBsb2FkRGF0YVJlY29yZDtcbiAgICAgICAgICAgICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkRGF0YVJlY29yZCA9IHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGZpbGVPckJsb2JJZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVwbG9hZERhdGFSZWNvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUgPSB1cGxvYWREYXRhUmVjb3JkLmZpbGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGUgfHwgbnVsbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJblByb2dyZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogWyBxcS5zdGF0dXMuVVBMT0FESU5HLCBxcS5zdGF0dXMuVVBMT0FEX1JFVFJZSU5HLCBxcS5zdGF0dXMuUVVFVUVEIF1cbiAgICAgICAgICAgICAgICB9KS5sZW5ndGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TmFtZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pLm5hbWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UGFyZW50SWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHVwbG9hZERhdGFFbnRyeSA9IHRoaXMuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pLCBwYXJlbnRJZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKHVwbG9hZERhdGFFbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YUVudHJ5LnBhcmVudElkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudElkID0gdXBsb2FkRGF0YUVudHJ5LnBhcmVudElkO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRJZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSZXN1bWFibGVGaWxlc0RhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVyLmdldFJlc3VtYWJsZUZpbGVzRGF0YSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFNpemU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KS5zaXplO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE5ldFVwbG9hZHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uZXRVcGxvYWRlZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSZW1haW5pbmdBbGxvd2VkSXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBhbGxvd2VkSXRlbXMgPSB0aGlzLl9jdXJyZW50SXRlbUxpbWl0O1xuICAgICAgICAgICAgICAgIGlmIChhbGxvd2VkSXRlbXMgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGxvd2VkSXRlbXMgLSB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRVcGxvYWRzOiBmdW5jdGlvbihvcHRpb25hbEZpbHRlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKG9wdGlvbmFsRmlsdGVyKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRVdWlkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSkudXVpZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1Jlc3VtYWJsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlci5oYXNSZXN1bWVSZWNvcmQoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24oc3RyLCBsZXZlbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmRlYnVnICYmICghbGV2ZWwgfHwgbGV2ZWwgPT09IFwiaW5mb1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBxcS5sb2coXCJbRmluZSBVcGxvYWRlciBcIiArIHFxLnZlcnNpb24gKyBcIl0gXCIgKyBzdHIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGV2ZWwgJiYgbGV2ZWwgIT09IFwiaW5mb1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmxvZyhcIltGaW5lIFVwbG9hZGVyIFwiICsgcXEudmVyc2lvbiArIFwiXSBcIiArIHN0ciwgbGV2ZWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXVzZVVwbG9hZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdXBsb2FkRGF0YSA9IHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIXFxLnN1cHBvcnRlZEZlYXR1cmVzLnBhdXNlIHx8ICF0aGlzLl9vcHRpb25zLmNodW5raW5nLmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocXEuaW5kZXhPZihbIHFxLnN0YXR1cy5VUExPQURJTkcsIHFxLnN0YXR1cy5VUExPQURfUkVUUllJTkcgXSwgdXBsb2FkRGF0YS5zdGF0dXMpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2hhbmRsZXIucGF1c2UoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlBBVVNFRCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKHFxLmZvcm1hdChcIlVuYWJsZSB0byBwYXVzZSBmaWxlIElEIHt9ICh7fSkuXCIsIGlkLCB0aGlzLmdldE5hbWUoaWQpKSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKHFxLmZvcm1hdChcIklnbm9yaW5nIHBhdXNlIGZvciBmaWxlIElEIHt9ICh7fSkuICBOb3QgaW4gcHJvZ3Jlc3MuXCIsIGlkLCB0aGlzLmdldE5hbWUoaWQpKSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbW92ZUZpbGVSZWY6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlci5leHB1bmdlKGlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnJlbW92ZUZpbGVSZWYoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIlJlc2V0dGluZyB1cGxvYWRlci4uLlwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVyLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RvcmVkSWRzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5fYXV0b1JldHJpZXMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXRyeVRpbWVvdXRzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5fcHJldmVudFJldHJpZXMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLl90aHVtYm5haWxVcmxzID0gW107XG4gICAgICAgICAgICAgICAgcXEuZWFjaCh0aGlzLl9idXR0b25zLCBmdW5jdGlvbihpZHgsIGJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICBidXR0b24ucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXNTdG9yZS5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2VuZHBvaW50U3RvcmUucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2J1dHRvbklkc0ZvckZpbGVJZHMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXN0ZUhhbmRsZXIgJiYgdGhpcy5fcGFzdGVIYW5kbGVyLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5zZXNzaW9uLnJlZnJlc2hPblJlc2V0ICYmIHRoaXMuX3JlZnJlc2hTZXNzaW9uRGF0YSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3N1Y2NlZWRlZFNpbmNlTGFzdEFsbENvbXBsZXRlID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5fZmFpbGVkU2luY2VMYXN0QWxsQ29tcGxldGUgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbFByb2dyZXNzICYmIHRoaXMuX3RvdGFsUHJvZ3Jlc3MucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXN0b21SZXN1bWVEYXRhU3RvcmUucmVzZXQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXRyeTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFudWFsUmV0cnkoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNjYWxlSW1hZ2U6IGZ1bmN0aW9uKGlkLCBzcGVjcykge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEuU2NhbGVyLnByb3RvdHlwZS5zY2FsZUltYWdlKGlkLCBzcGVjcywge1xuICAgICAgICAgICAgICAgICAgICBsb2c6IHFxLmJpbmQoc2VsZi5sb2csIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICBnZXRGaWxlOiBxcS5iaW5kKHNlbGYuZ2V0RmlsZSwgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZERhdGE6IHNlbGYuX3VwbG9hZERhdGFcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRDdXN0b21IZWFkZXJzOiBmdW5jdGlvbihoZWFkZXJzLCBpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1c3RvbUhlYWRlcnNTdG9yZS5zZXQoaGVhZGVycywgaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEN1c3RvbVJlc3VtZURhdGE6IGZ1bmN0aW9uKGlkLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3VzdG9tUmVzdW1lRGF0YVN0b3JlLnNldChkYXRhLCBpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0RGVsZXRlRmlsZUN1c3RvbUhlYWRlcnM6IGZ1bmN0aW9uKGhlYWRlcnMsIGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGVsZXRlRmlsZUN1c3RvbUhlYWRlcnNTdG9yZS5zZXQoaGVhZGVycywgaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldERlbGV0ZUZpbGVFbmRwb2ludDogZnVuY3Rpb24oZW5kcG9pbnQsIGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGVsZXRlRmlsZUVuZHBvaW50U3RvcmUuc2V0KGVuZHBvaW50LCBpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0RGVsZXRlRmlsZVBhcmFtczogZnVuY3Rpb24ocGFyYW1zLCBpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbGVQYXJhbXNTdG9yZS5zZXQocGFyYW1zLCBpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0RW5kcG9pbnQ6IGZ1bmN0aW9uKGVuZHBvaW50LCBpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2VuZHBvaW50U3RvcmUuc2V0KGVuZHBvaW50LCBpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Rm9ybTogZnVuY3Rpb24oZWxlbWVudE9ySWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVGb3JtU3VwcG9ydEFuZFBhcmFtcyhlbGVtZW50T3JJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0SXRlbUxpbWl0OiBmdW5jdGlvbihuZXdJdGVtTGltaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50SXRlbUxpbWl0ID0gbmV3SXRlbUxpbWl0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldE5hbWU6IGZ1bmN0aW9uKGlkLCBuZXdOYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS51cGRhdGVOYW1lKGlkLCBuZXdOYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRQYXJhbXM6IGZ1bmN0aW9uKHBhcmFtcywgaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXNTdG9yZS5zZXQocGFyYW1zLCBpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0VXVpZDogZnVuY3Rpb24oaWQsIG5ld1V1aWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBsb2FkRGF0YS51dWlkQ2hhbmdlZChpZCwgbmV3VXVpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0U3RhdHVzOiBmdW5jdGlvbihpZCwgbmV3U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVSZWNvcmQgPSB0aGlzLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIWZpbGVSZWNvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHFxLkVycm9yKGlkICsgXCIgaXMgbm90IGEgdmFsaWQgZmlsZSBJRC5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN3aXRjaCAobmV3U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICBjYXNlIHFxLnN0YXR1cy5ERUxFVEVEOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkRlbGV0ZUNvbXBsZXRlKGlkLCBudWxsLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICBjYXNlIHFxLnN0YXR1cy5ERUxFVEVfRkFJTEVEOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkRlbGV0ZUNvbXBsZXRlKGlkLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBcIk1ldGhvZCBzZXRTdGF0dXMgY2FsbGVkIG9uICdcIiArIG5hbWUgKyBcIicgbm90IGltcGxlbWVudGVkIHlldCBmb3IgXCIgKyBuZXdTdGF0dXM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKGVycm9yTWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBxcS5FcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGxvYWRTdG9yZWRGaWxlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0b3JlZElkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXRlbUVycm9yKFwibm9GaWxlc0Vycm9yXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZFN0b3JlZEZpbGVzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5iYXNlUHJpdmF0ZUFwaSA9IHtcbiAgICAgICAgICAgIF9hZGRDYW5uZWRGaWxlOiBmdW5jdGlvbihzZXNzaW9uRGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBsb2FkRGF0YS5hZGRGaWxlKHtcbiAgICAgICAgICAgICAgICAgICAgdXVpZDogc2Vzc2lvbkRhdGEudXVpZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogc2Vzc2lvbkRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2Vzc2lvbkRhdGEuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBxcS5zdGF0dXMuVVBMT0FEX1NVQ0NFU1NGVUwsXG4gICAgICAgICAgICAgICAgICAgIG9uQmVmb3JlU3RhdHVzQ2hhbmdlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkRhdGEuZGVsZXRlRmlsZUVuZHBvaW50ICYmIHNlbGYuc2V0RGVsZXRlRmlsZUVuZHBvaW50KHNlc3Npb25EYXRhLmRlbGV0ZUZpbGVFbmRwb2ludCwgaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkRhdGEuZGVsZXRlRmlsZVBhcmFtcyAmJiBzZWxmLnNldERlbGV0ZUZpbGVQYXJhbXMoc2Vzc2lvbkRhdGEuZGVsZXRlRmlsZVBhcmFtcywgaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb25EYXRhLnRodW1ibmFpbFVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3RodW1ibmFpbFVybHNbaWRdID0gc2Vzc2lvbkRhdGEudGh1bWJuYWlsVXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbmV0VXBsb2FkZWQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX25ldFVwbG9hZGVkT3JRdWV1ZWQrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9hbm5vdGF0ZVdpdGhCdXR0b25JZDogZnVuY3Rpb24oZmlsZSwgYXNzb2NpYXRlZElucHV0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzRmlsZShmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlLnFxQnV0dG9uSWQgPSB0aGlzLl9nZXRCdXR0b25JZChhc3NvY2lhdGVkSW5wdXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYmF0Y2hFcnJvcjogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uRXJyb3IobnVsbCwgbnVsbCwgbWVzc2FnZSwgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY3JlYXRlRGVsZXRlSGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuRGVsZXRlRmlsZUFqYXhSZXF1ZXN0ZXIoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHRoaXMuX29wdGlvbnMuZGVsZXRlRmlsZS5tZXRob2QudG9VcHBlckNhc2UoKSxcbiAgICAgICAgICAgICAgICAgICAgbWF4Q29ubmVjdGlvbnM6IHRoaXMuX29wdGlvbnMubWF4Q29ubmVjdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgIHV1aWRQYXJhbU5hbWU6IHRoaXMuX29wdGlvbnMucmVxdWVzdC51dWlkTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tSGVhZGVyczogdGhpcy5fZGVsZXRlRmlsZUN1c3RvbUhlYWRlcnNTdG9yZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zU3RvcmU6IHRoaXMuX2RlbGV0ZUZpbGVQYXJhbXNTdG9yZSxcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnRTdG9yZTogdGhpcy5fZGVsZXRlRmlsZUVuZHBvaW50U3RvcmUsXG4gICAgICAgICAgICAgICAgICAgIGNvcnM6IHRoaXMuX29wdGlvbnMuY29ycyxcbiAgICAgICAgICAgICAgICAgICAgbG9nOiBxcS5iaW5kKHNlbGYubG9nLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgb25EZWxldGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vbkRlbGV0ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vbkRlbGV0ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uRGVsZXRlQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCB4aHJPclhkciwgaXNFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25EZWxldGVDb21wbGV0ZShpZCwgeGhyT3JYZHIsIGlzRXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25EZWxldGVDb21wbGV0ZShpZCwgeGhyT3JYZHIsIGlzRXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NyZWF0ZVBhc3RlSGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuUGFzdGVTdXBwb3J0KHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudDogdGhpcy5fb3B0aW9ucy5wYXN0ZS50YXJnZXRFbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZzogcXEuYmluZChzZWxmLmxvZywgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZVJlY2VpdmVkOiBmdW5jdGlvbihibG9iKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlQ2hlY2tlZENhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJvblBhc3RlUmVjZWl2ZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHFxLmJpbmQoc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25QYXN0ZVJlY2VpdmVkLCBzZWxmLCBibG9iKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBxcS5iaW5kKHNlbGYuX2hhbmRsZVBhc3RlU3VjY2Vzcywgc2VsZiwgYmxvYiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IFwicGFzdGVkIGltYWdlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jcmVhdGVTdG9yZTogZnVuY3Rpb24oaW5pdGlhbFZhbHVlLCBfcmVhZE9ubHlWYWx1ZXNfKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0b3JlID0ge30sIGNhdGNoYWxsID0gaW5pdGlhbFZhbHVlLCBwZXJJZFJlYWRPbmx5VmFsdWVzID0ge30sIHJlYWRPbmx5VmFsdWVzID0gX3JlYWRPbmx5VmFsdWVzXywgY29weSA9IGZ1bmN0aW9uKG9yaWcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzT2JqZWN0KG9yaWcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXEuZXh0ZW5kKHt9LCBvcmlnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZztcbiAgICAgICAgICAgICAgICB9LCBnZXRSZWFkT25seVZhbHVlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNGdW5jdGlvbihyZWFkT25seVZhbHVlcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWFkT25seVZhbHVlcygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWFkT25seVZhbHVlcztcbiAgICAgICAgICAgICAgICB9LCBpbmNsdWRlUmVhZE9ubHlWYWx1ZXMgPSBmdW5jdGlvbihpZCwgZXhpc3RpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYWRPbmx5VmFsdWVzICYmIHFxLmlzT2JqZWN0KGV4aXN0aW5nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEuZXh0ZW5kKGV4aXN0aW5nLCBnZXRSZWFkT25seVZhbHVlcygpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocGVySWRSZWFkT25seVZhbHVlc1tpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxLmV4dGVuZChleGlzdGluZywgcGVySWRSZWFkT25seVZhbHVlc1tpZF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCwgaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaGFsbCA9IGNvcHkodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmVbaWRdID0gY29weSh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkICE9IG51bGwgJiYgc3RvcmVbaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gc3RvcmVbaWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBjb3B5KGNhdGNoYWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGVSZWFkT25seVZhbHVlcyhpZCwgdmFsdWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb3B5KHZhbHVlcyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGFkZFJlYWRPbmx5OiBmdW5jdGlvbihpZCwgdmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNPYmplY3Qoc3RvcmUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc0Z1bmN0aW9uKHZhbHVlcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRPbmx5VmFsdWVzID0gdmFsdWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZE9ubHlWYWx1ZXMgPSByZWFkT25seVZhbHVlcyB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxLmV4dGVuZChyZWFkT25seVZhbHVlcywgdmFsdWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcklkUmVhZE9ubHlWYWx1ZXNbaWRdID0gcGVySWRSZWFkT25seVZhbHVlc1tpZF0gfHwge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxLmV4dGVuZChwZXJJZFJlYWRPbmx5VmFsdWVzW2lkXSwgdmFsdWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVsZXRlIHN0b3JlW2ZpbGVJZF07XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJJZFJlYWRPbmx5VmFsdWVzID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaGFsbCA9IGluaXRpYWxWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NyZWF0ZVVwbG9hZERhdGFUcmFja2VyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5VcGxvYWREYXRhKHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0TmFtZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRVdWlkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0VXVpZChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldFNpemU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRTaXplKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25TdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uKGlkLCBvbGRTdGF0dXMsIG5ld1N0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25VcGxvYWRTdGF0dXNDaGFuZ2UoaWQsIG9sZFN0YXR1cywgbmV3U3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uU3RhdHVzQ2hhbmdlKGlkLCBvbGRTdGF0dXMsIG5ld1N0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYXliZUFsbENvbXBsZXRlKGlkLCBuZXdTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuX3RvdGFsUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl90b3RhbFByb2dyZXNzLm9uU3RhdHVzQ2hhbmdlKGlkLCBvbGRTdGF0dXMsIG5ld1N0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY3JlYXRlVXBsb2FkQnV0dG9uOiBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBhY2NlcHRGaWxlcyA9IHNwZWMuYWNjZXB0IHx8IHRoaXMuX29wdGlvbnMudmFsaWRhdGlvbi5hY2NlcHRGaWxlcywgYWxsb3dlZEV4dGVuc2lvbnMgPSBzcGVjLmFsbG93ZWRFeHRlbnNpb25zIHx8IHRoaXMuX29wdGlvbnMudmFsaWRhdGlvbi5hbGxvd2VkRXh0ZW5zaW9ucywgYnV0dG9uO1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGFsbG93TXVsdGlwbGUoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5zdXBwb3J0ZWRGZWF0dXJlcy5hamF4VXBsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5fb3B0aW9ucy53b3JrYXJvdW5kcy5pb3NFbXB0eVZpZGVvcyAmJiBxcS5pb3MoKSAmJiAhcXEuaW9zNigpICYmIHNlbGYuX2lzQWxsb3dlZEV4dGVuc2lvbihhbGxvd2VkRXh0ZW5zaW9ucywgXCIubW92XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWMubXVsdGlwbGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcHRpb25zLm11bHRpcGxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNwZWMubXVsdGlwbGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBidXR0b24gPSBuZXcgcXEuVXBsb2FkQnV0dG9uKHtcbiAgICAgICAgICAgICAgICAgICAgYWNjZXB0RmlsZXM6IGFjY2VwdEZpbGVzLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBzcGVjLmVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIGZvY3VzQ2xhc3M6IHRoaXMuX29wdGlvbnMuY2xhc3Nlcy5idXR0b25Gb2N1cyxcbiAgICAgICAgICAgICAgICAgICAgZm9sZGVyczogc3BlYy5mb2xkZXJzLFxuICAgICAgICAgICAgICAgICAgICBob3ZlckNsYXNzOiB0aGlzLl9vcHRpb25zLmNsYXNzZXMuYnV0dG9uSG92ZXIsXG4gICAgICAgICAgICAgICAgICAgIGlvczhCcm93c2VyQ3Jhc2hXb3JrYXJvdW5kOiB0aGlzLl9vcHRpb25zLndvcmthcm91bmRzLmlvczhCcm93c2VyQ3Jhc2gsXG4gICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiBhbGxvd011bHRpcGxlKCksXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuX29wdGlvbnMucmVxdWVzdC5pbnB1dE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25JbnB1dENoYW5nZShpbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBzcGVjLnRpdGxlID09IG51bGwgPyB0aGlzLl9vcHRpb25zLnRleHQuZmlsZUlucHV0VGl0bGUgOiBzcGVjLnRpdGxlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zZVN1cHBvcnQuYWRkRGlzcG9zZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2VsZi5fYnV0dG9ucy5wdXNoKGJ1dHRvbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY3JlYXRlVXBsb2FkSGFuZGxlcjogZnVuY3Rpb24oYWRkaXRpb25hbE9wdGlvbnMsIG5hbWVzcGFjZSkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgbGFzdE9uUHJvZ3Jlc3MgPSB7fSwgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWc6IHRoaXMuX29wdGlvbnMuZGVidWcsXG4gICAgICAgICAgICAgICAgICAgIG1heENvbm5lY3Rpb25zOiB0aGlzLl9vcHRpb25zLm1heENvbm5lY3Rpb25zLFxuICAgICAgICAgICAgICAgICAgICBjb3JzOiB0aGlzLl9vcHRpb25zLmNvcnMsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1N0b3JlOiB0aGlzLl9wYXJhbXNTdG9yZSxcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnRTdG9yZTogdGhpcy5fZW5kcG9pbnRTdG9yZSxcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtpbmc6IHRoaXMuX29wdGlvbnMuY2h1bmtpbmcsXG4gICAgICAgICAgICAgICAgICAgIHJlc3VtZTogdGhpcy5fb3B0aW9ucy5yZXN1bWUsXG4gICAgICAgICAgICAgICAgICAgIGJsb2JzOiB0aGlzLl9vcHRpb25zLmJsb2JzLFxuICAgICAgICAgICAgICAgICAgICBsb2c6IHFxLmJpbmQoc2VsZi5sb2csIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICBwcmV2ZW50UmV0cnlQYXJhbTogdGhpcy5fb3B0aW9ucy5yZXRyeS5wcmV2ZW50UmV0cnlSZXNwb25zZVByb3BlcnR5LFxuICAgICAgICAgICAgICAgICAgICBvblByb2dyZXNzOiBmdW5jdGlvbihpZCwgbmFtZSwgbG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRlZCA8IDAgfHwgdG90YWwgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RPblByb2dyZXNzW2lkXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0T25Qcm9ncmVzc1tpZF0ubG9hZGVkICE9PSBsb2FkZWQgfHwgbGFzdE9uUHJvZ3Jlc3NbaWRdLnRvdGFsICE9PSB0b3RhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vblByb2dyZXNzKGlkLCBuYW1lLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25Qcm9ncmVzcyhpZCwgbmFtZSwgbG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vblByb2dyZXNzKGlkLCBuYW1lLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblByb2dyZXNzKGlkLCBuYW1lLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RPblByb2dyZXNzW2lkXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IGxvYWRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCBuYW1lLCByZXN1bHQsIHhocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGxhc3RPblByb2dyZXNzW2lkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBzZWxmLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuc3RhdHVzLCByZXRWYWw7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FEX1NVQ0NFU1NGVUwgfHwgc3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FEX0ZBSUxFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IHNlbGYuX29uQ29tcGxldGUoaWQsIG5hbWUsIHJlc3VsdCwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRWYWwgaW5zdGFuY2VvZiBxcS5Qcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsLmRvbmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uQ29tcGxldGUoaWQsIG5hbWUsIHJlc3VsdCwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25Db21wbGV0ZShpZCwgbmFtZSwgcmVzdWx0LCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24oaWQsIG5hbWUsIGNhbmNlbEZpbmFsaXphdGlvbkVmZm9ydCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlQ2hlY2tlZENhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIm9uQ2FuY2VsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHFxLmJpbmQoc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25DYW5jZWwsIHNlbGYsIGlkLCBuYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IHByb21pc2UuZmFpbHVyZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxGaW5hbGl6YXRpb25FZmZvcnQudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uQ2FuY2VsKGlkLCBuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcjogaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkUHJlcDogcXEuYmluZCh0aGlzLl9vblVwbG9hZFByZXAsIHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICBvblVwbG9hZDogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uVXBsb2FkKGlkLCBuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvblVwbG9hZFJlc3VsdCA9IHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uVXBsb2FkKGlkLCBuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc0dlbmVyaWNQcm9taXNlKG9uVXBsb2FkUmVzdWx0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKHFxLmZvcm1hdChcIm9uVXBsb2FkIGZvciB7fSByZXR1cm5lZCBhIFByb21pc2UgLSB3YWl0aW5nIGZvciByZXNvbHV0aW9uLlwiLCBpZCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvblVwbG9hZFJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuUHJvbWlzZSgpLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWRDaHVuazogZnVuY3Rpb24oaWQsIG5hbWUsIGNodW5rRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25VcGxvYWRDaHVuayhpZCwgY2h1bmtEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvblVwbG9hZENodW5rUmVzdWx0ID0gc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25VcGxvYWRDaHVuayhpZCwgbmFtZSwgY2h1bmtEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc0dlbmVyaWNQcm9taXNlKG9uVXBsb2FkQ2h1bmtSZXN1bHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2cocXEuZm9ybWF0KFwib25VcGxvYWRDaHVuayBmb3Ige30ue30gcmV0dXJuZWQgYSBQcm9taXNlIC0gd2FpdGluZyBmb3IgcmVzb2x1dGlvbi5cIiwgaWQsIGNodW5rRGF0YS5wYXJ0SW5kZXgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb25VcGxvYWRDaHVua1Jlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuUHJvbWlzZSgpLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWRDaHVua1N1Y2Nlc3M6IGZ1bmN0aW9uKGlkLCBjaHVua0RhdGEsIHJlc3VsdCwgeGhyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vblVwbG9hZENodW5rU3VjY2VzcyhpZCwgY2h1bmtEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uVXBsb2FkQ2h1bmtTdWNjZXNzLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uUmVzdW1lOiBmdW5jdGlvbihpZCwgbmFtZSwgY2h1bmtEYXRhLCBjdXN0b21SZXN1bWVEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25SZXN1bWUoaWQsIG5hbWUsIGNodW5rRGF0YSwgY3VzdG9tUmVzdW1lRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uQXV0b1JldHJ5OiBmdW5jdGlvbihpZCwgbmFtZSwgcmVzcG9uc2VKU09OLCB4aHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9vbkF1dG9SZXRyeS5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblV1aWRDaGFuZ2VkOiBmdW5jdGlvbihpZCwgbmV3VXVpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2coXCJTZXJ2ZXIgcmVxdWVzdGVkIFVVSUQgY2hhbmdlIGZyb20gJ1wiICsgc2VsZi5nZXRVdWlkKGlkKSArIFwiJyB0byAnXCIgKyBuZXdVdWlkICsgXCInXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRVdWlkKGlkLCBuZXdVdWlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0TmFtZTogcXEuYmluZChzZWxmLmdldE5hbWUsIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICBnZXRVdWlkOiBxcS5iaW5kKHNlbGYuZ2V0VXVpZCwgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgIGdldFNpemU6IHFxLmJpbmQoc2VsZi5nZXRTaXplLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgc2V0U2l6ZTogcXEuYmluZChzZWxmLl9zZXRTaXplLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YUJ5VXVpZDogZnVuY3Rpb24odXVpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogdXVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGlzUXVldWVkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHNlbGYuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5zdGF0dXM7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdHVzID09PSBxcS5zdGF0dXMuUVVFVUVEIHx8IHN0YXR1cyA9PT0gcXEuc3RhdHVzLlNVQk1JVFRFRCB8fCBzdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURfUkVUUllJTkcgfHwgc3RhdHVzID09PSBxcS5zdGF0dXMuUEFVU0VEO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRJZHNJblByb3h5R3JvdXA6IHNlbGYuX3VwbG9hZERhdGEuZ2V0SWRzSW5Qcm94eUdyb3VwLFxuICAgICAgICAgICAgICAgICAgICBnZXRJZHNJbkJhdGNoOiBzZWxmLl91cGxvYWREYXRhLmdldElkc0luQmF0Y2gsXG4gICAgICAgICAgICAgICAgICAgIGlzSW5Qcm9ncmVzczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuc3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FESU5HO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRDdXN0b21SZXN1bWVEYXRhOiBxcS5iaW5kKHNlbGYuX2dldEN1c3RvbVJlc3VtZURhdGEsIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICBzZXRTdGF0dXM6IGZ1bmN0aW9uKGlkLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBzdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHRoaXMuX29wdGlvbnMucmVxdWVzdCwgZnVuY3Rpb24ocHJvcCwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbcHJvcF0gPSB2YWw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jdXN0b21IZWFkZXJzID0gdGhpcy5fY3VzdG9tSGVhZGVyc1N0b3JlO1xuICAgICAgICAgICAgICAgIGlmIChhZGRpdGlvbmFsT3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGFkZGl0aW9uYWxPcHRpb25zLCBmdW5jdGlvbihrZXksIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1trZXldID0gdmFsO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5VcGxvYWRIYW5kbGVyQ29udHJvbGxlcihvcHRpb25zLCBuYW1lc3BhY2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9maWxlT3JCbG9iUmVqZWN0ZWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZC0tO1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuUkVKRUNURUQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9mb3JtYXRTaXplOiBmdW5jdGlvbihieXRlcykge1xuICAgICAgICAgICAgICAgIGlmIChieXRlcyA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnl0ZXMgKyB0aGlzLl9vcHRpb25zLnRleHQuc2l6ZVN5bWJvbHNbMF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBpID0gLTE7XG4gICAgICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgICAgICBieXRlcyA9IGJ5dGVzIC8gMWUzO1xuICAgICAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgfSB3aGlsZSAoYnl0ZXMgPiA5OTkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChieXRlcywgLjEpLnRvRml4ZWQoMSkgKyB0aGlzLl9vcHRpb25zLnRleHQuc2l6ZVN5bWJvbHNbaV07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dlbmVyYXRlRXh0cmFCdXR0b25TcGVjczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHRoaXMuX2V4dHJhQnV0dG9uU3BlY3MgPSB7fTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHRoaXMuX29wdGlvbnMuZXh0cmFCdXR0b25zLCBmdW5jdGlvbihpZHgsIGV4dHJhQnV0dG9uT3B0aW9uRW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG11bHRpcGxlID0gZXh0cmFCdXR0b25PcHRpb25FbnRyeS5tdWx0aXBsZSwgdmFsaWRhdGlvbiA9IHFxLmV4dGVuZCh7fSwgc2VsZi5fb3B0aW9ucy52YWxpZGF0aW9uLCB0cnVlKSwgZXh0cmFCdXR0b25TcGVjID0gcXEuZXh0ZW5kKHt9LCBleHRyYUJ1dHRvbk9wdGlvbkVudHJ5KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG11bHRpcGxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlID0gc2VsZi5fb3B0aW9ucy5tdWx0aXBsZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZXh0cmFCdXR0b25TcGVjLnZhbGlkYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxLmV4dGVuZCh2YWxpZGF0aW9uLCBleHRyYUJ1dHRvbk9wdGlvbkVudHJ5LnZhbGlkYXRpb24sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHFxLmV4dGVuZChleHRyYUJ1dHRvblNwZWMsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiBtdWx0aXBsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb246IHZhbGlkYXRpb25cbiAgICAgICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX2luaXRFeHRyYUJ1dHRvbihleHRyYUJ1dHRvblNwZWMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRCdXR0b246IGZ1bmN0aW9uKGJ1dHRvbklkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4dHJhQnV0dG9uc1NwZWMgPSB0aGlzLl9leHRyYUJ1dHRvblNwZWNzW2J1dHRvbklkXTtcbiAgICAgICAgICAgICAgICBpZiAoZXh0cmFCdXR0b25zU3BlYykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXh0cmFCdXR0b25zU3BlYy5lbGVtZW50O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYnV0dG9uSWQgPT09IHRoaXMuX2RlZmF1bHRCdXR0b25JZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9ucy5idXR0b247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRCdXR0b25JZDogZnVuY3Rpb24oYnV0dG9uT3JGaWxlSW5wdXRPckZpbGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5wdXRzLCBmaWxlSW5wdXQsIGZpbGVCbG9iT3JJbnB1dCA9IGJ1dHRvbk9yRmlsZUlucHV0T3JGaWxlO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlQmxvYk9ySW5wdXQgaW5zdGFuY2VvZiBxcS5CbG9iUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUJsb2JPcklucHV0ID0gZmlsZUJsb2JPcklucHV0LnJlZmVyZW5jZUJsb2I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChmaWxlQmxvYk9ySW5wdXQgJiYgIXFxLmlzQmxvYihmaWxlQmxvYk9ySW5wdXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc0ZpbGUoZmlsZUJsb2JPcklucHV0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVCbG9iT3JJbnB1dC5xcUJ1dHRvbklkO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpbGVCbG9iT3JJbnB1dC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiaW5wdXRcIiAmJiBmaWxlQmxvYk9ySW5wdXQudHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImZpbGVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVCbG9iT3JJbnB1dC5nZXRBdHRyaWJ1dGUocXEuVXBsb2FkQnV0dG9uLkJVVFRPTl9JRF9BVFRSX05BTUUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlucHV0cyA9IGZpbGVCbG9iT3JJbnB1dC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlucHV0XCIpO1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGlucHV0cywgZnVuY3Rpb24oaWR4LCBpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LmdldEF0dHJpYnV0ZShcInR5cGVcIikgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZUlucHV0ID0gaW5wdXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVJbnB1dC5nZXRBdHRyaWJ1dGUocXEuVXBsb2FkQnV0dG9uLkJVVFRPTl9JRF9BVFRSX05BTUUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRDdXN0b21SZXN1bWVEYXRhOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VzdG9tUmVzdW1lRGF0YVN0b3JlLmdldChmaWxlSWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXROb3RGaW5pc2hlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFsgcXEuc3RhdHVzLlVQTE9BRElORywgcXEuc3RhdHVzLlVQTE9BRF9SRVRSWUlORywgcXEuc3RhdHVzLlFVRVVFRCwgcXEuc3RhdHVzLlNVQk1JVFRJTkcsIHFxLnN0YXR1cy5TVUJNSVRURUQsIHFxLnN0YXR1cy5QQVVTRUQgXVxuICAgICAgICAgICAgICAgIH0pLmxlbmd0aDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0VmFsaWRhdGlvbkJhc2U6IGZ1bmN0aW9uKGJ1dHRvbklkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4dHJhQnV0dG9uU3BlYyA9IHRoaXMuX2V4dHJhQnV0dG9uU3BlY3NbYnV0dG9uSWRdO1xuICAgICAgICAgICAgICAgIHJldHVybiBleHRyYUJ1dHRvblNwZWMgPyBleHRyYUJ1dHRvblNwZWMudmFsaWRhdGlvbiA6IHRoaXMuX29wdGlvbnMudmFsaWRhdGlvbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0VmFsaWRhdGlvbkRlc2NyaXB0b3I6IGZ1bmN0aW9uKGZpbGVXcmFwcGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVXcmFwcGVyLmZpbGUgaW5zdGFuY2VvZiBxcS5CbG9iUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHFxLmdldEZpbGVuYW1lKGZpbGVXcmFwcGVyLmZpbGUucmVmZXJlbmNlQmxvYiksXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBmaWxlV3JhcHBlci5maWxlLnJlZmVyZW5jZUJsb2Iuc2l6ZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGZpbGVXcmFwcGVyLmlkXG4gICAgICAgICAgICAgICAgICAgIH0pLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IHRoaXMuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZmlsZVdyYXBwZXIuaWRcbiAgICAgICAgICAgICAgICAgICAgfSkuc2l6ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldFZhbGlkYXRpb25EZXNjcmlwdG9yczogZnVuY3Rpb24oZmlsZVdyYXBwZXJzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBmaWxlRGVzY3JpcHRvcnMgPSBbXTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGZpbGVXcmFwcGVycywgZnVuY3Rpb24oaWR4LCBmaWxlV3JhcHBlcikge1xuICAgICAgICAgICAgICAgICAgICBmaWxlRGVzY3JpcHRvcnMucHVzaChzZWxmLl9nZXRWYWxpZGF0aW9uRGVzY3JpcHRvcihmaWxlV3JhcHBlcikpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlRGVzY3JpcHRvcnM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hhbmRsZUNhbWVyYUFjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuY2FtZXJhLmlvcyAmJiBxcS5pb3MoKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYWNjZXB0SW9zQ2FtZXJhID0gXCJpbWFnZS8qO2NhcHR1cmU9Y2FtZXJhXCIsIGJ1dHRvbiA9IHRoaXMuX29wdGlvbnMuY2FtZXJhLmJ1dHRvbiwgYnV0dG9uSWQgPSBidXR0b24gPyB0aGlzLl9nZXRCdXR0b25JZChidXR0b24pIDogdGhpcy5fZGVmYXVsdEJ1dHRvbklkLCBvcHRpb25Sb290ID0gdGhpcy5fb3B0aW9ucztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbklkICYmIGJ1dHRvbklkICE9PSB0aGlzLl9kZWZhdWx0QnV0dG9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvblJvb3QgPSB0aGlzLl9leHRyYUJ1dHRvblNwZWNzW2J1dHRvbklkXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvcHRpb25Sb290Lm11bHRpcGxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25Sb290LnZhbGlkYXRpb24uYWNjZXB0RmlsZXMgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvblJvb3QudmFsaWRhdGlvbi5hY2NlcHRGaWxlcyA9IGFjY2VwdElvc0NhbWVyYTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvblJvb3QudmFsaWRhdGlvbi5hY2NlcHRGaWxlcyArPSBcIixcIiArIGFjY2VwdElvc0NhbWVyYTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKHRoaXMuX2J1dHRvbnMsIGZ1bmN0aW9uKGlkeCwgYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnV0dG9uLmdldEJ1dHRvbklkKCkgPT09IGJ1dHRvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnNldE11bHRpcGxlKG9wdGlvblJvb3QubXVsdGlwbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBY2NlcHRGaWxlcyhvcHRpb25Sb290LmFjY2VwdEZpbGVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGFuZGxlQ2hlY2tlZENhbGxiYWNrOiBmdW5jdGlvbihkZXRhaWxzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBjYWxsYmFja1JldFZhbCA9IGRldGFpbHMuY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNHZW5lcmljUHJvbWlzZShjYWxsYmFja1JldFZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coZGV0YWlscy5uYW1lICsgXCIgLSB3YWl0aW5nIGZvciBcIiArIGRldGFpbHMubmFtZSArIFwiIHByb21pc2UgdG8gYmUgZnVsZmlsbGVkIGZvciBcIiArIGRldGFpbHMuaWRlbnRpZmllcik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFja1JldFZhbC50aGVuKGZ1bmN0aW9uKHN1Y2Nlc3NQYXJhbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2coZGV0YWlscy5uYW1lICsgXCIgcHJvbWlzZSBzdWNjZXNzIGZvciBcIiArIGRldGFpbHMuaWRlbnRpZmllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxzLm9uU3VjY2VzcyhzdWNjZXNzUGFyYW0pO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXRhaWxzLm9uRmFpbHVyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKGRldGFpbHMubmFtZSArIFwiIHByb21pc2UgZmFpbHVyZSBmb3IgXCIgKyBkZXRhaWxzLmlkZW50aWZpZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHMub25GYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKGRldGFpbHMubmFtZSArIFwiIHByb21pc2UgZmFpbHVyZSBmb3IgXCIgKyBkZXRhaWxzLmlkZW50aWZpZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrUmV0VmFsICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBkZXRhaWxzLm9uU3VjY2VzcyhjYWxsYmFja1JldFZhbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRldGFpbHMub25GYWlsdXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhkZXRhaWxzLm5hbWUgKyBcIiAtIHJldHVybiB2YWx1ZSB3YXMgJ2ZhbHNlJyBmb3IgXCIgKyBkZXRhaWxzLmlkZW50aWZpZXIgKyBcIi4gIEludm9raW5nIGZhaWx1cmUgY2FsbGJhY2suXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlscy5vbkZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKGRldGFpbHMubmFtZSArIFwiIC0gcmV0dXJuIHZhbHVlIHdhcyAnZmFsc2UnIGZvciBcIiArIGRldGFpbHMuaWRlbnRpZmllciArIFwiLiAgV2lsbCBub3QgcHJvY2VlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrUmV0VmFsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oYW5kbGVOZXdGaWxlOiBmdW5jdGlvbihmaWxlLCBiYXRjaElkLCBuZXdGaWxlV3JhcHBlckxpc3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIHV1aWQgPSBxcS5nZXRVbmlxdWVJZCgpLCBzaXplID0gLTEsIG5hbWUgPSBxcS5nZXRGaWxlbmFtZShmaWxlKSwgYWN0dWFsRmlsZSA9IGZpbGUuYmxvYiB8fCBmaWxlLCBoYW5kbGVyID0gdGhpcy5fY3VzdG9tTmV3RmlsZUhhbmRsZXIgPyB0aGlzLl9jdXN0b21OZXdGaWxlSGFuZGxlciA6IHFxLmJpbmQoc2VsZi5faGFuZGxlTmV3RmlsZUdlbmVyaWMsIHNlbGYpO1xuICAgICAgICAgICAgICAgIGlmICghcXEuaXNJbnB1dChhY3R1YWxGaWxlKSAmJiBhY3R1YWxGaWxlLnNpemUgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzaXplID0gYWN0dWFsRmlsZS5zaXplO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBoYW5kbGVyKGFjdHVhbEZpbGUsIG5hbWUsIHV1aWQsIHNpemUsIG5ld0ZpbGVXcmFwcGVyTGlzdCwgYmF0Y2hJZCwgdGhpcy5fb3B0aW9ucy5yZXF1ZXN0LnV1aWROYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZERhdGE6IHNlbGYuX3VwbG9hZERhdGEsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1N0b3JlOiBzZWxmLl9wYXJhbXNTdG9yZSxcbiAgICAgICAgICAgICAgICAgICAgYWRkRmlsZVRvSGFuZGxlcjogZnVuY3Rpb24oaWQsIGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2hhbmRsZXIuYWRkKGlkLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX25ldFVwbG9hZGVkT3JRdWV1ZWQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3RyYWNrQnV0dG9uKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oYW5kbGVOZXdGaWxlR2VuZXJpYzogZnVuY3Rpb24oZmlsZSwgbmFtZSwgdXVpZCwgc2l6ZSwgZmlsZUxpc3QsIGJhdGNoSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSB0aGlzLl91cGxvYWREYXRhLmFkZEZpbGUoe1xuICAgICAgICAgICAgICAgICAgICB1dWlkOiB1dWlkLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBzaXplLFxuICAgICAgICAgICAgICAgICAgICBiYXRjaElkOiBiYXRjaElkLFxuICAgICAgICAgICAgICAgICAgICBmaWxlOiBmaWxlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlci5hZGQoaWQsIGZpbGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RyYWNrQnV0dG9uKGlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkKys7XG4gICAgICAgICAgICAgICAgZmlsZUxpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgZmlsZTogZmlsZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oYW5kbGVQYXN0ZVN1Y2Nlc3M6IGZ1bmN0aW9uKGJsb2IsIGV4dFN1cHBsaWVkTmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBleHRlbnNpb24gPSBibG9iLnR5cGUuc3BsaXQoXCIvXCIpWzFdLCBuYW1lID0gZXh0U3VwcGxpZWROYW1lO1xuICAgICAgICAgICAgICAgIGlmIChuYW1lID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHRoaXMuX29wdGlvbnMucGFzdGUuZGVmYXVsdE5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5hbWUgKz0gXCIuXCIgKyBleHRlbnNpb247XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRGaWxlcyh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGJsb2I6IGJsb2JcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGFuZGxlRGVsZXRlU3VjY2VzczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSkuc3RhdHVzICE9PSBxcS5zdGF0dXMuREVMRVRFRCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHRoaXMuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQtLTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWQtLTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlci5leHB1bmdlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5ERUxFVEVEKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coXCJEZWxldGUgcmVxdWVzdCBmb3IgJ1wiICsgbmFtZSArIFwiJyBoYXMgc3VjY2VlZGVkLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hhbmRsZURlbGV0ZUZhaWxlZDogZnVuY3Rpb24oaWQsIHhock9yWGRyKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB0aGlzLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuREVMRVRFX0ZBSUxFRCk7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2coXCJEZWxldGUgcmVxdWVzdCBmb3IgJ1wiICsgbmFtZSArIFwiJyBoYXMgZmFpbGVkLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIGlmICgheGhyT3JYZHIgfHwgeGhyT3JYZHIud2l0aENyZWRlbnRpYWxzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25FcnJvcihpZCwgbmFtZSwgXCJEZWxldGUgcmVxdWVzdCBmYWlsZWRcIiwgeGhyT3JYZHIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uRXJyb3IoaWQsIG5hbWUsIFwiRGVsZXRlIHJlcXVlc3QgZmFpbGVkIHdpdGggcmVzcG9uc2UgY29kZSBcIiArIHhock9yWGRyLnN0YXR1cywgeGhyT3JYZHIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaW5pdEV4dHJhQnV0dG9uOiBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IHRoaXMuX2NyZWF0ZVVwbG9hZEJ1dHRvbih7XG4gICAgICAgICAgICAgICAgICAgIGFjY2VwdDogc3BlYy52YWxpZGF0aW9uLmFjY2VwdEZpbGVzLFxuICAgICAgICAgICAgICAgICAgICBhbGxvd2VkRXh0ZW5zaW9uczogc3BlYy52YWxpZGF0aW9uLmFsbG93ZWRFeHRlbnNpb25zLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBzcGVjLmVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIGZvbGRlcnM6IHNwZWMuZm9sZGVycyxcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IHNwZWMubXVsdGlwbGUsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBzcGVjLmZpbGVJbnB1dFRpdGxlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fZXh0cmFCdXR0b25TcGVjc1tidXR0b24uZ2V0QnV0dG9uSWQoKV0gPSBzcGVjO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pbml0Rm9ybVN1cHBvcnRBbmRQYXJhbXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2Zvcm1TdXBwb3J0ID0gcXEuRm9ybVN1cHBvcnQgJiYgbmV3IHFxLkZvcm1TdXBwb3J0KHRoaXMuX29wdGlvbnMuZm9ybSwgcXEuYmluZCh0aGlzLnVwbG9hZFN0b3JlZEZpbGVzLCB0aGlzKSwgcXEuYmluZCh0aGlzLmxvZywgdGhpcykpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9mb3JtU3VwcG9ydCAmJiB0aGlzLl9mb3JtU3VwcG9ydC5hdHRhY2hlZFRvRm9ybSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXNTdG9yZSA9IHRoaXMuX2NyZWF0ZVN0b3JlKHRoaXMuX29wdGlvbnMucmVxdWVzdC5wYXJhbXMsIHRoaXMuX2Zvcm1TdXBwb3J0LmdldEZvcm1JbnB1dHNBc09iamVjdCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuYXV0b1VwbG9hZCA9IHRoaXMuX2Zvcm1TdXBwb3J0Lm5ld0F1dG9VcGxvYWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9mb3JtU3VwcG9ydC5uZXdFbmRwb2ludCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5yZXF1ZXN0LmVuZHBvaW50ID0gdGhpcy5fZm9ybVN1cHBvcnQubmV3RW5kcG9pbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXNTdG9yZSA9IHRoaXMuX2NyZWF0ZVN0b3JlKHRoaXMuX29wdGlvbnMucmVxdWVzdC5wYXJhbXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaXNEZWxldGVQb3NzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFxcS5EZWxldGVGaWxlQWpheFJlcXVlc3RlciB8fCAhdGhpcy5fb3B0aW9ucy5kZWxldGVGaWxlLmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5jb3JzLmV4cGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5zdXBwb3J0ZWRGZWF0dXJlcy5kZWxldGVGaWxlQ29yc1hocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLnN1cHBvcnRlZEZlYXR1cmVzLmRlbGV0ZUZpbGVDb3JzWGRyICYmIHRoaXMuX29wdGlvbnMuY29ycy5hbGxvd1hkcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaXNBbGxvd2VkRXh0ZW5zaW9uOiBmdW5jdGlvbihhbGxvd2VkLCBmaWxlTmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciB2YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmICghYWxsb3dlZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHFxLmVhY2goYWxsb3dlZCwgZnVuY3Rpb24oaWR4LCBhbGxvd2VkRXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc1N0cmluZyhhbGxvd2VkRXh0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4dFJlZ2V4ID0gbmV3IFJlZ0V4cChcIlxcXFwuXCIgKyBhbGxvd2VkRXh0ICsgXCIkXCIsIFwiaVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlTmFtZS5tYXRjaChleHRSZWdleCkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2l0ZW1FcnJvcjogZnVuY3Rpb24oY29kZSwgbWF5YmVOYW1lT3JOYW1lcywgaXRlbSkge1xuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gdGhpcy5fb3B0aW9ucy5tZXNzYWdlc1tjb2RlXSwgYWxsb3dlZEV4dGVuc2lvbnMgPSBbXSwgbmFtZXMgPSBbXS5jb25jYXQobWF5YmVOYW1lT3JOYW1lcyksIG5hbWUgPSBuYW1lc1swXSwgYnV0dG9uSWQgPSB0aGlzLl9nZXRCdXR0b25JZChpdGVtKSwgdmFsaWRhdGlvbkJhc2UgPSB0aGlzLl9nZXRWYWxpZGF0aW9uQmFzZShidXR0b25JZCksIGV4dGVuc2lvbnNGb3JNZXNzYWdlLCBwbGFjZWhvbGRlck1hdGNoO1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHIobmFtZSwgcmVwbGFjZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UucmVwbGFjZShuYW1lLCByZXBsYWNlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHFxLmVhY2godmFsaWRhdGlvbkJhc2UuYWxsb3dlZEV4dGVuc2lvbnMsIGZ1bmN0aW9uKGlkeCwgYWxsb3dlZEV4dGVuc2lvbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNTdHJpbmcoYWxsb3dlZEV4dGVuc2lvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRFeHRlbnNpb25zLnB1c2goYWxsb3dlZEV4dGVuc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBleHRlbnNpb25zRm9yTWVzc2FnZSA9IGFsbG93ZWRFeHRlbnNpb25zLmpvaW4oXCIsIFwiKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIHIoXCJ7ZmlsZX1cIiwgdGhpcy5fb3B0aW9ucy5mb3JtYXRGaWxlTmFtZShuYW1lKSk7XG4gICAgICAgICAgICAgICAgcihcIntleHRlbnNpb25zfVwiLCBleHRlbnNpb25zRm9yTWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgcihcIntzaXplTGltaXR9XCIsIHRoaXMuX2Zvcm1hdFNpemUodmFsaWRhdGlvbkJhc2Uuc2l6ZUxpbWl0KSk7XG4gICAgICAgICAgICAgICAgcihcInttaW5TaXplTGltaXR9XCIsIHRoaXMuX2Zvcm1hdFNpemUodmFsaWRhdGlvbkJhc2UubWluU2l6ZUxpbWl0KSk7XG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXJNYXRjaCA9IG1lc3NhZ2UubWF0Y2goLyhcXHtcXHcrXFx9KS9nKTtcbiAgICAgICAgICAgICAgICBpZiAocGxhY2Vob2xkZXJNYXRjaCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKHBsYWNlaG9sZGVyTWF0Y2gsIGZ1bmN0aW9uKGlkeCwgcGxhY2Vob2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHIocGxhY2Vob2xkZXIsIG5hbWVzW2lkeF0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25FcnJvcihudWxsLCBuYW1lLCBtZXNzYWdlLCB1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYW51YWxSZXRyeTogZnVuY3Rpb24oaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29uQmVmb3JlTWFudWFsUmV0cnkoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQrKztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5VUExPQURfUkVUUllJTkcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIucmV0cnkoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWF5YmVBbGxDb21wbGV0ZTogZnVuY3Rpb24oaWQsIHN0YXR1cykge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgbm90RmluaXNoZWQgPSB0aGlzLl9nZXROb3RGaW5pc2hlZCgpO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURfU1VDQ0VTU0ZVTCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdWNjZWVkZWRTaW5jZUxhc3RBbGxDb21wbGV0ZS5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRF9GQUlMRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmFpbGVkU2luY2VMYXN0QWxsQ29tcGxldGUucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChub3RGaW5pc2hlZCA9PT0gMCAmJiAodGhpcy5fc3VjY2VlZGVkU2luY2VMYXN0QWxsQ29tcGxldGUubGVuZ3RoIHx8IHRoaXMuX2ZhaWxlZFNpbmNlTGFzdEFsbENvbXBsZXRlLmxlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uQWxsQ29tcGxldGUoc2VsZi5fc3VjY2VlZGVkU2luY2VMYXN0QWxsQ29tcGxldGUsIHNlbGYuX2ZhaWxlZFNpbmNlTGFzdEFsbENvbXBsZXRlKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXliZUhhbmRsZUlvczhTYWZhcmlXb3JrYXJvdW5kOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMud29ya2Fyb3VuZHMuaW9zOFNhZmFyaVVwbG9hZHMgJiYgcXEuaW9zODAwKCkgJiYgcXEuaW9zU2FmYXJpKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydChzZWxmLl9vcHRpb25zLm1lc3NhZ2VzLnVuc3VwcG9ydGVkQnJvd3NlcklvczhTYWZhcmkpO1xuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHFxLkVycm9yKHRoaXMuX29wdGlvbnMubWVzc2FnZXMudW5zdXBwb3J0ZWRCcm93c2VySW9zOFNhZmFyaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXliZVBhcnNlQW5kU2VuZFVwbG9hZEVycm9yOiBmdW5jdGlvbihpZCwgbmFtZSwgcmVzcG9uc2UsIHhocikge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoeGhyICYmIHhoci5zdGF0dXMgIT09IDIwMCAmJiAhcmVzcG9uc2UuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uRXJyb3IoaWQsIG5hbWUsIFwiWEhSIHJldHVybmVkIHJlc3BvbnNlIGNvZGUgXCIgKyB4aHIuc3RhdHVzLCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVhc29uID0gcmVzcG9uc2UuZXJyb3IgPyByZXNwb25zZS5lcnJvciA6IHRoaXMuX29wdGlvbnMudGV4dC5kZWZhdWx0UmVzcG9uc2VFcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uRXJyb3IoaWQsIG5hbWUsIGVycm9yUmVhc29uLCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXliZVByb2Nlc3NOZXh0SXRlbUFmdGVyT25WYWxpZGF0ZUNhbGxiYWNrOiBmdW5jdGlvbih2YWxpZEl0ZW0sIGl0ZW1zLCBpbmRleCwgcGFyYW1zLCBlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID4gaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkSXRlbSB8fCAhdGhpcy5fb3B0aW9ucy52YWxpZGF0aW9uLnN0b3BPbkZpcnN0SW52YWxpZEZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbGlkYXRpb25EZXNjcmlwdG9yID0gc2VsZi5fZ2V0VmFsaWRhdGlvbkRlc2NyaXB0b3IoaXRlbXNbaW5kZXhdKSwgYnV0dG9uSWQgPSBzZWxmLl9nZXRCdXR0b25JZChpdGVtc1tpbmRleF0uZmlsZSksIGJ1dHRvbiA9IHNlbGYuX2dldEJ1dHRvbihidXR0b25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlQ2hlY2tlZENhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJvblZhbGlkYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBxcS5iaW5kKHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uVmFsaWRhdGUsIHNlbGYsIHZhbGlkYXRpb25EZXNjcmlwdG9yLCBidXR0b24pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IHFxLmJpbmQoc2VsZi5fb25WYWxpZGF0ZUNhbGxiYWNrU3VjY2Vzcywgc2VsZiwgaXRlbXMsIGluZGV4LCBwYXJhbXMsIGVuZHBvaW50KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GYWlsdXJlOiBxcS5iaW5kKHNlbGYuX29uVmFsaWRhdGVDYWxsYmFja0ZhaWx1cmUsIHNlbGYsIGl0ZW1zLCBpbmRleCwgcGFyYW1zLCBlbmRwb2ludCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IFwiSXRlbSAnXCIgKyB2YWxpZGF0aW9uRGVzY3JpcHRvci5uYW1lICsgXCInLCBzaXplOiBcIiArIHZhbGlkYXRpb25EZXNjcmlwdG9yLnNpemVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF2YWxpZEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoO2luZGV4IDwgaXRlbXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmlsZU9yQmxvYlJlamVjdGVkKGl0ZW1zW2luZGV4XS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQWxsQ29tcGxldGU6IGZ1bmN0aW9uKHN1Y2Nlc3NmdWwsIGZhaWxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsUHJvZ3Jlc3MgJiYgdGhpcy5fdG90YWxQcm9ncmVzcy5vbkFsbENvbXBsZXRlKHN1Y2Nlc3NmdWwsIGZhaWxlZCwgdGhpcy5fcHJldmVudFJldHJpZXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uQWxsQ29tcGxldGUocXEuZXh0ZW5kKFtdLCBzdWNjZXNzZnVsKSwgcXEuZXh0ZW5kKFtdLCBmYWlsZWQpKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWNjZWVkZWRTaW5jZUxhc3RBbGxDb21wbGV0ZSA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZhaWxlZFNpbmNlTGFzdEFsbENvbXBsZXRlID0gW107XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQXV0b1JldHJ5OiBmdW5jdGlvbihpZCwgbmFtZSwgcmVzcG9uc2VKU09OLCB4aHIsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHNlbGYuX3ByZXZlbnRSZXRyaWVzW2lkXSA9IHJlc3BvbnNlSlNPTltzZWxmLl9vcHRpb25zLnJldHJ5LnByZXZlbnRSZXRyeVJlc3BvbnNlUHJvcGVydHldO1xuICAgICAgICAgICAgICAgIGlmIChzZWxmLl9zaG91bGRBdXRvUmV0cnkoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXRyeVdhaXRQZXJpb2QgPSBzZWxmLl9vcHRpb25zLnJldHJ5LmF1dG9BdHRlbXB0RGVsYXkgKiAxZTM7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX21heWJlUGFyc2VBbmRTZW5kVXBsb2FkRXJyb3IuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25BdXRvUmV0cnkoaWQsIG5hbWUsIHNlbGYuX2F1dG9SZXRyaWVzW2lkXSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX29uQmVmb3JlQXV0b1JldHJ5KGlkLCBuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5VUExPQURfUkVUUllJTkcpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9yZXRyeVRpbWVvdXRzW2lkXSA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhcIlN0YXJ0aW5nIHJldHJ5IGZvciBcIiArIG5hbWUgKyBcIi4uLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlci5yZXRyeShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIHJldHJ5V2FpdFBlcmlvZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25CZWZvcmVBdXRvUmV0cnk6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2coXCJXYWl0aW5nIFwiICsgdGhpcy5fb3B0aW9ucy5yZXRyeS5hdXRvQXR0ZW1wdERlbGF5ICsgXCIgc2Vjb25kcyBiZWZvcmUgcmV0cnlpbmcgXCIgKyBuYW1lICsgXCIuLi5cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQmVmb3JlTWFudWFsUmV0cnk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1MaW1pdCA9IHRoaXMuX2N1cnJlbnRJdGVtTGltaXQsIGZpbGVOYW1lO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wcmV2ZW50UmV0cmllc1tpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coXCJSZXRyaWVzIGFyZSBmb3JiaWRkZW4gZm9yIGlkIFwiICsgaWQsIFwid2FyblwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5faGFuZGxlci5pc1ZhbGlkKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZSA9IHRoaXMuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vbk1hbnVhbFJldHJ5KGlkLCBmaWxlTmFtZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1MaW1pdCA+IDAgJiYgdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZCArIDEgPiBpdGVtTGltaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1FcnJvcihcInJldHJ5RmFpbFRvb01hbnlJdGVtc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIlJldHJ5aW5nIHVwbG9hZCBmb3IgJ1wiICsgZmlsZU5hbWUgKyBcIicgKGlkOiBcIiArIGlkICsgXCIpLi4uXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIidcIiArIGlkICsgXCInIGlzIG5vdCBhIHZhbGlkIGZpbGUgSURcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25DYW5jZWw6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZC0tO1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9yZXRyeVRpbWVvdXRzW2lkXSk7XG4gICAgICAgICAgICAgICAgdmFyIHN0b3JlZEl0ZW1JbmRleCA9IHFxLmluZGV4T2YodGhpcy5fc3RvcmVkSWRzLCBpZCk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9vcHRpb25zLmF1dG9VcGxvYWQgJiYgc3RvcmVkSXRlbUluZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RvcmVkSWRzLnNwbGljZShzdG9yZWRJdGVtSW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLkNBTkNFTEVEKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25Db21wbGV0ZTogZnVuY3Rpb24oaWQsIG5hbWUsIHJlc3VsdCwgeGhyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkLS07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuVVBMT0FEX0ZBSUxFRCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHRbdGhpcy5fb3B0aW9ucy5yZXRyeS5wcmV2ZW50UmV0cnlSZXNwb25zZVByb3BlcnR5XSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJldmVudFJldHJpZXNbaWRdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudGh1bWJuYWlsVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90aHVtYm5haWxVcmxzW2lkXSA9IHJlc3VsdC50aHVtYm5haWxVcmw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWQrKztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5VUExPQURfU1VDQ0VTU0ZVTCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX21heWJlUGFyc2VBbmRTZW5kVXBsb2FkRXJyb3IoaWQsIG5hbWUsIHJlc3VsdCwgeGhyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LnN1Y2Nlc3MgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uRGVsZXRlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuREVMRVRJTkcpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkRlbGV0ZUNvbXBsZXRlOiBmdW5jdGlvbihpZCwgeGhyT3JYZHIsIGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHRoaXMuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlRGVsZXRlRmFpbGVkKGlkLCB4aHJPclhkcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlRGVsZXRlU3VjY2VzcyhpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbklucHV0Q2hhbmdlOiBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlSW5kZXg7XG4gICAgICAgICAgICAgICAgaWYgKHFxLnN1cHBvcnRlZEZlYXR1cmVzLmFqYXhVcGxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChmaWxlSW5kZXggPSAwOyBmaWxlSW5kZXggPCBpbnB1dC5maWxlcy5sZW5ndGg7IGZpbGVJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbm5vdGF0ZVdpdGhCdXR0b25JZChpbnB1dC5maWxlc1tmaWxlSW5kZXhdLCBpbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRGaWxlcyhpbnB1dC5maWxlcyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbnB1dC52YWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRmlsZXMoaW5wdXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxcS5lYWNoKHRoaXMuX2J1dHRvbnMsIGZ1bmN0aW9uKGlkeCwgYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5yZXNldCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblByb2dyZXNzOiBmdW5jdGlvbihpZCwgbmFtZSwgbG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsUHJvZ3Jlc3MgJiYgdGhpcy5fdG90YWxQcm9ncmVzcy5vbkluZGl2aWR1YWxQcm9ncmVzcyhpZCwgbG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uU3VibWl0OiBmdW5jdGlvbihpZCwgbmFtZSkge30sXG4gICAgICAgICAgICBfb25TdWJtaXRDYWxsYmFja1N1Y2Nlc3M6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25TdWJtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlNVQk1JVFRFRCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25TdWJtaXR0ZWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5hdXRvVXBsb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uU3VibWl0dGVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZEZpbGUoaWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0b3JlRm9yTGF0ZXIoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vblN1Ym1pdHRlZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25TdWJtaXREZWxldGU6IGZ1bmN0aW9uKGlkLCBvblN1Y2Nlc3NDYWxsYmFjaywgYWRkaXRpb25hbE1hbmRhdGVkUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIHV1aWQgPSB0aGlzLmdldFV1aWQoaWQpLCBhZGp1c3RlZE9uU3VjY2Vzc0NhbGxiYWNrO1xuICAgICAgICAgICAgICAgIGlmIChvblN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBhZGp1c3RlZE9uU3VjY2Vzc0NhbGxiYWNrID0gcXEuYmluZChvblN1Y2Nlc3NDYWxsYmFjaywgdGhpcywgaWQsIHV1aWQsIGFkZGl0aW9uYWxNYW5kYXRlZFBhcmFtcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0RlbGV0ZVBvc3NpYmxlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlQ2hlY2tlZENhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwib25TdWJtaXREZWxldGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBxcS5iaW5kKHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uU3VibWl0RGVsZXRlLCB0aGlzLCBpZCksXG4gICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IGFkanVzdGVkT25TdWNjZXNzQ2FsbGJhY2sgfHwgcXEuYmluZCh0aGlzLl9kZWxldGVIYW5kbGVyLnNlbmREZWxldGUsIHRoaXMsIGlkLCB1dWlkLCBhZGRpdGlvbmFsTWFuZGF0ZWRQYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcjogaWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiRGVsZXRlIHJlcXVlc3QgaWdub3JlZCBmb3IgSUQgXCIgKyBpZCArIFwiLCBkZWxldGUgZmVhdHVyZSBpcyBkaXNhYmxlZCBvciByZXF1ZXN0IG5vdCBwb3NzaWJsZSBcIiArIFwiZHVlIHRvIENPUlMgb24gYSB1c2VyIGFnZW50IHRoYXQgZG9lcyBub3Qgc3VwcG9ydCBwcmUtZmxpZ2h0aW5nLlwiLCBcIndhcm5cIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uU3VibWl0dGVkOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICBfb25Ub3RhbFByb2dyZXNzOiBmdW5jdGlvbihsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25Ub3RhbFByb2dyZXNzKGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblVwbG9hZFByZXA6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgIF9vblVwbG9hZDogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlVQTE9BRElORyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVXBsb2FkQ2h1bms6IGZ1bmN0aW9uKGlkLCBjaHVua0RhdGEpIHt9LFxuICAgICAgICAgICAgX29uVXBsb2FkQ2h1bmtTdWNjZXNzOiBmdW5jdGlvbihpZCwgY2h1bmtEYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9wcmV2ZW50UmV0cmllc1tpZF0gJiYgdGhpcy5fb3B0aW9ucy5yZXRyeS5lbmFibGVBdXRvKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2F1dG9SZXRyaWVzW2lkXSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblVwbG9hZFN0YXR1c0NoYW5nZTogZnVuY3Rpb24oaWQsIG9sZFN0YXR1cywgbmV3U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1N0YXR1cyA9PT0gcXEuc3RhdHVzLlBBVVNFRCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fcmV0cnlUaW1lb3V0c1tpZF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25WYWxpZGF0ZUJhdGNoQ2FsbGJhY2tGYWlsdXJlOiBmdW5jdGlvbihmaWxlV3JhcHBlcnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChmaWxlV3JhcHBlcnMsIGZ1bmN0aW9uKGlkeCwgZmlsZVdyYXBwZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmlsZU9yQmxvYlJlamVjdGVkKGZpbGVXcmFwcGVyLmlkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25WYWxpZGF0ZUJhdGNoQ2FsbGJhY2tTdWNjZXNzOiBmdW5jdGlvbih2YWxpZGF0aW9uRGVzY3JpcHRvcnMsIGl0ZW1zLCBwYXJhbXMsIGVuZHBvaW50LCBidXR0b24pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JNZXNzYWdlLCBpdGVtTGltaXQgPSB0aGlzLl9jdXJyZW50SXRlbUxpbWl0LCBwcm9wb3NlZE5ldEZpbGVzVXBsb2FkZWRPclF1ZXVlZCA9IHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQ7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1MaW1pdCA9PT0gMCB8fCBwcm9wb3NlZE5ldEZpbGVzVXBsb2FkZWRPclF1ZXVlZCA8PSBpdGVtTGltaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNoZWNrZWRDYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJvblZhbGlkYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHFxLmJpbmQodGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25WYWxpZGF0ZSwgdGhpcywgdmFsaWRhdGlvbkRlc2NyaXB0b3JzWzBdLCBidXR0b24pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogcXEuYmluZCh0aGlzLl9vblZhbGlkYXRlQ2FsbGJhY2tTdWNjZXNzLCB0aGlzLCBpdGVtcywgMCwgcGFyYW1zLCBlbmRwb2ludCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GYWlsdXJlOiBxcS5iaW5kKHRoaXMuX29uVmFsaWRhdGVDYWxsYmFja0ZhaWx1cmUsIHRoaXMsIGl0ZW1zLCAwLCBwYXJhbXMsIGVuZHBvaW50KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyOiBcIkl0ZW0gJ1wiICsgaXRlbXNbMF0uZmlsZS5uYW1lICsgXCInLCBzaXplOiBcIiArIGl0ZW1zWzBdLmZpbGUuc2l6ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pdGVtRXJyb3IoXCJub0ZpbGVzRXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblZhbGlkYXRlQmF0Y2hDYWxsYmFja0ZhaWx1cmUoaXRlbXMpO1xuICAgICAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSB0aGlzLl9vcHRpb25zLm1lc3NhZ2VzLnRvb01hbnlJdGVtc0Vycm9yLnJlcGxhY2UoL1xce25ldEl0ZW1zXFx9L2csIHByb3Bvc2VkTmV0RmlsZXNVcGxvYWRlZE9yUXVldWVkKS5yZXBsYWNlKC9cXHtpdGVtTGltaXRcXH0vZywgaXRlbUxpbWl0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmF0Y2hFcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25WYWxpZGF0ZUNhbGxiYWNrRmFpbHVyZTogZnVuY3Rpb24oaXRlbXMsIGluZGV4LCBwYXJhbXMsIGVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIG5leHRJbmRleCA9IGluZGV4ICsgMTtcbiAgICAgICAgICAgICAgICB0aGlzLl9maWxlT3JCbG9iUmVqZWN0ZWQoaXRlbXNbaW5kZXhdLmlkLCBpdGVtc1tpbmRleF0uZmlsZS5uYW1lKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXliZVByb2Nlc3NOZXh0SXRlbUFmdGVyT25WYWxpZGF0ZUNhbGxiYWNrKGZhbHNlLCBpdGVtcywgbmV4dEluZGV4LCBwYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25WYWxpZGF0ZUNhbGxiYWNrU3VjY2VzczogZnVuY3Rpb24oaXRlbXMsIGluZGV4LCBwYXJhbXMsIGVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBuZXh0SW5kZXggPSBpbmRleCArIDEsIHZhbGlkYXRpb25EZXNjcmlwdG9yID0gdGhpcy5fZ2V0VmFsaWRhdGlvbkRlc2NyaXB0b3IoaXRlbXNbaW5kZXhdKTtcbiAgICAgICAgICAgICAgICB0aGlzLl92YWxpZGF0ZUZpbGVPckJsb2JEYXRhKGl0ZW1zW2luZGV4XSwgdmFsaWRhdGlvbkRlc2NyaXB0b3IpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3VwbG9hZChpdGVtc1tpbmRleF0uaWQsIHBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYXliZVByb2Nlc3NOZXh0SXRlbUFmdGVyT25WYWxpZGF0ZUNhbGxiYWNrKHRydWUsIGl0ZW1zLCBuZXh0SW5kZXgsIHBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYXliZVByb2Nlc3NOZXh0SXRlbUFmdGVyT25WYWxpZGF0ZUNhbGxiYWNrKGZhbHNlLCBpdGVtcywgbmV4dEluZGV4LCBwYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcHJlcGFyZUl0ZW1zRm9yVXBsb2FkOiBmdW5jdGlvbihpdGVtcywgcGFyYW1zLCBlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXRlbUVycm9yKFwibm9GaWxlc0Vycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciB2YWxpZGF0aW9uRGVzY3JpcHRvcnMgPSB0aGlzLl9nZXRWYWxpZGF0aW9uRGVzY3JpcHRvcnMoaXRlbXMpLCBidXR0b25JZCA9IHRoaXMuX2dldEJ1dHRvbklkKGl0ZW1zWzBdLmZpbGUpLCBidXR0b24gPSB0aGlzLl9nZXRCdXR0b24oYnV0dG9uSWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNoZWNrZWRDYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwib25WYWxpZGF0ZUJhdGNoXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBxcS5iaW5kKHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uVmFsaWRhdGVCYXRjaCwgdGhpcywgdmFsaWRhdGlvbkRlc2NyaXB0b3JzLCBidXR0b24pLFxuICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IHFxLmJpbmQodGhpcy5fb25WYWxpZGF0ZUJhdGNoQ2FsbGJhY2tTdWNjZXNzLCB0aGlzLCB2YWxpZGF0aW9uRGVzY3JpcHRvcnMsIGl0ZW1zLCBwYXJhbXMsIGVuZHBvaW50LCBidXR0b24pLFxuICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IHFxLmJpbmQodGhpcy5fb25WYWxpZGF0ZUJhdGNoQ2FsbGJhY2tGYWlsdXJlLCB0aGlzLCBpdGVtcyksXG4gICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IFwiYmF0Y2ggdmFsaWRhdGlvblwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3ByZXZlbnRMZWF2ZUluUHJvZ3Jlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwb3NlU3VwcG9ydC5hdHRhY2god2luZG93LCBcImJlZm9yZXVubG9hZFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmdldEluUHJvZ3Jlc3MoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGUgfHwgd2luZG93LmV2ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5yZXR1cm5WYWx1ZSA9IHNlbGYuX29wdGlvbnMubWVzc2FnZXMub25MZWF2ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcHRpb25zLm1lc3NhZ2VzLm9uTGVhdmU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcmVmcmVzaFNlc3Npb25EYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIG9wdGlvbnMgPSB0aGlzLl9vcHRpb25zLnNlc3Npb247XG4gICAgICAgICAgICAgICAgaWYgKHFxLlNlc3Npb24gJiYgdGhpcy5fb3B0aW9ucy5zZXNzaW9uLmVuZHBvaW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcS5leHRlbmQob3B0aW9ucywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnM6IHRoaXMuX29wdGlvbnMuY29yc1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmxvZyA9IHFxLmJpbmQodGhpcy5sb2csIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hZGRGaWxlUmVjb3JkID0gcXEuYmluZCh0aGlzLl9hZGRDYW5uZWRGaWxlLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nlc3Npb24gPSBuZXcgcXEuU2Vzc2lvbihvcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2Vzc2lvbi5yZWZyZXNoKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSwgeGhyT3JYZHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zZXNzaW9uUmVxdWVzdENvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25TZXNzaW9uUmVxdWVzdENvbXBsZXRlKHJlc3BvbnNlLCB0cnVlLCB4aHJPclhkcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSwgeGhyT3JYZHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblNlc3Npb25SZXF1ZXN0Q29tcGxldGUocmVzcG9uc2UsIGZhbHNlLCB4aHJPclhkcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXNzaW9uUmVxdWVzdENvbXBsZXRlOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICAgICAgX3NldFNpemU6IGZ1bmN0aW9uKGlkLCBuZXdTaXplKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS51cGRhdGVTaXplKGlkLCBuZXdTaXplKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbFByb2dyZXNzICYmIHRoaXMuX3RvdGFsUHJvZ3Jlc3Mub25OZXdTaXplKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2hvdWxkQXV0b1JldHJ5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciB1cGxvYWREYXRhID0gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcHJldmVudFJldHJpZXNbaWRdICYmIHRoaXMuX29wdGlvbnMucmV0cnkuZW5hYmxlQXV0byAmJiB1cGxvYWREYXRhLnN0YXR1cyAhPT0gcXEuc3RhdHVzLlBBVVNFRCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXV0b1JldHJpZXNbaWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2F1dG9SZXRyaWVzW2lkXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2F1dG9SZXRyaWVzW2lkXSA8IHRoaXMuX29wdGlvbnMucmV0cnkubWF4QXV0b0F0dGVtcHRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdXRvUmV0cmllc1tpZF0gKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc3RvcmVGb3JMYXRlcjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdG9yZWRJZHMucHVzaChpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3RyYWNrQnV0dG9uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBidXR0b25JZDtcbiAgICAgICAgICAgICAgICBpZiAocXEuc3VwcG9ydGVkRmVhdHVyZXMuYWpheFVwbG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBidXR0b25JZCA9IHRoaXMuX2hhbmRsZXIuZ2V0RmlsZShpZCkucXFCdXR0b25JZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBidXR0b25JZCA9IHRoaXMuX2dldEJ1dHRvbklkKHRoaXMuX2hhbmRsZXIuZ2V0SW5wdXQoaWQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGJ1dHRvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1dHRvbklkc0ZvckZpbGVJZHNbaWRdID0gYnV0dG9uSWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF91cGRhdGVGb3JtU3VwcG9ydEFuZFBhcmFtczogZnVuY3Rpb24oZm9ybUVsZW1lbnRPcklkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5mb3JtLmVsZW1lbnQgPSBmb3JtRWxlbWVudE9ySWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5fZm9ybVN1cHBvcnQgPSBxcS5Gb3JtU3VwcG9ydCAmJiBuZXcgcXEuRm9ybVN1cHBvcnQodGhpcy5fb3B0aW9ucy5mb3JtLCBxcS5iaW5kKHRoaXMudXBsb2FkU3RvcmVkRmlsZXMsIHRoaXMpLCBxcS5iaW5kKHRoaXMubG9nLCB0aGlzKSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2Zvcm1TdXBwb3J0ICYmIHRoaXMuX2Zvcm1TdXBwb3J0LmF0dGFjaGVkVG9Gb3JtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtc1N0b3JlLmFkZFJlYWRPbmx5KG51bGwsIHRoaXMuX2Zvcm1TdXBwb3J0LmdldEZvcm1JbnB1dHNBc09iamVjdCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuYXV0b1VwbG9hZCA9IHRoaXMuX2Zvcm1TdXBwb3J0Lm5ld0F1dG9VcGxvYWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9mb3JtU3VwcG9ydC5uZXdFbmRwb2ludCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRFbmRwb2ludCh0aGlzLl9mb3JtU3VwcG9ydC5uZXdFbmRwb2ludCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3VwbG9hZDogZnVuY3Rpb24oaWQsIHBhcmFtcywgZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHRoaXMuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBhcmFtcyhwYXJhbXMsIGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RW5kcG9pbnQoZW5kcG9pbnQsIGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlQ2hlY2tlZENhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJvblN1Ym1pdFwiLFxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogcXEuYmluZCh0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vblN1Ym1pdCwgdGhpcywgaWQsIG5hbWUpLFxuICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IHFxLmJpbmQodGhpcy5fb25TdWJtaXRDYWxsYmFja1N1Y2Nlc3MsIHRoaXMsIGlkLCBuYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgb25GYWlsdXJlOiBxcS5iaW5kKHRoaXMuX2ZpbGVPckJsb2JSZWplY3RlZCwgdGhpcywgaWQsIG5hbWUpLFxuICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyOiBpZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF91cGxvYWRGaWxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5faGFuZGxlci51cGxvYWQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuUVVFVUVEKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3VwbG9hZFN0b3JlZEZpbGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWRUb1VwbG9hZCwgc3RpbGxTdWJtaXR0aW5nLCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICB3aGlsZSAodGhpcy5fc3RvcmVkSWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZFRvVXBsb2FkID0gdGhpcy5fc3RvcmVkSWRzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZEZpbGUoaWRUb1VwbG9hZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0aWxsU3VibWl0dGluZyA9IHRoaXMuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogcXEuc3RhdHVzLlNVQk1JVFRJTkdcbiAgICAgICAgICAgICAgICB9KS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHN0aWxsU3VibWl0dGluZykge1xuICAgICAgICAgICAgICAgICAgICBxcS5sb2coXCJTdGlsbCB3YWl0aW5nIGZvciBcIiArIHN0aWxsU3VibWl0dGluZyArIFwiIGZpbGVzIHRvIGNsZWFyIHN1Ym1pdCBxdWV1ZS4gV2lsbCByZS1wYXJzZSBzdG9yZWQgSURzIGFycmF5IHNob3J0bHkuXCIpO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdXBsb2FkU3RvcmVkRmlsZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMWUzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3ZhbGlkYXRlRmlsZU9yQmxvYkRhdGE6IGZ1bmN0aW9uKGZpbGVXcmFwcGVyLCB2YWxpZGF0aW9uRGVzY3JpcHRvcikge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgZmlsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZVdyYXBwZXIuZmlsZSBpbnN0YW5jZW9mIHFxLkJsb2JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVXcmFwcGVyLmZpbGUucmVmZXJlbmNlQmxvYjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsZVdyYXBwZXIuZmlsZTtcbiAgICAgICAgICAgICAgICB9KCksIG5hbWUgPSB2YWxpZGF0aW9uRGVzY3JpcHRvci5uYW1lLCBzaXplID0gdmFsaWRhdGlvbkRlc2NyaXB0b3Iuc2l6ZSwgYnV0dG9uSWQgPSB0aGlzLl9nZXRCdXR0b25JZChmaWxlV3JhcHBlci5maWxlKSwgdmFsaWRhdGlvbkJhc2UgPSB0aGlzLl9nZXRWYWxpZGF0aW9uQmFzZShidXR0b25JZCksIHZhbGlkaXR5Q2hlY2tlciA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICAgICAgdmFsaWRpdHlDaGVja2VyLnRoZW4oZnVuY3Rpb24oKSB7fSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX2ZpbGVPckJsb2JSZWplY3RlZChmaWxlV3JhcHBlci5pZCwgbmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzRmlsZU9ySW5wdXQoZmlsZSkgJiYgIXRoaXMuX2lzQWxsb3dlZEV4dGVuc2lvbih2YWxpZGF0aW9uQmFzZS5hbGxvd2VkRXh0ZW5zaW9ucywgbmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXRlbUVycm9yKFwidHlwZUVycm9yXCIsIG5hbWUsIGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRpdHlDaGVja2VyLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9vcHRpb25zLnZhbGlkYXRpb24uYWxsb3dFbXB0eSAmJiBzaXplID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1FcnJvcihcImVtcHR5RXJyb3JcIiwgbmFtZSwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGl0eUNoZWNrZXIuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSA+IDAgJiYgdmFsaWRhdGlvbkJhc2Uuc2l6ZUxpbWl0ICYmIHNpemUgPiB2YWxpZGF0aW9uQmFzZS5zaXplTGltaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXRlbUVycm9yKFwic2l6ZUVycm9yXCIsIG5hbWUsIGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRpdHlDaGVja2VyLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNpemUgPiAwICYmIHNpemUgPCB2YWxpZGF0aW9uQmFzZS5taW5TaXplTGltaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXRlbUVycm9yKFwibWluU2l6ZUVycm9yXCIsIG5hbWUsIGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRpdHlDaGVja2VyLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHFxLkltYWdlVmFsaWRhdGlvbiAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5pbWFnZVByZXZpZXdzICYmIHFxLmlzRmlsZShmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICBuZXcgcXEuSW1hZ2VWYWxpZGF0aW9uKGZpbGUsIHFxLmJpbmQoc2VsZi5sb2csIHNlbGYpKS52YWxpZGF0ZSh2YWxpZGF0aW9uQmFzZS5pbWFnZSkudGhlbih2YWxpZGl0eUNoZWNrZXIuc3VjY2VzcywgZnVuY3Rpb24oZXJyb3JDb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9pdGVtRXJyb3IoZXJyb3JDb2RlICsgXCJJbWFnZUVycm9yXCIsIG5hbWUsIGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRpdHlDaGVja2VyLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRpdHlDaGVja2VyLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkaXR5Q2hlY2tlcjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfd3JhcENhbGxiYWNrczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYsIHNhZmVDYWxsYmFjaywgcHJvcDtcbiAgICAgICAgICAgICAgICBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICBzYWZlQ2FsbGJhY2sgPSBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgYXJncykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNc2c7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2suYXBwbHkoc2VsZiwgYXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4Y2VwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgPSBleGNlcHRpb24ubWVzc2FnZSB8fCBleGNlcHRpb24udG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKFwiQ2F1Z2h0IGV4Y2VwdGlvbiBpbiAnXCIgKyBuYW1lICsgXCInIGNhbGxiYWNrIC0gXCIgKyBlcnJvck1zZywgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZm9yIChwcm9wIGluIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzKSB7XG4gICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjYWxsYmFja05hbWUsIGNhbGxiYWNrRnVuYztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrTmFtZSA9IHByb3A7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja0Z1bmMgPSBzZWxmLl9vcHRpb25zLmNhbGxiYWNrc1tjYWxsYmFja05hbWVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3NbY2FsbGJhY2tOYW1lXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzYWZlQ2FsbGJhY2soY2FsbGJhY2tOYW1lLCBjYWxsYmFja0Z1bmMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KSgpO1xuICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHFxLkZpbmVVcGxvYWRlckJhc2ljID0gZnVuY3Rpb24obykge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5fb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBkZWJ1ZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgYnV0dG9uOiBudWxsLFxuICAgICAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1heENvbm5lY3Rpb25zOiAzLFxuICAgICAgICAgICAgICAgIGRpc2FibGVDYW5jZWxGb3JGb3JtVXBsb2FkczogZmFsc2UsXG4gICAgICAgICAgICAgICAgYXV0b1VwbG9hZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB3YXJuQmVmb3JlVW5sb2FkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tSGVhZGVyczoge30sXG4gICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBcIi9zZXJ2ZXIvdXBsb2FkXCIsXG4gICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lUGFyYW06IFwicXFmaWxlbmFtZVwiLFxuICAgICAgICAgICAgICAgICAgICBmb3JjZU11bHRpcGFydDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaW5wdXROYW1lOiBcInFxZmlsZVwiLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICBvbWl0RGVmYXVsdFBhcmFtczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczoge30sXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc0luQm9keTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZVN1Y2Nlc3NKc29uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbEZpbGVTaXplTmFtZTogXCJxcXRvdGFsZmlsZXNpemVcIixcbiAgICAgICAgICAgICAgICAgICAgdXVpZE5hbWU6IFwicXF1dWlkXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHZhbGlkYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgYWxsb3dlZEV4dGVuc2lvbnM6IFtdLFxuICAgICAgICAgICAgICAgICAgICBzaXplTGltaXQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIG1pblNpemVMaW1pdDogMCxcbiAgICAgICAgICAgICAgICAgICAgaXRlbUxpbWl0OiAwLFxuICAgICAgICAgICAgICAgICAgICBzdG9wT25GaXJzdEludmFsaWRGaWxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhY2NlcHRGaWxlczogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWluV2lkdGg6IDBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYWxsb3dFbXB0eTogZmFsc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgICAgICAgICBvblN1Ym1pdDogZnVuY3Rpb24oaWQsIG5hbWUpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblN1Ym1pdHRlZDogZnVuY3Rpb24oaWQsIG5hbWUpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbihpZCwgbmFtZSwgcmVzcG9uc2VKU09OLCBtYXliZVhocikge30sXG4gICAgICAgICAgICAgICAgICAgIG9uQWxsQ29tcGxldGU6IGZ1bmN0aW9uKHN1Y2Nlc3NmdWwsIGZhaWxlZCkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbihpZCwgbmFtZSkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkOiBmdW5jdGlvbihpZCwgbmFtZSkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkQ2h1bms6IGZ1bmN0aW9uKGlkLCBuYW1lLCBjaHVua0RhdGEpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblVwbG9hZENodW5rU3VjY2VzczogZnVuY3Rpb24oaWQsIGNodW5rRGF0YSwgcmVzcG9uc2VKU09OLCB4aHIpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblJlc3VtZTogZnVuY3Rpb24oaWQsIGZpbGVOYW1lLCBjaHVua0RhdGEsIGN1c3RvbVJlc3VtZURhdGEpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblByb2dyZXNzOiBmdW5jdGlvbihpZCwgbmFtZSwgbG9hZGVkLCB0b3RhbCkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uVG90YWxQcm9ncmVzczogZnVuY3Rpb24obG9hZGVkLCB0b3RhbCkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uKGlkLCBuYW1lLCByZWFzb24sIG1heWJlWGhyT3JYZHIpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvbkF1dG9SZXRyeTogZnVuY3Rpb24oaWQsIG5hbWUsIGF0dGVtcHROdW1iZXIpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvbk1hbnVhbFJldHJ5OiBmdW5jdGlvbihpZCwgbmFtZSkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uVmFsaWRhdGVCYXRjaDogZnVuY3Rpb24oZmlsZU9yQmxvYkRhdGEpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblZhbGlkYXRlOiBmdW5jdGlvbihmaWxlT3JCbG9iRGF0YSkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uU3VibWl0RGVsZXRlOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uRGVsZXRlOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uRGVsZXRlQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCB4aHJPclhkciwgaXNFcnJvcikge30sXG4gICAgICAgICAgICAgICAgICAgIG9uUGFzdGVSZWNlaXZlZDogZnVuY3Rpb24oYmxvYikge30sXG4gICAgICAgICAgICAgICAgICAgIG9uU3RhdHVzQ2hhbmdlOiBmdW5jdGlvbihpZCwgb2xkU3RhdHVzLCBuZXdTdGF0dXMpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblNlc3Npb25SZXF1ZXN0Q29tcGxldGU6IGZ1bmN0aW9uKHJlc3BvbnNlLCBzdWNjZXNzLCB4aHJPclhkcikge31cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVFcnJvcjogXCJ7ZmlsZX0gaGFzIGFuIGludmFsaWQgZXh0ZW5zaW9uLiBWYWxpZCBleHRlbnNpb24ocyk6IHtleHRlbnNpb25zfS5cIixcbiAgICAgICAgICAgICAgICAgICAgc2l6ZUVycm9yOiBcIntmaWxlfSBpcyB0b28gbGFyZ2UsIG1heGltdW0gZmlsZSBzaXplIGlzIHtzaXplTGltaXR9LlwiLFxuICAgICAgICAgICAgICAgICAgICBtaW5TaXplRXJyb3I6IFwie2ZpbGV9IGlzIHRvbyBzbWFsbCwgbWluaW11bSBmaWxlIHNpemUgaXMge21pblNpemVMaW1pdH0uXCIsXG4gICAgICAgICAgICAgICAgICAgIGVtcHR5RXJyb3I6IFwie2ZpbGV9IGlzIGVtcHR5LCBwbGVhc2Ugc2VsZWN0IGZpbGVzIGFnYWluIHdpdGhvdXQgaXQuXCIsXG4gICAgICAgICAgICAgICAgICAgIG5vRmlsZXNFcnJvcjogXCJObyBmaWxlcyB0byB1cGxvYWQuXCIsXG4gICAgICAgICAgICAgICAgICAgIHRvb01hbnlJdGVtc0Vycm9yOiBcIlRvbyBtYW55IGl0ZW1zICh7bmV0SXRlbXN9KSB3b3VsZCBiZSB1cGxvYWRlZC4gIEl0ZW0gbGltaXQgaXMge2l0ZW1MaW1pdH0uXCIsXG4gICAgICAgICAgICAgICAgICAgIG1heEhlaWdodEltYWdlRXJyb3I6IFwiSW1hZ2UgaXMgdG9vIHRhbGwuXCIsXG4gICAgICAgICAgICAgICAgICAgIG1heFdpZHRoSW1hZ2VFcnJvcjogXCJJbWFnZSBpcyB0b28gd2lkZS5cIixcbiAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0SW1hZ2VFcnJvcjogXCJJbWFnZSBpcyBub3QgdGFsbCBlbm91Z2guXCIsXG4gICAgICAgICAgICAgICAgICAgIG1pbldpZHRoSW1hZ2VFcnJvcjogXCJJbWFnZSBpcyBub3Qgd2lkZSBlbm91Z2guXCIsXG4gICAgICAgICAgICAgICAgICAgIHJldHJ5RmFpbFRvb01hbnlJdGVtczogXCJSZXRyeSBmYWlsZWQgLSB5b3UgaGF2ZSByZWFjaGVkIHlvdXIgZmlsZSBsaW1pdC5cIixcbiAgICAgICAgICAgICAgICAgICAgb25MZWF2ZTogXCJUaGUgZmlsZXMgYXJlIGJlaW5nIHVwbG9hZGVkLCBpZiB5b3UgbGVhdmUgbm93IHRoZSB1cGxvYWQgd2lsbCBiZSBjYW5jZWxlZC5cIixcbiAgICAgICAgICAgICAgICAgICAgdW5zdXBwb3J0ZWRCcm93c2VySW9zOFNhZmFyaTogXCJVbnJlY292ZXJhYmxlIGVycm9yIC0gdGhpcyBicm93c2VyIGRvZXMgbm90IHBlcm1pdCBmaWxlIHVwbG9hZGluZyBvZiBhbnkga2luZCBkdWUgdG8gc2VyaW91cyBidWdzIGluIGlPUzggU2FmYXJpLiAgUGxlYXNlIHVzZSBpT1M4IENocm9tZSB1bnRpbCBBcHBsZSBmaXhlcyB0aGVzZSBpc3N1ZXMuXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJldHJ5OiB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUF1dG86IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBtYXhBdXRvQXR0ZW1wdHM6IDMsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9BdHRlbXB0RGVsYXk6IDUsXG4gICAgICAgICAgICAgICAgICAgIHByZXZlbnRSZXRyeVJlc3BvbnNlUHJvcGVydHk6IFwicHJldmVudFJldHJ5XCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNsYXNzZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uSG92ZXI6IFwicXEtdXBsb2FkLWJ1dHRvbi1ob3ZlclwiLFxuICAgICAgICAgICAgICAgICAgICBidXR0b25Gb2N1czogXCJxcS11cGxvYWQtYnV0dG9uLWZvY3VzXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNodW5raW5nOiB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb25jdXJyZW50OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBtYW5kYXRvcnk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbU5hbWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0SW5kZXg6IFwicXFwYXJ0aW5kZXhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRCeXRlT2Zmc2V0OiBcInFxcGFydGJ5dGVvZmZzZXRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rU2l6ZTogXCJxcWNodW5rc2l6ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxGaWxlU2l6ZTogXCJxcXRvdGFsZmlsZXNpemVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsUGFydHM6IFwicXF0b3RhbHBhcnRzXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGFydFNpemU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMmU2O1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAganNvblBheWxvYWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNldE9uU3RhdHVzOiBbXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZXN1bWU6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHJlY29yZHNFeHBpcmVJbjogNyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1OYW1lczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdW1pbmc6IFwicXFyZXN1bWVcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21LZXlzOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZm9ybWF0RmlsZU5hbWU6IGZ1bmN0aW9uKGZpbGVPckJsb2JOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlT3JCbG9iTmFtZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRleHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFJlc3BvbnNlRXJyb3I6IFwiVXBsb2FkIGZhaWx1cmUgcmVhc29uIHVua25vd25cIixcbiAgICAgICAgICAgICAgICAgICAgZmlsZUlucHV0VGl0bGU6IFwiZmlsZSBpbnB1dFwiLFxuICAgICAgICAgICAgICAgICAgICBzaXplU3ltYm9sczogWyBcImtCXCIsIFwiTUJcIiwgXCJHQlwiLCBcIlRCXCIsIFwiUEJcIiwgXCJFQlwiIF1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRlbGV0ZUZpbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFwiL3NlcnZlci91cGxvYWRcIixcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tSGVhZGVyczoge30sXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczoge31cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBzZW5kQ3JlZGVudGlhbHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBhbGxvd1hkcjogZmFsc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJsb2JzOiB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHROYW1lOiBcIm1pc2NfZGF0YVwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwYXN0ZToge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TmFtZTogXCJwYXN0ZWRfaW1hZ2VcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2FtZXJhOiB7XG4gICAgICAgICAgICAgICAgICAgIGlvczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbjogbnVsbFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXh0cmFCdXR0b25zOiBbXSxcbiAgICAgICAgICAgICAgICBzZXNzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHt9LFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21IZWFkZXJzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaE9uUmVzZXQ6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZvcm06IHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogXCJxcS1mb3JtXCIsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9VcGxvYWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBpbnRlcmNlcHRTdWJtaXQ6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNjYWxpbmc6IHtcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplcjogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgc2VuZE9yaWdpbmFsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBvcmllbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRUeXBlOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0UXVhbGl0eTogODAsXG4gICAgICAgICAgICAgICAgICAgIGZhaWx1cmVUZXh0OiBcIkZhaWxlZCB0byBzY2FsZVwiLFxuICAgICAgICAgICAgICAgICAgICBpbmNsdWRlRXhpZjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNpemVzOiBbXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgd29ya2Fyb3VuZHM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW9zRW1wdHlWaWRlb3M6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGlvczhTYWZhcmlVcGxvYWRzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBpb3M4QnJvd3NlckNyYXNoOiBmYWxzZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBxcS5leHRlbmQodGhpcy5fb3B0aW9ucywgbywgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLl9idXR0b25zID0gW107XG4gICAgICAgICAgICB0aGlzLl9leHRyYUJ1dHRvblNwZWNzID0ge307XG4gICAgICAgICAgICB0aGlzLl9idXR0b25JZHNGb3JGaWxlSWRzID0gW107XG4gICAgICAgICAgICB0aGlzLl93cmFwQ2FsbGJhY2tzKCk7XG4gICAgICAgICAgICB0aGlzLl9kaXNwb3NlU3VwcG9ydCA9IG5ldyBxcS5EaXNwb3NlU3VwcG9ydCgpO1xuICAgICAgICAgICAgdGhpcy5fc3RvcmVkSWRzID0gW107XG4gICAgICAgICAgICB0aGlzLl9hdXRvUmV0cmllcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fcmV0cnlUaW1lb3V0cyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fcHJldmVudFJldHJpZXMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX3RodW1ibmFpbFVybHMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQgPSAwO1xuICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWQgPSAwO1xuICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YSA9IHRoaXMuX2NyZWF0ZVVwbG9hZERhdGFUcmFja2VyKCk7XG4gICAgICAgICAgICB0aGlzLl9pbml0Rm9ybVN1cHBvcnRBbmRQYXJhbXMoKTtcbiAgICAgICAgICAgIHRoaXMuX2N1c3RvbUhlYWRlcnNTdG9yZSA9IHRoaXMuX2NyZWF0ZVN0b3JlKHRoaXMuX29wdGlvbnMucmVxdWVzdC5jdXN0b21IZWFkZXJzKTtcbiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbGVDdXN0b21IZWFkZXJzU3RvcmUgPSB0aGlzLl9jcmVhdGVTdG9yZSh0aGlzLl9vcHRpb25zLmRlbGV0ZUZpbGUuY3VzdG9tSGVhZGVycyk7XG4gICAgICAgICAgICB0aGlzLl9kZWxldGVGaWxlUGFyYW1zU3RvcmUgPSB0aGlzLl9jcmVhdGVTdG9yZSh0aGlzLl9vcHRpb25zLmRlbGV0ZUZpbGUucGFyYW1zKTtcbiAgICAgICAgICAgIHRoaXMuX2VuZHBvaW50U3RvcmUgPSB0aGlzLl9jcmVhdGVTdG9yZSh0aGlzLl9vcHRpb25zLnJlcXVlc3QuZW5kcG9pbnQpO1xuICAgICAgICAgICAgdGhpcy5fZGVsZXRlRmlsZUVuZHBvaW50U3RvcmUgPSB0aGlzLl9jcmVhdGVTdG9yZSh0aGlzLl9vcHRpb25zLmRlbGV0ZUZpbGUuZW5kcG9pbnQpO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlciA9IHRoaXMuX2NyZWF0ZVVwbG9hZEhhbmRsZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUhhbmRsZXIgPSBxcS5EZWxldGVGaWxlQWpheFJlcXVlc3RlciAmJiB0aGlzLl9jcmVhdGVEZWxldGVIYW5kbGVyKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5idXR0b24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kZWZhdWx0QnV0dG9uSWQgPSB0aGlzLl9jcmVhdGVVcGxvYWRCdXR0b24oe1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiB0aGlzLl9vcHRpb25zLmJ1dHRvbixcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMuX29wdGlvbnMudGV4dC5maWxlSW5wdXRUaXRsZVxuICAgICAgICAgICAgICAgIH0pLmdldEJ1dHRvbklkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9nZW5lcmF0ZUV4dHJhQnV0dG9uU3BlY3MoKTtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNhbWVyYUFjY2VzcygpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMucGFzdGUudGFyZ2V0RWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmIChxcS5QYXN0ZVN1cHBvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFzdGVIYW5kbGVyID0gdGhpcy5fY3JlYXRlUGFzdGVIYW5kbGVyKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coXCJQYXN0ZSBzdXBwb3J0IG1vZHVsZSBub3QgZm91bmRcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zLndhcm5CZWZvcmVVbmxvYWQgJiYgdGhpcy5fcHJldmVudExlYXZlSW5Qcm9ncmVzcygpO1xuICAgICAgICAgICAgdGhpcy5faW1hZ2VHZW5lcmF0b3IgPSBxcS5JbWFnZUdlbmVyYXRvciAmJiBuZXcgcXEuSW1hZ2VHZW5lcmF0b3IocXEuYmluZCh0aGlzLmxvZywgdGhpcykpO1xuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaFNlc3Npb25EYXRhKCk7XG4gICAgICAgICAgICB0aGlzLl9zdWNjZWVkZWRTaW5jZUxhc3RBbGxDb21wbGV0ZSA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fZmFpbGVkU2luY2VMYXN0QWxsQ29tcGxldGUgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX3NjYWxlciA9IHFxLlNjYWxlciAmJiBuZXcgcXEuU2NhbGVyKHRoaXMuX29wdGlvbnMuc2NhbGluZywgcXEuYmluZCh0aGlzLmxvZywgdGhpcykpIHx8IHt9O1xuICAgICAgICAgICAgaWYgKHRoaXMuX3NjYWxlci5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3VzdG9tTmV3RmlsZUhhbmRsZXIgPSBxcS5iaW5kKHRoaXMuX3NjYWxlci5oYW5kbGVOZXdGaWxlLCB0aGlzLl9zY2FsZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHFxLlRvdGFsUHJvZ3Jlc3MgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMucHJvZ3Jlc3NCYXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbFByb2dyZXNzID0gbmV3IHFxLlRvdGFsUHJvZ3Jlc3MocXEuYmluZCh0aGlzLl9vblRvdGFsUHJvZ3Jlc3MsIHRoaXMpLCBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW50cnkgPSBzZWxmLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVudHJ5ICYmIGVudHJ5LnNpemUgfHwgMDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRJdGVtTGltaXQgPSB0aGlzLl9vcHRpb25zLnZhbGlkYXRpb24uaXRlbUxpbWl0O1xuICAgICAgICAgICAgdGhpcy5fY3VzdG9tUmVzdW1lRGF0YVN0b3JlID0gdGhpcy5fY3JlYXRlU3RvcmUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuRmluZVVwbG9hZGVyQmFzaWMucHJvdG90eXBlID0gcXEuYmFzZVB1YmxpY0FwaTtcbiAgICAgICAgcXEuZXh0ZW5kKHFxLkZpbmVVcGxvYWRlckJhc2ljLnByb3RvdHlwZSwgcXEuYmFzZVByaXZhdGVBcGkpO1xuICAgIH0pKCk7XG4gICAgcXEuQWpheFJlcXVlc3RlciA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBsb2csIHNob3VsZFBhcmFtc0JlSW5RdWVyeVN0cmluZywgcXVldWUgPSBbXSwgcmVxdWVzdERhdGEgPSB7fSwgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGFjY2VwdEhlYWRlcjogbnVsbCxcbiAgICAgICAgICAgIHZhbGlkTWV0aG9kczogWyBcIlBBVENIXCIsIFwiUE9TVFwiLCBcIlBVVFwiIF0sXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsXG4gICAgICAgICAgICBtYXhDb25uZWN0aW9uczogMyxcbiAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IHt9LFxuICAgICAgICAgICAgZW5kcG9pbnRTdG9yZToge30sXG4gICAgICAgICAgICBwYXJhbXNTdG9yZToge30sXG4gICAgICAgICAgICBtYW5kYXRlZFBhcmFtczoge30sXG4gICAgICAgICAgICBhbGxvd1hSZXF1ZXN0ZWRXaXRoQW5kQ2FjaGVDb250cm9sOiB0cnVlLFxuICAgICAgICAgICAgc3VjY2Vzc2Z1bFJlc3BvbnNlQ29kZXM6IHtcbiAgICAgICAgICAgICAgICBERUxFVEU6IFsgMjAwLCAyMDIsIDIwNCBdLFxuICAgICAgICAgICAgICAgIFBBVENIOiBbIDIwMCwgMjAxLCAyMDIsIDIwMywgMjA0IF0sXG4gICAgICAgICAgICAgICAgUE9TVDogWyAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCBdLFxuICAgICAgICAgICAgICAgIFBVVDogWyAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCBdLFxuICAgICAgICAgICAgICAgIEdFVDogWyAyMDAgXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvcnM6IHtcbiAgICAgICAgICAgICAgICBleHBlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2VuZENyZWRlbnRpYWxzOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24oc3RyLCBsZXZlbCkge30sXG4gICAgICAgICAgICBvblNlbmQ6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCB4aHJPclhkciwgaXNFcnJvcikge30sXG4gICAgICAgICAgICBvblByb2dyZXNzOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBvKTtcbiAgICAgICAgbG9nID0gb3B0aW9ucy5sb2c7XG4gICAgICAgIGlmIChxcS5pbmRleE9mKG9wdGlvbnMudmFsaWRNZXRob2RzLCBvcHRpb25zLm1ldGhvZCkgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCInXCIgKyBvcHRpb25zLm1ldGhvZCArIFwiJyBpcyBub3QgYSBzdXBwb3J0ZWQgbWV0aG9kIGZvciB0aGlzIHR5cGUgb2YgcmVxdWVzdCFcIik7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNTaW1wbGVNZXRob2QoKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW5kZXhPZihbIFwiR0VUXCIsIFwiUE9TVFwiLCBcIkhFQURcIiBdLCBvcHRpb25zLm1ldGhvZCkgPj0gMDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBjb250YWluc05vblNpbXBsZUhlYWRlcnMoaGVhZGVycykge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5zTm9uU2ltcGxlID0gZmFsc2U7XG4gICAgICAgICAgICBxcS5lYWNoKGNvbnRhaW5zTm9uU2ltcGxlLCBmdW5jdGlvbihpZHgsIGhlYWRlcikge1xuICAgICAgICAgICAgICAgIGlmIChxcS5pbmRleE9mKFsgXCJBY2NlcHRcIiwgXCJBY2NlcHQtTGFuZ3VhZ2VcIiwgXCJDb250ZW50LUxhbmd1YWdlXCIsIFwiQ29udGVudC1UeXBlXCIgXSwgaGVhZGVyKSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbnNOb25TaW1wbGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gY29udGFpbnNOb25TaW1wbGU7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNYZHIoeGhyKSB7XG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5jb3JzLmV4cGVjdGVkICYmIHhoci53aXRoQ3JlZGVudGlhbHMgPT09IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRDb3JzQWpheFRyYW5zcG9ydCgpIHtcbiAgICAgICAgICAgIHZhciB4aHJPclhkcjtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuWE1MSHR0cFJlcXVlc3QgfHwgd2luZG93LkFjdGl2ZVhPYmplY3QpIHtcbiAgICAgICAgICAgICAgICB4aHJPclhkciA9IHFxLmNyZWF0ZVhockluc3RhbmNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHhock9yWGRyLndpdGhDcmVkZW50aWFscyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHhock9yWGRyID0gbmV3IFhEb21haW5SZXF1ZXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIHhock9yWGRyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge307XG4gICAgICAgICAgICAgICAgICAgIHhock9yWGRyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHt9O1xuICAgICAgICAgICAgICAgICAgICB4aHJPclhkci5vbnRpbWVvdXQgPSBmdW5jdGlvbigpIHt9O1xuICAgICAgICAgICAgICAgICAgICB4aHJPclhkci5vbnByb2dyZXNzID0gZnVuY3Rpb24oKSB7fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geGhyT3JYZHI7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0WGhyT3JYZHIoaWQsIHN1cHBsaWVkWGhyKSB7XG4gICAgICAgICAgICB2YXIgeGhyT3JYZHIgPSByZXF1ZXN0RGF0YVtpZF0gJiYgcmVxdWVzdERhdGFbaWRdLnhocjtcbiAgICAgICAgICAgIGlmICgheGhyT3JYZHIpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3VwcGxpZWRYaHIpIHtcbiAgICAgICAgICAgICAgICAgICAgeGhyT3JYZHIgPSBzdXBwbGllZFhocjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5jb3JzLmV4cGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB4aHJPclhkciA9IGdldENvcnNBamF4VHJhbnNwb3J0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB4aHJPclhkciA9IHFxLmNyZWF0ZVhockluc3RhbmNlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVxdWVzdERhdGFbaWRdLnhociA9IHhock9yWGRyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHhock9yWGRyO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGRlcXVldWUoaWQpIHtcbiAgICAgICAgICAgIHZhciBpID0gcXEuaW5kZXhPZihxdWV1ZSwgaWQpLCBtYXggPSBvcHRpb25zLm1heENvbm5lY3Rpb25zLCBuZXh0SWQ7XG4gICAgICAgICAgICBkZWxldGUgcmVxdWVzdERhdGFbaWRdO1xuICAgICAgICAgICAgcXVldWUuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCA+PSBtYXggJiYgaSA8IG1heCkge1xuICAgICAgICAgICAgICAgIG5leHRJZCA9IHF1ZXVlW21heCAtIDFdO1xuICAgICAgICAgICAgICAgIHNlbmRSZXF1ZXN0KG5leHRJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gb25Db21wbGV0ZShpZCwgeGRyRXJyb3IpIHtcbiAgICAgICAgICAgIHZhciB4aHIgPSBnZXRYaHJPclhkcihpZCksIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kLCBpc0Vycm9yID0geGRyRXJyb3IgPT09IHRydWU7XG4gICAgICAgICAgICBkZXF1ZXVlKGlkKTtcbiAgICAgICAgICAgIGlmIChpc0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgbG9nKG1ldGhvZCArIFwiIHJlcXVlc3QgZm9yIFwiICsgaWQgKyBcIiBoYXMgZmFpbGVkXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFpc1hkcih4aHIpICYmICFpc1Jlc3BvbnNlU3VjY2Vzc2Z1bCh4aHIuc3RhdHVzKSkge1xuICAgICAgICAgICAgICAgIGlzRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGxvZyhtZXRob2QgKyBcIiByZXF1ZXN0IGZvciBcIiArIGlkICsgXCIgaGFzIGZhaWxlZCAtIHJlc3BvbnNlIGNvZGUgXCIgKyB4aHIuc3RhdHVzLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy5vbkNvbXBsZXRlKGlkLCB4aHIsIGlzRXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldFBhcmFtcyhpZCkge1xuICAgICAgICAgICAgdmFyIG9uRGVtYW5kUGFyYW1zID0gcmVxdWVzdERhdGFbaWRdLmFkZGl0aW9uYWxQYXJhbXMsIG1hbmRhdGVkUGFyYW1zID0gb3B0aW9ucy5tYW5kYXRlZFBhcmFtcywgcGFyYW1zO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMucGFyYW1zU3RvcmUuZ2V0KSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gb3B0aW9ucy5wYXJhbXNTdG9yZS5nZXQoaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9uRGVtYW5kUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChvbkRlbWFuZFBhcmFtcywgZnVuY3Rpb24obmFtZSwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zW25hbWVdID0gdmFsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1hbmRhdGVkUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChtYW5kYXRlZFBhcmFtcywgZnVuY3Rpb24obmFtZSwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zW25hbWVdID0gdmFsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzZW5kUmVxdWVzdChpZCwgb3B0WGhyKSB7XG4gICAgICAgICAgICB2YXIgeGhyID0gZ2V0WGhyT3JYZHIoaWQsIG9wdFhociksIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kLCBwYXJhbXMgPSBnZXRQYXJhbXMoaWQpLCBwYXlsb2FkID0gcmVxdWVzdERhdGFbaWRdLnBheWxvYWQsIHVybDtcbiAgICAgICAgICAgIG9wdGlvbnMub25TZW5kKGlkKTtcbiAgICAgICAgICAgIHVybCA9IGNyZWF0ZVVybChpZCwgcGFyYW1zLCByZXF1ZXN0RGF0YVtpZF0uYWRkaXRpb25hbFF1ZXJ5UGFyYW1zKTtcbiAgICAgICAgICAgIGlmIChpc1hkcih4aHIpKSB7XG4gICAgICAgICAgICAgICAgeGhyLm9ubG9hZCA9IGdldFhkckxvYWRIYW5kbGVyKGlkKTtcbiAgICAgICAgICAgICAgICB4aHIub25lcnJvciA9IGdldFhkckVycm9ySGFuZGxlcihpZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBnZXRYaHJSZWFkeVN0YXRlQ2hhbmdlSGFuZGxlcihpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZWdpc3RlckZvclVwbG9hZFByb2dyZXNzKGlkKTtcbiAgICAgICAgICAgIHhoci5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmNvcnMuZXhwZWN0ZWQgJiYgb3B0aW9ucy5jb3JzLnNlbmRDcmVkZW50aWFscyAmJiAhaXNYZHIoeGhyKSkge1xuICAgICAgICAgICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0SGVhZGVycyhpZCk7XG4gICAgICAgICAgICBsb2coXCJTZW5kaW5nIFwiICsgbWV0aG9kICsgXCIgcmVxdWVzdCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICBpZiAocGF5bG9hZCkge1xuICAgICAgICAgICAgICAgIHhoci5zZW5kKHBheWxvYWQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzaG91bGRQYXJhbXNCZUluUXVlcnlTdHJpbmcgfHwgIXBhcmFtcykge1xuICAgICAgICAgICAgICAgIHhoci5zZW5kKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtcyAmJiBvcHRpb25zLmNvbnRlbnRUeXBlICYmIG9wdGlvbnMuY29udGVudFR5cGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIpID49IDApIHtcbiAgICAgICAgICAgICAgICB4aHIuc2VuZChxcS5vYmoydXJsKHBhcmFtcywgXCJcIikpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJhbXMgJiYgb3B0aW9ucy5jb250ZW50VHlwZSAmJiBvcHRpb25zLmNvbnRlbnRUeXBlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImFwcGxpY2F0aW9uL2pzb25cIikgPj0gMCkge1xuICAgICAgICAgICAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KHBhcmFtcykpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB4aHIuc2VuZChwYXJhbXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHhocjtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVVcmwoaWQsIHBhcmFtcywgYWRkaXRpb25hbFF1ZXJ5UGFyYW1zKSB7XG4gICAgICAgICAgICB2YXIgZW5kcG9pbnQgPSBvcHRpb25zLmVuZHBvaW50U3RvcmUuZ2V0KGlkKSwgYWRkVG9QYXRoID0gcmVxdWVzdERhdGFbaWRdLmFkZFRvUGF0aDtcbiAgICAgICAgICAgIGlmIChhZGRUb1BhdGggIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZW5kcG9pbnQgKz0gXCIvXCIgKyBhZGRUb1BhdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2hvdWxkUGFyYW1zQmVJblF1ZXJ5U3RyaW5nICYmIHBhcmFtcykge1xuICAgICAgICAgICAgICAgIGVuZHBvaW50ID0gcXEub2JqMnVybChwYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhZGRpdGlvbmFsUXVlcnlQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBlbmRwb2ludCA9IHFxLm9iajJ1cmwoYWRkaXRpb25hbFF1ZXJ5UGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZW5kcG9pbnQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0WGhyUmVhZHlTdGF0ZUNoYW5nZUhhbmRsZXIoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoZ2V0WGhyT3JYZHIoaWQpLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZShpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlckZvclVwbG9hZFByb2dyZXNzKGlkKSB7XG4gICAgICAgICAgICB2YXIgb25Qcm9ncmVzcyA9IG9wdGlvbnMub25Qcm9ncmVzcztcbiAgICAgICAgICAgIGlmIChvblByb2dyZXNzKSB7XG4gICAgICAgICAgICAgICAgZ2V0WGhyT3JYZHIoaWQpLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5sZW5ndGhDb21wdXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvblByb2dyZXNzKGlkLCBlLmxvYWRlZCwgZS50b3RhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldFhkckxvYWRIYW5kbGVyKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZShpZCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldFhkckVycm9ySGFuZGxlcihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoaWQsIHRydWUpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzZXRIZWFkZXJzKGlkKSB7XG4gICAgICAgICAgICB2YXIgeGhyID0gZ2V0WGhyT3JYZHIoaWQpLCBjdXN0b21IZWFkZXJzID0gb3B0aW9ucy5jdXN0b21IZWFkZXJzLCBvbkRlbWFuZEhlYWRlcnMgPSByZXF1ZXN0RGF0YVtpZF0uYWRkaXRpb25hbEhlYWRlcnMgfHwge30sIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kLCBhbGxIZWFkZXJzID0ge307XG4gICAgICAgICAgICBpZiAoIWlzWGRyKHhocikpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmFjY2VwdEhlYWRlciAmJiB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdFwiLCBvcHRpb25zLmFjY2VwdEhlYWRlcik7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYWxsb3dYUmVxdWVzdGVkV2l0aEFuZENhY2hlQ29udHJvbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuY29ycy5leHBlY3RlZCB8fCAoIWlzU2ltcGxlTWV0aG9kKCkgfHwgY29udGFpbnNOb25TaW1wbGVIZWFkZXJzKGN1c3RvbUhlYWRlcnMpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJYLVJlcXVlc3RlZC1XaXRoXCIsIFwiWE1MSHR0cFJlcXVlc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNhY2hlLUNvbnRyb2xcIiwgXCJuby1jYWNoZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5jb250ZW50VHlwZSAmJiAobWV0aG9kID09PSBcIlBPU1RcIiB8fCBtZXRob2QgPT09IFwiUFVUXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIG9wdGlvbnMuY29udGVudFR5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxcS5leHRlbmQoYWxsSGVhZGVycywgcXEuaXNGdW5jdGlvbihjdXN0b21IZWFkZXJzKSA/IGN1c3RvbUhlYWRlcnMoaWQpIDogY3VzdG9tSGVhZGVycyk7XG4gICAgICAgICAgICAgICAgcXEuZXh0ZW5kKGFsbEhlYWRlcnMsIG9uRGVtYW5kSGVhZGVycyk7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChhbGxIZWFkZXJzLCBmdW5jdGlvbihuYW1lLCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIobmFtZSwgdmFsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc1Jlc3BvbnNlU3VjY2Vzc2Z1bChyZXNwb25zZUNvZGUpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pbmRleE9mKG9wdGlvbnMuc3VjY2Vzc2Z1bFJlc3BvbnNlQ29kZXNbb3B0aW9ucy5tZXRob2RdLCByZXNwb25zZUNvZGUpID49IDA7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcHJlcGFyZVRvU2VuZChpZCwgb3B0WGhyLCBhZGRUb1BhdGgsIGFkZGl0aW9uYWxQYXJhbXMsIGFkZGl0aW9uYWxRdWVyeVBhcmFtcywgYWRkaXRpb25hbEhlYWRlcnMsIHBheWxvYWQpIHtcbiAgICAgICAgICAgIHJlcXVlc3REYXRhW2lkXSA9IHtcbiAgICAgICAgICAgICAgICBhZGRUb1BhdGg6IGFkZFRvUGF0aCxcbiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsUGFyYW1zOiBhZGRpdGlvbmFsUGFyYW1zLFxuICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxRdWVyeVBhcmFtczogYWRkaXRpb25hbFF1ZXJ5UGFyYW1zLFxuICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxIZWFkZXJzOiBhZGRpdGlvbmFsSGVhZGVycyxcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiBwYXlsb2FkXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIGxlbiA9IHF1ZXVlLnB1c2goaWQpO1xuICAgICAgICAgICAgaWYgKGxlbiA8PSBvcHRpb25zLm1heENvbm5lY3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0KGlkLCBvcHRYaHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNob3VsZFBhcmFtc0JlSW5RdWVyeVN0cmluZyA9IG9wdGlvbnMubWV0aG9kID09PSBcIkdFVFwiIHx8IG9wdGlvbnMubWV0aG9kID09PSBcIkRFTEVURVwiO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgaW5pdFRyYW5zcG9ydDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGF0aCwgcGFyYW1zLCBoZWFkZXJzLCBwYXlsb2FkLCBjYWNoZUJ1c3RlciwgYWRkaXRpb25hbFF1ZXJ5UGFyYW1zO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHdpdGhQYXRoOiBmdW5jdGlvbihhcHBlbmRUb1BhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBhcHBlbmRUb1BhdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgd2l0aFBhcmFtczogZnVuY3Rpb24oYWRkaXRpb25hbFBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gYWRkaXRpb25hbFBhcmFtcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB3aXRoUXVlcnlQYXJhbXM6IGZ1bmN0aW9uKF9hZGRpdGlvbmFsUXVlcnlQYXJhbXNfKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsUXVlcnlQYXJhbXMgPSBfYWRkaXRpb25hbFF1ZXJ5UGFyYW1zXztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB3aXRoSGVhZGVyczogZnVuY3Rpb24oYWRkaXRpb25hbEhlYWRlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSBhZGRpdGlvbmFsSGVhZGVycztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB3aXRoUGF5bG9hZDogZnVuY3Rpb24odGhlUGF5bG9hZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IHRoZVBheWxvYWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgd2l0aENhY2hlQnVzdGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlQnVzdGVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzZW5kOiBmdW5jdGlvbihvcHRYaHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWNoZUJ1c3RlciAmJiBxcS5pbmRleE9mKFsgXCJHRVRcIiwgXCJERUxFVEVcIiBdLCBvcHRpb25zLm1ldGhvZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy5xcXRpbWVzdGFtcCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByZXBhcmVUb1NlbmQoaWQsIG9wdFhociwgcGF0aCwgcGFyYW1zLCBhZGRpdGlvbmFsUXVlcnlQYXJhbXMsIGhlYWRlcnMsIHBheWxvYWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYW5jZWxlZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBkZXF1ZXVlKGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5VcGxvYWRIYW5kbGVyID0gZnVuY3Rpb24oc3BlYykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHByb3h5ID0gc3BlYy5wcm94eSwgZmlsZVN0YXRlID0ge30sIG9uQ2FuY2VsID0gcHJveHkub25DYW5jZWwsIGdldE5hbWUgPSBwcm94eS5nZXROYW1lO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgYWRkOiBmdW5jdGlvbihpZCwgZmlsZUl0ZW0pIHtcbiAgICAgICAgICAgICAgICBmaWxlU3RhdGVbaWRdID0gZmlsZUl0ZW07XG4gICAgICAgICAgICAgICAgZmlsZVN0YXRlW2lkXS50ZW1wID0ge307XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgY2FuY2VsRmluYWxpemF0aW9uRWZmb3J0ID0gbmV3IHFxLlByb21pc2UoKSwgb25DYW5jZWxSZXRWYWwgPSBvbkNhbmNlbChpZCwgZ2V0TmFtZShpZCksIGNhbmNlbEZpbmFsaXphdGlvbkVmZm9ydCk7XG4gICAgICAgICAgICAgICAgb25DYW5jZWxSZXRWYWwudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuaXNWYWxpZChpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTdGF0ZVtpZF0uY2FuY2VsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5leHB1bmdlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxGaW5hbGl6YXRpb25FZmZvcnQuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4cHVuZ2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGZpbGVTdGF0ZVtpZF07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0VGhpcmRQYXJ0eUZpbGVJZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZVN0YXRlW2lkXS5rZXk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNWYWxpZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZVN0YXRlW2lkXSAhPT0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBmaWxlU3RhdGUgPSB7fTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0RmlsZVN0YXRlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlU3RhdGVbaWRdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXRUaGlyZFBhcnR5RmlsZUlkOiBmdW5jdGlvbihpZCwgdGhpcmRQYXJ0eUZpbGVJZCkge1xuICAgICAgICAgICAgICAgIGZpbGVTdGF0ZVtpZF0ua2V5ID0gdGhpcmRQYXJ0eUZpbGVJZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfd2FzQ2FuY2VsZWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhZmlsZVN0YXRlW2lkXS5jYW5jZWxlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5VcGxvYWRIYW5kbGVyQ29udHJvbGxlciA9IGZ1bmN0aW9uKG8sIG5hbWVzcGFjZSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSB0aGlzLCBjaHVua2luZ1Bvc3NpYmxlID0gZmFsc2UsIGNvbmN1cnJlbnRDaHVua2luZ1Bvc3NpYmxlID0gZmFsc2UsIGNodW5raW5nLCBwcmV2ZW50UmV0cnlSZXNwb25zZSwgbG9nLCBoYW5kbGVyLCBvcHRpb25zID0ge1xuICAgICAgICAgICAgcGFyYW1zU3RvcmU6IHt9LFxuICAgICAgICAgICAgbWF4Q29ubmVjdGlvbnM6IDMsXG4gICAgICAgICAgICBjaHVua2luZzoge1xuICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG11bHRpcGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24oc3RyLCBsZXZlbCkge30sXG4gICAgICAgICAgICBvblByb2dyZXNzOiBmdW5jdGlvbihpZCwgZmlsZU5hbWUsIGxvYWRlZCwgdG90YWwpIHt9LFxuICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24oaWQsIGZpbGVOYW1lLCByZXNwb25zZSwgeGhyKSB7fSxcbiAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbihpZCwgZmlsZU5hbWUpIHt9LFxuICAgICAgICAgICAgb25VcGxvYWRQcmVwOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICBvblVwbG9hZDogZnVuY3Rpb24oaWQsIGZpbGVOYW1lKSB7fSxcbiAgICAgICAgICAgIG9uVXBsb2FkQ2h1bms6IGZ1bmN0aW9uKGlkLCBmaWxlTmFtZSwgY2h1bmtEYXRhKSB7fSxcbiAgICAgICAgICAgIG9uVXBsb2FkQ2h1bmtTdWNjZXNzOiBmdW5jdGlvbihpZCwgY2h1bmtEYXRhLCByZXNwb25zZSwgeGhyKSB7fSxcbiAgICAgICAgICAgIG9uQXV0b1JldHJ5OiBmdW5jdGlvbihpZCwgZmlsZU5hbWUsIHJlc3BvbnNlLCB4aHIpIHt9LFxuICAgICAgICAgICAgb25SZXN1bWU6IGZ1bmN0aW9uKGlkLCBmaWxlTmFtZSwgY2h1bmtEYXRhLCBjdXN0b21SZXN1bWVEYXRhKSB7fSxcbiAgICAgICAgICAgIG9uVXVpZENoYW5nZWQ6IGZ1bmN0aW9uKGlkLCBuZXdVdWlkKSB7fSxcbiAgICAgICAgICAgIGdldE5hbWU6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgIHNldFNpemU6IGZ1bmN0aW9uKGlkLCBuZXdTaXplKSB7fSxcbiAgICAgICAgICAgIGlzUXVldWVkOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICBnZXRJZHNJblByb3h5R3JvdXA6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgIGdldElkc0luQmF0Y2g6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgIGlzSW5Qcm9ncmVzczogZnVuY3Rpb24oaWQpIHt9XG4gICAgICAgIH0sIGNodW5rZWQgPSB7XG4gICAgICAgICAgICBkb25lOiBmdW5jdGlvbihpZCwgY2h1bmtJZHgsIHJlc3BvbnNlLCB4aHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2h1bmtEYXRhID0gaGFuZGxlci5fZ2V0Q2h1bmtEYXRhKGlkLCBjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5hdHRlbXB0aW5nUmVzdW1lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcC5jaHVua1Byb2dyZXNzW2NodW5rSWR4XTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmxvYWRlZCArPSBjaHVua0RhdGEuc2l6ZTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLm9uVXBsb2FkQ2h1bmtTdWNjZXNzKGlkLCBoYW5kbGVyLl9nZXRDaHVua0RhdGFGb3JDYWxsYmFjayhjaHVua0RhdGEpLCByZXNwb25zZSwgeGhyKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaW5hbGl6ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IG9wdGlvbnMuZ2V0U2l6ZShpZCksIG5hbWUgPSBvcHRpb25zLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIGxvZyhcIkFsbCBjaHVua3MgaGF2ZSBiZWVuIHVwbG9hZGVkIGZvciBcIiArIGlkICsgXCIgLSBmaW5hbGl6aW5nLi4uLlwiKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLmZpbmFsaXplQ2h1bmtzKGlkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlLCB4aHIpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiRmluYWxpemUgc3VjY2Vzc2Z1bCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBub3JtYWl6ZWRSZXNwb25zZSA9IHVwbG9hZC5ub3JtYWxpemVSZXNwb25zZShyZXNwb25zZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMub25Qcm9ncmVzcyhpZCwgbmFtZSwgc2l6ZSwgc2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX21heWJlRGVsZXRlUGVyc2lzdGVkQ2h1bmtEYXRhKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkLmNsZWFudXAoaWQsIG5vcm1haXplZFJlc3BvbnNlLCB4aHIpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlLCB4aHIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vcm1hbGl6ZWRSZXNwb25zZSA9IHVwbG9hZC5ub3JtYWxpemVSZXNwb25zZShyZXNwb25zZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJQcm9ibGVtIGZpbmFsaXppbmcgY2h1bmtzIGZvciBmaWxlIElEIFwiICsgaWQgKyBcIiAtIFwiICsgbm9ybWFsaXplZFJlc3BvbnNlLmVycm9yLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9ybWFsaXplZFJlc3BvbnNlLnJlc2V0IHx8IHhociAmJiBvcHRpb25zLmNodW5raW5nLnN1Y2Nlc3MucmVzZXRPblN0YXR1cy5pbmRleE9mKHhoci5zdGF0dXMpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWQucmVzZXQoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5vbkF1dG9SZXRyeShpZCwgbmFtZSwgbm9ybWFsaXplZFJlc3BvbnNlLCB4aHIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQuY2xlYW51cChpZCwgbm9ybWFsaXplZFJlc3BvbnNlLCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFuZGxlRmFpbHVyZTogZnVuY3Rpb24oY2h1bmtJZHgsIGlkLCByZXNwb25zZSwgeGhyKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBvcHRpb25zLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIGxvZyhcIkNodW5rZWQgdXBsb2FkIHJlcXVlc3QgZmFpbGVkIGZvciBcIiArIGlkICsgXCIsIGNodW5rIFwiICsgY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuY2xlYXJDYWNoZWRDaHVuayhpZCwgY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZVRvUmVwb3J0ID0gdXBsb2FkLm5vcm1hbGl6ZVJlc3BvbnNlKHJlc3BvbnNlLCBmYWxzZSksIGluUHJvZ3Jlc3NJZHg7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlVG9SZXBvcnQucmVzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5yZXNldChpZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluUHJvZ3Jlc3NDaHVua3NBcnJheSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmcuaW5Qcm9ncmVzcztcbiAgICAgICAgICAgICAgICAgICAgaW5Qcm9ncmVzc0lkeCA9IGluUHJvZ3Jlc3NDaHVua3NBcnJheSA/IHFxLmluZGV4T2YoaW5Qcm9ncmVzc0NodW5rc0FycmF5LCBjaHVua0lkeCkgOiAtMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluUHJvZ3Jlc3NJZHggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZy5pblByb2dyZXNzLnNwbGljZShpblByb2dyZXNzSWR4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmcucmVtYWluaW5nLnVuc2hpZnQoY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wLmlnbm9yZUZhaWx1cmUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmN1cnJlbnRDaHVua2luZ1Bvc3NpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAuaWdub3JlRmFpbHVyZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiR29pbmcgdG8gYXR0ZW1wdCB0byBhYm9ydCB0aGVzZSBjaHVua3M6IHt9LiBUaGVzZSBhcmUgY3VycmVudGx5IGluLXByb2dyZXNzOiB7fS5cIiwgSlNPTi5zdHJpbmdpZnkoT2JqZWN0LmtleXMoaGFuZGxlci5fZ2V0WGhycyhpZCkpKSwgSlNPTi5zdHJpbmdpZnkoaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZy5pblByb2dyZXNzKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChoYW5kbGVyLl9nZXRYaHJzKGlkKSwgZnVuY3Rpb24oY2tpZCwgY2tYaHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiQXR0ZW1wdGluZyB0byBhYm9ydCBmaWxlIHt9Lnt9LiBYSFIgcmVhZHlTdGF0ZSB7fS4gXCIsIGlkLCBja2lkLCBja1hoci5yZWFkeVN0YXRlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2tYaHIuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBja1hoci5fY2FuY2VsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5tb3ZlSW5Qcm9ncmVzc1RvUmVtYWluaW5nKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLmZyZWUoaWQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5vbkF1dG9SZXRyeShpZCwgbmFtZSwgcmVzcG9uc2VUb1JlcG9ydCwgeGhyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkLmNsZWFudXAoaWQsIHJlc3BvbnNlVG9SZXBvcnQsIHhocik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFzTW9yZVBhcnRzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhIWhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmcucmVtYWluaW5nLmxlbmd0aDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBuZXh0UGFydDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV4dElkeCA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmcucmVtYWluaW5nLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRJZHggPj0gaGFuZGxlci5fZ2V0VG90YWxDaHVua3MoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5leHRJZHggPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dElkeDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJTZXJ2ZXIgb3IgY2FsbGJhY2sgaGFzIG9yZGVyZWQgY2h1bmtpbmcgZWZmb3J0IHRvIGJlIHJlc3RhcnRlZCBvbiBuZXh0IGF0dGVtcHQgZm9yIGl0ZW0gSUQgXCIgKyBpZCwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9tYXliZURlbGV0ZVBlcnNpc3RlZENodW5rRGF0YShpZCk7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5yZWV2YWx1YXRlQ2h1bmtpbmcoaWQpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkubG9hZGVkID0gMDtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmF0dGVtcHRpbmdSZXN1bWUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZW5kTmV4dDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IG9wdGlvbnMuZ2V0U2l6ZShpZCksIG5hbWUgPSBvcHRpb25zLmdldE5hbWUoaWQpLCBjaHVua0lkeCA9IGNodW5rZWQubmV4dFBhcnQoaWQpLCBjaHVua0RhdGEgPSBoYW5kbGVyLl9nZXRDaHVua0RhdGEoaWQsIGNodW5rSWR4KSwgZmlsZVN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKSwgcmVzdW1pbmcgPSBmaWxlU3RhdGUuYXR0ZW1wdGluZ1Jlc3VtZSwgaW5Qcm9ncmVzc0NodW5rcyA9IGZpbGVTdGF0ZS5jaHVua2luZy5pblByb2dyZXNzIHx8IFtdO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlU3RhdGUubG9hZGVkID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZVN0YXRlLmxvYWRlZCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bWluZyAmJiBvcHRpb25zLm9uUmVzdW1lKGlkLCBuYW1lLCBjaHVua0RhdGEsIGZpbGVTdGF0ZS5jdXN0b21SZXN1bWVEYXRhKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5yZXNldChpZCk7XG4gICAgICAgICAgICAgICAgICAgIGNodW5rSWR4ID0gY2h1bmtlZC5uZXh0UGFydChpZCk7XG4gICAgICAgICAgICAgICAgICAgIGNodW5rRGF0YSA9IGhhbmRsZXIuX2dldENodW5rRGF0YShpZCwgY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bWluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2h1bmtJZHggPT0gbnVsbCAmJiBpblByb2dyZXNzQ2h1bmtzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjaHVua2VkLmZpbmFsaXplKGlkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpblByb2dyZXNzQ2h1bmtzLnB1c2goY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nLmluUHJvZ3Jlc3MgPSBpblByb2dyZXNzQ2h1bmtzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uY3VycmVudENodW5raW5nUG9zc2libGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLm9wZW4oaWQsIGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY29uY3VycmVudENodW5raW5nUG9zc2libGUgJiYgY29ubmVjdGlvbk1hbmFnZXIuYXZhaWxhYmxlKCkgJiYgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZy5yZW1haW5pbmcubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkLnNlbmROZXh0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY2h1bmtEYXRhLmJsb2Iuc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkNodW5rIHt9IGZvciBmaWxlIHt9IHdpbGwgbm90IGJlIHVwbG9hZGVkLCB6ZXJvIHNpemVkIGNodW5rLlwiLCBjaHVua0lkeCwgaWQpLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5oYW5kbGVGYWlsdXJlKGNodW5rSWR4LCBpZCwgXCJGaWxlIGlzIG5vIGxvbmdlciBhdmFpbGFibGVcIiwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uVXBsb2FkQ2h1bmtQcm9taXNlID0gb3B0aW9ucy5vblVwbG9hZENodW5rKGlkLCBuYW1lLCBoYW5kbGVyLl9nZXRDaHVua0RhdGFGb3JDYWxsYmFjayhjaHVua0RhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWRDaHVua1Byb21pc2UudGhlbihmdW5jdGlvbihyZXF1ZXN0T3ZlcnJpZGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuaXNJblByb2dyZXNzKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJOb3Qgc2VuZGluZyBjaHVua2VkIHVwbG9hZCByZXF1ZXN0IGZvciBpdGVtIHt9Lnt9IC0gbm8gbG9uZ2VyIGluIHByb2dyZXNzLlwiLCBpZCwgY2h1bmtJZHgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIlNlbmRpbmcgY2h1bmtlZCB1cGxvYWQgcmVxdWVzdCBmb3IgaXRlbSB7fS57fSwgYnl0ZXMge30te30gb2Yge30uXCIsIGlkLCBjaHVua0lkeCwgY2h1bmtEYXRhLnN0YXJ0ICsgMSwgY2h1bmtEYXRhLmVuZCwgc2l6ZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cGxvYWRDaHVua0RhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rSWR4OiBjaHVua0lkeCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVycmlkZXM6IHJlcXVlc3RPdmVycmlkZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VtaW5nOiByZXN1bWluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci51cGxvYWRDaHVuayh1cGxvYWRDaHVua0RhdGEpLnRoZW4oZnVuY3Rpb24gc3VjY2VzcyhyZXNwb25zZSwgeGhyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIkNodW5rZWQgdXBsb2FkIHJlcXVlc3Qgc3VjY2VlZGVkIGZvciBcIiArIGlkICsgXCIsIGNodW5rIFwiICsgY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmNsZWFyQ2FjaGVkQ2h1bmsoaWQsIGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluUHJvZ3Jlc3NDaHVua3MgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nLmluUHJvZ3Jlc3MgfHwgW10sIHJlc3BvbnNlVG9SZXBvcnQgPSB1cGxvYWQubm9ybWFsaXplUmVzcG9uc2UocmVzcG9uc2UsIHRydWUpLCBpblByb2dyZXNzQ2h1bmtJZHggPSBxcS5pbmRleE9mKGluUHJvZ3Jlc3NDaHVua3MsIGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkNodW5rIHt9IGZvciBmaWxlIHt9IHVwbG9hZGVkIHN1Y2Nlc3NmdWxseS5cIiwgY2h1bmtJZHgsIGlkKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWQuZG9uZShpZCwgY2h1bmtJZHgsIHJlc3BvbnNlVG9SZXBvcnQsIHhocik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpblByb2dyZXNzQ2h1bmtJZHggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5Qcm9ncmVzc0NodW5rcy5zcGxpY2UoaW5Qcm9ncmVzc0NodW5rSWR4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9tYXliZVBlcnNpc3RDaHVua2VkU3RhdGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNodW5rZWQuaGFzTW9yZVBhcnRzKGlkKSAmJiBpblByb2dyZXNzQ2h1bmtzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5maW5hbGl6ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2h1bmtlZC5oYXNNb3JlUGFydHMoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkLnNlbmROZXh0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJGaWxlIElEIHt9IGhhcyBubyBtb3JlIGNodW5rcyB0byBzZW5kIGFuZCB0aGVzZSBjaHVuayBpbmRleGVzIGFyZSBzdGlsbCBtYXJrZWQgYXMgaW4tcHJvZ3Jlc3M6IHt9XCIsIGlkLCBKU09OLnN0cmluZ2lmeShpblByb2dyZXNzQ2h1bmtzKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZmFpbHVyZShyZXNwb25zZSwgeGhyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWQuaGFuZGxlRmFpbHVyZShjaHVua0lkeCwgaWQsIHJlc3BvbnNlLCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuY2xlYXJYaHIoaWQsIGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWQuaGFuZGxlRmFpbHVyZShjaHVua0lkeCwgaWQsIGVycm9yLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBjb25uZWN0aW9uTWFuYWdlciA9IHtcbiAgICAgICAgICAgIF9vcGVuOiBbXSxcbiAgICAgICAgICAgIF9vcGVuQ2h1bmtzOiB7fSxcbiAgICAgICAgICAgIF93YWl0aW5nOiBbXSxcbiAgICAgICAgICAgIGF2YWlsYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1heCA9IG9wdGlvbnMubWF4Q29ubmVjdGlvbnMsIG9wZW5DaHVua0VudHJpZXNDb3VudCA9IDAsIG9wZW5DaHVua3NDb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChjb25uZWN0aW9uTWFuYWdlci5fb3BlbkNodW5rcywgZnVuY3Rpb24oZmlsZUlkLCBvcGVuQ2h1bmtJbmRleGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wZW5DaHVua0VudHJpZXNDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBvcGVuQ2h1bmtzQ291bnQgKz0gb3BlbkNodW5rSW5kZXhlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1heCAtIChjb25uZWN0aW9uTWFuYWdlci5fb3Blbi5sZW5ndGggLSBvcGVuQ2h1bmtFbnRyaWVzQ291bnQgKyBvcGVuQ2h1bmtzQ291bnQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZyZWU6IGZ1bmN0aW9uKGlkLCBkb250QWxsb3dOZXh0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGFsbG93TmV4dCA9ICFkb250QWxsb3dOZXh0LCB3YWl0aW5nSW5kZXggPSBxcS5pbmRleE9mKGNvbm5lY3Rpb25NYW5hZ2VyLl93YWl0aW5nLCBpZCksIGNvbm5lY3Rpb25zSW5kZXggPSBxcS5pbmRleE9mKGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuLCBpZCksIG5leHRJZDtcbiAgICAgICAgICAgICAgICBkZWxldGUgY29ubmVjdGlvbk1hbmFnZXIuX29wZW5DaHVua3NbaWRdO1xuICAgICAgICAgICAgICAgIGlmICh1cGxvYWQuZ2V0UHJveHlPckJsb2IoaWQpIGluc3RhbmNlb2YgcXEuQmxvYlByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIkdlbmVyYXRlZCBibG9iIHVwbG9hZCBoYXMgZW5kZWQgZm9yIFwiICsgaWQgKyBcIiwgZGlzcG9zaW5nIGdlbmVyYXRlZCBibG9iLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuZmlsZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHdhaXRpbmdJbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLl93YWl0aW5nLnNwbGljZSh3YWl0aW5nSW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxsb3dOZXh0ICYmIGNvbm5lY3Rpb25zSW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5fb3Blbi5zcGxpY2UoY29ubmVjdGlvbnNJbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIG5leHRJZCA9IGNvbm5lY3Rpb25NYW5hZ2VyLl93YWl0aW5nLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0SWQgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuX29wZW4ucHVzaChuZXh0SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkLnN0YXJ0KG5leHRJZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0V2FpdGluZ09yQ29ubmVjdGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgd2FpdGluZ09yQ29ubmVjdGVkID0gW107XG4gICAgICAgICAgICAgICAgcXEuZWFjaChjb25uZWN0aW9uTWFuYWdlci5fb3BlbkNodW5rcywgZnVuY3Rpb24oZmlsZUlkLCBjaHVua3MpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNodW5rcyAmJiBjaHVua3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YWl0aW5nT3JDb25uZWN0ZWQucHVzaChwYXJzZUludChmaWxlSWQpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goY29ubmVjdGlvbk1hbmFnZXIuX29wZW4sIGZ1bmN0aW9uKGlkeCwgZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY29ubmVjdGlvbk1hbmFnZXIuX29wZW5DaHVua3NbZmlsZUlkXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FpdGluZ09yQ29ubmVjdGVkLnB1c2gocGFyc2VJbnQoZmlsZUlkKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB3YWl0aW5nT3JDb25uZWN0ZWQgPSB3YWl0aW5nT3JDb25uZWN0ZWQuY29uY2F0KGNvbm5lY3Rpb25NYW5hZ2VyLl93YWl0aW5nKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gd2FpdGluZ09yQ29ubmVjdGVkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzVXNpbmdDb25uZWN0aW9uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcS5pbmRleE9mKGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuLCBpZCkgPj0gMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcGVuOiBmdW5jdGlvbihpZCwgY2h1bmtJZHgpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2h1bmtJZHggPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5fd2FpdGluZy5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb25NYW5hZ2VyLmF2YWlsYWJsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaHVua0lkeCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5fd2FpdGluZy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcGVuQ2h1bmtzRW50cnkgPSBjb25uZWN0aW9uTWFuYWdlci5fb3BlbkNodW5rc1tpZF0gfHwgW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbkNodW5rc0VudHJ5LnB1c2goY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuQ2h1bmtzW2lkXSA9IG9wZW5DaHVua3NFbnRyeTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuX3dhaXRpbmcgPSBbXTtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5fb3BlbiA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBzaW1wbGUgPSB7XG4gICAgICAgICAgICBzZW5kOiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlU3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpO1xuICAgICAgICAgICAgICAgIGlmICghZmlsZVN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIklnbm9yaW5nIHNlbmQgcmVxdWVzdCBhcyB0aGlzIHVwbG9hZCBtYXkgaGF2ZSBiZWVuIGNhbmNlbGxlZCwgRmlsZSBJRCBcIiArIGlkLCBcIndhcm5cIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmlsZVN0YXRlLmxvYWRlZCA9IDA7XG4gICAgICAgICAgICAgICAgbG9nKFwiU2VuZGluZyBzaW1wbGUgdXBsb2FkIHJlcXVlc3QgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIudXBsb2FkRmlsZShpZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSwgb3B0WGhyKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIlNpbXBsZSB1cGxvYWQgcmVxdWVzdCBzdWNjZWVkZWQgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VUb1JlcG9ydCA9IHVwbG9hZC5ub3JtYWxpemVSZXNwb25zZShyZXNwb25zZSwgdHJ1ZSksIHNpemUgPSBvcHRpb25zLmdldFNpemUoaWQpO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm9uUHJvZ3Jlc3MoaWQsIG5hbWUsIHNpemUsIHNpemUpO1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWQubWF5YmVOZXdVdWlkKGlkLCByZXNwb25zZVRvUmVwb3J0KTtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkLmNsZWFudXAoaWQsIHJlc3BvbnNlVG9SZXBvcnQsIG9wdFhocik7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UsIG9wdFhocikge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJTaW1wbGUgdXBsb2FkIHJlcXVlc3QgZmFpbGVkIGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlVG9SZXBvcnQgPSB1cGxvYWQubm9ybWFsaXplUmVzcG9uc2UocmVzcG9uc2UsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLm9uQXV0b1JldHJ5KGlkLCBuYW1lLCByZXNwb25zZVRvUmVwb3J0LCBvcHRYaHIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQuY2xlYW51cChpZCwgcmVzcG9uc2VUb1JlcG9ydCwgb3B0WGhyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB1cGxvYWQgPSB7XG4gICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiQ2FuY2VsbGluZyBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnBhcmFtc1N0b3JlLnJlbW92ZShpZCk7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuZnJlZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xlYW51cDogZnVuY3Rpb24oaWQsIHJlc3BvbnNlLCBvcHRYaHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IG9wdGlvbnMuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5vbkNvbXBsZXRlKGlkLCBuYW1lLCByZXNwb25zZSwgb3B0WGhyKTtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9jbGVhclhocnMgJiYgaGFuZGxlci5fY2xlYXJYaHJzKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuZnJlZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UHJveHlPckJsb2I6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuZ2V0UHJveHkgJiYgaGFuZGxlci5nZXRQcm94eShpZCkgfHwgaGFuZGxlci5nZXRGaWxlICYmIGhhbmRsZXIuZ2V0RmlsZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5pdEhhbmRsZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBoYW5kbGVyVHlwZSA9IG5hbWVzcGFjZSA/IHFxW25hbWVzcGFjZV0gOiBxcS50cmFkaXRpb25hbCwgaGFuZGxlck1vZHVsZVN1YnR5cGUgPSBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5hamF4VXBsb2FkaW5nID8gXCJYaHJcIiA6IFwiRm9ybVwiO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIgPSBuZXcgaGFuZGxlclR5cGVbaGFuZGxlck1vZHVsZVN1YnR5cGUgKyBcIlVwbG9hZEhhbmRsZXJcIl0ob3B0aW9ucywge1xuICAgICAgICAgICAgICAgICAgICBnZXRDdXN0b21SZXN1bWVEYXRhOiBvcHRpb25zLmdldEN1c3RvbVJlc3VtZURhdGEsXG4gICAgICAgICAgICAgICAgICAgIGdldERhdGFCeVV1aWQ6IG9wdGlvbnMuZ2V0RGF0YUJ5VXVpZCxcbiAgICAgICAgICAgICAgICAgICAgZ2V0TmFtZTogb3B0aW9ucy5nZXROYW1lLFxuICAgICAgICAgICAgICAgICAgICBnZXRTaXplOiBvcHRpb25zLmdldFNpemUsXG4gICAgICAgICAgICAgICAgICAgIGdldFV1aWQ6IG9wdGlvbnMuZ2V0VXVpZCxcbiAgICAgICAgICAgICAgICAgICAgbG9nOiBsb2csXG4gICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBvcHRpb25zLm9uQ2FuY2VsLFxuICAgICAgICAgICAgICAgICAgICBvblByb2dyZXNzOiBvcHRpb25zLm9uUHJvZ3Jlc3MsXG4gICAgICAgICAgICAgICAgICAgIG9uVXVpZENoYW5nZWQ6IG9wdGlvbnMub25VdWlkQ2hhbmdlZCxcbiAgICAgICAgICAgICAgICAgICAgb25GaW5hbGl6aW5nOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5VUExPQURfRklOQUxJWklORyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5fcmVtb3ZlRXhwaXJlZENodW5raW5nUmVjb3Jkcykge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9yZW1vdmVFeHBpcmVkQ2h1bmtpbmdSZWNvcmRzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzRGVmZXJyZWRFbGlnaWJsZUZvclVwbG9hZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5pc1F1ZXVlZChpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWF5YmVEZWZlcjogZnVuY3Rpb24oaWQsIGJsb2IpIHtcbiAgICAgICAgICAgICAgICBpZiAoYmxvYiAmJiAhaGFuZGxlci5nZXRGaWxlKGlkKSAmJiBibG9iIGluc3RhbmNlb2YgcXEuQmxvYlByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMub25VcGxvYWRQcmVwKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiQXR0ZW1wdGluZyB0byBnZW5lcmF0ZSBhIGJsb2Igb24tZGVtYW5kIGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICAgICAgYmxvYi5jcmVhdGUoKS50aGVuKGZ1bmN0aW9uKGdlbmVyYXRlZEJsb2IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIkdlbmVyYXRlZCBhbiBvbi1kZW1hbmQgYmxvYiBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnVwZGF0ZUJsb2IoaWQsIGdlbmVyYXRlZEJsb2IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zZXRTaXplKGlkLCBnZW5lcmF0ZWRCbG9iLnNpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5yZWV2YWx1YXRlQ2h1bmtpbmcoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkLm1heWJlU2VuZERlZmVycmVkRmlsZXMoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JSZXNwb25zZS5lcnJvciA9IGVycm9yTWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJGYWlsZWQgdG8gZ2VuZXJhdGUgYmxvYiBmb3IgSUQge30uICBFcnJvciBtZXNzYWdlOiB7fS5cIiwgaWQsIGVycm9yTWVzc2FnZSksIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm9uQ29tcGxldGUoaWQsIG9wdGlvbnMuZ2V0TmFtZShpZCksIHFxLmV4dGVuZChlcnJvclJlc3BvbnNlLCBwcmV2ZW50UmV0cnlSZXNwb25zZSksIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkLm1heWJlU2VuZERlZmVycmVkRmlsZXMoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuZnJlZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGxvYWQubWF5YmVTZW5kRGVmZXJyZWRGaWxlcyhpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXliZVNlbmREZWZlcnJlZEZpbGVzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBpZHNJbkdyb3VwID0gb3B0aW9ucy5nZXRJZHNJblByb3h5R3JvdXAoaWQpLCB1cGxvYWRlZFRoaXNJZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChpZHNJbkdyb3VwICYmIGlkc0luR3JvdXAubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIk1heWJlIHJlYWR5IHRvIHVwbG9hZCBwcm94eSBncm91cCBmaWxlIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGlkc0luR3JvdXAsIGZ1bmN0aW9uKGlkeCwgaWRJbkdyb3VwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkLmlzRGVmZXJyZWRFbGlnaWJsZUZvclVwbG9hZChpZEluR3JvdXApICYmICEhaGFuZGxlci5nZXRGaWxlKGlkSW5Hcm91cCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZFRoaXNJZCA9IGlkSW5Hcm91cCA9PT0gaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkLm5vdyhpZEluR3JvdXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1cGxvYWQuaXNEZWZlcnJlZEVsaWdpYmxlRm9yVXBsb2FkKGlkSW5Hcm91cCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVkVGhpc0lkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkLm5vdyhpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB1cGxvYWRlZFRoaXNJZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXliZU5ld1V1aWQ6IGZ1bmN0aW9uKGlkLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5uZXdVdWlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5vblV1aWRDaGFuZ2VkKGlkLCByZXNwb25zZS5uZXdVdWlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbm9ybWFsaXplUmVzcG9uc2U6IGZ1bmN0aW9uKG9yaWdpbmFsUmVzcG9uc2UsIHN1Y2Nlc3NmdWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBvcmlnaW5hbFJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIGlmICghcXEuaXNPYmplY3Qob3JpZ2luYWxSZXNwb25zZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzU3RyaW5nKG9yaWdpbmFsUmVzcG9uc2UpICYmICFzdWNjZXNzZnVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5lcnJvciA9IG9yaWdpbmFsUmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IHN1Y2Nlc3NmdWw7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG5vdzogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IG9wdGlvbnMuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb250cm9sbGVyLmlzVmFsaWQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBxcS5FcnJvcihpZCArIFwiIGlzIG5vdCBhIHZhbGlkIGZpbGUgSUQgdG8gdXBsb2FkIVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5vblVwbG9hZChpZCwgbmFtZSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UucGF1c2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuUEFVU0VEKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIucGF1c2UoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuZnJlZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2h1bmtpbmdQb3NzaWJsZSAmJiBoYW5kbGVyLl9zaG91bGRDaHVua1RoaXNGaWxlKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWQuc2VuZE5leHQoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW1wbGUuc2VuZChpZCwgbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGVycm9yIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICBsb2coaWQgKyBcIiB1cGxvYWQgc3RhcnQgYWJvcnRlZCBkdWUgdG8gcmVqZWN0ZWQgb25VcGxvYWQgUHJvbWlzZSAtIGRldGFpbHM6IFwiICsgZXJyb3IsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5vbkF1dG9SZXRyeShpZCwgbmFtZSwgZXJyb3IucmVzcG9uc2VKU09OIHx8IHt9KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gdXBsb2FkLm5vcm1hbGl6ZVJlc3BvbnNlKGVycm9yLnJlc3BvbnNlSlNPTiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkLmNsZWFudXAoaWQsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBibG9iVG9VcGxvYWQgPSB1cGxvYWQuZ2V0UHJveHlPckJsb2IoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChibG9iVG9VcGxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwbG9hZC5tYXliZURlZmVyKGlkLCBibG9iVG9VcGxvYWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZC5ub3coaWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGlkLCBmaWxlKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5hZGQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGxvYWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb25NYW5hZ2VyLm9wZW4oaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGxvYWQuc3RhcnQoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0cnk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmN1cnJlbnRDaHVua2luZ1Bvc3NpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcC5pZ25vcmVGYWlsdXJlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9uTWFuYWdlci5pc1VzaW5nQ29ubmVjdGlvbihpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwbG9hZC5zdGFydChpZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXIudXBsb2FkKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBjYW5jZWxSZXRWYWwgPSBoYW5kbGVyLmNhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzR2VuZXJpY1Byb21pc2UoY2FuY2VsUmV0VmFsKSkge1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWxSZXRWYWwudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZC5jYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNhbmNlbFJldFZhbCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkLmNhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbmNlbEFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHdhaXRpbmdPckNvbm5lY3RlZCA9IGNvbm5lY3Rpb25NYW5hZ2VyLmdldFdhaXRpbmdPckNvbm5lY3RlZCgpLCBpO1xuICAgICAgICAgICAgICAgIGlmICh3YWl0aW5nT3JDb25uZWN0ZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IHdhaXRpbmdPckNvbm5lY3RlZC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlci5jYW5jZWwod2FpdGluZ09yQ29ubmVjdGVkW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5yZXNldCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZpbGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIuZ2V0UHJveHkgJiYgaGFuZGxlci5nZXRQcm94eShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuZ2V0UHJveHkoaWQpLnJlZmVyZW5jZUJsb2I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmdldEZpbGUgJiYgaGFuZGxlci5nZXRGaWxlKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1Byb3hpZWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhKGhhbmRsZXIuZ2V0UHJveHkgJiYgaGFuZGxlci5nZXRQcm94eShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldElucHV0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLmdldElucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmdldElucHV0KGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxvZyhcIlJlc2V0dGluZyB1cGxvYWQgaGFuZGxlclwiKTtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyLmNhbmNlbEFsbCgpO1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5yZXNldCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4cHVuZ2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXIuaXNWYWxpZChpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuZXhwdW5nZShpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzVmFsaWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuaXNWYWxpZChpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFzUmVzdW1lUmVjb3JkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBoYW5kbGVyLmlzVmFsaWQoaWQpICYmIGhhbmRsZXIuX2dldExvY2FsU3RvcmFnZUlkICYmIGhhbmRsZXIuX2dldExvY2FsU3RvcmFnZUlkKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhIWxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSZXN1bWFibGVGaWxlc0RhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLmdldFJlc3VtYWJsZUZpbGVzRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5nZXRSZXN1bWFibGVGaWxlc0RhdGEoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFRoaXJkUGFydHlGaWxlSWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXIuaXNWYWxpZChpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuZ2V0VGhpcmRQYXJ0eUZpbGVJZChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhdXNlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChjb250cm9sbGVyLmlzUmVzdW1hYmxlKGlkKSAmJiBoYW5kbGVyLnBhdXNlICYmIGNvbnRyb2xsZXIuaXNWYWxpZChpZCkgJiYgaGFuZGxlci5wYXVzZShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuZnJlZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIubW92ZUluUHJvZ3Jlc3NUb1JlbWFpbmluZyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNBdHRlbXB0aW5nUmVzdW1lOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhIWhhbmRsZXIuaXNBdHRlbXB0aW5nUmVzdW1lICYmIGhhbmRsZXIuaXNBdHRlbXB0aW5nUmVzdW1lKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1Jlc3VtYWJsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISFoYW5kbGVyLmlzUmVzdW1hYmxlICYmIGhhbmRsZXIuaXNSZXN1bWFibGUoaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIG8pO1xuICAgICAgICBsb2cgPSBvcHRpb25zLmxvZztcbiAgICAgICAgY2h1bmtpbmdQb3NzaWJsZSA9IG9wdGlvbnMuY2h1bmtpbmcuZW5hYmxlZCAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5jaHVua2luZztcbiAgICAgICAgY29uY3VycmVudENodW5raW5nUG9zc2libGUgPSBjaHVua2luZ1Bvc3NpYmxlICYmIG9wdGlvbnMuY2h1bmtpbmcuY29uY3VycmVudC5lbmFibGVkO1xuICAgICAgICBwcmV2ZW50UmV0cnlSZXNwb25zZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0ge307XG4gICAgICAgICAgICByZXNwb25zZVtvcHRpb25zLnByZXZlbnRSZXRyeVBhcmFtXSA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0oKTtcbiAgICAgICAgdXBsb2FkLmluaXRIYW5kbGVyKCk7XG4gICAgfTtcbiAgICBxcS5XaW5kb3dSZWNlaXZlTWVzc2FnZSA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsZXZlbCkge31cbiAgICAgICAgfSwgY2FsbGJhY2tXcmFwcGVyRGV0YWNoZXJzID0ge307XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBvKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHJlY2VpdmVNZXNzYWdlOiBmdW5jdGlvbihpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB2YXIgb25NZXNzYWdlQ2FsbGJhY2tXcmFwcGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXZlbnQuZGF0YSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LnBvc3RNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrV3JhcHBlckRldGFjaGVyc1tpZF0gPSBxcSh3aW5kb3cpLmF0dGFjaChcIm1lc3NhZ2VcIiwgb25NZXNzYWdlQ2FsbGJhY2tXcmFwcGVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJpZnJhbWUgbWVzc2FnZSBwYXNzaW5nIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyIVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdG9wUmVjZWl2aW5nTWVzc2FnZXM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5wb3N0TWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGV0YWNoZXIgPSBjYWxsYmFja1dyYXBwZXJEZXRhY2hlcnNbaWRdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGV0YWNoZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFjaGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuRm9ybVVwbG9hZEhhbmRsZXIgPSBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgb3B0aW9ucyA9IHNwZWMub3B0aW9ucywgaGFuZGxlciA9IHRoaXMsIHByb3h5ID0gc3BlYy5wcm94eSwgZm9ybUhhbmRsZXJJbnN0YW5jZUlkID0gcXEuZ2V0VW5pcXVlSWQoKSwgb25sb2FkQ2FsbGJhY2tzID0ge30sIGRldGFjaExvYWRFdmVudHMgPSB7fSwgcG9zdE1lc3NhZ2VDYWxsYmFja1RpbWVycyA9IHt9LCBpc0NvcnMgPSBvcHRpb25zLmlzQ29ycywgaW5wdXROYW1lID0gb3B0aW9ucy5pbnB1dE5hbWUsIGdldFV1aWQgPSBwcm94eS5nZXRVdWlkLCBsb2cgPSBwcm94eS5sb2csIGNvcnNNZXNzYWdlUmVjZWl2ZXIgPSBuZXcgcXEuV2luZG93UmVjZWl2ZU1lc3NhZ2Uoe1xuICAgICAgICAgICAgbG9nOiBsb2dcbiAgICAgICAgfSk7XG4gICAgICAgIGZ1bmN0aW9uIGV4cHVuZ2VGaWxlKGlkKSB7XG4gICAgICAgICAgICBkZWxldGUgZGV0YWNoTG9hZEV2ZW50c1tpZF07XG4gICAgICAgICAgICBpZiAoaXNDb3JzKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHBvc3RNZXNzYWdlQ2FsbGJhY2tUaW1lcnNbaWRdKTtcbiAgICAgICAgICAgICAgICBkZWxldGUgcG9zdE1lc3NhZ2VDYWxsYmFja1RpbWVyc1tpZF07XG4gICAgICAgICAgICAgICAgY29yc01lc3NhZ2VSZWNlaXZlci5zdG9wUmVjZWl2aW5nTWVzc2FnZXMoaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGlmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhhbmRsZXIuX2dldElmcmFtZU5hbWUoaWQpKTtcbiAgICAgICAgICAgIGlmIChpZnJhbWUpIHtcbiAgICAgICAgICAgICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwiamF2YXNjcmlwdDpmYWxzZTtcIik7XG4gICAgICAgICAgICAgICAgcXEoaWZyYW1lKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRGaWxlSWRGb3JJZnJhbWVOYW1lKGlmcmFtZU5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBpZnJhbWVOYW1lLnNwbGl0KFwiX1wiKVswXTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpbml0SWZyYW1lRm9yVXBsb2FkKG5hbWUpIHtcbiAgICAgICAgICAgIHZhciBpZnJhbWUgPSBxcS50b0VsZW1lbnQoXCI8aWZyYW1lIHNyYz0namF2YXNjcmlwdDpmYWxzZTsnIG5hbWU9J1wiICsgbmFtZSArIFwiJyAvPlwiKTtcbiAgICAgICAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuYW1lKTtcbiAgICAgICAgICAgIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gaWZyYW1lO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyUG9zdE1lc3NhZ2VDYWxsYmFjayhpZnJhbWUsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgaWZyYW1lTmFtZSA9IGlmcmFtZS5pZCwgZmlsZUlkID0gZ2V0RmlsZUlkRm9ySWZyYW1lTmFtZShpZnJhbWVOYW1lKSwgdXVpZCA9IGdldFV1aWQoZmlsZUlkKTtcbiAgICAgICAgICAgIG9ubG9hZENhbGxiYWNrc1t1dWlkXSA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgZGV0YWNoTG9hZEV2ZW50c1tmaWxlSWRdID0gcXEoaWZyYW1lKS5hdHRhY2goXCJsb2FkXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLmdldElucHV0KGZpbGVJZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiUmVjZWl2ZWQgaWZyYW1lIGxvYWQgZXZlbnQgZm9yIENPUlMgdXBsb2FkIHJlcXVlc3QgKGlmcmFtZSBuYW1lIFwiICsgaWZyYW1lTmFtZSArIFwiKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2VDYWxsYmFja1RpbWVyc1tpZnJhbWVOYW1lXSA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNZXNzYWdlID0gXCJObyB2YWxpZCBtZXNzYWdlIHJlY2VpdmVkIGZyb20gbG9hZGVkIGlmcmFtZSBmb3IgaWZyYW1lIG5hbWUgXCIgKyBpZnJhbWVOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGVycm9yTWVzc2FnZSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3JNZXNzYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMWUzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvcnNNZXNzYWdlUmVjZWl2ZXIucmVjZWl2ZU1lc3NhZ2UoaWZyYW1lTmFtZSwgZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIGxvZyhcIlJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgd2luZG93IG1lc3NhZ2U6ICdcIiArIG1lc3NhZ2UgKyBcIidcIik7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVJZCA9IGdldEZpbGVJZEZvcklmcmFtZU5hbWUoaWZyYW1lTmFtZSksIHJlc3BvbnNlID0gaGFuZGxlci5fcGFyc2VKc29uUmVzcG9uc2UobWVzc2FnZSksIHV1aWQgPSByZXNwb25zZS51dWlkLCBvbmxvYWRDYWxsYmFjaztcbiAgICAgICAgICAgICAgICBpZiAodXVpZCAmJiBvbmxvYWRDYWxsYmFja3NbdXVpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiSGFuZGxpbmcgcmVzcG9uc2UgZm9yIGlmcmFtZSBuYW1lIFwiICsgaWZyYW1lTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChwb3N0TWVzc2FnZUNhbGxiYWNrVGltZXJzW2lmcmFtZU5hbWVdKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHBvc3RNZXNzYWdlQ2FsbGJhY2tUaW1lcnNbaWZyYW1lTmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2RldGFjaExvYWRFdmVudChpZnJhbWVOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgb25sb2FkQ2FsbGJhY2sgPSBvbmxvYWRDYWxsYmFja3NbdXVpZF07XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvbmxvYWRDYWxsYmFja3NbdXVpZF07XG4gICAgICAgICAgICAgICAgICAgIGNvcnNNZXNzYWdlUmVjZWl2ZXIuc3RvcFJlY2VpdmluZ01lc3NhZ2VzKGlmcmFtZU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBvbmxvYWRDYWxsYmFjayhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdXVpZCkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCInXCIgKyBtZXNzYWdlICsgXCInIGRvZXMgbm90IGNvbnRhaW4gYSBVVUlEIC0gaWdub3JpbmcuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuVXBsb2FkSGFuZGxlcihzcGVjKSk7XG4gICAgICAgIHFxLm92ZXJyaWRlKHRoaXMsIGZ1bmN0aW9uKHN1cGVyXykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGlkLCBmaWxlSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3VwZXJfLmFkZChpZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IGZpbGVJbnB1dFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUlucHV0LnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgaW5wdXROYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVJbnB1dC5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcShmaWxlSW5wdXQpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBleHB1bmdlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICBleHB1bmdlRmlsZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHN1cGVyXy5leHB1bmdlKGlkKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGlzVmFsaWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlcl8uaXNWYWxpZChpZCkgJiYgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5pbnB1dCAhPT0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgZ2V0SW5wdXQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuaW5wdXQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2F0dGFjaExvYWRFdmVudDogZnVuY3Rpb24oaWZyYW1lLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZURlc2NyaXB0b3I7XG4gICAgICAgICAgICAgICAgaWYgKGlzQ29ycykge1xuICAgICAgICAgICAgICAgICAgICByZWdpc3RlclBvc3RNZXNzYWdlQ2FsbGJhY2soaWZyYW1lLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGV0YWNoTG9hZEV2ZW50c1tpZnJhbWUuaWRdID0gcXEoaWZyYW1lKS5hdHRhY2goXCJsb2FkXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiUmVjZWl2ZWQgcmVzcG9uc2UgZm9yIFwiICsgaWZyYW1lLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaWZyYW1lLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZnJhbWUuY29udGVudERvY3VtZW50ICYmIGlmcmFtZS5jb250ZW50RG9jdW1lbnQuYm9keSAmJiBpZnJhbWUuY29udGVudERvY3VtZW50LmJvZHkuaW5uZXJIVE1MID09IFwiZmFsc2VcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJFcnJvciB3aGVuIGF0dGVtcHRpbmcgdG8gYWNjZXNzIGlmcmFtZSBkdXJpbmcgaGFuZGxpbmcgb2YgdXBsb2FkIHJlc3BvbnNlIChcIiArIGVycm9yLm1lc3NhZ2UgKyBcIilcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZURlc2NyaXB0b3IgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlRGVzY3JpcHRvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY3JlYXRlSWZyYW1lOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBpZnJhbWVOYW1lID0gaGFuZGxlci5fZ2V0SWZyYW1lTmFtZShpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluaXRJZnJhbWVGb3JVcGxvYWQoaWZyYW1lTmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2RldGFjaExvYWRFdmVudDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGV0YWNoTG9hZEV2ZW50c1tpZF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBkZXRhY2hMb2FkRXZlbnRzW2lkXSgpO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgZGV0YWNoTG9hZEV2ZW50c1tpZF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRJZnJhbWVOYW1lOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZUlkICsgXCJfXCIgKyBmb3JtSGFuZGxlckluc3RhbmNlSWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXRGb3JtRm9yVXBsb2FkOiBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1ldGhvZCA9IHNwZWMubWV0aG9kLCBlbmRwb2ludCA9IHNwZWMuZW5kcG9pbnQsIHBhcmFtcyA9IHNwZWMucGFyYW1zLCBwYXJhbXNJbkJvZHkgPSBzcGVjLnBhcmFtc0luQm9keSwgdGFyZ2V0TmFtZSA9IHNwZWMudGFyZ2V0TmFtZSwgZm9ybSA9IHFxLnRvRWxlbWVudChcIjxmb3JtIG1ldGhvZD0nXCIgKyBtZXRob2QgKyBcIicgZW5jdHlwZT0nbXVsdGlwYXJ0L2Zvcm0tZGF0YSc+PC9mb3JtPlwiKSwgdXJsID0gZW5kcG9pbnQ7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmFtc0luQm9keSkge1xuICAgICAgICAgICAgICAgICAgICBxcS5vYmoySW5wdXRzKHBhcmFtcywgZm9ybSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsID0gcXEub2JqMnVybChwYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9ybS5zZXRBdHRyaWJ1dGUoXCJhY3Rpb25cIiwgdXJsKTtcbiAgICAgICAgICAgICAgICBmb3JtLnNldEF0dHJpYnV0ZShcInRhcmdldFwiLCB0YXJnZXROYW1lKTtcbiAgICAgICAgICAgICAgICBmb3JtLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZvcm0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmb3JtO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9wYXJzZUpzb25SZXNwb25zZTogZnVuY3Rpb24oaW5uZXJIdG1sT3JNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0ge307XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBxcS5wYXJzZUpzb24oaW5uZXJIdG1sT3JNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJFcnJvciB3aGVuIGF0dGVtcHRpbmcgdG8gcGFyc2UgaWZyYW1lIHVwbG9hZCByZXNwb25zZSAoXCIgKyBlcnJvci5tZXNzYWdlICsgXCIpXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5YaHJVcGxvYWRIYW5kbGVyID0gZnVuY3Rpb24oc3BlYykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGhhbmRsZXIgPSB0aGlzLCBuYW1lc3BhY2UgPSBzcGVjLm9wdGlvbnMubmFtZXNwYWNlLCBwcm94eSA9IHNwZWMucHJveHksIGNodW5raW5nID0gc3BlYy5vcHRpb25zLmNodW5raW5nLCBnZXRDaHVua1NpemUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdmFyIGZpbGVTdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCk7XG4gICAgICAgICAgICBpZiAoZmlsZVN0YXRlLmNodW5rU2l6ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlU3RhdGUuY2h1bmtTaXplO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgY2h1bmtTaXplID0gY2h1bmtpbmcucGFydFNpemU7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzRnVuY3Rpb24oY2h1bmtTaXplKSkge1xuICAgICAgICAgICAgICAgICAgICBjaHVua1NpemUgPSBjaHVua1NpemUoaWQsIGdldFNpemUoaWQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmlsZVN0YXRlLmNodW5rU2l6ZSA9IGNodW5rU2l6ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2h1bmtTaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCByZXN1bWUgPSBzcGVjLm9wdGlvbnMucmVzdW1lLCBjaHVua0ZpbGVzID0gY2h1bmtpbmcgJiYgc3BlYy5vcHRpb25zLmNodW5raW5nLmVuYWJsZWQgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuY2h1bmtpbmcsIHJlc3VtZUVuYWJsZWQgPSByZXN1bWUgJiYgc3BlYy5vcHRpb25zLnJlc3VtZS5lbmFibGVkICYmIGNodW5rRmlsZXMgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMucmVzdW1lLCBnZXROYW1lID0gcHJveHkuZ2V0TmFtZSwgZ2V0U2l6ZSA9IHByb3h5LmdldFNpemUsIGdldFV1aWQgPSBwcm94eS5nZXRVdWlkLCBnZXRFbmRwb2ludCA9IHByb3h5LmdldEVuZHBvaW50LCBnZXREYXRhQnlVdWlkID0gcHJveHkuZ2V0RGF0YUJ5VXVpZCwgb25VdWlkQ2hhbmdlZCA9IHByb3h5Lm9uVXVpZENoYW5nZWQsIG9uUHJvZ3Jlc3MgPSBwcm94eS5vblByb2dyZXNzLCBsb2cgPSBwcm94eS5sb2csIGdldEN1c3RvbVJlc3VtZURhdGEgPSBwcm94eS5nZXRDdXN0b21SZXN1bWVEYXRhO1xuICAgICAgICBmdW5jdGlvbiBhYm9ydChpZCkge1xuICAgICAgICAgICAgcXEuZWFjaChoYW5kbGVyLl9nZXRYaHJzKGlkKSwgZnVuY3Rpb24oeGhySWQsIHhocikge1xuICAgICAgICAgICAgICAgIHZhciBhamF4UmVxdWVzdGVyID0gaGFuZGxlci5fZ2V0QWpheFJlcXVlc3RlcihpZCwgeGhySWQpO1xuICAgICAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgeGhyLmFib3J0KCk7XG4gICAgICAgICAgICAgICAgYWpheFJlcXVlc3RlciAmJiBhamF4UmVxdWVzdGVyLmNhbmNlbGVkICYmIGFqYXhSZXF1ZXN0ZXIuY2FuY2VsZWQoaWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5VcGxvYWRIYW5kbGVyKHNwZWMpKTtcbiAgICAgICAgcXEub3ZlcnJpZGUodGhpcywgZnVuY3Rpb24oc3VwZXJfKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGFkZDogZnVuY3Rpb24oaWQsIGJsb2JPclByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc0ZpbGUoYmxvYk9yUHJveHkpIHx8IHFxLmlzQmxvYihibG9iT3JQcm94eSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1cGVyXy5hZGQoaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiBibG9iT3JQcm94eVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYmxvYk9yUHJveHkgaW5zdGFuY2VvZiBxcS5CbG9iUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1cGVyXy5hZGQoaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eTogYmxvYk9yUHJveHlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUGFzc2VkIG9iaiBpcyBub3QgYSBGaWxlLCBCbG9iLCBvciBwcm94eVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9pbml0VGVtcFN0YXRlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdW1lRW5hYmxlZCAmJiBoYW5kbGVyLl9tYXliZVByZXBhcmVGb3JSZXN1bWUoaWQpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXhwdW5nZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYWJvcnQoaWQpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9tYXliZURlbGV0ZVBlcnNpc3RlZENodW5rRGF0YShpZCk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2NsZWFyWGhycyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIHN1cGVyXy5leHB1bmdlKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGNsZWFyQ2FjaGVkQ2h1bms6IGZ1bmN0aW9uKGlkLCBjaHVua0lkeCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlU3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGZpbGVTdGF0ZS50ZW1wLmNhY2hlZENodW5rc1tjaHVua0lkeF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsZWFyWGhyOiBmdW5jdGlvbihpZCwgY2h1bmtJZHgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcFN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wO1xuICAgICAgICAgICAgICAgIGlmICh0ZW1wU3RhdGUueGhycykge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGVtcFN0YXRlLnhocnNbY2h1bmtJZHhdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGVtcFN0YXRlLmFqYXhSZXF1ZXN0ZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0ZW1wU3RhdGUuYWpheFJlcXVlc3RlcnNbY2h1bmtJZHhdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaW5hbGl6ZUNodW5rczogZnVuY3Rpb24oaWQsIHJlc3BvbnNlUGFyc2VyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhc3RDaHVua0lkeCA9IGhhbmRsZXIuX2dldFRvdGFsQ2h1bmtzKGlkKSAtIDEsIHhociA9IGhhbmRsZXIuX2dldFhocihpZCwgbGFzdENodW5rSWR4KTtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VQYXJzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5Qcm9taXNlKCkuc3VjY2VzcyhyZXNwb25zZVBhcnNlcih4aHIpLCB4aHIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLlByb21pc2UoKS5zdWNjZXNzKHt9LCB4aHIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZpbGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuaXNWYWxpZChpZCkgJiYgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5maWxlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFByb3h5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmlzVmFsaWQoaWQpICYmIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkucHJveHk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UmVzdW1hYmxlRmlsZXNEYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdW1hYmxlRmlsZXNEYXRhID0gW107XG4gICAgICAgICAgICAgICAgaGFuZGxlci5faXRlcmF0ZVJlc3VtZVJlY29yZHMoZnVuY3Rpb24oa2V5LCB1cGxvYWREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIubW92ZUluUHJvZ3Jlc3NUb1JlbWFpbmluZyhudWxsLCB1cGxvYWREYXRhLmNodW5raW5nLmluUHJvZ3Jlc3MsIHVwbG9hZERhdGEuY2h1bmtpbmcucmVtYWluaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB1cGxvYWREYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmc6IHVwbG9hZERhdGEuY2h1bmtpbmcucmVtYWluaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogdXBsb2FkRGF0YS5zaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogdXBsb2FkRGF0YS51dWlkXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWREYXRhLmtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5rZXkgPSB1cGxvYWREYXRhLmtleTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YS5jdXN0b21SZXN1bWVEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmN1c3RvbVJlc3VtZURhdGEgPSB1cGxvYWREYXRhLmN1c3RvbVJlc3VtZURhdGE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzdW1hYmxlRmlsZXNEYXRhLnB1c2goZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VtYWJsZUZpbGVzRGF0YTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0F0dGVtcHRpbmdSZXN1bWU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuYXR0ZW1wdGluZ1Jlc3VtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1Jlc3VtYWJsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISFjaHVua2luZyAmJiBoYW5kbGVyLmlzVmFsaWQoaWQpICYmICFoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLm5vdFJlc3VtYWJsZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtb3ZlSW5Qcm9ncmVzc1RvUmVtYWluaW5nOiBmdW5jdGlvbihpZCwgb3B0SW5Qcm9ncmVzcywgb3B0UmVtYWluaW5nKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVTdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkgfHwge30sIGNodW5raW5nU3RhdGUgPSBmaWxlU3RhdGUuY2h1bmtpbmcgfHwge30sIGluUHJvZ3Jlc3MgPSBvcHRJblByb2dyZXNzIHx8IGNodW5raW5nU3RhdGUuaW5Qcm9ncmVzcywgcmVtYWluaW5nID0gb3B0UmVtYWluaW5nIHx8IGNodW5raW5nU3RhdGUucmVtYWluaW5nO1xuICAgICAgICAgICAgICAgIGlmIChpblByb2dyZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJNb3ZpbmcgdGhlc2UgY2h1bmtzIGZyb20gaW4tcHJvZ3Jlc3Mge30sIHRvIHJlbWFpbmluZy5cIiwgSlNPTi5zdHJpbmdpZnkoaW5Qcm9ncmVzcykpKTtcbiAgICAgICAgICAgICAgICAgICAgaW5Qcm9ncmVzcy5yZXZlcnNlKCk7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goaW5Qcm9ncmVzcywgZnVuY3Rpb24oaWR4LCBjaHVua0lkeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nLnVuc2hpZnQoY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaW5Qcm9ncmVzcy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXVzZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5pc1ZhbGlkKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiQWJvcnRpbmcgWEhSIHVwbG9hZCBmb3Ige30gJ3t9JyBkdWUgdG8gcGF1c2UgaW5zdHJ1Y3Rpb24uXCIsIGlkLCBnZXROYW1lKGlkKSkpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnBhdXNlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGFib3J0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlZXZhbHVhdGVDaHVua2luZzogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2h1bmtpbmcgJiYgaGFuZGxlci5pc1ZhbGlkKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLCB0b3RhbENodW5rcywgaTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLmNodW5raW5nO1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jaHVua2luZyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB0b3RhbENodW5rcyA9IGhhbmRsZXIuX2dldFRvdGFsQ2h1bmtzKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsQ2h1bmtzID4gMSB8fCBjaHVua2luZy5tYW5kYXRvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmNodW5raW5nLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2h1bmtpbmcucGFydHMgPSB0b3RhbENodW5rcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmNodW5raW5nLnJlbWFpbmluZyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRvdGFsQ2h1bmtzOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jaHVua2luZy5yZW1haW5pbmcucHVzaChpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2luaXRUZW1wU3RhdGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2h1bmtpbmcuZW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZUJsb2I6IGZ1bmN0aW9uKGlkLCBuZXdCbG9iKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIuaXNWYWxpZChpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5maWxlID0gbmV3QmxvYjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NsZWFyWGhyczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcFN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wO1xuICAgICAgICAgICAgICAgIHFxLmVhY2godGVtcFN0YXRlLmFqYXhSZXF1ZXN0ZXJzLCBmdW5jdGlvbihjaHVua0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0ZW1wU3RhdGUuYWpheFJlcXVlc3RlcnNbY2h1bmtJZF07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcXEuZWFjaCh0ZW1wU3RhdGUueGhycywgZnVuY3Rpb24oY2h1bmtJZCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGVtcFN0YXRlLnhocnNbY2h1bmtJZF07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NyZWF0ZVhocjogZnVuY3Rpb24oaWQsIG9wdENodW5rSWR4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuX3JlZ2lzdGVyWGhyKGlkLCBvcHRDaHVua0lkeCwgcXEuY3JlYXRlWGhySW5zdGFuY2UoKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldEFqYXhSZXF1ZXN0ZXI6IGZ1bmN0aW9uKGlkLCBvcHRDaHVua0lkeCkge1xuICAgICAgICAgICAgICAgIHZhciBjaHVua0lkeCA9IG9wdENodW5rSWR4ID09IG51bGwgPyAtMSA6IG9wdENodW5rSWR4O1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAuYWpheFJlcXVlc3RlcnNbY2h1bmtJZHhdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRDaHVua0RhdGE6IGZ1bmN0aW9uKGlkLCBjaHVua0luZGV4KSB7XG4gICAgICAgICAgICAgICAgdmFyIGNodW5rU2l6ZSA9IGdldENodW5rU2l6ZShpZCksIGZpbGVTaXplID0gZ2V0U2l6ZShpZCksIGZpbGVPckJsb2IgPSBoYW5kbGVyLmdldEZpbGUoaWQpLCBzdGFydEJ5dGVzID0gY2h1bmtTaXplICogY2h1bmtJbmRleCwgZW5kQnl0ZXMgPSBzdGFydEJ5dGVzICsgY2h1bmtTaXplID49IGZpbGVTaXplID8gZmlsZVNpemUgOiBzdGFydEJ5dGVzICsgY2h1bmtTaXplLCB0b3RhbENodW5rcyA9IGhhbmRsZXIuX2dldFRvdGFsQ2h1bmtzKGlkKSwgY2FjaGVkQ2h1bmtzID0gdGhpcy5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wLmNhY2hlZENodW5rcywgYmxvYiA9IGNhY2hlZENodW5rc1tjaHVua0luZGV4XSB8fCBxcS5zbGljZUJsb2IoZmlsZU9yQmxvYiwgc3RhcnRCeXRlcywgZW5kQnl0ZXMpO1xuICAgICAgICAgICAgICAgIGNhY2hlZENodW5rc1tjaHVua0luZGV4XSA9IGJsb2I7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcGFydDogY2h1bmtJbmRleCxcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0Qnl0ZXMsXG4gICAgICAgICAgICAgICAgICAgIGVuZDogZW5kQnl0ZXMsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiB0b3RhbENodW5rcyxcbiAgICAgICAgICAgICAgICAgICAgYmxvYjogYmxvYixcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogZW5kQnl0ZXMgLSBzdGFydEJ5dGVzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0Q2h1bmtEYXRhRm9yQ2FsbGJhY2s6IGZ1bmN0aW9uKGNodW5rRGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleDogY2h1bmtEYXRhLnBhcnQsXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0Qnl0ZTogY2h1bmtEYXRhLnN0YXJ0ICsgMSxcbiAgICAgICAgICAgICAgICAgICAgZW5kQnl0ZTogY2h1bmtEYXRhLmVuZCxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxQYXJ0czogY2h1bmtEYXRhLmNvdW50XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0TG9jYWxTdG9yYWdlSWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdFZlcnNpb24gPSBcIjUuMFwiLCBuYW1lID0gZ2V0TmFtZShpZCksIHNpemUgPSBnZXRTaXplKGlkKSwgY2h1bmtTaXplID0gZ2V0Q2h1bmtTaXplKGlkKSwgZW5kcG9pbnQgPSBnZXRFbmRwb2ludChpZCksIGN1c3RvbUtleXMgPSByZXN1bWUuY3VzdG9tS2V5cyhpZCksIGxvY2FsU3RvcmFnZUlkID0gcXEuZm9ybWF0KFwicXF7fXJlc3VtZXt9LXt9LXt9LXt9LXt9XCIsIG5hbWVzcGFjZSwgZm9ybWF0VmVyc2lvbiwgbmFtZSwgc2l6ZSwgY2h1bmtTaXplLCBlbmRwb2ludCk7XG4gICAgICAgICAgICAgICAgY3VzdG9tS2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VJZCArPSBcIi1cIiArIGtleTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlSWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldE1pbWVUeXBlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmdldEZpbGUoaWQpLnR5cGU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldFBlcnNpc3RhYmxlRGF0YTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0VG90YWxDaHVua3M6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNodW5raW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlU2l6ZSA9IGdldFNpemUoaWQpLCBjaHVua1NpemUgPSBnZXRDaHVua1NpemUoaWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5jZWlsKGZpbGVTaXplIC8gY2h1bmtTaXplKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldFhocjogZnVuY3Rpb24oaWQsIG9wdENodW5rSWR4KSB7XG4gICAgICAgICAgICAgICAgdmFyIGNodW5rSWR4ID0gb3B0Q2h1bmtJZHggPT0gbnVsbCA/IC0xIDogb3B0Q2h1bmtJZHg7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcC54aHJzW2NodW5rSWR4XTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0WGhyczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wLnhocnM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2l0ZXJhdGVSZXN1bWVSZWNvcmRzOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bWVFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2gobG9jYWxTdG9yYWdlLCBmdW5jdGlvbihrZXksIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkuaW5kZXhPZihxcS5mb3JtYXQoXCJxcXt9cmVzdW1lXCIsIG5hbWVzcGFjZSkpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVwbG9hZERhdGEgPSBKU09OLnBhcnNlKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGtleSwgdXBsb2FkRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaW5pdFRlbXBTdGF0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFqYXhSZXF1ZXN0ZXJzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtQcm9ncmVzczoge30sXG4gICAgICAgICAgICAgICAgICAgIHhocnM6IHt9LFxuICAgICAgICAgICAgICAgICAgICBjYWNoZWRDaHVua3M6IHt9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWFya05vdFJlc3VtYWJsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLm5vdFJlc3VtYWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21heWJlRGVsZXRlUGVyc2lzdGVkQ2h1bmtEYXRhOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBsb2NhbFN0b3JhZ2VJZDtcbiAgICAgICAgICAgICAgICBpZiAocmVzdW1lRW5hYmxlZCAmJiBoYW5kbGVyLmlzUmVzdW1hYmxlKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VJZCA9IGhhbmRsZXIuX2dldExvY2FsU3RvcmFnZUlkKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZUlkICYmIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGxvY2FsU3RvcmFnZUlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0obG9jYWxTdG9yYWdlSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXliZVByZXBhcmVGb3JSZXN1bWU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKSwgbG9jYWxTdG9yYWdlSWQsIHBlcnNpc3RlZERhdGE7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VtZUVuYWJsZWQgJiYgc3RhdGUua2V5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlSWQgPSBoYW5kbGVyLl9nZXRMb2NhbFN0b3JhZ2VJZChpZCk7XG4gICAgICAgICAgICAgICAgICAgIHBlcnNpc3RlZERhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShsb2NhbFN0b3JhZ2VJZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwZXJzaXN0ZWREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0ZWREYXRhID0gSlNPTi5wYXJzZShwZXJzaXN0ZWREYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXREYXRhQnlVdWlkKHBlcnNpc3RlZERhdGEudXVpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9tYXJrTm90UmVzdW1hYmxlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIklkZW50aWZpZWQgZmlsZSB3aXRoIElEIHt9IGFuZCBuYW1lIG9mIHt9IGFzIHJlc3VtYWJsZS5cIiwgaWQsIGdldE5hbWUoaWQpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25VdWlkQ2hhbmdlZChpZCwgcGVyc2lzdGVkRGF0YS51dWlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5rZXkgPSBwZXJzaXN0ZWREYXRhLmtleTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jaHVua2luZyA9IHBlcnNpc3RlZERhdGEuY2h1bmtpbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUubG9hZGVkID0gcGVyc2lzdGVkRGF0YS5sb2FkZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuY3VzdG9tUmVzdW1lRGF0YSA9IHBlcnNpc3RlZERhdGEuY3VzdG9tUmVzdW1lRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5hdHRlbXB0aW5nUmVzdW1lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLm1vdmVJblByb2dyZXNzVG9SZW1haW5pbmcoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXliZVBlcnNpc3RDaHVua2VkU3RhdGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKSwgbG9jYWxTdG9yYWdlSWQsIHBlcnNpc3RlZERhdGE7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VtZUVuYWJsZWQgJiYgaGFuZGxlci5pc1Jlc3VtYWJsZShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1c3RvbVJlc3VtZURhdGEgPSBnZXRDdXN0b21SZXN1bWVEYXRhKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlSWQgPSBoYW5kbGVyLl9nZXRMb2NhbFN0b3JhZ2VJZChpZCk7XG4gICAgICAgICAgICAgICAgICAgIHBlcnNpc3RlZERhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBnZXROYW1lKGlkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IGdldFNpemUoaWQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogZ2V0VXVpZChpZCksXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IHN0YXRlLmtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5raW5nOiBzdGF0ZS5jaHVua2luZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogc3RhdGUubG9hZGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFVwZGF0ZWQ6IERhdGUubm93KClcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1c3RvbVJlc3VtZURhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcnNpc3RlZERhdGEuY3VzdG9tUmVzdW1lRGF0YSA9IGN1c3RvbVJlc3VtZURhdGE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGxvY2FsU3RvcmFnZUlkLCBKU09OLnN0cmluZ2lmeShwZXJzaXN0ZWREYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiVW5hYmxlIHRvIHNhdmUgcmVzdW1lIGRhdGEgZm9yICd7fScgZHVlIHRvIGVycm9yOiAne30nLlwiLCBpZCwgZXJyb3IudG9TdHJpbmcoKSksIFwid2FyblwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcmVnaXN0ZXJQcm9ncmVzc0hhbmRsZXI6IGZ1bmN0aW9uKGlkLCBjaHVua0lkeCwgY2h1bmtTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIHhociA9IGhhbmRsZXIuX2dldFhocihpZCwgY2h1bmtJZHgpLCBuYW1lID0gZ2V0TmFtZShpZCksIHByb2dyZXNzQ2FsY3VsYXRvciA9IHtcbiAgICAgICAgICAgICAgICAgICAgc2ltcGxlOiBmdW5jdGlvbihsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZVNpemUgPSBnZXRTaXplKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkZWQgPT09IHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Qcm9ncmVzcyhpZCwgbmFtZSwgZmlsZVNpemUsIGZpbGVTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Qcm9ncmVzcyhpZCwgbmFtZSwgbG9hZGVkID49IGZpbGVTaXplID8gZmlsZVNpemUgLSAxIDogbG9hZGVkLCBmaWxlU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNodW5rZWQ6IGZ1bmN0aW9uKGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaHVua1Byb2dyZXNzID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wLmNodW5rUHJvZ3Jlc3MsIHRvdGFsU3VjY2Vzc2Z1bGx5TG9hZGVkRm9yRmlsZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkubG9hZGVkLCBsb2FkZWRGb3JSZXF1ZXN0ID0gbG9hZGVkLCB0b3RhbEZvclJlcXVlc3QgPSB0b3RhbCwgdG90YWxGaWxlU2l6ZSA9IGdldFNpemUoaWQpLCBlc3RBY3R1YWxDaHVua0xvYWRlZCA9IGxvYWRlZEZvclJlcXVlc3QgLSAodG90YWxGb3JSZXF1ZXN0IC0gY2h1bmtTaXplKSwgdG90YWxMb2FkZWRGb3JGaWxlID0gdG90YWxTdWNjZXNzZnVsbHlMb2FkZWRGb3JGaWxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtQcm9ncmVzc1tjaHVua0lkeF0gPSBlc3RBY3R1YWxDaHVua0xvYWRlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxLmVhY2goY2h1bmtQcm9ncmVzcywgZnVuY3Rpb24oY2h1bmtJZHgsIGNodW5rTG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxMb2FkZWRGb3JGaWxlICs9IGNodW5rTG9hZGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvblByb2dyZXNzKGlkLCBuYW1lLCB0b3RhbExvYWRlZEZvckZpbGUsIHRvdGFsRmlsZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmxlbmd0aENvbXB1dGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gY2h1bmtTaXplID09IG51bGwgPyBcInNpbXBsZVwiIDogXCJjaHVua2VkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0NhbGN1bGF0b3JbdHlwZV0oZS5sb2FkZWQsIGUudG90YWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcmVnaXN0ZXJYaHI6IGZ1bmN0aW9uKGlkLCBvcHRDaHVua0lkeCwgeGhyLCBvcHRBamF4UmVxdWVzdGVyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHhocnNJZCA9IG9wdENodW5rSWR4ID09IG51bGwgPyAtMSA6IG9wdENodW5rSWR4LCB0ZW1wU3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXA7XG4gICAgICAgICAgICAgICAgdGVtcFN0YXRlLnhocnMgPSB0ZW1wU3RhdGUueGhycyB8fCB7fTtcbiAgICAgICAgICAgICAgICB0ZW1wU3RhdGUuYWpheFJlcXVlc3RlcnMgPSB0ZW1wU3RhdGUuYWpheFJlcXVlc3RlcnMgfHwge307XG4gICAgICAgICAgICAgICAgdGVtcFN0YXRlLnhocnNbeGhyc0lkXSA9IHhocjtcbiAgICAgICAgICAgICAgICBpZiAob3B0QWpheFJlcXVlc3Rlcikge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wU3RhdGUuYWpheFJlcXVlc3RlcnNbeGhyc0lkXSA9IG9wdEFqYXhSZXF1ZXN0ZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB4aHI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3JlbW92ZUV4cGlyZWRDaHVua2luZ1JlY29yZHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBleHBpcmF0aW9uRGF5cyA9IHJlc3VtZS5yZWNvcmRzRXhwaXJlSW47XG4gICAgICAgICAgICAgICAgaGFuZGxlci5faXRlcmF0ZVJlc3VtZVJlY29yZHMoZnVuY3Rpb24oa2V5LCB1cGxvYWREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBleHBpcmF0aW9uRGF0ZSA9IG5ldyBEYXRlKHVwbG9hZERhdGEubGFzdFVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZS5zZXREYXRlKGV4cGlyYXRpb25EYXRlLmdldERhdGUoKSArIGV4cGlyYXRpb25EYXlzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4cGlyYXRpb25EYXRlLmdldFRpbWUoKSA8PSBEYXRlLm5vdygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJSZW1vdmluZyBleHBpcmVkIHJlc3VtZSByZWNvcmQgd2l0aCBrZXkgXCIgKyBrZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zaG91bGRDaHVua1RoaXNGaWxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghc3RhdGUuY2h1bmtpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIucmVldmFsdWF0ZUNodW5raW5nKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUuY2h1bmtpbmcuZW5hYmxlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuRGVsZXRlRmlsZUFqYXhSZXF1ZXN0ZXIgPSBmdW5jdGlvbihvKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgcmVxdWVzdGVyLCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgICAgICAgdXVpZFBhcmFtTmFtZTogXCJxcXV1aWRcIixcbiAgICAgICAgICAgIGVuZHBvaW50U3RvcmU6IHt9LFxuICAgICAgICAgICAgbWF4Q29ubmVjdGlvbnM6IDMsXG4gICAgICAgICAgICBjdXN0b21IZWFkZXJzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXJhbXNTdG9yZToge30sXG4gICAgICAgICAgICBjb3JzOiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNlbmRDcmVkZW50aWFsczogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKHN0ciwgbGV2ZWwpIHt9LFxuICAgICAgICAgICAgb25EZWxldGU6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgIG9uRGVsZXRlQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCB4aHJPclhkciwgaXNFcnJvcikge31cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIG8pO1xuICAgICAgICBmdW5jdGlvbiBnZXRNYW5kYXRlZFBhcmFtcygpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLm1ldGhvZC50b1VwcGVyQ2FzZSgpID09PSBcIlBPU1RcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIF9tZXRob2Q6IFwiREVMRVRFXCJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgICAgIHJlcXVlc3RlciA9IHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuQWpheFJlcXVlc3Rlcih7XG4gICAgICAgICAgICBhY2NlcHRIZWFkZXI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgdmFsaWRNZXRob2RzOiBbIFwiUE9TVFwiLCBcIkRFTEVURVwiIF0sXG4gICAgICAgICAgICBtZXRob2Q6IG9wdGlvbnMubWV0aG9kLFxuICAgICAgICAgICAgZW5kcG9pbnRTdG9yZTogb3B0aW9ucy5lbmRwb2ludFN0b3JlLFxuICAgICAgICAgICAgcGFyYW1zU3RvcmU6IG9wdGlvbnMucGFyYW1zU3RvcmUsXG4gICAgICAgICAgICBtYW5kYXRlZFBhcmFtczogZ2V0TWFuZGF0ZWRQYXJhbXMoKSxcbiAgICAgICAgICAgIG1heENvbm5lY3Rpb25zOiBvcHRpb25zLm1heENvbm5lY3Rpb25zLFxuICAgICAgICAgICAgY3VzdG9tSGVhZGVyczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5jdXN0b21IZWFkZXJzLmdldChpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9nOiBvcHRpb25zLmxvZyxcbiAgICAgICAgICAgIG9uU2VuZDogb3B0aW9ucy5vbkRlbGV0ZSxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IG9wdGlvbnMub25EZWxldGVDb21wbGV0ZSxcbiAgICAgICAgICAgIGNvcnM6IG9wdGlvbnMuY29yc1xuICAgICAgICB9KSk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBzZW5kRGVsZXRlOiBmdW5jdGlvbihpZCwgdXVpZCwgYWRkaXRpb25hbE1hbmRhdGVkUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFkZGl0aW9uYWxPcHRpb25zID0gYWRkaXRpb25hbE1hbmRhdGVkUGFyYW1zIHx8IHt9O1xuICAgICAgICAgICAgICAgIG9wdGlvbnMubG9nKFwiU3VibWl0dGluZyBkZWxldGUgZmlsZSByZXF1ZXN0IGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tZXRob2QgPT09IFwiREVMRVRFXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGVyLmluaXRUcmFuc3BvcnQoaWQpLndpdGhQYXRoKHV1aWQpLndpdGhQYXJhbXMoYWRkaXRpb25hbE9wdGlvbnMpLnNlbmQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsT3B0aW9uc1tvcHRpb25zLnV1aWRQYXJhbU5hbWVdID0gdXVpZDtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGVyLmluaXRUcmFuc3BvcnQoaWQpLndpdGhQYXJhbXMoYWRkaXRpb25hbE9wdGlvbnMpLnNlbmQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICBmdW5jdGlvbiBkZXRlY3RTdWJzYW1wbGluZyhpbWcpIHtcbiAgICAgICAgICAgIHZhciBpdyA9IGltZy5uYXR1cmFsV2lkdGgsIGloID0gaW1nLm5hdHVyYWxIZWlnaHQsIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIiksIGN0eDtcbiAgICAgICAgICAgIGlmIChpdyAqIGloID4gMTAyNCAqIDEwMjQpIHtcbiAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBjYW52YXMuaGVpZ2h0ID0gMTtcbiAgICAgICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAtaXcgKyAxLCAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxLCAxKS5kYXRhWzNdID09PSAwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZGV0ZWN0VmVydGljYWxTcXVhc2goaW1nLCBpdywgaWgpIHtcbiAgICAgICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLCBzeSA9IDAsIGV5ID0gaWgsIHB5ID0gaWgsIGN0eCwgZGF0YSwgYWxwaGEsIHJhdGlvO1xuICAgICAgICAgICAgY2FudmFzLndpZHRoID0gMTtcbiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBpaDtcbiAgICAgICAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCk7XG4gICAgICAgICAgICBkYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxLCBpaCkuZGF0YTtcbiAgICAgICAgICAgIHdoaWxlIChweSA+IHN5KSB7XG4gICAgICAgICAgICAgICAgYWxwaGEgPSBkYXRhWyhweSAtIDEpICogNCArIDNdO1xuICAgICAgICAgICAgICAgIGlmIChhbHBoYSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBleSA9IHB5O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHN5ID0gcHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHB5ID0gZXkgKyBzeSA+PiAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmF0aW8gPSBweSAvIGloO1xuICAgICAgICAgICAgcmV0dXJuIHJhdGlvID09PSAwID8gMSA6IHJhdGlvO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlbmRlckltYWdlVG9EYXRhVVJMKGltZywgYmxvYiwgb3B0aW9ucywgZG9TcXVhc2gpIHtcbiAgICAgICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLCBtaW1lID0gb3B0aW9ucy5taW1lIHx8IFwiaW1hZ2UvanBlZ1wiLCBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIHJlbmRlckltYWdlVG9DYW52YXMoaW1nLCBibG9iLCBjYW52YXMsIG9wdGlvbnMsIGRvU3F1YXNoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhjYW52YXMudG9EYXRhVVJMKG1pbWUsIG9wdGlvbnMucXVhbGl0eSB8fCAuOCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBtYXliZUNhbGN1bGF0ZURvd25zYW1wbGVkRGltZW5zaW9ucyhzcGVjKSB7XG4gICAgICAgICAgICB2YXIgbWF4UGl4ZWxzID0gNTI0MWUzO1xuICAgICAgICAgICAgaWYgKCFxcS5pb3MoKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBxcS5FcnJvcihcIkRvd25zYW1wbGVkIGRpbWVuc2lvbnMgY2FuIG9ubHkgYmUgcmVsaWFibHkgY2FsY3VsYXRlZCBmb3IgaU9TIVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzcGVjLm9yaWdIZWlnaHQgKiBzcGVjLm9yaWdXaWR0aCA+IG1heFBpeGVscykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0hlaWdodDogTWF0aC5yb3VuZChNYXRoLnNxcnQobWF4UGl4ZWxzICogKHNwZWMub3JpZ0hlaWdodCAvIHNwZWMub3JpZ1dpZHRoKSkpLFxuICAgICAgICAgICAgICAgICAgICBuZXdXaWR0aDogTWF0aC5yb3VuZChNYXRoLnNxcnQobWF4UGl4ZWxzICogKHNwZWMub3JpZ1dpZHRoIC8gc3BlYy5vcmlnSGVpZ2h0KSkpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZW5kZXJJbWFnZVRvQ2FudmFzKGltZywgYmxvYiwgY2FudmFzLCBvcHRpb25zLCBkb1NxdWFzaCkge1xuICAgICAgICAgICAgdmFyIGl3ID0gaW1nLm5hdHVyYWxXaWR0aCwgaWggPSBpbWcubmF0dXJhbEhlaWdodCwgd2lkdGggPSBvcHRpb25zLndpZHRoLCBoZWlnaHQgPSBvcHRpb25zLmhlaWdodCwgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSwgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCksIG1vZGlmaWVkRGltZW5zaW9ucztcbiAgICAgICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5yZXNpemUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVySW1hZ2VUb0NhbnZhc1dpdGhDdXN0b21SZXNpemVyKHtcbiAgICAgICAgICAgICAgICAgICAgYmxvYjogYmxvYixcbiAgICAgICAgICAgICAgICAgICAgY2FudmFzOiBjYW52YXMsXG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiBpbWcsXG4gICAgICAgICAgICAgICAgICAgIGltYWdlSGVpZ2h0OiBpaCxcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VXaWR0aDogaXcsXG4gICAgICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uOiBvcHRpb25zLm9yaWVudGF0aW9uLFxuICAgICAgICAgICAgICAgICAgICByZXNpemU6IG9wdGlvbnMucmVzaXplLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRIZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0V2lkdGg6IHdpZHRoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXFxLnN1cHBvcnRlZEZlYXR1cmVzLnVubGltaXRlZFNjYWxlZEltYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIG1vZGlmaWVkRGltZW5zaW9ucyA9IG1heWJlQ2FsY3VsYXRlRG93bnNhbXBsZWREaW1lbnNpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgb3JpZ1dpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgb3JpZ0hlaWdodDogaGVpZ2h0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKG1vZGlmaWVkRGltZW5zaW9ucykge1xuICAgICAgICAgICAgICAgICAgICBxcS5sb2cocXEuZm9ybWF0KFwiSGFkIHRvIHJlZHVjZSBkaW1lbnNpb25zIGR1ZSB0byBkZXZpY2UgbGltaXRhdGlvbnMgZnJvbSB7fXcgLyB7fWggdG8ge313IC8ge31oXCIsIHdpZHRoLCBoZWlnaHQsIG1vZGlmaWVkRGltZW5zaW9ucy5uZXdXaWR0aCwgbW9kaWZpZWREaW1lbnNpb25zLm5ld0hlaWdodCksIFwid2FyblwiKTtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBtb2RpZmllZERpbWVuc2lvbnMubmV3V2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IG1vZGlmaWVkRGltZW5zaW9ucy5uZXdIZWlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJhbnNmb3JtQ29vcmRpbmF0ZShjYW52YXMsIHdpZHRoLCBoZWlnaHQsIG9wdGlvbnMub3JpZW50YXRpb24pO1xuICAgICAgICAgICAgaWYgKHFxLmlvcygpKSB7XG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGV0ZWN0U3Vic2FtcGxpbmcoaW1nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXcgLz0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGloIC89IDI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSAxMDI0LCB0bXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLCB2ZXJ0U3F1YXNoUmF0aW8gPSBkb1NxdWFzaCA/IGRldGVjdFZlcnRpY2FsU3F1YXNoKGltZywgaXcsIGloKSA6IDEsIGR3ID0gTWF0aC5jZWlsKGQgKiB3aWR0aCAvIGl3KSwgZGggPSBNYXRoLmNlaWwoZCAqIGhlaWdodCAvIGloIC8gdmVydFNxdWFzaFJhdGlvKSwgc3kgPSAwLCBkeSA9IDAsIHRtcEN0eCwgc3gsIGR4O1xuICAgICAgICAgICAgICAgICAgICB0bXBDYW52YXMud2lkdGggPSB0bXBDYW52YXMuaGVpZ2h0ID0gZDtcbiAgICAgICAgICAgICAgICAgICAgdG1wQ3R4ID0gdG1wQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHN5IDwgaWgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChzeCA8IGl3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wQ3R4LmNsZWFyUmVjdCgwLCAwLCBkLCBkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBDdHguZHJhd0ltYWdlKGltZywgLXN4LCAtc3kpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodG1wQ2FudmFzLCAwLCAwLCBkLCBkLCBkeCwgZHksIGR3LCBkaCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ggKz0gZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeCArPSBkdztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHN5ICs9IGQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBkeSArPSBkaDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgICAgICAgICAgICAgICB0bXBDYW52YXMgPSB0bXBDdHggPSBudWxsO1xuICAgICAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbnZhcy5xcUltYWdlUmVuZGVyZWQgJiYgY2FudmFzLnFxSW1hZ2VSZW5kZXJlZCgpO1xuICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKCk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZW5kZXJJbWFnZVRvQ2FudmFzV2l0aEN1c3RvbVJlc2l6ZXIocmVzaXplSW5mbykge1xuICAgICAgICAgICAgdmFyIGJsb2IgPSByZXNpemVJbmZvLmJsb2IsIGltYWdlID0gcmVzaXplSW5mby5pbWFnZSwgaW1hZ2VIZWlnaHQgPSByZXNpemVJbmZvLmltYWdlSGVpZ2h0LCBpbWFnZVdpZHRoID0gcmVzaXplSW5mby5pbWFnZVdpZHRoLCBvcmllbnRhdGlvbiA9IHJlc2l6ZUluZm8ub3JpZW50YXRpb24sIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpLCByZXNpemUgPSByZXNpemVJbmZvLnJlc2l6ZSwgc291cmNlQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKSwgc291cmNlQ2FudmFzQ29udGV4dCA9IHNvdXJjZUNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIiksIHRhcmdldENhbnZhcyA9IHJlc2l6ZUluZm8uY2FudmFzLCB0YXJnZXRIZWlnaHQgPSByZXNpemVJbmZvLnRhcmdldEhlaWdodCwgdGFyZ2V0V2lkdGggPSByZXNpemVJbmZvLnRhcmdldFdpZHRoO1xuICAgICAgICAgICAgdHJhbnNmb3JtQ29vcmRpbmF0ZShzb3VyY2VDYW52YXMsIGltYWdlV2lkdGgsIGltYWdlSGVpZ2h0LCBvcmllbnRhdGlvbik7XG4gICAgICAgICAgICB0YXJnZXRDYW52YXMuaGVpZ2h0ID0gdGFyZ2V0SGVpZ2h0O1xuICAgICAgICAgICAgdGFyZ2V0Q2FudmFzLndpZHRoID0gdGFyZ2V0V2lkdGg7XG4gICAgICAgICAgICBzb3VyY2VDYW52YXNDb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7XG4gICAgICAgICAgICByZXNpemUoe1xuICAgICAgICAgICAgICAgIGJsb2I6IGJsb2IsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiB0YXJnZXRIZWlnaHQsXG4gICAgICAgICAgICAgICAgaW1hZ2U6IGltYWdlLFxuICAgICAgICAgICAgICAgIHNvdXJjZUNhbnZhczogc291cmNlQ2FudmFzLFxuICAgICAgICAgICAgICAgIHRhcmdldENhbnZhczogdGFyZ2V0Q2FudmFzLFxuICAgICAgICAgICAgICAgIHdpZHRoOiB0YXJnZXRXaWR0aFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgIHRhcmdldENhbnZhcy5xcUltYWdlUmVuZGVyZWQgJiYgdGFyZ2V0Q2FudmFzLnFxSW1hZ2VSZW5kZXJlZCgpO1xuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcygpO1xuICAgICAgICAgICAgfSwgcHJvbWlzZS5mYWlsdXJlKTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybUNvb3JkaW5hdGUoY2FudmFzLCB3aWR0aCwgaGVpZ2h0LCBvcmllbnRhdGlvbikge1xuICAgICAgICAgICAgc3dpdGNoIChvcmllbnRhdGlvbikge1xuICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gaGVpZ2h0O1xuICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSB3aWR0aDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICAgIHN3aXRjaCAob3JpZW50YXRpb24pIHtcbiAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUod2lkdGgsIDApO1xuICAgICAgICAgICAgICAgIGN0eC5zY2FsZSgtMSwgMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUod2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSgwLCBoZWlnaHQpO1xuICAgICAgICAgICAgICAgIGN0eC5zY2FsZSgxLCAtMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoLjUgKiBNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICBjdHguc2NhbGUoMSwgLTEpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICBjdHgucm90YXRlKC41ICogTWF0aC5QSSk7XG4gICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSgwLCAtaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgY3R4LnJvdGF0ZSguNSAqIE1hdGguUEkpO1xuICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUod2lkdGgsIC1oZWlnaHQpO1xuICAgICAgICAgICAgICAgIGN0eC5zY2FsZSgtMSwgMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoLS41ICogTWF0aC5QSSk7XG4gICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSgtd2lkdGgsIDApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gTWVnYVBpeEltYWdlKHNyY0ltYWdlLCBlcnJvckNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICBpZiAod2luZG93LkJsb2IgJiYgc3JjSW1hZ2UgaW5zdGFuY2VvZiBCbG9iKSB7XG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCksIFVSTCA9IHdpbmRvdy5VUkwgJiYgd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwgPyB3aW5kb3cuVVJMIDogd2luZG93LndlYmtpdFVSTCAmJiB3aW5kb3cud2Via2l0VVJMLmNyZWF0ZU9iamVjdFVSTCA/IHdpbmRvdy53ZWJraXRVUkwgOiBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIVVSTCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJObyBjcmVhdGVPYmplY3RVUkwgZnVuY3Rpb24gZm91bmQgdG8gY3JlYXRlIGJsb2IgdXJsXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGltZy5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHNyY0ltYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5ibG9iID0gc3JjSW1hZ2U7XG4gICAgICAgICAgICAgICAgICAgIHNyY0ltYWdlID0gaW1nO1xuICAgICAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXNyY0ltYWdlLm5hdHVyYWxXaWR0aCAmJiAhc3JjSW1hZ2UubmF0dXJhbEhlaWdodCkge1xuICAgICAgICAgICAgICAgIHNyY0ltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdGVuZXJzID0gc2VsZi5pbWFnZUxvYWRMaXN0ZW5lcnM7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaW1hZ2VMb2FkTGlzdGVuZXJzID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxpc3RlbmVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnNbaV0oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgc3JjSW1hZ2Uub25lcnJvciA9IGVycm9yQ2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgdGhpcy5pbWFnZUxvYWRMaXN0ZW5lcnMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc3JjSW1hZ2UgPSBzcmNJbWFnZTtcbiAgICAgICAgfVxuICAgICAgICBNZWdhUGl4SW1hZ2UucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKHRhcmdldCwgb3B0aW9ucykge1xuICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGltZ1dpZHRoID0gdGhpcy5zcmNJbWFnZS5uYXR1cmFsV2lkdGgsIGltZ0hlaWdodCA9IHRoaXMuc3JjSW1hZ2UubmF0dXJhbEhlaWdodCwgd2lkdGggPSBvcHRpb25zLndpZHRoLCBoZWlnaHQgPSBvcHRpb25zLmhlaWdodCwgbWF4V2lkdGggPSBvcHRpb25zLm1heFdpZHRoLCBtYXhIZWlnaHQgPSBvcHRpb25zLm1heEhlaWdodCwgZG9TcXVhc2ggPSAhdGhpcy5ibG9iIHx8IHRoaXMuYmxvYi50eXBlID09PSBcImltYWdlL2pwZWdcIiwgdGFnTmFtZSA9IHRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCksIG9wdDtcbiAgICAgICAgICAgIGlmICh0aGlzLmltYWdlTG9hZExpc3RlbmVycykge1xuICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VMb2FkTGlzdGVuZXJzLnB1c2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKHRhcmdldCwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHdpZHRoICYmICFoZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBpbWdIZWlnaHQgKiB3aWR0aCAvIGltZ1dpZHRoIDw8IDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhlaWdodCAmJiAhd2lkdGgpIHtcbiAgICAgICAgICAgICAgICB3aWR0aCA9IGltZ1dpZHRoICogaGVpZ2h0IC8gaW1nSGVpZ2h0IDw8IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHdpZHRoID0gaW1nV2lkdGg7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gaW1nSGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1heFdpZHRoICYmIHdpZHRoID4gbWF4V2lkdGgpIHtcbiAgICAgICAgICAgICAgICB3aWR0aCA9IG1heFdpZHRoO1xuICAgICAgICAgICAgICAgIGhlaWdodCA9IGltZ0hlaWdodCAqIHdpZHRoIC8gaW1nV2lkdGggPDwgMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtYXhIZWlnaHQgJiYgaGVpZ2h0ID4gbWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gbWF4SGVpZ2h0O1xuICAgICAgICAgICAgICAgIHdpZHRoID0gaW1nV2lkdGggKiBoZWlnaHQgLyBpbWdIZWlnaHQgPDwgMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdCA9IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHRcbiAgICAgICAgICAgIH0sIHFxLmVhY2gob3B0aW9ucywgZnVuY3Rpb24ob3B0aW9uc0tleSwgb3B0aW9uc1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgb3B0W29wdGlvbnNLZXldID0gb3B0aW9uc1ZhbHVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAodGFnTmFtZSA9PT0gXCJpbWdcIikge1xuICAgICAgICAgICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9sZFRhcmdldFNyYyA9IHRhcmdldC5zcmM7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlckltYWdlVG9EYXRhVVJMKHNlbGYuc3JjSW1hZ2UsIHNlbGYuYmxvYiwgb3B0LCBkb1NxdWFzaCkudGhlbihmdW5jdGlvbihkYXRhVXJpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuc3JjID0gZGF0YVVyaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZFRhcmdldFNyYyA9PT0gdGFyZ2V0LnNyYyAmJiB0YXJnZXQub25sb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhZ05hbWUgPT09IFwiY2FudmFzXCIpIHtcbiAgICAgICAgICAgICAgICByZW5kZXJJbWFnZVRvQ2FudmFzKHRoaXMuc3JjSW1hZ2UsIHRoaXMuYmxvYiwgdGFyZ2V0LCBvcHQsIGRvU3F1YXNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5vbnJlbmRlciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbnJlbmRlcih0YXJnZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5NZWdhUGl4SW1hZ2UgPSBNZWdhUGl4SW1hZ2U7XG4gICAgfSkoKTtcbiAgICBxcS5JbWFnZUdlbmVyYXRvciA9IGZ1bmN0aW9uKGxvZykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgZnVuY3Rpb24gaXNJbWcoZWwpIHtcbiAgICAgICAgICAgIHJldHVybiBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiaW1nXCI7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNDYW52YXMoZWwpIHtcbiAgICAgICAgICAgIHJldHVybiBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiY2FudmFzXCI7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNJbWdDb3JzU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBJbWFnZSgpLmNyb3NzT3JpZ2luICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNDYW52YXNTdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgICAgICAgIHJldHVybiBjYW52YXMuZ2V0Q29udGV4dCAmJiBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGRldGVybWluZU1pbWVPZkZpbGVOYW1lKG5hbWVXaXRoUGF0aCkge1xuICAgICAgICAgICAgdmFyIHBhdGhTZWdtZW50cyA9IG5hbWVXaXRoUGF0aC5zcGxpdChcIi9cIiksIG5hbWUgPSBwYXRoU2VnbWVudHNbcGF0aFNlZ21lbnRzLmxlbmd0aCAtIDFdLnNwbGl0KFwiP1wiKVswXSwgZXh0ZW5zaW9uID0gcXEuZ2V0RXh0ZW5zaW9uKG5hbWUpO1xuICAgICAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9uICYmIGV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgc3dpdGNoIChleHRlbnNpb24pIHtcbiAgICAgICAgICAgICAgY2FzZSBcImpwZWdcIjpcbiAgICAgICAgICAgICAgY2FzZSBcImpwZ1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImltYWdlL2pwZWdcIjtcblxuICAgICAgICAgICAgICBjYXNlIFwicG5nXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaW1hZ2UvcG5nXCI7XG5cbiAgICAgICAgICAgICAgY2FzZSBcImJtcFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImltYWdlL2JtcFwiO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJnaWZcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpbWFnZS9naWZcIjtcblxuICAgICAgICAgICAgICBjYXNlIFwidGlmZlwiOlxuICAgICAgICAgICAgICBjYXNlIFwidGlmXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaW1hZ2UvdGlmZlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzQ3Jvc3NPcmlnaW4odXJsKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0QW5jaG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIiksIHRhcmdldFByb3RvY29sLCB0YXJnZXRIb3N0bmFtZSwgdGFyZ2V0UG9ydDtcbiAgICAgICAgICAgIHRhcmdldEFuY2hvci5ocmVmID0gdXJsO1xuICAgICAgICAgICAgdGFyZ2V0UHJvdG9jb2wgPSB0YXJnZXRBbmNob3IucHJvdG9jb2w7XG4gICAgICAgICAgICB0YXJnZXRQb3J0ID0gdGFyZ2V0QW5jaG9yLnBvcnQ7XG4gICAgICAgICAgICB0YXJnZXRIb3N0bmFtZSA9IHRhcmdldEFuY2hvci5ob3N0bmFtZTtcbiAgICAgICAgICAgIGlmICh0YXJnZXRQcm90b2NvbC50b0xvd2VyQ2FzZSgpICE9PSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhcmdldEhvc3RuYW1lLnRvTG93ZXJDYXNlKCkgIT09IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGFyZ2V0UG9ydCAhPT0gd2luZG93LmxvY2F0aW9uLnBvcnQgJiYgIXFxLmllKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlckltZ0xvYWRMaXN0ZW5lcnMoaW1nLCBwcm9taXNlKSB7XG4gICAgICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaW1nLm9ubG9hZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhpbWcpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGltZy5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaW1nLm9ubG9hZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgIGxvZyhcIlByb2JsZW0gZHJhd2luZyB0aHVtYm5haWwhXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsdXJlKGltZywgXCJQcm9ibGVtIGRyYXdpbmcgdGh1bWJuYWlsIVwiKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJDYW52YXNEcmF3SW1hZ2VMaXN0ZW5lcihjYW52YXMsIHByb21pc2UpIHtcbiAgICAgICAgICAgIGNhbnZhcy5xcUltYWdlUmVuZGVyZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MoY2FudmFzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJUaHVtYm5haWxSZW5kZXJlZExpc3RlbmVyKGltZ09yQ2FudmFzLCBwcm9taXNlKSB7XG4gICAgICAgICAgICB2YXIgcmVnaXN0ZXJlZCA9IGlzSW1nKGltZ09yQ2FudmFzKSB8fCBpc0NhbnZhcyhpbWdPckNhbnZhcyk7XG4gICAgICAgICAgICBpZiAoaXNJbWcoaW1nT3JDYW52YXMpKSB7XG4gICAgICAgICAgICAgICAgcmVnaXN0ZXJJbWdMb2FkTGlzdGVuZXJzKGltZ09yQ2FudmFzLCBwcm9taXNlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDYW52YXMoaW1nT3JDYW52YXMpKSB7XG4gICAgICAgICAgICAgICAgcmVnaXN0ZXJDYW52YXNEcmF3SW1hZ2VMaXN0ZW5lcihpbWdPckNhbnZhcywgcHJvbWlzZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbHVyZShpbWdPckNhbnZhcyk7XG4gICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkVsZW1lbnQgY29udGFpbmVyIG9mIHR5cGUge30gaXMgbm90IHN1cHBvcnRlZCFcIiwgaW1nT3JDYW52YXMudGFnTmFtZSksIFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVnaXN0ZXJlZDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBkcmF3KGZpbGVPckJsb2IsIGNvbnRhaW5lciwgb3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIGRyYXdQcmV2aWV3ID0gbmV3IHFxLlByb21pc2UoKSwgaWRlbnRpZmllciA9IG5ldyBxcS5JZGVudGlmeShmaWxlT3JCbG9iLCBsb2cpLCBtYXhTaXplID0gb3B0aW9ucy5tYXhTaXplLCBvcmllbnQgPSBvcHRpb25zLm9yaWVudCA9PSBudWxsID8gdHJ1ZSA6IG9wdGlvbnMub3JpZW50LCBtZWdhcGl4RXJyb3JIYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLm9uZXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5vbmxvYWQgPSBudWxsO1xuICAgICAgICAgICAgICAgIGxvZyhcIkNvdWxkIG5vdCByZW5kZXIgcHJldmlldywgZmlsZSBtYXkgYmUgdG9vIGxhcmdlIVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIGRyYXdQcmV2aWV3LmZhaWx1cmUoY29udGFpbmVyLCBcIkJyb3dzZXIgY2Fubm90IHJlbmRlciBpbWFnZSFcIik7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWRlbnRpZmllci5pc1ByZXZpZXdhYmxlKCkudGhlbihmdW5jdGlvbihtaW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGR1bW15RXhpZiA9IHtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5Qcm9taXNlKCkuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgZXhpZiA9IG9yaWVudCA/IG5ldyBxcS5FeGlmKGZpbGVPckJsb2IsIGxvZykgOiBkdW1teUV4aWYsIG1wSW1nID0gbmV3IHFxLk1lZ2FQaXhJbWFnZShmaWxlT3JCbG9iLCBtZWdhcGl4RXJyb3JIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBpZiAocmVnaXN0ZXJUaHVtYm5haWxSZW5kZXJlZExpc3RlbmVyKGNvbnRhaW5lciwgZHJhd1ByZXZpZXcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4aWYucGFyc2UoKS50aGVuKGZ1bmN0aW9uKGV4aWYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcmllbnRhdGlvbiA9IGV4aWYgJiYgZXhpZi5PcmllbnRhdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1wSW1nLnJlbmRlcihjb250YWluZXIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aDogbWF4U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IG1heFNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZW50YXRpb246IG9yaWVudGF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbWU6IG1pbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplOiBvcHRpb25zLmN1c3RvbVJlc2l6ZUZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZmFpbHVyZU1zZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkVYSUYgZGF0YSBjb3VsZCBub3QgYmUgcGFyc2VkICh7fSkuICBBc3N1bWluZyBvcmllbnRhdGlvbiA9IDEuXCIsIGZhaWx1cmVNc2cpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1wSW1nLnJlbmRlcihjb250YWluZXIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aDogbWF4U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IG1heFNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWltZTogbWltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemU6IG9wdGlvbnMuY3VzdG9tUmVzaXplRnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJOb3QgcHJldmlld2FibGVcIik7XG4gICAgICAgICAgICAgICAgZHJhd1ByZXZpZXcuZmFpbHVyZShjb250YWluZXIsIFwiTm90IHByZXZpZXdhYmxlXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZHJhd1ByZXZpZXc7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZHJhd09uQ2FudmFzT3JJbWdGcm9tVXJsKHVybCwgY2FudmFzT3JJbWcsIGRyYXcsIG1heFNpemUsIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uKSB7XG4gICAgICAgICAgICB2YXIgdGVtcEltZyA9IG5ldyBJbWFnZSgpLCB0ZW1wSW1nUmVuZGVyID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIHJlZ2lzdGVyVGh1bWJuYWlsUmVuZGVyZWRMaXN0ZW5lcih0ZW1wSW1nLCB0ZW1wSW1nUmVuZGVyKTtcbiAgICAgICAgICAgIGlmIChpc0Nyb3NzT3JpZ2luKHVybCkpIHtcbiAgICAgICAgICAgICAgICB0ZW1wSW1nLmNyb3NzT3JpZ2luID0gXCJhbm9ueW1vdXNcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRlbXBJbWcuc3JjID0gdXJsO1xuICAgICAgICAgICAgdGVtcEltZ1JlbmRlci50aGVuKGZ1bmN0aW9uIHJlbmRlcmVkKCkge1xuICAgICAgICAgICAgICAgIHJlZ2lzdGVyVGh1bWJuYWlsUmVuZGVyZWRMaXN0ZW5lcihjYW52YXNPckltZywgZHJhdyk7XG4gICAgICAgICAgICAgICAgdmFyIG1wSW1nID0gbmV3IHFxLk1lZ2FQaXhJbWFnZSh0ZW1wSW1nKTtcbiAgICAgICAgICAgICAgICBtcEltZy5yZW5kZXIoY2FudmFzT3JJbWcsIHtcbiAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IG1heFNpemUsXG4gICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogbWF4U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgbWltZTogZGV0ZXJtaW5lTWltZU9mRmlsZU5hbWUodXJsKSxcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplOiBjdXN0b21SZXNpemVGdW5jdGlvblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgZHJhdy5mYWlsdXJlKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBkcmF3T25JbWdGcm9tVXJsV2l0aENzc1NjYWxpbmcodXJsLCBpbWcsIGRyYXcsIG1heFNpemUpIHtcbiAgICAgICAgICAgIHJlZ2lzdGVyVGh1bWJuYWlsUmVuZGVyZWRMaXN0ZW5lcihpbWcsIGRyYXcpO1xuICAgICAgICAgICAgcXEoaW1nKS5jc3Moe1xuICAgICAgICAgICAgICAgIG1heFdpZHRoOiBtYXhTaXplICsgXCJweFwiLFxuICAgICAgICAgICAgICAgIG1heEhlaWdodDogbWF4U2l6ZSArIFwicHhcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpbWcuc3JjID0gdXJsO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGRyYXdGcm9tVXJsKHVybCwgY29udGFpbmVyLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgZHJhdyA9IG5ldyBxcS5Qcm9taXNlKCksIHNjYWxlID0gb3B0aW9ucy5zY2FsZSwgbWF4U2l6ZSA9IHNjYWxlID8gb3B0aW9ucy5tYXhTaXplIDogbnVsbDtcbiAgICAgICAgICAgIGlmIChzY2FsZSAmJiBpc0ltZyhjb250YWluZXIpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzQ2FudmFzU3VwcG9ydGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ3Jvc3NPcmlnaW4odXJsKSAmJiAhaXNJbWdDb3JzU3VwcG9ydGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXdPbkltZ0Zyb21VcmxXaXRoQ3NzU2NhbGluZyh1cmwsIGNvbnRhaW5lciwgZHJhdywgbWF4U2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcmF3T25DYW52YXNPckltZ0Zyb21VcmwodXJsLCBjb250YWluZXIsIGRyYXcsIG1heFNpemUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZHJhd09uSW1nRnJvbVVybFdpdGhDc3NTY2FsaW5nKHVybCwgY29udGFpbmVyLCBkcmF3LCBtYXhTaXplKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzQ2FudmFzKGNvbnRhaW5lcikpIHtcbiAgICAgICAgICAgICAgICBkcmF3T25DYW52YXNPckltZ0Zyb21VcmwodXJsLCBjb250YWluZXIsIGRyYXcsIG1heFNpemUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZWdpc3RlclRodW1ibmFpbFJlbmRlcmVkTGlzdGVuZXIoY29udGFpbmVyLCBkcmF3KSkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zcmMgPSB1cmw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZHJhdztcbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgZ2VuZXJhdGU6IGZ1bmN0aW9uKGZpbGVCbG9iT3JVcmwsIGNvbnRhaW5lciwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc1N0cmluZyhmaWxlQmxvYk9yVXJsKSkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJBdHRlbXB0aW5nIHRvIHVwZGF0ZSB0aHVtYm5haWwgYmFzZWQgb24gc2VydmVyIHJlc3BvbnNlLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRyYXdGcm9tVXJsKGZpbGVCbG9iT3JVcmwsIGNvbnRhaW5lciwgb3B0aW9ucyB8fCB7fSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiQXR0ZW1wdGluZyB0byBkcmF3IGNsaWVudC1zaWRlIGltYWdlIHByZXZpZXcuXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZHJhdyhmaWxlQmxvYk9yVXJsLCBjb250YWluZXIsIG9wdGlvbnMgfHwge30pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcgPSB7fTtcbiAgICAgICAgdGhpcy5fdGVzdGluZy5pc0ltZyA9IGlzSW1nO1xuICAgICAgICB0aGlzLl90ZXN0aW5nLmlzQ2FudmFzID0gaXNDYW52YXM7XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcuaXNDcm9zc09yaWdpbiA9IGlzQ3Jvc3NPcmlnaW47XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcuZGV0ZXJtaW5lTWltZU9mRmlsZU5hbWUgPSBkZXRlcm1pbmVNaW1lT2ZGaWxlTmFtZTtcbiAgICB9O1xuICAgIHFxLkV4aWYgPSBmdW5jdGlvbihmaWxlT3JCbG9iLCBsb2cpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBUQUdfSURTID0gWyAyNzQgXSwgVEFHX0lORk8gPSB7XG4gICAgICAgICAgICAyNzQ6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIk9yaWVudGF0aW9uXCIsXG4gICAgICAgICAgICAgICAgYnl0ZXM6IDJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZnVuY3Rpb24gcGFyc2VMaXR0bGVFbmRpYW4oaGV4KSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMCwgcG93ID0gMDtcbiAgICAgICAgICAgIHdoaWxlIChoZXgubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYXJzZUludChoZXguc3Vic3RyaW5nKDAsIDIpLCAxNikgKiBNYXRoLnBvdygyLCBwb3cpO1xuICAgICAgICAgICAgICAgIGhleCA9IGhleC5zdWJzdHJpbmcoMiwgaGV4Lmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgcG93ICs9IDg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNlZWtUb0FwcDEob2Zmc2V0LCBwcm9taXNlKSB7XG4gICAgICAgICAgICB2YXIgdGhlT2Zmc2V0ID0gb2Zmc2V0LCB0aGVQcm9taXNlID0gcHJvbWlzZTtcbiAgICAgICAgICAgIGlmICh0aGVPZmZzZXQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoZU9mZnNldCA9IDI7XG4gICAgICAgICAgICAgICAgdGhlUHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBxcS5yZWFkQmxvYlRvSGV4KGZpbGVPckJsb2IsIHRoZU9mZnNldCwgNCkudGhlbihmdW5jdGlvbihoZXgpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSAvXmZmZShbMC05XSkvLmV4ZWMoaGV4KSwgc2VnbWVudExlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoWzFdICE9PSBcIjFcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudExlbmd0aCA9IHBhcnNlSW50KGhleC5zbGljZSg0LCA4KSwgMTYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vla1RvQXBwMSh0aGVPZmZzZXQgKyBzZWdtZW50TGVuZ3RoICsgMiwgdGhlUHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGVQcm9taXNlLnN1Y2Nlc3ModGhlT2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoZVByb21pc2UuZmFpbHVyZShcIk5vIEVYSUYgaGVhZGVyIHRvIGJlIGZvdW5kIVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGVQcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldEFwcDFPZmZzZXQoKSB7XG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBxcS5yZWFkQmxvYlRvSGV4KGZpbGVPckJsb2IsIDAsIDYpLnRoZW4oZnVuY3Rpb24oaGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKGhleC5pbmRleE9mKFwiZmZkOFwiKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLmZhaWx1cmUoXCJOb3QgYSB2YWxpZCBKUEVHIVwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWVrVG9BcHAxKCkudGhlbihmdW5jdGlvbihvZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhvZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsdXJlKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0xpdHRsZUVuZGlhbihhcHAxU3RhcnQpIHtcbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIHFxLnJlYWRCbG9iVG9IZXgoZmlsZU9yQmxvYiwgYXBwMVN0YXJ0ICsgMTAsIDIpLnRoZW4oZnVuY3Rpb24oaGV4KSB7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKGhleCA9PT0gXCI0OTQ5XCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXREaXJFbnRyeUNvdW50KGFwcDFTdGFydCwgbGl0dGxlRW5kaWFuKSB7XG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBxcS5yZWFkQmxvYlRvSGV4KGZpbGVPckJsb2IsIGFwcDFTdGFydCArIDE4LCAyKS50aGVuKGZ1bmN0aW9uKGhleCkge1xuICAgICAgICAgICAgICAgIGlmIChsaXR0bGVFbmRpYW4pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2Uuc3VjY2VzcyhwYXJzZUxpdHRsZUVuZGlhbihoZXgpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MocGFyc2VJbnQoaGV4LCAxNikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0SWZkKGFwcDFTdGFydCwgZGlyRW50cmllcykge1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IGFwcDFTdGFydCArIDIwLCBieXRlcyA9IGRpckVudHJpZXMgKiAxMjtcbiAgICAgICAgICAgIHJldHVybiBxcS5yZWFkQmxvYlRvSGV4KGZpbGVPckJsb2IsIG9mZnNldCwgYnl0ZXMpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldERpckVudHJpZXMoaWZkSGV4KSB7XG4gICAgICAgICAgICB2YXIgZW50cmllcyA9IFtdLCBvZmZzZXQgPSAwO1xuICAgICAgICAgICAgd2hpbGUgKG9mZnNldCArIDI0IDw9IGlmZEhleC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2goaWZkSGV4LnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgMjQpKTtcbiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMjQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZW50cmllcztcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRUYWdWYWx1ZXMobGl0dGxlRW5kaWFuLCBkaXJFbnRyaWVzKSB7XG4gICAgICAgICAgICB2YXIgVEFHX1ZBTF9PRkZTRVQgPSAxNiwgdGFnc1RvRmluZCA9IHFxLmV4dGVuZChbXSwgVEFHX0lEUyksIHZhbHMgPSB7fTtcbiAgICAgICAgICAgIHFxLmVhY2goZGlyRW50cmllcywgZnVuY3Rpb24oaWR4LCBlbnRyeSkge1xuICAgICAgICAgICAgICAgIHZhciBpZEhleCA9IGVudHJ5LnNsaWNlKDAsIDQpLCBpZCA9IGxpdHRsZUVuZGlhbiA/IHBhcnNlTGl0dGxlRW5kaWFuKGlkSGV4KSA6IHBhcnNlSW50KGlkSGV4LCAxNiksIHRhZ3NUb0ZpbmRJZHggPSB0YWdzVG9GaW5kLmluZGV4T2YoaWQpLCB0YWdWYWxIZXgsIHRhZ05hbWUsIHRhZ1ZhbExlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAodGFnc1RvRmluZElkeCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhZ05hbWUgPSBUQUdfSU5GT1tpZF0ubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgdGFnVmFsTGVuZ3RoID0gVEFHX0lORk9baWRdLmJ5dGVzO1xuICAgICAgICAgICAgICAgICAgICB0YWdWYWxIZXggPSBlbnRyeS5zbGljZShUQUdfVkFMX09GRlNFVCwgVEFHX1ZBTF9PRkZTRVQgKyB0YWdWYWxMZW5ndGggKiAyKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsc1t0YWdOYW1lXSA9IGxpdHRsZUVuZGlhbiA/IHBhcnNlTGl0dGxlRW5kaWFuKHRhZ1ZhbEhleCkgOiBwYXJzZUludCh0YWdWYWxIZXgsIDE2KTtcbiAgICAgICAgICAgICAgICAgICAgdGFnc1RvRmluZC5zcGxpY2UodGFnc1RvRmluZElkeCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0YWdzVG9GaW5kLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdmFscztcbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgcGFyc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgcXEuUHJvbWlzZSgpLCBvblBhcnNlRmFpbHVyZSA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkVYSUYgaGVhZGVyIHBhcnNlIGZhaWxlZDogJ3t9JyBcIiwgbWVzc2FnZSkpO1xuICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmFpbHVyZShtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGdldEFwcDFPZmZzZXQoKS50aGVuKGZ1bmN0aW9uKGFwcDFPZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIk1vdmluZyBmb3J3YXJkIHdpdGggRVhJRiBoZWFkZXIgcGFyc2luZyBmb3IgJ3t9J1wiLCBmaWxlT3JCbG9iLm5hbWUgPT09IHVuZGVmaW5lZCA/IFwiYmxvYlwiIDogZmlsZU9yQmxvYi5uYW1lKSk7XG4gICAgICAgICAgICAgICAgICAgIGlzTGl0dGxlRW5kaWFuKGFwcDFPZmZzZXQpLnRoZW4oZnVuY3Rpb24obGl0dGxlRW5kaWFuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiRVhJRiBCeXRlIG9yZGVyIGlzIHt9IGVuZGlhblwiLCBsaXR0bGVFbmRpYW4gPyBcImxpdHRsZVwiIDogXCJiaWdcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGlyRW50cnlDb3VudChhcHAxT2Zmc2V0LCBsaXR0bGVFbmRpYW4pLnRoZW4oZnVuY3Rpb24oZGlyRW50cnlDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJGb3VuZCB7fSBBUFAxIGRpcmVjdG9yeSBlbnRyaWVzXCIsIGRpckVudHJ5Q291bnQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRJZmQoYXBwMU9mZnNldCwgZGlyRW50cnlDb3VudCkudGhlbihmdW5jdGlvbihpZmRIZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpckVudHJpZXMgPSBnZXREaXJFbnRyaWVzKGlmZEhleCksIHRhZ1ZhbHVlcyA9IGdldFRhZ1ZhbHVlcyhsaXR0bGVFbmRpYW4sIGRpckVudHJpZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJTdWNjZXNzZnVsbHkgcGFyc2VkIHNvbWUgRVhJRiB0YWdzXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuc3VjY2Vzcyh0YWdWYWx1ZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIG9uUGFyc2VGYWlsdXJlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIG9uUGFyc2VGYWlsdXJlKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgb25QYXJzZUZhaWx1cmUpO1xuICAgICAgICAgICAgICAgIH0sIG9uUGFyc2VGYWlsdXJlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fdGVzdGluZyA9IHt9O1xuICAgICAgICB0aGlzLl90ZXN0aW5nLnBhcnNlTGl0dGxlRW5kaWFuID0gcGFyc2VMaXR0bGVFbmRpYW47XG4gICAgfTtcbiAgICBxcS5JZGVudGlmeSA9IGZ1bmN0aW9uKGZpbGVPckJsb2IsIGxvZykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgZnVuY3Rpb24gaXNJZGVudGlmaWFibGUobWFnaWNCeXRlcywgcXVlc3Rpb25hYmxlQnl0ZXMpIHtcbiAgICAgICAgICAgIHZhciBpZGVudGlmaWFibGUgPSBmYWxzZSwgbWFnaWNCeXRlc0VudHJpZXMgPSBbXS5jb25jYXQobWFnaWNCeXRlcyk7XG4gICAgICAgICAgICBxcS5lYWNoKG1hZ2ljQnl0ZXNFbnRyaWVzLCBmdW5jdGlvbihpZHgsIG1hZ2ljQnl0ZXNBcnJheUVudHJ5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uYWJsZUJ5dGVzLmluZGV4T2YobWFnaWNCeXRlc0FycmF5RW50cnkpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkZW50aWZpYWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBpZGVudGlmaWFibGU7XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGlzUHJldmlld2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgaWRlbnRpZmllciA9IG5ldyBxcS5Qcm9taXNlKCksIHByZXZpZXdhYmxlID0gZmFsc2UsIG5hbWUgPSBmaWxlT3JCbG9iLm5hbWUgPT09IHVuZGVmaW5lZCA/IFwiYmxvYlwiIDogZmlsZU9yQmxvYi5uYW1lO1xuICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJBdHRlbXB0aW5nIHRvIGRldGVybWluZSBpZiB7fSBjYW4gYmUgcmVuZGVyZWQgaW4gdGhpcyBicm93c2VyXCIsIG5hbWUpKTtcbiAgICAgICAgICAgICAgICBsb2coXCJGaXJzdCBwYXNzOiBjaGVjayB0eXBlIGF0dHJpYnV0ZSBvZiBibG9iIG9iamVjdC5cIik7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNQcmV2aWV3YWJsZVN5bmMoKSkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJTZWNvbmQgcGFzczogY2hlY2sgZm9yIG1hZ2ljIGJ5dGVzIGluIGZpbGUgaGVhZGVyLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgcXEucmVhZEJsb2JUb0hleChmaWxlT3JCbG9iLCAwLCA0KS50aGVuKGZ1bmN0aW9uKGhleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChzZWxmLlBSRVZJRVdBQkxFX01JTUVfVFlQRVMsIGZ1bmN0aW9uKG1pbWUsIGJ5dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSWRlbnRpZmlhYmxlKGJ5dGVzLCBoZXgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW1lICE9PSBcImltYWdlL3RpZmZcIiB8fCBxcS5zdXBwb3J0ZWRGZWF0dXJlcy50aWZmUHJldmlld3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpZXdhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXIuc3VjY2VzcyhtaW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiJ3t9JyBpcyB7fSBhYmxlIHRvIGJlIHJlbmRlcmVkIGluIHRoaXMgYnJvd3NlclwiLCBuYW1lLCBwcmV2aWV3YWJsZSA/IFwiXCIgOiBcIk5PVFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByZXZpZXdhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllci5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiRXJyb3IgcmVhZGluZyBmaWxlIHcvIG5hbWUgJ1wiICsgbmFtZSArIFwiJy4gIE5vdCBhYmxlIHRvIGJlIHJlbmRlcmVkIGluIHRoaXMgYnJvd3Nlci5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllci5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBpZGVudGlmaWVyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzUHJldmlld2FibGVTeW5jOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZU1pbWUgPSBmaWxlT3JCbG9iLnR5cGUsIGlzUmVjb2duaXplZEltYWdlID0gcXEuaW5kZXhPZihPYmplY3Qua2V5cyh0aGlzLlBSRVZJRVdBQkxFX01JTUVfVFlQRVMpLCBmaWxlTWltZSkgPj0gMCwgcHJldmlld2FibGUgPSBmYWxzZSwgbmFtZSA9IGZpbGVPckJsb2IubmFtZSA9PT0gdW5kZWZpbmVkID8gXCJibG9iXCIgOiBmaWxlT3JCbG9iLm5hbWU7XG4gICAgICAgICAgICAgICAgaWYgKGlzUmVjb2duaXplZEltYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlTWltZSA9PT0gXCJpbWFnZS90aWZmXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpZXdhYmxlID0gcXEuc3VwcG9ydGVkRmVhdHVyZXMudGlmZlByZXZpZXdzO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlld2FibGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICFwcmV2aWV3YWJsZSAmJiBsb2cobmFtZSArIFwiIGlzIG5vdCBwcmV2aWV3YWJsZSBpbiB0aGlzIGJyb3dzZXIgcGVyIHRoZSBibG9iJ3MgdHlwZSBhdHRyXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwcmV2aWV3YWJsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5JZGVudGlmeS5wcm90b3R5cGUuUFJFVklFV0FCTEVfTUlNRV9UWVBFUyA9IHtcbiAgICAgICAgXCJpbWFnZS9qcGVnXCI6IFwiZmZkOGZmXCIsXG4gICAgICAgIFwiaW1hZ2UvZ2lmXCI6IFwiNDc0OTQ2XCIsXG4gICAgICAgIFwiaW1hZ2UvcG5nXCI6IFwiODk1MDRlXCIsXG4gICAgICAgIFwiaW1hZ2UvYm1wXCI6IFwiNDI0ZFwiLFxuICAgICAgICBcImltYWdlL3RpZmZcIjogWyBcIjQ5NDkyYTAwXCIsIFwiNGQ0ZDAwMmFcIiBdXG4gICAgfTtcbiAgICBxcS5JbWFnZVZhbGlkYXRpb24gPSBmdW5jdGlvbihibG9iLCBsb2cpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIGZ1bmN0aW9uIGhhc05vblplcm9MaW1pdHMobGltaXRzKSB7XG4gICAgICAgICAgICB2YXIgYXRMZWFzdE9uZSA9IGZhbHNlO1xuICAgICAgICAgICAgcXEuZWFjaChsaW1pdHMsIGZ1bmN0aW9uKGxpbWl0LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgYXRMZWFzdE9uZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBhdExlYXN0T25lO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldFdpZHRoSGVpZ2h0KCkge1xuICAgICAgICAgICAgdmFyIHNpemVEZXRlcm1pbmF0aW9uID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIG5ldyBxcS5JZGVudGlmeShibG9iLCBsb2cpLmlzUHJldmlld2FibGUoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9IG5ldyBJbWFnZSgpLCB1cmwgPSB3aW5kb3cuVVJMICYmIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMID8gd2luZG93LlVSTCA6IHdpbmRvdy53ZWJraXRVUkwgJiYgd2luZG93LndlYmtpdFVSTC5jcmVhdGVPYmplY3RVUkwgPyB3aW5kb3cud2Via2l0VVJMIDogbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIkNhbm5vdCBkZXRlcm1pbmUgZGltZW5zaW9ucyBmb3IgaW1hZ2UuICBNYXkgYmUgdG9vIGxhcmdlLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZURldGVybWluYXRpb24uZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpbWFnZS5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemVEZXRlcm1pbmF0aW9uLnN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpbWFnZS5zcmMgPSB1cmwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIk5vIGNyZWF0ZU9iamVjdFVSTCBmdW5jdGlvbiBhdmFpbGFibGUgdG8gZ2VuZXJhdGUgaW1hZ2UgVVJMIVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICBzaXplRGV0ZXJtaW5hdGlvbi5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgc2l6ZURldGVybWluYXRpb24uZmFpbHVyZSk7XG4gICAgICAgICAgICByZXR1cm4gc2l6ZURldGVybWluYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0RmFpbGluZ0xpbWl0KGxpbWl0cywgZGltZW5zaW9ucykge1xuICAgICAgICAgICAgdmFyIGZhaWxpbmdMaW1pdDtcbiAgICAgICAgICAgIHFxLmVhY2gobGltaXRzLCBmdW5jdGlvbihsaW1pdE5hbWUsIGxpbWl0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAobGltaXRWYWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbWl0TWF0Y2hlciA9IC8obWF4fG1pbikoV2lkdGh8SGVpZ2h0KS8uZXhlYyhsaW1pdE5hbWUpLCBkaW1lbnNpb25Qcm9wTmFtZSA9IGxpbWl0TWF0Y2hlclsyXS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIGxpbWl0TWF0Y2hlclsyXS5zbGljZSgxKSwgYWN0dWFsVmFsdWUgPSBkaW1lbnNpb25zW2RpbWVuc2lvblByb3BOYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChsaW1pdE1hdGNoZXJbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibWluXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0dWFsVmFsdWUgPCBsaW1pdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGluZ0xpbWl0ID0gbGltaXROYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1heFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdHVhbFZhbHVlID4gbGltaXRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxpbmdMaW1pdCA9IGxpbWl0TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGZhaWxpbmdMaW1pdDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZhbGlkYXRlID0gZnVuY3Rpb24obGltaXRzKSB7XG4gICAgICAgICAgICB2YXIgdmFsaWRhdGlvbkVmZm9ydCA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBsb2coXCJBdHRlbXB0aW5nIHRvIHZhbGlkYXRlIGltYWdlLlwiKTtcbiAgICAgICAgICAgIGlmIChoYXNOb25aZXJvTGltaXRzKGxpbWl0cykpIHtcbiAgICAgICAgICAgICAgICBnZXRXaWR0aEhlaWdodCgpLnRoZW4oZnVuY3Rpb24oZGltZW5zaW9ucykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbGluZ0xpbWl0ID0gZ2V0RmFpbGluZ0xpbWl0KGxpbWl0cywgZGltZW5zaW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsaW5nTGltaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25FZmZvcnQuZmFpbHVyZShmYWlsaW5nTGltaXQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbkVmZm9ydC5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCB2YWxpZGF0aW9uRWZmb3J0LnN1Y2Nlc3MpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uRWZmb3J0LnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2YWxpZGF0aW9uRWZmb3J0O1xuICAgICAgICB9O1xuICAgIH07XG4gICAgcXEuU2Vzc2lvbiA9IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgZW5kcG9pbnQ6IG51bGwsXG4gICAgICAgICAgICBwYXJhbXM6IHt9LFxuICAgICAgICAgICAgY3VzdG9tSGVhZGVyczoge30sXG4gICAgICAgICAgICBjb3JzOiB7fSxcbiAgICAgICAgICAgIGFkZEZpbGVSZWNvcmQ6IGZ1bmN0aW9uKHNlc3Npb25EYXRhKSB7fSxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSwgbGV2ZWwpIHt9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBzcGVjLCB0cnVlKTtcbiAgICAgICAgZnVuY3Rpb24gaXNKc29uUmVzcG9uc2VWYWxpZChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHFxLmlzQXJyYXkocmVzcG9uc2UpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLmxvZyhcIlNlc3Npb24gcmVzcG9uc2UgaXMgbm90IGFuIGFycmF5LlwiLCBcImVycm9yXCIpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZUZpbGVJdGVtcyhmaWxlSXRlbXMsIHN1Y2Nlc3MsIHhock9yWGRyLCBwcm9taXNlKSB7XG4gICAgICAgICAgICB2YXIgc29tZUl0ZW1zSWdub3JlZCA9IGZhbHNlO1xuICAgICAgICAgICAgc3VjY2VzcyA9IHN1Y2Nlc3MgJiYgaXNKc29uUmVzcG9uc2VWYWxpZChmaWxlSXRlbXMpO1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGZpbGVJdGVtcywgZnVuY3Rpb24oaWR4LCBmaWxlSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZUl0ZW0udXVpZCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb21lSXRlbXNJZ25vcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubG9nKHFxLmZvcm1hdChcIlNlc3Npb24gcmVzcG9uc2UgaXRlbSB7fSBkaWQgbm90IGluY2x1ZGUgYSB2YWxpZCBVVUlEIC0gaWdub3JpbmcuXCIsIGlkeCksIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZUl0ZW0ubmFtZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb21lSXRlbXNJZ25vcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubG9nKHFxLmZvcm1hdChcIlNlc3Npb24gcmVzcG9uc2UgaXRlbSB7fSBkaWQgbm90IGluY2x1ZGUgYSB2YWxpZCBuYW1lIC0gaWdub3JpbmcuXCIsIGlkeCksIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWRkRmlsZVJlY29yZChmaWxlSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb21lSXRlbXNJZ25vcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmxvZyhlcnIubWVzc2FnZSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcm9taXNlW3N1Y2Nlc3MgJiYgIXNvbWVJdGVtc0lnbm9yZWQgPyBcInN1Y2Nlc3NcIiA6IFwiZmFpbHVyZVwiXShmaWxlSXRlbXMsIHhock9yWGRyKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlZnJlc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciByZWZyZXNoRWZmb3J0ID0gbmV3IHFxLlByb21pc2UoKSwgcmVmcmVzaENvbXBsZXRlQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXNwb25zZSwgc3VjY2VzcywgeGhyT3JYZHIpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVGaWxlSXRlbXMocmVzcG9uc2UsIHN1Y2Nlc3MsIHhock9yWGRyLCByZWZyZXNoRWZmb3J0KTtcbiAgICAgICAgICAgIH0sIHJlcXVlc3Rlck9wdGlvbnMgPSBxcS5leHRlbmQoe30sIG9wdGlvbnMpLCByZXF1ZXN0ZXIgPSBuZXcgcXEuU2Vzc2lvbkFqYXhSZXF1ZXN0ZXIocXEuZXh0ZW5kKHJlcXVlc3Rlck9wdGlvbnMsIHtcbiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlOiByZWZyZXNoQ29tcGxldGVDYWxsYmFja1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgcmVxdWVzdGVyLnF1ZXJ5U2VydmVyKCk7XG4gICAgICAgICAgICByZXR1cm4gcmVmcmVzaEVmZm9ydDtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIHFxLlNlc3Npb25BamF4UmVxdWVzdGVyID0gZnVuY3Rpb24oc3BlYykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHJlcXVlc3Rlciwgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGVuZHBvaW50OiBudWxsLFxuICAgICAgICAgICAgY3VzdG9tSGVhZGVyczoge30sXG4gICAgICAgICAgICBwYXJhbXM6IHt9LFxuICAgICAgICAgICAgY29yczoge1xuICAgICAgICAgICAgICAgIGV4cGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzZW5kQ3JlZGVudGlhbHM6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24ocmVzcG9uc2UsIHN1Y2Nlc3MsIHhock9yWGRyKSB7fSxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24oc3RyLCBsZXZlbCkge31cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIHNwZWMpO1xuICAgICAgICBmdW5jdGlvbiBvbkNvbXBsZXRlKGlkLCB4aHJPclhkciwgaXNFcnJvcikge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbnVsbDtcbiAgICAgICAgICAgIGlmICh4aHJPclhkci5yZXNwb25zZVRleHQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcXEucGFyc2VKc29uKHhock9yWGRyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubG9nKFwiUHJvYmxlbSBwYXJzaW5nIHNlc3Npb24gcmVzcG9uc2U6IFwiICsgZXJyLm1lc3NhZ2UsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIGlzRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMub25Db21wbGV0ZShyZXNwb25zZSwgIWlzRXJyb3IsIHhock9yWGRyKTtcbiAgICAgICAgfVxuICAgICAgICByZXF1ZXN0ZXIgPSBxcS5leHRlbmQodGhpcywgbmV3IHFxLkFqYXhSZXF1ZXN0ZXIoe1xuICAgICAgICAgICAgYWNjZXB0SGVhZGVyOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgIHZhbGlkTWV0aG9kczogWyBcIkdFVFwiIF0sXG4gICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICBlbmRwb2ludFN0b3JlOiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZW5kcG9pbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IG9wdGlvbnMuY3VzdG9tSGVhZGVycyxcbiAgICAgICAgICAgIGxvZzogb3B0aW9ucy5sb2csXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBvbkNvbXBsZXRlLFxuICAgICAgICAgICAgY29yczogb3B0aW9ucy5jb3JzXG4gICAgICAgIH0pKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHF1ZXJ5U2VydmVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gcXEuZXh0ZW5kKHt9LCBvcHRpb25zLnBhcmFtcyk7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5sb2coXCJTZXNzaW9uIHF1ZXJ5IHJlcXVlc3QuXCIpO1xuICAgICAgICAgICAgICAgIHJlcXVlc3Rlci5pbml0VHJhbnNwb3J0KFwic2Vzc2lvblJlZnJlc2hcIikud2l0aFBhcmFtcyhwYXJhbXMpLndpdGhDYWNoZUJ1c3RlcigpLnNlbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5TY2FsZXIgPSBmdW5jdGlvbihzcGVjLCBsb2cpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcywgY3VzdG9tUmVzaXplRnVuY3Rpb24gPSBzcGVjLmN1c3RvbVJlc2l6ZXIsIGluY2x1ZGVPcmlnaW5hbCA9IHNwZWMuc2VuZE9yaWdpbmFsLCBvcmllbnQgPSBzcGVjLm9yaWVudCwgZGVmYXVsdFR5cGUgPSBzcGVjLmRlZmF1bHRUeXBlLCBkZWZhdWx0UXVhbGl0eSA9IHNwZWMuZGVmYXVsdFF1YWxpdHkgLyAxMDAsIGZhaWxlZFRvU2NhbGVUZXh0ID0gc3BlYy5mYWlsdXJlVGV4dCwgaW5jbHVkZUV4aWYgPSBzcGVjLmluY2x1ZGVFeGlmLCBzaXplcyA9IHRoaXMuX2dldFNvcnRlZFNpemVzKHNwZWMuc2l6ZXMpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgZW5hYmxlZDogcXEuc3VwcG9ydGVkRmVhdHVyZXMuc2NhbGluZyAmJiBzaXplcy5sZW5ndGggPiAwLFxuICAgICAgICAgICAgZ2V0RmlsZVJlY29yZHM6IGZ1bmN0aW9uKG9yaWdpbmFsRmlsZVV1aWQsIG9yaWdpbmFsRmlsZU5hbWUsIG9yaWdpbmFsQmxvYk9yQmxvYkRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIHJlY29yZHMgPSBbXSwgb3JpZ2luYWxCbG9iID0gb3JpZ2luYWxCbG9iT3JCbG9iRGF0YS5ibG9iID8gb3JpZ2luYWxCbG9iT3JCbG9iRGF0YS5ibG9iIDogb3JpZ2luYWxCbG9iT3JCbG9iRGF0YSwgaWRlbnRpZmllciA9IG5ldyBxcS5JZGVudGlmeShvcmlnaW5hbEJsb2IsIGxvZyk7XG4gICAgICAgICAgICAgICAgaWYgKGlkZW50aWZpZXIuaXNQcmV2aWV3YWJsZVN5bmMoKSkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKHNpemVzLCBmdW5jdGlvbihpZHgsIHNpemVSZWNvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvdXRwdXRUeXBlID0gc2VsZi5fZGV0ZXJtaW5lT3V0cHV0VHlwZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFR5cGU6IGRlZmF1bHRUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RlZFR5cGU6IHNpemVSZWNvcmQudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZUeXBlOiBvcmlnaW5hbEJsb2IudHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IHFxLmdldFVuaXF1ZUlkKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogc2VsZi5fZ2V0TmFtZShvcmlnaW5hbEZpbGVOYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHNpemVSZWNvcmQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogb3V0cHV0VHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmVHlwZTogb3JpZ2luYWxCbG9iLnR5cGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9iOiBuZXcgcXEuQmxvYlByb3h5KG9yaWdpbmFsQmxvYiwgcXEuYmluZChzZWxmLl9nZW5lcmF0ZVNjYWxlZEltYWdlLCBzZWxmLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uOiBjdXN0b21SZXNpemVGdW5jdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4U2l6ZTogc2l6ZVJlY29yZC5tYXhTaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmllbnQ6IG9yaWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogb3V0cHV0VHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVhbGl0eTogZGVmYXVsdFF1YWxpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZFRleHQ6IGZhaWxlZFRvU2NhbGVUZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlRXhpZjogaW5jbHVkZUV4aWYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZzogbG9nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBvcmlnaW5hbEZpbGVVdWlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogb3JpZ2luYWxGaWxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG9yaWdpbmFsQmxvYi5zaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvYjogaW5jbHVkZU9yaWdpbmFsID8gb3JpZ2luYWxCbG9iIDogbnVsbFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWNvcmRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogb3JpZ2luYWxGaWxlVXVpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG9yaWdpbmFsRmlsZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBvcmlnaW5hbEJsb2Iuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2I6IG9yaWdpbmFsQmxvYlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZHM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFuZGxlTmV3RmlsZTogZnVuY3Rpb24oZmlsZSwgbmFtZSwgdXVpZCwgc2l6ZSwgZmlsZUxpc3QsIGJhdGNoSWQsIHV1aWRQYXJhbU5hbWUsIGFwaSkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgYnV0dG9uSWQgPSBmaWxlLnFxQnV0dG9uSWQgfHwgZmlsZS5ibG9iICYmIGZpbGUuYmxvYi5xcUJ1dHRvbklkLCBzY2FsZWRJZHMgPSBbXSwgb3JpZ2luYWxJZCA9IG51bGwsIGFkZEZpbGVUb0hhbmRsZXIgPSBhcGkuYWRkRmlsZVRvSGFuZGxlciwgdXBsb2FkRGF0YSA9IGFwaS51cGxvYWREYXRhLCBwYXJhbXNTdG9yZSA9IGFwaS5wYXJhbXNTdG9yZSwgcHJveHlHcm91cElkID0gcXEuZ2V0VW5pcXVlSWQoKTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHNlbGYuZ2V0RmlsZVJlY29yZHModXVpZCwgbmFtZSwgZmlsZSksIGZ1bmN0aW9uKGlkeCwgcmVjb3JkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBibG9iU2l6ZSA9IHJlY29yZC5zaXplLCBpZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZC5ibG9iIGluc3RhbmNlb2YgcXEuQmxvYlByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9iU2l6ZSA9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlkID0gdXBsb2FkRGF0YS5hZGRGaWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IHJlY29yZC51dWlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcmVjb3JkLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBibG9iU2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoSWQ6IGJhdGNoSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm94eUdyb3VwSWQ6IHByb3h5R3JvdXBJZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZC5ibG9iIGluc3RhbmNlb2YgcXEuQmxvYlByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZWRJZHMucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbElkID0gaWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZC5ibG9iKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRGaWxlVG9IYW5kbGVyKGlkLCByZWNvcmQuYmxvYik7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlTGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogcmVjb3JkLmJsb2JcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5SRUpFQ1RFRCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWxJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKHNjYWxlZElkcywgZnVuY3Rpb24oaWR4LCBzY2FsZWRJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcXBhcmVudHV1aWQ6IHVwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogb3JpZ2luYWxJZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnV1aWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXFwYXJlbnRzaXplOiB1cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IG9yaWdpbmFsSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5zaXplXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zW3V1aWRQYXJhbU5hbWVdID0gdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHNjYWxlZElkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS51dWlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkRGF0YS5zZXRQYXJlbnRJZChzY2FsZWRJZCwgb3JpZ2luYWxJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXNTdG9yZS5hZGRSZWFkT25seShzY2FsZWRJZCwgcGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY2FsZWRJZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1bdXVpZFBhcmFtTmFtZV0gPSB1cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IG9yaWdpbmFsSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS51dWlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1N0b3JlLmFkZFJlYWRPbmx5KG9yaWdpbmFsSWQsIHBhcmFtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuZXh0ZW5kKHFxLlNjYWxlci5wcm90b3R5cGUsIHtcbiAgICAgICAgc2NhbGVJbWFnZTogZnVuY3Rpb24oaWQsIHNwZWNzLCBhcGkpIHtcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgaWYgKCFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5zY2FsaW5nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IHFxLkVycm9yKFwiU2NhbGluZyBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlciFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc2NhbGluZ0VmZm9ydCA9IG5ldyBxcS5Qcm9taXNlKCksIGxvZyA9IGFwaS5sb2csIGZpbGUgPSBhcGkuZ2V0RmlsZShpZCksIHVwbG9hZERhdGEgPSBhcGkudXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICB9KSwgbmFtZSA9IHVwbG9hZERhdGEgJiYgdXBsb2FkRGF0YS5uYW1lLCB1dWlkID0gdXBsb2FkRGF0YSAmJiB1cGxvYWREYXRhLnV1aWQsIHNjYWxpbmdPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZXI6IHNwZWNzLmN1c3RvbVJlc2l6ZXIsXG4gICAgICAgICAgICAgICAgc2VuZE9yaWdpbmFsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBvcmllbnQ6IHNwZWNzLm9yaWVudCxcbiAgICAgICAgICAgICAgICBkZWZhdWx0VHlwZTogc3BlY3MudHlwZSB8fCBudWxsLFxuICAgICAgICAgICAgICAgIGRlZmF1bHRRdWFsaXR5OiBzcGVjcy5xdWFsaXR5LFxuICAgICAgICAgICAgICAgIGZhaWxlZFRvU2NhbGVUZXh0OiBcIlVuYWJsZSB0byBzY2FsZVwiLFxuICAgICAgICAgICAgICAgIHNpemVzOiBbIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgbWF4U2l6ZTogc3BlY3MubWF4U2l6ZVxuICAgICAgICAgICAgICAgIH0gXVxuICAgICAgICAgICAgfSwgc2NhbGVyID0gbmV3IHFxLlNjYWxlcihzY2FsaW5nT3B0aW9ucywgbG9nKTtcbiAgICAgICAgICAgIGlmICghcXEuU2NhbGVyIHx8ICFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5pbWFnZVByZXZpZXdzIHx8ICFmaWxlKSB7XG4gICAgICAgICAgICAgICAgc2NhbGluZ0VmZm9ydC5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgbG9nKFwiQ291bGQgbm90IGdlbmVyYXRlIHJlcXVlc3RlZCBzY2FsZWQgaW1hZ2UgZm9yIFwiICsgaWQgKyBcIi4gIFwiICsgXCJTY2FsaW5nIGlzIGVpdGhlciBub3QgcG9zc2libGUgaW4gdGhpcyBicm93c2VyLCBvciB0aGUgZmlsZSBjb3VsZCBub3QgYmUgbG9jYXRlZC5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcXEuYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IHNjYWxlci5nZXRGaWxlUmVjb3Jkcyh1dWlkLCBuYW1lLCBmaWxlKVswXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZCAmJiByZWNvcmQuYmxvYiBpbnN0YW5jZW9mIHFxLkJsb2JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkLmJsb2IuY3JlYXRlKCkudGhlbihzY2FsaW5nRWZmb3J0LnN1Y2Nlc3MsIHNjYWxpbmdFZmZvcnQuZmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coaWQgKyBcIiBpcyBub3QgYSBzY2FsYWJsZSBpbWFnZSFcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxpbmdFZmZvcnQuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgdGhpcykoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzY2FsaW5nRWZmb3J0O1xuICAgICAgICB9LFxuICAgICAgICBfZGV0ZXJtaW5lT3V0cHV0VHlwZTogZnVuY3Rpb24oc3BlYykge1xuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICB2YXIgcmVxdWVzdGVkVHlwZSA9IHNwZWMucmVxdWVzdGVkVHlwZSwgZGVmYXVsdFR5cGUgPSBzcGVjLmRlZmF1bHRUeXBlLCByZWZlcmVuY2VUeXBlID0gc3BlYy5yZWZUeXBlO1xuICAgICAgICAgICAgaWYgKCFkZWZhdWx0VHlwZSAmJiAhcmVxdWVzdGVkVHlwZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZWZlcmVuY2VUeXBlICE9PSBcImltYWdlL2pwZWdcIikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJpbWFnZS9wbmdcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlZmVyZW5jZVR5cGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXJlcXVlc3RlZFR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFR5cGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocXEuaW5kZXhPZihPYmplY3Qua2V5cyhxcS5JZGVudGlmeS5wcm90b3R5cGUuUFJFVklFV0FCTEVfTUlNRV9UWVBFUyksIHJlcXVlc3RlZFR5cGUpID49IDApIHtcbiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdGVkVHlwZSA9PT0gXCJpbWFnZS90aWZmXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHFxLnN1cHBvcnRlZEZlYXR1cmVzLnRpZmZQcmV2aWV3cyA/IHJlcXVlc3RlZFR5cGUgOiBkZWZhdWx0VHlwZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RlZFR5cGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGVmYXVsdFR5cGU7XG4gICAgICAgIH0sXG4gICAgICAgIF9nZXROYW1lOiBmdW5jdGlvbihvcmlnaW5hbE5hbWUsIHNjYWxlZFZlcnNpb25Qcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgIHZhciBzdGFydE9mRXh0ID0gb3JpZ2luYWxOYW1lLmxhc3RJbmRleE9mKFwiLlwiKSwgdmVyc2lvblR5cGUgPSBzY2FsZWRWZXJzaW9uUHJvcGVydGllcy50eXBlIHx8IFwiaW1hZ2UvcG5nXCIsIHJlZmVyZW5jZVR5cGUgPSBzY2FsZWRWZXJzaW9uUHJvcGVydGllcy5yZWZUeXBlLCBzY2FsZWROYW1lID0gXCJcIiwgc2NhbGVkRXh0ID0gcXEuZ2V0RXh0ZW5zaW9uKG9yaWdpbmFsTmFtZSksIG5hbWVBcHBlbmRhZ2UgPSBcIlwiO1xuICAgICAgICAgICAgaWYgKHNjYWxlZFZlcnNpb25Qcm9wZXJ0aWVzLm5hbWUgJiYgc2NhbGVkVmVyc2lvblByb3BlcnRpZXMubmFtZS50cmltKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbmFtZUFwcGVuZGFnZSA9IFwiIChcIiArIHNjYWxlZFZlcnNpb25Qcm9wZXJ0aWVzLm5hbWUgKyBcIilcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdGFydE9mRXh0ID49IDApIHtcbiAgICAgICAgICAgICAgICBzY2FsZWROYW1lID0gb3JpZ2luYWxOYW1lLnN1YnN0cigwLCBzdGFydE9mRXh0KTtcbiAgICAgICAgICAgICAgICBpZiAocmVmZXJlbmNlVHlwZSAhPT0gdmVyc2lvblR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVkRXh0ID0gdmVyc2lvblR5cGUuc3BsaXQoXCIvXCIpWzFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzY2FsZWROYW1lICs9IG5hbWVBcHBlbmRhZ2UgKyBcIi5cIiArIHNjYWxlZEV4dDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2NhbGVkTmFtZSA9IG9yaWdpbmFsTmFtZSArIG5hbWVBcHBlbmRhZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc2NhbGVkTmFtZTtcbiAgICAgICAgfSxcbiAgICAgICAgX2dldFNvcnRlZFNpemVzOiBmdW5jdGlvbihzaXplcykge1xuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICBzaXplcyA9IHFxLmV4dGVuZChbXSwgc2l6ZXMpO1xuICAgICAgICAgICAgcmV0dXJuIHNpemVzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgICAgIGlmIChhLm1heFNpemUgPiBiLm1heFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhLm1heFNpemUgPCBiLm1heFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBfZ2VuZXJhdGVTY2FsZWRJbWFnZTogZnVuY3Rpb24oc3BlYywgc291cmNlRmlsZSkge1xuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uID0gc3BlYy5jdXN0b21SZXNpemVGdW5jdGlvbiwgbG9nID0gc3BlYy5sb2csIG1heFNpemUgPSBzcGVjLm1heFNpemUsIG9yaWVudCA9IHNwZWMub3JpZW50LCB0eXBlID0gc3BlYy50eXBlLCBxdWFsaXR5ID0gc3BlYy5xdWFsaXR5LCBmYWlsZWRUZXh0ID0gc3BlYy5mYWlsZWRUZXh0LCBpbmNsdWRlRXhpZiA9IHNwZWMuaW5jbHVkZUV4aWYgJiYgc291cmNlRmlsZS50eXBlID09PSBcImltYWdlL2pwZWdcIiAmJiB0eXBlID09PSBcImltYWdlL2pwZWdcIiwgc2NhbGluZ0VmZm9ydCA9IG5ldyBxcS5Qcm9taXNlKCksIGltYWdlR2VuZXJhdG9yID0gbmV3IHFxLkltYWdlR2VuZXJhdG9yKGxvZyksIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgICAgICBsb2coXCJBdHRlbXB0aW5nIHRvIGdlbmVyYXRlIHNjYWxlZCB2ZXJzaW9uIGZvciBcIiArIHNvdXJjZUZpbGUubmFtZSk7XG4gICAgICAgICAgICBpbWFnZUdlbmVyYXRvci5nZW5lcmF0ZShzb3VyY2VGaWxlLCBjYW52YXMsIHtcbiAgICAgICAgICAgICAgICBtYXhTaXplOiBtYXhTaXplLFxuICAgICAgICAgICAgICAgIG9yaWVudDogb3JpZW50LFxuICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uOiBjdXN0b21SZXNpemVGdW5jdGlvblxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2NhbGVkSW1hZ2VEYXRhVXJpID0gY2FudmFzLnRvRGF0YVVSTCh0eXBlLCBxdWFsaXR5KSwgc2lnbmFsU3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJTdWNjZXNzIGdlbmVyYXRpbmcgc2NhbGVkIHZlcnNpb24gZm9yIFwiICsgc291cmNlRmlsZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2IgPSBxcS5kYXRhVXJpVG9CbG9iKHNjYWxlZEltYWdlRGF0YVVyaSk7XG4gICAgICAgICAgICAgICAgICAgIHNjYWxpbmdFZmZvcnQuc3VjY2VzcyhibG9iKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlRXhpZikge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9pbnNlcnRFeGlmSGVhZGVyKHNvdXJjZUZpbGUsIHNjYWxlZEltYWdlRGF0YVVyaSwgbG9nKS50aGVuKGZ1bmN0aW9uKHNjYWxlZEltYWdlRGF0YVVyaVdpdGhFeGlmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZWRJbWFnZURhdGFVcmkgPSBzY2FsZWRJbWFnZURhdGFVcmlXaXRoRXhpZjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbFN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJQcm9ibGVtIGluc2VydGluZyBFWElGIGhlYWRlciBpbnRvIHNjYWxlZCBpbWFnZS4gIFVzaW5nIHNjYWxlZCBpbWFnZSB3L291dCBFWElGIGRhdGEuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaWduYWxTdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ25hbFN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJGYWlsZWQgYXR0ZW1wdCB0byBnZW5lcmF0ZSBzY2FsZWQgdmVyc2lvbiBmb3IgXCIgKyBzb3VyY2VGaWxlLm5hbWUsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgc2NhbGluZ0VmZm9ydC5mYWlsdXJlKGZhaWxlZFRleHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gc2NhbGluZ0VmZm9ydDtcbiAgICAgICAgfSxcbiAgICAgICAgX2luc2VydEV4aWZIZWFkZXI6IGZ1bmN0aW9uKG9yaWdpbmFsSW1hZ2UsIHNjYWxlZEltYWdlRGF0YVVyaSwgbG9nKSB7XG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpLCBpbnNlcnRpb25FZmZvcnQgPSBuZXcgcXEuUHJvbWlzZSgpLCBvcmlnaW5hbEltYWdlRGF0YVVyaSA9IFwiXCI7XG4gICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgb3JpZ2luYWxJbWFnZURhdGFVcmkgPSByZWFkZXIucmVzdWx0O1xuICAgICAgICAgICAgICAgIGluc2VydGlvbkVmZm9ydC5zdWNjZXNzKHFxLkV4aWZSZXN0b3Jlci5yZXN0b3JlKG9yaWdpbmFsSW1hZ2VEYXRhVXJpLCBzY2FsZWRJbWFnZURhdGFVcmkpKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxvZyhcIlByb2JsZW0gcmVhZGluZyBcIiArIG9yaWdpbmFsSW1hZ2UubmFtZSArIFwiIGR1cmluZyBhdHRlbXB0IHRvIHRyYW5zZmVyIEVYSUYgZGF0YSB0byBzY2FsZWQgdmVyc2lvbi5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICBpbnNlcnRpb25FZmZvcnQuZmFpbHVyZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKG9yaWdpbmFsSW1hZ2UpO1xuICAgICAgICAgICAgcmV0dXJuIGluc2VydGlvbkVmZm9ydDtcbiAgICAgICAgfSxcbiAgICAgICAgX2RhdGFVcmlUb0Jsb2I6IGZ1bmN0aW9uKGRhdGFVcmkpIHtcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgdmFyIGJ5dGVTdHJpbmcsIG1pbWVTdHJpbmcsIGFycmF5QnVmZmVyLCBpbnRBcnJheTtcbiAgICAgICAgICAgIGlmIChkYXRhVXJpLnNwbGl0KFwiLFwiKVswXS5pbmRleE9mKFwiYmFzZTY0XCIpID49IDApIHtcbiAgICAgICAgICAgICAgICBieXRlU3RyaW5nID0gYXRvYihkYXRhVXJpLnNwbGl0KFwiLFwiKVsxXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ5dGVTdHJpbmcgPSBkZWNvZGVVUkkoZGF0YVVyaS5zcGxpdChcIixcIilbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbWltZVN0cmluZyA9IGRhdGFVcmkuc3BsaXQoXCIsXCIpWzBdLnNwbGl0KFwiOlwiKVsxXS5zcGxpdChcIjtcIilbMF07XG4gICAgICAgICAgICBhcnJheUJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihieXRlU3RyaW5nLmxlbmd0aCk7XG4gICAgICAgICAgICBpbnRBcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKTtcbiAgICAgICAgICAgIHFxLmVhY2goYnl0ZVN0cmluZywgZnVuY3Rpb24oaWR4LCBjaGFyYWN0ZXIpIHtcbiAgICAgICAgICAgICAgICBpbnRBcnJheVtpZHhdID0gY2hhcmFjdGVyLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVCbG9iKGFycmF5QnVmZmVyLCBtaW1lU3RyaW5nKTtcbiAgICAgICAgfSxcbiAgICAgICAgX2NyZWF0ZUJsb2I6IGZ1bmN0aW9uKGRhdGEsIG1pbWUpIHtcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgdmFyIEJsb2JCdWlsZGVyID0gd2luZG93LkJsb2JCdWlsZGVyIHx8IHdpbmRvdy5XZWJLaXRCbG9iQnVpbGRlciB8fCB3aW5kb3cuTW96QmxvYkJ1aWxkZXIgfHwgd2luZG93Lk1TQmxvYkJ1aWxkZXIsIGJsb2JCdWlsZGVyID0gQmxvYkJ1aWxkZXIgJiYgbmV3IEJsb2JCdWlsZGVyKCk7XG4gICAgICAgICAgICBpZiAoYmxvYkJ1aWxkZXIpIHtcbiAgICAgICAgICAgICAgICBibG9iQnVpbGRlci5hcHBlbmQoZGF0YSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJsb2JCdWlsZGVyLmdldEJsb2IobWltZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQmxvYihbIGRhdGEgXSwge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBtaW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBxcS5FeGlmUmVzdG9yZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIEV4aWZSZXN0b3JlciA9IHt9O1xuICAgICAgICBFeGlmUmVzdG9yZXIuS0VZX1NUUiA9IFwiQUJDREVGR0hJSktMTU5PUFwiICsgXCJRUlNUVVZXWFlaYWJjZGVmXCIgKyBcImdoaWprbG1ub3BxcnN0dXZcIiArIFwid3h5ejAxMjM0NTY3ODkrL1wiICsgXCI9XCI7XG4gICAgICAgIEV4aWZSZXN0b3Jlci5lbmNvZGU2NCA9IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgICAgICB2YXIgb3V0cHV0ID0gXCJcIiwgY2hyMSwgY2hyMiwgY2hyMyA9IFwiXCIsIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQgPSBcIlwiLCBpID0gMDtcbiAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICBjaHIxID0gaW5wdXRbaSsrXTtcbiAgICAgICAgICAgICAgICBjaHIyID0gaW5wdXRbaSsrXTtcbiAgICAgICAgICAgICAgICBjaHIzID0gaW5wdXRbaSsrXTtcbiAgICAgICAgICAgICAgICBlbmMxID0gY2hyMSA+PiAyO1xuICAgICAgICAgICAgICAgIGVuYzIgPSAoY2hyMSAmIDMpIDw8IDQgfCBjaHIyID4+IDQ7XG4gICAgICAgICAgICAgICAgZW5jMyA9IChjaHIyICYgMTUpIDw8IDIgfCBjaHIzID4+IDY7XG4gICAgICAgICAgICAgICAgZW5jNCA9IGNocjMgJiA2MztcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4oY2hyMikpIHtcbiAgICAgICAgICAgICAgICAgICAgZW5jMyA9IGVuYzQgPSA2NDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTmFOKGNocjMpKSB7XG4gICAgICAgICAgICAgICAgICAgIGVuYzQgPSA2NDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gb3V0cHV0ICsgdGhpcy5LRVlfU1RSLmNoYXJBdChlbmMxKSArIHRoaXMuS0VZX1NUUi5jaGFyQXQoZW5jMikgKyB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzMpICsgdGhpcy5LRVlfU1RSLmNoYXJBdChlbmM0KTtcbiAgICAgICAgICAgICAgICBjaHIxID0gY2hyMiA9IGNocjMgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGVuYzEgPSBlbmMyID0gZW5jMyA9IGVuYzQgPSBcIlwiO1xuICAgICAgICAgICAgfSB3aGlsZSAoaSA8IGlucHV0Lmxlbmd0aCk7XG4gICAgICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgICAgICB9O1xuICAgICAgICBFeGlmUmVzdG9yZXIucmVzdG9yZSA9IGZ1bmN0aW9uKG9yaWdGaWxlQmFzZTY0LCByZXNpemVkRmlsZUJhc2U2NCkge1xuICAgICAgICAgICAgdmFyIGV4cGVjdGVkQmFzZTY0SGVhZGVyID0gXCJkYXRhOmltYWdlL2pwZWc7YmFzZTY0LFwiO1xuICAgICAgICAgICAgaWYgKCFvcmlnRmlsZUJhc2U2NC5tYXRjaChleHBlY3RlZEJhc2U2NEhlYWRlcikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzaXplZEZpbGVCYXNlNjQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmF3SW1hZ2UgPSB0aGlzLmRlY29kZTY0KG9yaWdGaWxlQmFzZTY0LnJlcGxhY2UoZXhwZWN0ZWRCYXNlNjRIZWFkZXIsIFwiXCIpKTtcbiAgICAgICAgICAgIHZhciBzZWdtZW50cyA9IHRoaXMuc2xpY2UyU2VnbWVudHMocmF3SW1hZ2UpO1xuICAgICAgICAgICAgdmFyIGltYWdlID0gdGhpcy5leGlmTWFuaXB1bGF0aW9uKHJlc2l6ZWRGaWxlQmFzZTY0LCBzZWdtZW50cyk7XG4gICAgICAgICAgICByZXR1cm4gZXhwZWN0ZWRCYXNlNjRIZWFkZXIgKyB0aGlzLmVuY29kZTY0KGltYWdlKTtcbiAgICAgICAgfTtcbiAgICAgICAgRXhpZlJlc3RvcmVyLmV4aWZNYW5pcHVsYXRpb24gPSBmdW5jdGlvbihyZXNpemVkRmlsZUJhc2U2NCwgc2VnbWVudHMpIHtcbiAgICAgICAgICAgIHZhciBleGlmQXJyYXkgPSB0aGlzLmdldEV4aWZBcnJheShzZWdtZW50cyksIG5ld0ltYWdlQXJyYXkgPSB0aGlzLmluc2VydEV4aWYocmVzaXplZEZpbGVCYXNlNjQsIGV4aWZBcnJheSksIGFCdWZmZXIgPSBuZXcgVWludDhBcnJheShuZXdJbWFnZUFycmF5KTtcbiAgICAgICAgICAgIHJldHVybiBhQnVmZmVyO1xuICAgICAgICB9O1xuICAgICAgICBFeGlmUmVzdG9yZXIuZ2V0RXhpZkFycmF5ID0gZnVuY3Rpb24oc2VnbWVudHMpIHtcbiAgICAgICAgICAgIHZhciBzZWc7XG4gICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHNlZ21lbnRzLmxlbmd0aDsgeCsrKSB7XG4gICAgICAgICAgICAgICAgc2VnID0gc2VnbWVudHNbeF07XG4gICAgICAgICAgICAgICAgaWYgKHNlZ1swXSA9PSAyNTUgJiBzZWdbMV0gPT0gMjI1KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9O1xuICAgICAgICBFeGlmUmVzdG9yZXIuaW5zZXJ0RXhpZiA9IGZ1bmN0aW9uKHJlc2l6ZWRGaWxlQmFzZTY0LCBleGlmQXJyYXkpIHtcbiAgICAgICAgICAgIHZhciBpbWFnZURhdGEgPSByZXNpemVkRmlsZUJhc2U2NC5yZXBsYWNlKFwiZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCxcIiwgXCJcIiksIGJ1ZiA9IHRoaXMuZGVjb2RlNjQoaW1hZ2VEYXRhKSwgc2VwYXJhdGVQb2ludCA9IGJ1Zi5pbmRleE9mKDI1NSwgMyksIG1hZSA9IGJ1Zi5zbGljZSgwLCBzZXBhcmF0ZVBvaW50KSwgYXRvID0gYnVmLnNsaWNlKHNlcGFyYXRlUG9pbnQpLCBhcnJheSA9IG1hZTtcbiAgICAgICAgICAgIGFycmF5ID0gYXJyYXkuY29uY2F0KGV4aWZBcnJheSk7XG4gICAgICAgICAgICBhcnJheSA9IGFycmF5LmNvbmNhdChhdG8pO1xuICAgICAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgICAgICB9O1xuICAgICAgICBFeGlmUmVzdG9yZXIuc2xpY2UyU2VnbWVudHMgPSBmdW5jdGlvbihyYXdJbWFnZUFycmF5KSB7XG4gICAgICAgICAgICB2YXIgaGVhZCA9IDAsIHNlZ21lbnRzID0gW107XG4gICAgICAgICAgICB3aGlsZSAoMSkge1xuICAgICAgICAgICAgICAgIGlmIChyYXdJbWFnZUFycmF5W2hlYWRdID09IDI1NSAmIHJhd0ltYWdlQXJyYXlbaGVhZCArIDFdID09IDIxOCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJhd0ltYWdlQXJyYXlbaGVhZF0gPT0gMjU1ICYgcmF3SW1hZ2VBcnJheVtoZWFkICsgMV0gPT0gMjE2KSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWQgKz0gMjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoID0gcmF3SW1hZ2VBcnJheVtoZWFkICsgMl0gKiAyNTYgKyByYXdJbWFnZUFycmF5W2hlYWQgKyAzXSwgZW5kUG9pbnQgPSBoZWFkICsgbGVuZ3RoICsgMiwgc2VnID0gcmF3SW1hZ2VBcnJheS5zbGljZShoZWFkLCBlbmRQb2ludCk7XG4gICAgICAgICAgICAgICAgICAgIHNlZ21lbnRzLnB1c2goc2VnKTtcbiAgICAgICAgICAgICAgICAgICAgaGVhZCA9IGVuZFBvaW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaGVhZCA+IHJhd0ltYWdlQXJyYXkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzZWdtZW50cztcbiAgICAgICAgfTtcbiAgICAgICAgRXhpZlJlc3RvcmVyLmRlY29kZTY0ID0gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgICAgIHZhciBvdXRwdXQgPSBcIlwiLCBjaHIxLCBjaHIyLCBjaHIzID0gXCJcIiwgZW5jMSwgZW5jMiwgZW5jMywgZW5jNCA9IFwiXCIsIGkgPSAwLCBidWYgPSBbXTtcbiAgICAgICAgICAgIHZhciBiYXNlNjR0ZXN0ID0gL1teQS1aYS16MC05XFwrXFwvXFw9XS9nO1xuICAgICAgICAgICAgaWYgKGJhc2U2NHRlc3QuZXhlYyhpbnB1dCkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGVyZSB3ZXJlIGludmFsaWQgYmFzZTY0IGNoYXJhY3RlcnMgaW4gdGhlIGlucHV0IHRleHQuICBcIiArIFwiVmFsaWQgYmFzZTY0IGNoYXJhY3RlcnMgYXJlIEEtWiwgYS16LCAwLTksICcrJywgJy8nLGFuZCAnPSdcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbnB1dCA9IGlucHV0LnJlcGxhY2UoL1teQS1aYS16MC05XFwrXFwvXFw9XS9nLCBcIlwiKTtcbiAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICBlbmMxID0gdGhpcy5LRVlfU1RSLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpO1xuICAgICAgICAgICAgICAgIGVuYzIgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgICAgICAgICAgICAgZW5jMyA9IHRoaXMuS0VZX1NUUi5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICAgICAgICAgICAgICBlbmM0ID0gdGhpcy5LRVlfU1RSLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpO1xuICAgICAgICAgICAgICAgIGNocjEgPSBlbmMxIDw8IDIgfCBlbmMyID4+IDQ7XG4gICAgICAgICAgICAgICAgY2hyMiA9IChlbmMyICYgMTUpIDw8IDQgfCBlbmMzID4+IDI7XG4gICAgICAgICAgICAgICAgY2hyMyA9IChlbmMzICYgMykgPDwgNiB8IGVuYzQ7XG4gICAgICAgICAgICAgICAgYnVmLnB1c2goY2hyMSk7XG4gICAgICAgICAgICAgICAgaWYgKGVuYzMgIT0gNjQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVmLnB1c2goY2hyMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbmM0ICE9IDY0KSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1Zi5wdXNoKGNocjMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjaHIxID0gY2hyMiA9IGNocjMgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGVuYzEgPSBlbmMyID0gZW5jMyA9IGVuYzQgPSBcIlwiO1xuICAgICAgICAgICAgfSB3aGlsZSAoaSA8IGlucHV0Lmxlbmd0aCk7XG4gICAgICAgICAgICByZXR1cm4gYnVmO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gRXhpZlJlc3RvcmVyO1xuICAgIH0oKTtcbiAgICBxcS5Ub3RhbFByb2dyZXNzID0gZnVuY3Rpb24oY2FsbGJhY2ssIGdldFNpemUpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBwZXJGaWxlUHJvZ3Jlc3MgPSB7fSwgdG90YWxMb2FkZWQgPSAwLCB0b3RhbFNpemUgPSAwLCBsYXN0TG9hZGVkU2VudCA9IC0xLCBsYXN0VG90YWxTZW50ID0gLTEsIGNhbGxiYWNrUHJveHkgPSBmdW5jdGlvbihsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICBpZiAobG9hZGVkICE9PSBsYXN0TG9hZGVkU2VudCB8fCB0b3RhbCAhPT0gbGFzdFRvdGFsU2VudCkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGFzdExvYWRlZFNlbnQgPSBsb2FkZWQ7XG4gICAgICAgICAgICBsYXN0VG90YWxTZW50ID0gdG90YWw7XG4gICAgICAgIH0sIG5vUmV0cnlhYmxlRmlsZXMgPSBmdW5jdGlvbihmYWlsZWQsIHJldHJ5YWJsZSkge1xuICAgICAgICAgICAgdmFyIG5vbmUgPSB0cnVlO1xuICAgICAgICAgICAgcXEuZWFjaChmYWlsZWQsIGZ1bmN0aW9uKGlkeCwgZmFpbGVkSWQpIHtcbiAgICAgICAgICAgICAgICBpZiAocXEuaW5kZXhPZihyZXRyeWFibGUsIGZhaWxlZElkKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vbmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG5vbmU7XG4gICAgICAgIH0sIG9uQ2FuY2VsID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHVwZGF0ZVRvdGFsUHJvZ3Jlc3MoaWQsIC0xLCAtMSk7XG4gICAgICAgICAgICBkZWxldGUgcGVyRmlsZVByb2dyZXNzW2lkXTtcbiAgICAgICAgfSwgb25BbGxDb21wbGV0ZSA9IGZ1bmN0aW9uKHN1Y2Nlc3NmdWwsIGZhaWxlZCwgcmV0cnlhYmxlKSB7XG4gICAgICAgICAgICBpZiAoZmFpbGVkLmxlbmd0aCA9PT0gMCB8fCBub1JldHJ5YWJsZUZpbGVzKGZhaWxlZCwgcmV0cnlhYmxlKSkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrUHJveHkodG90YWxTaXplLCB0b3RhbFNpemUpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgb25OZXcgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdmFyIHNpemUgPSBnZXRTaXplKGlkKTtcbiAgICAgICAgICAgIGlmIChzaXplID4gMCkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVRvdGFsUHJvZ3Jlc3MoaWQsIDAsIHNpemUpO1xuICAgICAgICAgICAgICAgIHBlckZpbGVQcm9ncmVzc1tpZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRlZDogMCxcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IHNpemVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB1cGRhdGVUb3RhbFByb2dyZXNzID0gZnVuY3Rpb24oaWQsIG5ld0xvYWRlZCwgbmV3VG90YWwpIHtcbiAgICAgICAgICAgIHZhciBvbGRMb2FkZWQgPSBwZXJGaWxlUHJvZ3Jlc3NbaWRdID8gcGVyRmlsZVByb2dyZXNzW2lkXS5sb2FkZWQgOiAwLCBvbGRUb3RhbCA9IHBlckZpbGVQcm9ncmVzc1tpZF0gPyBwZXJGaWxlUHJvZ3Jlc3NbaWRdLnRvdGFsIDogMDtcbiAgICAgICAgICAgIGlmIChuZXdMb2FkZWQgPT09IC0xICYmIG5ld1RvdGFsID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHRvdGFsTG9hZGVkIC09IG9sZExvYWRlZDtcbiAgICAgICAgICAgICAgICB0b3RhbFNpemUgLT0gb2xkVG90YWw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChuZXdMb2FkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxMb2FkZWQgKz0gbmV3TG9hZGVkIC0gb2xkTG9hZGVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobmV3VG90YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxTaXplICs9IG5ld1RvdGFsIC0gb2xkVG90YWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2tQcm94eSh0b3RhbExvYWRlZCwgdG90YWxTaXplKTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIG9uQWxsQ29tcGxldGU6IG9uQWxsQ29tcGxldGUsXG4gICAgICAgICAgICBvblN0YXR1c0NoYW5nZTogZnVuY3Rpb24oaWQsIG9sZFN0YXR1cywgbmV3U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1N0YXR1cyA9PT0gcXEuc3RhdHVzLkNBTkNFTEVEIHx8IG5ld1N0YXR1cyA9PT0gcXEuc3RhdHVzLlJFSkVDVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1N0YXR1cyA9PT0gcXEuc3RhdHVzLlNVQk1JVFRJTkcpIHtcbiAgICAgICAgICAgICAgICAgICAgb25OZXcoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkluZGl2aWR1YWxQcm9ncmVzczogZnVuY3Rpb24oaWQsIGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVUb3RhbFByb2dyZXNzKGlkLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgICAgICBwZXJGaWxlUHJvZ3Jlc3NbaWRdID0ge1xuICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IGxvYWRlZCxcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRvdGFsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbk5ld1NpemU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgb25OZXcoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwZXJGaWxlUHJvZ3Jlc3MgPSB7fTtcbiAgICAgICAgICAgICAgICB0b3RhbExvYWRlZCA9IDA7XG4gICAgICAgICAgICAgICAgdG90YWxTaXplID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5QYXN0ZVN1cHBvcnQgPSBmdW5jdGlvbihvKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgb3B0aW9ucywgZGV0YWNoUGFzdGVIYW5kbGVyO1xuICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgICAgdGFyZ2V0RWxlbWVudDogbnVsbCxcbiAgICAgICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSwgbGV2ZWwpIHt9LFxuICAgICAgICAgICAgICAgIHBhc3RlUmVjZWl2ZWQ6IGZ1bmN0aW9uKGJsb2IpIHt9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGZ1bmN0aW9uIGlzSW1hZ2UoaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW0udHlwZSAmJiBpdGVtLnR5cGUuaW5kZXhPZihcImltYWdlL1wiKSA9PT0gMDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlclBhc3RlSGFuZGxlcigpIHtcbiAgICAgICAgICAgIGRldGFjaFBhc3RlSGFuZGxlciA9IHFxKG9wdGlvbnMudGFyZ2V0RWxlbWVudCkuYXR0YWNoKFwicGFzdGVcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2xpcGJvYXJkRGF0YSA9IGV2ZW50LmNsaXBib2FyZERhdGE7XG4gICAgICAgICAgICAgICAgaWYgKGNsaXBib2FyZERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChjbGlwYm9hcmREYXRhLml0ZW1zLCBmdW5jdGlvbihpZHgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0ltYWdlKGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2IgPSBpdGVtLmdldEFzRmlsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY2FsbGJhY2tzLnBhc3RlUmVjZWl2ZWQoYmxvYik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXJQYXN0ZUhhbmRsZXIoKSB7XG4gICAgICAgICAgICBpZiAoZGV0YWNoUGFzdGVIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgZGV0YWNoUGFzdGVIYW5kbGVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIG8pO1xuICAgICAgICByZWdpc3RlclBhc3RlSGFuZGxlcigpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJQYXN0ZUhhbmRsZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5Gb3JtU3VwcG9ydCA9IGZ1bmN0aW9uKG9wdGlvbnMsIHN0YXJ0VXBsb2FkLCBsb2cpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcywgaW50ZXJjZXB0U3VibWl0ID0gb3B0aW9ucy5pbnRlcmNlcHRTdWJtaXQsIGZvcm1FbCA9IG9wdGlvbnMuZWxlbWVudCwgYXV0b1VwbG9hZCA9IG9wdGlvbnMuYXV0b1VwbG9hZDtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIG5ld0VuZHBvaW50OiBudWxsLFxuICAgICAgICAgICAgbmV3QXV0b1VwbG9hZDogYXV0b1VwbG9hZCxcbiAgICAgICAgICAgIGF0dGFjaGVkVG9Gb3JtOiBmYWxzZSxcbiAgICAgICAgICAgIGdldEZvcm1JbnB1dHNBc09iamVjdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZvcm1FbCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZm9ybTJPYmooZm9ybUVsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGZ1bmN0aW9uIGRldGVybWluZU5ld0VuZHBvaW50KGZvcm1FbCkge1xuICAgICAgICAgICAgaWYgKGZvcm1FbC5nZXRBdHRyaWJ1dGUoXCJhY3Rpb25cIikpIHtcbiAgICAgICAgICAgICAgICBzZWxmLm5ld0VuZHBvaW50ID0gZm9ybUVsLmdldEF0dHJpYnV0ZShcImFjdGlvblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZUZvcm0oZm9ybUVsLCBuYXRpdmVTdWJtaXQpIHtcbiAgICAgICAgICAgIGlmIChmb3JtRWwuY2hlY2tWYWxpZGl0eSAmJiAhZm9ybUVsLmNoZWNrVmFsaWRpdHkoKSkge1xuICAgICAgICAgICAgICAgIGxvZyhcIkZvcm0gZGlkIG5vdCBwYXNzIHZhbGlkYXRpb24gY2hlY2tzIC0gd2lsbCBub3QgdXBsb2FkLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIG5hdGl2ZVN1Ym1pdCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBtYXliZVVwbG9hZE9uU3VibWl0KGZvcm1FbCkge1xuICAgICAgICAgICAgdmFyIG5hdGl2ZVN1Ym1pdCA9IGZvcm1FbC5zdWJtaXQ7XG4gICAgICAgICAgICBxcShmb3JtRWwpLmF0dGFjaChcInN1Ym1pdFwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50O1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5wcmV2ZW50RGVmYXVsdCkge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhbGlkYXRlRm9ybShmb3JtRWwsIG5hdGl2ZVN1Ym1pdCkgJiYgc3RhcnRVcGxvYWQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZm9ybUVsLnN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhbGlkYXRlRm9ybShmb3JtRWwsIG5hdGl2ZVN1Ym1pdCkgJiYgc3RhcnRVcGxvYWQoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZGV0ZXJtaW5lRm9ybUVsKGZvcm1FbCkge1xuICAgICAgICAgICAgaWYgKGZvcm1FbCkge1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc1N0cmluZyhmb3JtRWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1FbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZvcm1FbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChmb3JtRWwpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiQXR0YWNoaW5nIHRvIGZvcm0gZWxlbWVudC5cIik7XG4gICAgICAgICAgICAgICAgICAgIGRldGVybWluZU5ld0VuZHBvaW50KGZvcm1FbCk7XG4gICAgICAgICAgICAgICAgICAgIGludGVyY2VwdFN1Ym1pdCAmJiBtYXliZVVwbG9hZE9uU3VibWl0KGZvcm1FbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZvcm1FbDtcbiAgICAgICAgfVxuICAgICAgICBmb3JtRWwgPSBkZXRlcm1pbmVGb3JtRWwoZm9ybUVsKTtcbiAgICAgICAgdGhpcy5hdHRhY2hlZFRvRm9ybSA9ICEhZm9ybUVsO1xuICAgIH07XG4gICAgcXEuZXh0ZW5kKHFxLkZvcm1TdXBwb3J0LnByb3RvdHlwZSwge1xuICAgICAgICBfZm9ybTJPYmo6IGZ1bmN0aW9uKGZvcm0pIHtcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgdmFyIG9iaiA9IHt9LCBub3RJcnJlbGV2YW50VHlwZSA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgaXJyZWxldmFudFR5cGVzID0gWyBcImJ1dHRvblwiLCBcImltYWdlXCIsIFwicmVzZXRcIiwgXCJzdWJtaXRcIiBdO1xuICAgICAgICAgICAgICAgIHJldHVybiBxcS5pbmRleE9mKGlycmVsZXZhbnRUeXBlcywgdHlwZS50b0xvd2VyQ2FzZSgpKSA8IDA7XG4gICAgICAgICAgICB9LCByYWRpb09yQ2hlY2tib3ggPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxLmluZGV4T2YoWyBcImNoZWNrYm94XCIsIFwicmFkaW9cIiBdLCB0eXBlLnRvTG93ZXJDYXNlKCkpID49IDA7XG4gICAgICAgICAgICB9LCBpZ25vcmVWYWx1ZSA9IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJhZGlvT3JDaGVja2JveChlbC50eXBlKSAmJiAhZWwuY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsLmRpc2FibGVkICYmIGVsLnR5cGUudG9Mb3dlckNhc2UoKSAhPT0gXCJoaWRkZW5cIjtcbiAgICAgICAgICAgIH0sIHNlbGVjdFZhbHVlID0gZnVuY3Rpb24oc2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHFxKHNlbGVjdCkuY2hpbGRyZW4oKSwgZnVuY3Rpb24oaWR4LCBjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcIm9wdGlvblwiICYmIGNoaWxkLnNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoaWxkLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHFxLmVhY2goZm9ybS5lbGVtZW50cywgZnVuY3Rpb24oaWR4LCBlbCkge1xuICAgICAgICAgICAgICAgIGlmICgocXEuaXNJbnB1dChlbCwgdHJ1ZSkgfHwgZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInRleHRhcmVhXCIpICYmIG5vdElycmVsZXZhbnRUeXBlKGVsLnR5cGUpICYmICFpZ25vcmVWYWx1ZShlbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqW2VsLm5hbWVdID0gZWwudmFsdWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwic2VsZWN0XCIgJiYgIWlnbm9yZVZhbHVlKGVsKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBzZWxlY3RWYWx1ZShlbCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2VsLm5hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBxcS50cmFkaXRpb25hbCA9IHFxLnRyYWRpdGlvbmFsIHx8IHt9O1xuICAgIHFxLnRyYWRpdGlvbmFsLkZvcm1VcGxvYWRIYW5kbGVyID0gZnVuY3Rpb24ob3B0aW9ucywgcHJveHkpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBoYW5kbGVyID0gdGhpcywgZ2V0TmFtZSA9IHByb3h5LmdldE5hbWUsIGdldFV1aWQgPSBwcm94eS5nZXRVdWlkLCBsb2cgPSBwcm94eS5sb2c7XG4gICAgICAgIGZ1bmN0aW9uIGdldElmcmFtZUNvbnRlbnRKc29uKGlkLCBpZnJhbWUpIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZSwgZG9jLCBpbm5lckh0bWw7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGRvYyA9IGlmcmFtZS5jb250ZW50RG9jdW1lbnQgfHwgaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7XG4gICAgICAgICAgICAgICAgaW5uZXJIdG1sID0gZG9jLmJvZHkuaW5uZXJIVE1MO1xuICAgICAgICAgICAgICAgIGxvZyhcImNvbnZlcnRpbmcgaWZyYW1lJ3MgaW5uZXJIVE1MIHRvIEpTT05cIik7XG4gICAgICAgICAgICAgICAgbG9nKFwiaW5uZXJIVE1MID0gXCIgKyBpbm5lckh0bWwpO1xuICAgICAgICAgICAgICAgIGlmIChpbm5lckh0bWwgJiYgaW5uZXJIdG1sLm1hdGNoKC9ePHByZS9pKSkge1xuICAgICAgICAgICAgICAgICAgICBpbm5lckh0bWwgPSBkb2MuYm9keS5maXJzdENoaWxkLmZpcnN0Q2hpbGQubm9kZVZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGhhbmRsZXIuX3BhcnNlSnNvblJlc3BvbnNlKGlubmVySHRtbCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGxvZyhcIkVycm9yIHdoZW4gYXR0ZW1wdGluZyB0byBwYXJzZSBmb3JtIHVwbG9hZCByZXNwb25zZSAoXCIgKyBlcnJvci5tZXNzYWdlICsgXCIpXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVGb3JtKGlkLCBpZnJhbWUpIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBvcHRpb25zLnBhcmFtc1N0b3JlLmdldChpZCksIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kLnRvTG93ZXJDYXNlKCkgPT09IFwiZ2V0XCIgPyBcIkdFVFwiIDogXCJQT1NUXCIsIGVuZHBvaW50ID0gb3B0aW9ucy5lbmRwb2ludFN0b3JlLmdldChpZCksIG5hbWUgPSBnZXROYW1lKGlkKTtcbiAgICAgICAgICAgIHBhcmFtc1tvcHRpb25zLnV1aWROYW1lXSA9IGdldFV1aWQoaWQpO1xuICAgICAgICAgICAgcGFyYW1zW29wdGlvbnMuZmlsZW5hbWVQYXJhbV0gPSBuYW1lO1xuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuX2luaXRGb3JtRm9yVXBsb2FkKHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCxcbiAgICAgICAgICAgICAgICBlbmRwb2ludDogZW5kcG9pbnQsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgcGFyYW1zSW5Cb2R5OiBvcHRpb25zLnBhcmFtc0luQm9keSxcbiAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiBpZnJhbWUubmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGxvYWRGaWxlID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IGhhbmRsZXIuZ2V0SW5wdXQoaWQpLCBpZnJhbWUgPSBoYW5kbGVyLl9jcmVhdGVJZnJhbWUoaWQpLCBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKSwgZm9ybTtcbiAgICAgICAgICAgIGZvcm0gPSBjcmVhdGVGb3JtKGlkLCBpZnJhbWUpO1xuICAgICAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChpbnB1dCk7XG4gICAgICAgICAgICBoYW5kbGVyLl9hdHRhY2hMb2FkRXZlbnQoaWZyYW1lLCBmdW5jdGlvbihyZXNwb25zZUZyb21NZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiaWZyYW1lIGxvYWRlZFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSByZXNwb25zZUZyb21NZXNzYWdlID8gcmVzcG9uc2VGcm9tTWVzc2FnZSA6IGdldElmcmFtZUNvbnRlbnRKc29uKGlkLCBpZnJhbWUpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX2RldGFjaExvYWRFdmVudChpZCk7XG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmNvcnMuZXhwZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoaWZyYW1lKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLmZhaWx1cmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbG9nKFwiU2VuZGluZyB1cGxvYWQgcmVxdWVzdCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICBmb3JtLnN1Ym1pdCgpO1xuICAgICAgICAgICAgcXEoZm9ybSkucmVtb3ZlKCk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5Gb3JtVXBsb2FkSGFuZGxlcih7XG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgaXNDb3JzOiBvcHRpb25zLmNvcnMuZXhwZWN0ZWQsXG4gICAgICAgICAgICAgICAgaW5wdXROYW1lOiBvcHRpb25zLmlucHV0TmFtZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHByb3h5OiB7XG4gICAgICAgICAgICAgICAgb25DYW5jZWw6IG9wdGlvbnMub25DYW5jZWwsXG4gICAgICAgICAgICAgICAgZ2V0TmFtZTogZ2V0TmFtZSxcbiAgICAgICAgICAgICAgICBnZXRVdWlkOiBnZXRVdWlkLFxuICAgICAgICAgICAgICAgIGxvZzogbG9nXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9O1xuICAgIHFxLnRyYWRpdGlvbmFsID0gcXEudHJhZGl0aW9uYWwgfHwge307XG4gICAgcXEudHJhZGl0aW9uYWwuWGhyVXBsb2FkSGFuZGxlciA9IGZ1bmN0aW9uKHNwZWMsIHByb3h5KSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgaGFuZGxlciA9IHRoaXMsIGdldE5hbWUgPSBwcm94eS5nZXROYW1lLCBnZXRTaXplID0gcHJveHkuZ2V0U2l6ZSwgZ2V0VXVpZCA9IHByb3h5LmdldFV1aWQsIGxvZyA9IHByb3h5LmxvZywgbXVsdGlwYXJ0ID0gc3BlYy5mb3JjZU11bHRpcGFydCB8fCBzcGVjLnBhcmFtc0luQm9keSwgYWRkQ2h1bmtpbmdTcGVjaWZpY1BhcmFtcyA9IGZ1bmN0aW9uKGlkLCBwYXJhbXMsIGNodW5rRGF0YSkge1xuICAgICAgICAgICAgdmFyIHNpemUgPSBnZXRTaXplKGlkKSwgbmFtZSA9IGdldE5hbWUoaWQpO1xuICAgICAgICAgICAgaWYgKCFzcGVjLm9taXREZWZhdWx0UGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMuY2h1bmtpbmcucGFyYW1OYW1lcy5wYXJ0SW5kZXhdID0gY2h1bmtEYXRhLnBhcnQ7XG4gICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMuY2h1bmtpbmcucGFyYW1OYW1lcy5wYXJ0Qnl0ZU9mZnNldF0gPSBjaHVua0RhdGEuc3RhcnQ7XG4gICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMuY2h1bmtpbmcucGFyYW1OYW1lcy5jaHVua1NpemVdID0gY2h1bmtEYXRhLnNpemU7XG4gICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMuY2h1bmtpbmcucGFyYW1OYW1lcy50b3RhbFBhcnRzXSA9IGNodW5rRGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy50b3RhbEZpbGVTaXplTmFtZV0gPSBzaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG11bHRpcGFydCAmJiAhc3BlYy5vbWl0RGVmYXVsdFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLmZpbGVuYW1lUGFyYW1dID0gbmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYWxsQ2h1bmtzRG9uZVJlcXVlc3RlciA9IG5ldyBxcS50cmFkaXRpb25hbC5BbGxDaHVua3NEb25lQWpheFJlcXVlc3Rlcih7XG4gICAgICAgICAgICBjb3JzOiBzcGVjLmNvcnMsXG4gICAgICAgICAgICBlbmRwb2ludDogc3BlYy5jaHVua2luZy5zdWNjZXNzLmVuZHBvaW50LFxuICAgICAgICAgICAgaGVhZGVyczogc3BlYy5jaHVua2luZy5zdWNjZXNzLmhlYWRlcnMsXG4gICAgICAgICAgICBqc29uUGF5bG9hZDogc3BlYy5jaHVua2luZy5zdWNjZXNzLmpzb25QYXlsb2FkLFxuICAgICAgICAgICAgbG9nOiBsb2csXG4gICAgICAgICAgICBtZXRob2Q6IHNwZWMuY2h1bmtpbmcuc3VjY2Vzcy5tZXRob2QsXG4gICAgICAgICAgICBwYXJhbXM6IHNwZWMuY2h1bmtpbmcuc3VjY2Vzcy5wYXJhbXNcbiAgICAgICAgfSksIGNyZWF0ZVJlYWR5U3RhdGVDaGFuZ2VkSGFuZGxlciA9IGZ1bmN0aW9uKGlkLCB4aHIpIHtcbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG9uVXBsb2FkT3JDaHVua0NvbXBsZXRlKGlkLCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhyZXN1bHQucmVzcG9uc2UsIHhocik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlLmZhaWx1cmUocmVzdWx0LnJlc3BvbnNlLCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9LCBnZXRDaHVua3NDb21wbGV0ZVBhcmFtcyA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gc3BlYy5wYXJhbXNTdG9yZS5nZXQoaWQpLCBuYW1lID0gZ2V0TmFtZShpZCksIHNpemUgPSBnZXRTaXplKGlkKTtcbiAgICAgICAgICAgIHBhcmFtc1tzcGVjLnV1aWROYW1lXSA9IGdldFV1aWQoaWQpO1xuICAgICAgICAgICAgcGFyYW1zW3NwZWMuZmlsZW5hbWVQYXJhbV0gPSBuYW1lO1xuICAgICAgICAgICAgcGFyYW1zW3NwZWMudG90YWxGaWxlU2l6ZU5hbWVdID0gc2l6ZTtcbiAgICAgICAgICAgIHBhcmFtc1tzcGVjLmNodW5raW5nLnBhcmFtTmFtZXMudG90YWxQYXJ0c10gPSBoYW5kbGVyLl9nZXRUb3RhbENodW5rcyhpZCk7XG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9LCBpc0Vycm9yVXBsb2FkUmVzcG9uc2UgPSBmdW5jdGlvbih4aHIsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW5kZXhPZihbIDIwMCwgMjAxLCAyMDIsIDIwMywgMjA0IF0sIHhoci5zdGF0dXMpIDwgMCB8fCBzcGVjLnJlcXVpcmVTdWNjZXNzSnNvbiAmJiAhcmVzcG9uc2Uuc3VjY2VzcyB8fCByZXNwb25zZS5yZXNldDtcbiAgICAgICAgfSwgb25VcGxvYWRPckNodW5rQ29tcGxldGUgPSBmdW5jdGlvbihpZCwgeGhyKSB7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2U7XG4gICAgICAgICAgICBsb2coXCJ4aHIgLSBzZXJ2ZXIgcmVzcG9uc2UgcmVjZWl2ZWQgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgbG9nKFwicmVzcG9uc2VUZXh0ID0gXCIgKyB4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gcGFyc2VSZXNwb25zZSh0cnVlLCB4aHIpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAhaXNFcnJvclVwbG9hZFJlc3BvbnNlKHhociwgcmVzcG9uc2UpLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlOiByZXNwb25zZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSwgcGFyc2VSZXNwb25zZSA9IGZ1bmN0aW9uKHVwbG9hZCwgeGhyKSB7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB7fTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIlJlY2VpdmVkIHJlc3BvbnNlIHN0YXR1cyB7fSB3aXRoIGJvZHk6IHt9XCIsIHhoci5zdGF0dXMsIHhoci5yZXNwb25zZVRleHQpKTtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHFxLnBhcnNlSnNvbih4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdXBsb2FkICYmIHNwZWMucmVxdWlyZVN1Y2Nlc3NKc29uICYmIGxvZyhcIkVycm9yIHdoZW4gYXR0ZW1wdGluZyB0byBwYXJzZSB4aHIgcmVzcG9uc2UgdGV4dCAoXCIgKyBlcnJvci5tZXNzYWdlICsgXCIpXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0sIHNlbmRDaHVua3NDb21wbGV0ZVJlcXVlc3QgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgYWxsQ2h1bmtzRG9uZVJlcXVlc3Rlci5jb21wbGV0ZShpZCwgaGFuZGxlci5fY3JlYXRlWGhyKGlkKSwgZ2V0Q2h1bmtzQ29tcGxldGVQYXJhbXMoaWQpLCBzcGVjLmN1c3RvbUhlYWRlcnMuZ2V0KGlkKSkudGhlbihmdW5jdGlvbih4aHIpIHtcbiAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MocGFyc2VSZXNwb25zZShmYWxzZSwgeGhyKSwgeGhyKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHhocikge1xuICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbHVyZShwYXJzZVJlc3BvbnNlKGZhbHNlLCB4aHIpLCB4aHIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfSwgc2V0UGFyYW1zQW5kR2V0RW50aXR5VG9TZW5kID0gZnVuY3Rpb24oZW50aXR5VG9TZW5kUGFyYW1zKSB7XG4gICAgICAgICAgICB2YXIgZmlsZU9yQmxvYiA9IGVudGl0eVRvU2VuZFBhcmFtcy5maWxlT3JCbG9iO1xuICAgICAgICAgICAgdmFyIGlkID0gZW50aXR5VG9TZW5kUGFyYW1zLmlkO1xuICAgICAgICAgICAgdmFyIHhociA9IGVudGl0eVRvU2VuZFBhcmFtcy54aHI7XG4gICAgICAgICAgICB2YXIgeGhyT3ZlcnJpZGVzID0gZW50aXR5VG9TZW5kUGFyYW1zLnhock92ZXJyaWRlcyB8fCB7fTtcbiAgICAgICAgICAgIHZhciBjdXN0b21QYXJhbXMgPSBlbnRpdHlUb1NlbmRQYXJhbXMuY3VzdG9tUGFyYW1zIHx8IHt9O1xuICAgICAgICAgICAgdmFyIGRlZmF1bHRQYXJhbXMgPSBlbnRpdHlUb1NlbmRQYXJhbXMucGFyYW1zIHx8IHt9O1xuICAgICAgICAgICAgdmFyIHhock92ZXJyaWRlUGFyYW1zID0geGhyT3ZlcnJpZGVzLnBhcmFtcyB8fCB7fTtcbiAgICAgICAgICAgIHZhciBwYXJhbXM7XG4gICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBtdWx0aXBhcnQgPyBuZXcgRm9ybURhdGEoKSA6IG51bGwsIG1ldGhvZCA9IHhock92ZXJyaWRlcy5tZXRob2QgfHwgc3BlYy5tZXRob2QsIGVuZHBvaW50ID0geGhyT3ZlcnJpZGVzLmVuZHBvaW50IHx8IHNwZWMuZW5kcG9pbnRTdG9yZS5nZXQoaWQpLCBuYW1lID0gZ2V0TmFtZShpZCksIHNpemUgPSBnZXRTaXplKGlkKTtcbiAgICAgICAgICAgIGlmIChzcGVjLm9taXREZWZhdWx0UGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcXEuZXh0ZW5kKHt9LCBjdXN0b21QYXJhbXMpO1xuICAgICAgICAgICAgICAgIHFxLmV4dGVuZChwYXJhbXMsIHhock92ZXJyaWRlUGFyYW1zKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcXEuZXh0ZW5kKHt9LCBjdXN0b21QYXJhbXMpO1xuICAgICAgICAgICAgICAgIHFxLmV4dGVuZChwYXJhbXMsIHhock92ZXJyaWRlUGFyYW1zKTtcbiAgICAgICAgICAgICAgICBxcS5leHRlbmQocGFyYW1zLCBkZWZhdWx0UGFyYW1zKTtcbiAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy51dWlkTmFtZV0gPSBnZXRVdWlkKGlkKTtcbiAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy5maWxlbmFtZVBhcmFtXSA9IG5hbWU7XG4gICAgICAgICAgICAgICAgaWYgKG11bHRpcGFydCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy50b3RhbEZpbGVTaXplTmFtZV0gPSBzaXplO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXNwZWMucGFyYW1zSW5Cb2R5KSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLmlucHV0TmFtZV0gPSBuYW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghc3BlYy5wYXJhbXNJbkJvZHkpIHtcbiAgICAgICAgICAgICAgICBlbmRwb2ludCA9IHFxLm9iajJ1cmwocGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB4aHIub3BlbihtZXRob2QsIGVuZHBvaW50LCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChzcGVjLmNvcnMuZXhwZWN0ZWQgJiYgc3BlYy5jb3JzLnNlbmRDcmVkZW50aWFscykge1xuICAgICAgICAgICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG11bHRpcGFydCkge1xuICAgICAgICAgICAgICAgIGlmIChzcGVjLnBhcmFtc0luQm9keSkge1xuICAgICAgICAgICAgICAgICAgICBxcS5vYmoyRm9ybURhdGEocGFyYW1zLCBmb3JtRGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChzcGVjLmlucHV0TmFtZSwgZmlsZU9yQmxvYik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1EYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZpbGVPckJsb2I7XG4gICAgICAgIH0sIHNldFVwbG9hZEhlYWRlcnMgPSBmdW5jdGlvbihoZWFkZXJzT3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIGhlYWRlck92ZXJyaWRlcyA9IGhlYWRlcnNPcHRpb25zLmhlYWRlck92ZXJyaWRlcztcbiAgICAgICAgICAgIHZhciBpZCA9IGhlYWRlcnNPcHRpb25zLmlkO1xuICAgICAgICAgICAgdmFyIHhociA9IGhlYWRlcnNPcHRpb25zLnhocjtcbiAgICAgICAgICAgIGlmIChoZWFkZXJPdmVycmlkZXMpIHtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGhlYWRlck92ZXJyaWRlcywgZnVuY3Rpb24oaGVhZGVyTmFtZSwgaGVhZGVyVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyTmFtZSwgaGVhZGVyVmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgZXh0cmFIZWFkZXJzID0gc3BlYy5jdXN0b21IZWFkZXJzLmdldChpZCksIGZpbGVPckJsb2IgPSBoYW5kbGVyLmdldEZpbGUoaWQpO1xuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQWNjZXB0XCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlgtUmVxdWVzdGVkLVdpdGhcIiwgXCJYTUxIdHRwUmVxdWVzdFwiKTtcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNhY2hlLUNvbnRyb2xcIiwgXCJuby1jYWNoZVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIW11bHRpcGFydCkge1xuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiKTtcbiAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJYLU1pbWUtVHlwZVwiLCBmaWxlT3JCbG9iLnR5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxcS5lYWNoKGV4dHJhSGVhZGVycywgZnVuY3Rpb24obmFtZSwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKG5hbWUsIHZhbCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICB1cGxvYWRDaHVuazogZnVuY3Rpb24odXBsb2FkQ2h1bmtQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSB1cGxvYWRDaHVua1BhcmFtcy5pZDtcbiAgICAgICAgICAgICAgICB2YXIgY2h1bmtJZHggPSB1cGxvYWRDaHVua1BhcmFtcy5jaHVua0lkeDtcbiAgICAgICAgICAgICAgICB2YXIgb3ZlcnJpZGVzID0gdXBsb2FkQ2h1bmtQYXJhbXMub3ZlcnJpZGVzIHx8IHt9O1xuICAgICAgICAgICAgICAgIHZhciByZXN1bWluZyA9IHVwbG9hZENodW5rUGFyYW1zLnJlc3VtaW5nO1xuICAgICAgICAgICAgICAgIHZhciBjaHVua0RhdGEgPSBoYW5kbGVyLl9nZXRDaHVua0RhdGEoaWQsIGNodW5rSWR4KSwgeGhyID0gaGFuZGxlci5fY3JlYXRlWGhyKGlkLCBjaHVua0lkeCksIHByb21pc2UsIHRvU2VuZCwgY3VzdG9tUGFyYW1zLCBwYXJhbXMgPSB7fTtcbiAgICAgICAgICAgICAgICBwcm9taXNlID0gY3JlYXRlUmVhZHlTdGF0ZUNoYW5nZWRIYW5kbGVyKGlkLCB4aHIpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX3JlZ2lzdGVyUHJvZ3Jlc3NIYW5kbGVyKGlkLCBjaHVua0lkeCwgY2h1bmtEYXRhLnNpemUpO1xuICAgICAgICAgICAgICAgIGN1c3RvbVBhcmFtcyA9IHNwZWMucGFyYW1zU3RvcmUuZ2V0KGlkKTtcbiAgICAgICAgICAgICAgICBhZGRDaHVua2luZ1NwZWNpZmljUGFyYW1zKGlkLCBwYXJhbXMsIGNodW5rRGF0YSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VtaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLnJlc3VtZS5wYXJhbU5hbWVzLnJlc3VtaW5nXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRvU2VuZCA9IHNldFBhcmFtc0FuZEdldEVudGl0eVRvU2VuZCh7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVPckJsb2I6IGNodW5rRGF0YS5ibG9iLFxuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbVBhcmFtczogY3VzdG9tUGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgeGhyOiB4aHIsXG4gICAgICAgICAgICAgICAgICAgIHhock92ZXJyaWRlczogb3ZlcnJpZGVzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2V0VXBsb2FkSGVhZGVycyh7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlck92ZXJyaWRlczogb3ZlcnJpZGVzLmhlYWRlcnMsXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgeGhyOiB4aHJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB4aHIuc2VuZCh0b1NlbmQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwbG9hZEZpbGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVPckJsb2IgPSBoYW5kbGVyLmdldEZpbGUoaWQpLCBwcm9taXNlLCB4aHIsIGN1c3RvbVBhcmFtcywgdG9TZW5kO1xuICAgICAgICAgICAgICAgIHhociA9IGhhbmRsZXIuX2NyZWF0ZVhocihpZCk7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fcmVnaXN0ZXJQcm9ncmVzc0hhbmRsZXIoaWQpO1xuICAgICAgICAgICAgICAgIHByb21pc2UgPSBjcmVhdGVSZWFkeVN0YXRlQ2hhbmdlZEhhbmRsZXIoaWQsIHhocik7XG4gICAgICAgICAgICAgICAgY3VzdG9tUGFyYW1zID0gc3BlYy5wYXJhbXNTdG9yZS5nZXQoaWQpO1xuICAgICAgICAgICAgICAgIHRvU2VuZCA9IHNldFBhcmFtc0FuZEdldEVudGl0eVRvU2VuZCh7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVPckJsb2I6IGZpbGVPckJsb2IsXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tUGFyYW1zOiBjdXN0b21QYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIHhocjogeGhyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2V0VXBsb2FkSGVhZGVycyh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgeGhyOiB4aHJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB4aHIuc2VuZCh0b1NlbmQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5YaHJVcGxvYWRIYW5kbGVyKHtcbiAgICAgICAgICAgIG9wdGlvbnM6IHFxLmV4dGVuZCh7XG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlOiBcInRyYWRpdGlvbmFsXCJcbiAgICAgICAgICAgIH0sIHNwZWMpLFxuICAgICAgICAgICAgcHJveHk6IHFxLmV4dGVuZCh7XG4gICAgICAgICAgICAgICAgZ2V0RW5kcG9pbnQ6IHNwZWMuZW5kcG9pbnRTdG9yZS5nZXRcbiAgICAgICAgICAgIH0sIHByb3h5KVxuICAgICAgICB9KSk7XG4gICAgICAgIHFxLm92ZXJyaWRlKHRoaXMsIGZ1bmN0aW9uKHN1cGVyXykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmaW5hbGl6ZUNodW5rczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJveHkub25GaW5hbGl6aW5nKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWMuY2h1bmtpbmcuc3VjY2Vzcy5lbmRwb2ludCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbmRDaHVua3NDb21wbGV0ZVJlcXVlc3QoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyXy5maW5hbGl6ZUNodW5rcyhpZCwgcXEuYmluZChwYXJzZVJlc3BvbnNlLCB0aGlzLCB0cnVlKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLnRyYWRpdGlvbmFsLkFsbENodW5rc0RvbmVBamF4UmVxdWVzdGVyID0gZnVuY3Rpb24obykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHJlcXVlc3Rlciwgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGNvcnM6IHtcbiAgICAgICAgICAgICAgICBhbGxvd1hkcjogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXhwZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNlbmRDcmVkZW50aWFsczogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbmRwb2ludDogbnVsbCxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24oc3RyLCBsZXZlbCkge30sXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiXG4gICAgICAgIH0sIHByb21pc2VzID0ge30sIGVuZHBvaW50SGFuZGxlciA9IHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNGdW5jdGlvbihvcHRpb25zLmVuZHBvaW50KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5lbmRwb2ludChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmVuZHBvaW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgbyk7XG4gICAgICAgIHJlcXVlc3RlciA9IHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuQWpheFJlcXVlc3Rlcih7XG4gICAgICAgICAgICBhY2NlcHRIZWFkZXI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgY29udGVudFR5cGU6IG9wdGlvbnMuanNvblBheWxvYWQgPyBcImFwcGxpY2F0aW9uL2pzb25cIiA6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsXG4gICAgICAgICAgICB2YWxpZE1ldGhvZHM6IFsgb3B0aW9ucy5tZXRob2QgXSxcbiAgICAgICAgICAgIG1ldGhvZDogb3B0aW9ucy5tZXRob2QsXG4gICAgICAgICAgICBlbmRwb2ludFN0b3JlOiBlbmRwb2ludEhhbmRsZXIsXG4gICAgICAgICAgICBhbGxvd1hSZXF1ZXN0ZWRXaXRoQW5kQ2FjaGVDb250cm9sOiBmYWxzZSxcbiAgICAgICAgICAgIGNvcnM6IG9wdGlvbnMuY29ycyxcbiAgICAgICAgICAgIGxvZzogb3B0aW9ucy5sb2csXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbihpZCwgeGhyLCBpc0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBwcm9taXNlc1tpZF07XG4gICAgICAgICAgICAgICAgZGVsZXRlIHByb21pc2VzW2lkXTtcbiAgICAgICAgICAgICAgICBpZiAoaXNFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLmZhaWx1cmUoeGhyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MoeGhyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihpZCwgeGhyLCBwYXJhbXMsIGhlYWRlcnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5sb2coXCJTdWJtaXR0aW5nIEFsbCBDaHVua3MgRG9uZSByZXF1ZXN0IGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICBwcm9taXNlc1tpZF0gPSBwcm9taXNlO1xuICAgICAgICAgICAgICAgIHJlcXVlc3Rlci5pbml0VHJhbnNwb3J0KGlkKS53aXRoUGFyYW1zKG9wdGlvbnMucGFyYW1zKGlkKSB8fCBwYXJhbXMpLndpdGhIZWFkZXJzKG9wdGlvbnMuaGVhZGVycyhpZCkgfHwgaGVhZGVycykuc2VuZCh4aHIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLkRyYWdBbmREcm9wID0gZnVuY3Rpb24obykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIG9wdGlvbnMsIEhJREVfWk9ORVNfRVZFTlRfTkFNRSA9IFwicXEtaGlkZXpvbmVzXCIsIEhJREVfQkVGT1JFX0VOVEVSX0FUVFIgPSBcInFxLWhpZGUtZHJvcHpvbmVcIiwgdXBsb2FkRHJvcFpvbmVzID0gW10sIGRyb3BwZWRGaWxlcyA9IFtdLCBkaXNwb3NlU3VwcG9ydCA9IG5ldyBxcS5EaXNwb3NlU3VwcG9ydCgpO1xuICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgICAgZHJvcFpvbmVFbGVtZW50czogW10sXG4gICAgICAgICAgICBhbGxvd011bHRpcGxlSXRlbXM6IHRydWUsXG4gICAgICAgICAgICBjbGFzc2VzOiB7XG4gICAgICAgICAgICAgICAgZHJvcEFjdGl2ZTogbnVsbFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbGxiYWNrczogbmV3IHFxLkRyYWdBbmREcm9wLmNhbGxiYWNrcygpXG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBvLCB0cnVlKTtcbiAgICAgICAgZnVuY3Rpb24gdXBsb2FkRHJvcHBlZEZpbGVzKGZpbGVzLCB1cGxvYWREcm9wWm9uZSkge1xuICAgICAgICAgICAgdmFyIGZpbGVzQXNBcnJheSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZpbGVzKTtcbiAgICAgICAgICAgIG9wdGlvbnMuY2FsbGJhY2tzLmRyb3BMb2coXCJHcmFiYmVkIFwiICsgZmlsZXMubGVuZ3RoICsgXCIgZHJvcHBlZCBmaWxlcy5cIik7XG4gICAgICAgICAgICB1cGxvYWREcm9wWm9uZS5kcm9wRGlzYWJsZWQoZmFsc2UpO1xuICAgICAgICAgICAgb3B0aW9ucy5jYWxsYmFja3MucHJvY2Vzc2luZ0Ryb3BwZWRGaWxlc0NvbXBsZXRlKGZpbGVzQXNBcnJheSwgdXBsb2FkRHJvcFpvbmUuZ2V0RWxlbWVudCgpKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiB0cmF2ZXJzZUZpbGVUcmVlKGVudHJ5KSB7XG4gICAgICAgICAgICB2YXIgcGFyc2VFbnRyeVByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgaWYgKGVudHJ5LmlzRmlsZSkge1xuICAgICAgICAgICAgICAgIGVudHJ5LmZpbGUoZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlLnFxUGF0aCA9IGV4dHJhY3REaXJlY3RvcnlQYXRoKGVudHJ5KTtcbiAgICAgICAgICAgICAgICAgICAgZHJvcHBlZEZpbGVzLnB1c2goZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlRW50cnlQcm9taXNlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihmaWxlRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jYWxsYmFja3MuZHJvcExvZyhcIlByb2JsZW0gcGFyc2luZyAnXCIgKyBlbnRyeS5mdWxsUGF0aCArIFwiJy4gIEZpbGVFcnJvciBjb2RlIFwiICsgZmlsZUVycm9yLmNvZGUgKyBcIi5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbnRyeVByb21pc2UuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbnRyeS5pc0RpcmVjdG9yeSkge1xuICAgICAgICAgICAgICAgIGdldEZpbGVzSW5EaXJlY3RvcnkoZW50cnkpLnRoZW4oZnVuY3Rpb24gYWxsRW50cmllc1JlYWQoZW50cmllcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW50cmllc0xlZnQgPSBlbnRyaWVzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChlbnRyaWVzLCBmdW5jdGlvbihpZHgsIGVudHJ5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmF2ZXJzZUZpbGVUcmVlKGVudHJ5KS5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXNMZWZ0IC09IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJpZXNMZWZ0ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRW50cnlQcm9taXNlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZW50cmllcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRW50cnlQcm9taXNlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIHJlYWRGYWlsdXJlKGZpbGVFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrcy5kcm9wTG9nKFwiUHJvYmxlbSBwYXJzaW5nICdcIiArIGVudHJ5LmZ1bGxQYXRoICsgXCInLiAgRmlsZUVycm9yIGNvZGUgXCIgKyBmaWxlRXJyb3IuY29kZSArIFwiLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICBwYXJzZUVudHJ5UHJvbWlzZS5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VFbnRyeVByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZXh0cmFjdERpcmVjdG9yeVBhdGgoZW50cnkpIHtcbiAgICAgICAgICAgIHZhciBuYW1lID0gZW50cnkubmFtZSwgZnVsbFBhdGggPSBlbnRyeS5mdWxsUGF0aCwgaW5kZXhPZk5hbWVJbkZ1bGxQYXRoID0gZnVsbFBhdGgubGFzdEluZGV4T2YobmFtZSk7XG4gICAgICAgICAgICBmdWxsUGF0aCA9IGZ1bGxQYXRoLnN1YnN0cigwLCBpbmRleE9mTmFtZUluRnVsbFBhdGgpO1xuICAgICAgICAgICAgaWYgKGZ1bGxQYXRoLmNoYXJBdCgwKSA9PT0gXCIvXCIpIHtcbiAgICAgICAgICAgICAgICBmdWxsUGF0aCA9IGZ1bGxQYXRoLnN1YnN0cigxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmdWxsUGF0aDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRGaWxlc0luRGlyZWN0b3J5KGVudHJ5LCByZWFkZXIsIGFjY3VtRW50cmllcywgZXhpc3RpbmdQcm9taXNlKSB7XG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IGV4aXN0aW5nUHJvbWlzZSB8fCBuZXcgcXEuUHJvbWlzZSgpLCBkaXJSZWFkZXIgPSByZWFkZXIgfHwgZW50cnkuY3JlYXRlUmVhZGVyKCk7XG4gICAgICAgICAgICBkaXJSZWFkZXIucmVhZEVudHJpZXMoZnVuY3Rpb24gcmVhZFN1Y2Nlc3MoZW50cmllcykge1xuICAgICAgICAgICAgICAgIHZhciBuZXdFbnRyaWVzID0gYWNjdW1FbnRyaWVzID8gYWNjdW1FbnRyaWVzLmNvbmNhdChlbnRyaWVzKSA6IGVudHJpZXM7XG4gICAgICAgICAgICAgICAgaWYgKGVudHJpZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRGaWxlc0luRGlyZWN0b3J5KGVudHJ5LCBkaXJSZWFkZXIsIG5ld0VudHJpZXMsIHByb21pc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MobmV3RW50cmllcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgcHJvbWlzZS5mYWlsdXJlKTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZURhdGFUcmFuc2ZlcihkYXRhVHJhbnNmZXIsIHVwbG9hZERyb3Bab25lKSB7XG4gICAgICAgICAgICB2YXIgcGVuZGluZ0ZvbGRlclByb21pc2VzID0gW10sIGhhbmRsZURhdGFUcmFuc2ZlclByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgb3B0aW9ucy5jYWxsYmFja3MucHJvY2Vzc2luZ0Ryb3BwZWRGaWxlcygpO1xuICAgICAgICAgICAgdXBsb2FkRHJvcFpvbmUuZHJvcERpc2FibGVkKHRydWUpO1xuICAgICAgICAgICAgaWYgKGRhdGFUcmFuc2Zlci5maWxlcy5sZW5ndGggPiAxICYmICFvcHRpb25zLmFsbG93TXVsdGlwbGVJdGVtcykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuY2FsbGJhY2tzLnByb2Nlc3NpbmdEcm9wcGVkRmlsZXNDb21wbGV0ZShbXSk7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jYWxsYmFja3MuZHJvcEVycm9yKFwidG9vTWFueUZpbGVzRXJyb3JcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgdXBsb2FkRHJvcFpvbmUuZHJvcERpc2FibGVkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVEYXRhVHJhbnNmZXJQcm9taXNlLmZhaWx1cmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZHJvcHBlZEZpbGVzID0gW107XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzRm9sZGVyRHJvcFN1cHBvcnRlZChkYXRhVHJhbnNmZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZGF0YVRyYW5zZmVyLml0ZW1zLCBmdW5jdGlvbihpZHgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbnRyeSA9IGl0ZW0ud2Via2l0R2V0QXNFbnRyeSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5LmlzRmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcm9wcGVkRmlsZXMucHVzaChpdGVtLmdldEFzRmlsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nRm9sZGVyUHJvbWlzZXMucHVzaCh0cmF2ZXJzZUZpbGVUcmVlKGVudHJ5KS5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0ZvbGRlclByb21pc2VzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdGb2xkZXJQcm9taXNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVEYXRhVHJhbnNmZXJQcm9taXNlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZHJvcHBlZEZpbGVzID0gZGF0YVRyYW5zZmVyLmZpbGVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocGVuZGluZ0ZvbGRlclByb21pc2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVEYXRhVHJhbnNmZXJQcm9taXNlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlRGF0YVRyYW5zZmVyUHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzZXR1cERyb3B6b25lKGRyb3BBcmVhKSB7XG4gICAgICAgICAgICB2YXIgZHJvcFpvbmUgPSBuZXcgcXEuVXBsb2FkRHJvcFpvbmUoe1xuICAgICAgICAgICAgICAgIEhJREVfWk9ORVNfRVZFTlRfTkFNRTogSElERV9aT05FU19FVkVOVF9OQU1FLFxuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGRyb3BBcmVhLFxuICAgICAgICAgICAgICAgIG9uRW50ZXI6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoZHJvcEFyZWEpLmFkZENsYXNzKG9wdGlvbnMuY2xhc3Nlcy5kcm9wQWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uTGVhdmVOb3REZXNjZW5kYW50czogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBxcShkcm9wQXJlYSkucmVtb3ZlQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmRyb3BBY3RpdmUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25Ecm9wOiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZURhdGFUcmFuc2ZlcihlLmRhdGFUcmFuc2ZlciwgZHJvcFpvbmUpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWREcm9wcGVkRmlsZXMoZHJvcHBlZEZpbGVzLCBkcm9wWm9uZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jYWxsYmFja3MuZHJvcExvZyhcIkRyb3AgZXZlbnQgRGF0YVRyYW5zZmVyIHBhcnNpbmcgZmFpbGVkLiAgTm8gZmlsZXMgd2lsbCBiZSB1cGxvYWRlZC5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hZGREaXNwb3NlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBkcm9wWm9uZS5kaXNwb3NlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHFxKGRyb3BBcmVhKS5oYXNBdHRyaWJ1dGUoSElERV9CRUZPUkVfRU5URVJfQVRUUikgJiYgcXEoZHJvcEFyZWEpLmhpZGUoKTtcbiAgICAgICAgICAgIHVwbG9hZERyb3Bab25lcy5wdXNoKGRyb3Bab25lKTtcbiAgICAgICAgICAgIHJldHVybiBkcm9wWm9uZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0ZpbGVEcmFnKGRyYWdFdmVudCkge1xuICAgICAgICAgICAgdmFyIGZpbGVEcmFnO1xuICAgICAgICAgICAgcXEuZWFjaChkcmFnRXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzLCBmdW5jdGlvbihrZXksIHZhbCkge1xuICAgICAgICAgICAgICAgIGlmICh2YWwgPT09IFwiRmlsZXNcIikge1xuICAgICAgICAgICAgICAgICAgICBmaWxlRHJhZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmaWxlRHJhZztcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBsZWF2aW5nRG9jdW1lbnRPdXQoZSkge1xuICAgICAgICAgICAgaWYgKHFxLnNhZmFyaSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUueCA8IDAgfHwgZS55IDwgMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlLnggPT09IDAgJiYgZS55ID09PSAwO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNldHVwRHJhZ0Ryb3AoKSB7XG4gICAgICAgICAgICB2YXIgZHJvcFpvbmVzID0gb3B0aW9ucy5kcm9wWm9uZUVsZW1lbnRzLCBtYXliZUhpZGVEcm9wWm9uZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGRyb3Bab25lcywgZnVuY3Rpb24oaWR4LCBkcm9wWm9uZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEoZHJvcFpvbmUpLmhhc0F0dHJpYnV0ZShISURFX0JFRk9SRV9FTlRFUl9BVFRSKSAmJiBxcShkcm9wWm9uZSkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEoZHJvcFpvbmUpLnJlbW92ZUNsYXNzKG9wdGlvbnMuY2xhc3Nlcy5kcm9wQWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMTApO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHFxLmVhY2goZHJvcFpvbmVzLCBmdW5jdGlvbihpZHgsIGRyb3Bab25lKSB7XG4gICAgICAgICAgICAgICAgdmFyIHVwbG9hZERyb3Bab25lID0gc2V0dXBEcm9wem9uZShkcm9wWm9uZSk7XG4gICAgICAgICAgICAgICAgaWYgKGRyb3Bab25lcy5sZW5ndGggJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuZmlsZURyb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGRvY3VtZW50LCBcImRyYWdlbnRlclwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXVwbG9hZERyb3Bab25lLmRyb3BEaXNhYmxlZCgpICYmIGlzRmlsZURyYWcoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGRyb3Bab25lcywgZnVuY3Rpb24oaWR4LCBkcm9wWm9uZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHJvcFpvbmUgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiBxcShkcm9wWm9uZSkuaGFzQXR0cmlidXRlKEhJREVfQkVGT1JFX0VOVEVSX0FUVFIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcShkcm9wWm9uZSkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBcImJsb2NrXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGRvY3VtZW50LCBcImRyYWdsZWF2ZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxlYXZpbmdEb2N1bWVudE91dChlKSkge1xuICAgICAgICAgICAgICAgICAgICBtYXliZUhpZGVEcm9wWm9uZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChxcShkb2N1bWVudCkuY2hpbGRyZW4oKVswXSwgXCJtb3VzZWVudGVyXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBtYXliZUhpZGVEcm9wWm9uZXMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGRvY3VtZW50LCBcImRyb3BcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmIChpc0ZpbGVEcmFnKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgbWF5YmVIaWRlRHJvcFpvbmVzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZG9jdW1lbnQsIEhJREVfWk9ORVNfRVZFTlRfTkFNRSwgbWF5YmVIaWRlRHJvcFpvbmVzKTtcbiAgICAgICAgfVxuICAgICAgICBzZXR1cERyYWdEcm9wKCk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBzZXR1cEV4dHJhRHJvcHpvbmU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmRyb3Bab25lRWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICBzZXR1cERyb3B6b25lKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbW92ZURyb3B6b25lOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIGksIGR6cyA9IG9wdGlvbnMuZHJvcFpvbmVFbGVtZW50cztcbiAgICAgICAgICAgICAgICBmb3IgKGkgaW4gZHpzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkenNbaV0gPT09IGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkenMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHVwbG9hZERyb3Bab25lcywgZnVuY3Rpb24oaWR4LCBkcm9wWm9uZSkge1xuICAgICAgICAgICAgICAgICAgICBkcm9wWm9uZS5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl90ZXN0aW5nID0ge307XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcuZXh0cmFjdERpcmVjdG9yeVBhdGggPSBleHRyYWN0RGlyZWN0b3J5UGF0aDtcbiAgICB9O1xuICAgIHFxLkRyYWdBbmREcm9wLmNhbGxiYWNrcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHByb2Nlc3NpbmdEcm9wcGVkRmlsZXM6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgICAgICBwcm9jZXNzaW5nRHJvcHBlZEZpbGVzQ29tcGxldGU6IGZ1bmN0aW9uKGZpbGVzLCB0YXJnZXRFbCkge30sXG4gICAgICAgICAgICBkcm9wRXJyb3I6IGZ1bmN0aW9uKGNvZGUsIGVycm9yU3BlY2lmaWNzKSB7XG4gICAgICAgICAgICAgICAgcXEubG9nKFwiRHJhZyAmIGRyb3AgZXJyb3IgY29kZSAnXCIgKyBjb2RlICsgXCIgd2l0aCB0aGVzZSBzcGVjaWZpY3M6ICdcIiArIGVycm9yU3BlY2lmaWNzICsgXCInXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZHJvcExvZzogZnVuY3Rpb24obWVzc2FnZSwgbGV2ZWwpIHtcbiAgICAgICAgICAgICAgICBxcS5sb2cobWVzc2FnZSwgbGV2ZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG4gICAgcXEuVXBsb2FkRHJvcFpvbmUgPSBmdW5jdGlvbihvKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgZGlzcG9zZVN1cHBvcnQgPSBuZXcgcXEuRGlzcG9zZVN1cHBvcnQoKSwgb3B0aW9ucywgZWxlbWVudCwgcHJldmVudERyb3AsIGRyb3BPdXRzaWRlRGlzYWJsZWQ7XG4gICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBlbGVtZW50OiBudWxsLFxuICAgICAgICAgICAgb25FbnRlcjogZnVuY3Rpb24oZSkge30sXG4gICAgICAgICAgICBvbkxlYXZlOiBmdW5jdGlvbihlKSB7fSxcbiAgICAgICAgICAgIG9uTGVhdmVOb3REZXNjZW5kYW50czogZnVuY3Rpb24oZSkge30sXG4gICAgICAgICAgICBvbkRyb3A6IGZ1bmN0aW9uKGUpIHt9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBvKTtcbiAgICAgICAgZWxlbWVudCA9IG9wdGlvbnMuZWxlbWVudDtcbiAgICAgICAgZnVuY3Rpb24gZHJhZ292ZXJTaG91bGRCZUNhbmNlbGVkKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLnNhZmFyaSgpIHx8IHFxLmZpcmVmb3goKSAmJiBxcS53aW5kb3dzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZGlzYWJsZURyb3BPdXRzaWRlKGUpIHtcbiAgICAgICAgICAgIGlmICghZHJvcE91dHNpZGVEaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIGlmIChkcmFnb3ZlclNob3VsZEJlQ2FuY2VsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGRvY3VtZW50LCBcImRyYWdvdmVyXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGRvY3VtZW50LCBcImRyYWdvdmVyXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmRhdGFUcmFuc2Zlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkcm9wT3V0c2lkZURpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkRmlsZURyYWcoZSkge1xuICAgICAgICAgICAgaWYgKCFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5maWxlRHJvcCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBlZmZlY3RUZXN0LCBkdCA9IGUuZGF0YVRyYW5zZmVyLCBpc1NhZmFyaSA9IHFxLnNhZmFyaSgpO1xuICAgICAgICAgICAgZWZmZWN0VGVzdCA9IHFxLmllKCkgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuZmlsZURyb3AgPyB0cnVlIDogZHQuZWZmZWN0QWxsb3dlZCAhPT0gXCJub25lXCI7XG4gICAgICAgICAgICByZXR1cm4gZHQgJiYgZWZmZWN0VGVzdCAmJiAoZHQuZmlsZXMgJiYgZHQuZmlsZXMubGVuZ3RoIHx8ICFpc1NhZmFyaSAmJiBkdC50eXBlcy5jb250YWlucyAmJiBkdC50eXBlcy5jb250YWlucyhcIkZpbGVzXCIpIHx8IGR0LnR5cGVzLmluY2x1ZGVzICYmIGR0LnR5cGVzLmluY2x1ZGVzKFwiRmlsZXNcIikpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzT3JTZXREcm9wRGlzYWJsZWQoaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgaWYgKGlzRGlzYWJsZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHByZXZlbnREcm9wID0gaXNEaXNhYmxlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwcmV2ZW50RHJvcDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiB0cmlnZ2VySGlkZXpvbmVzRXZlbnQoKSB7XG4gICAgICAgICAgICB2YXIgaGlkZVpvbmVzRXZlbnQ7XG4gICAgICAgICAgICBmdW5jdGlvbiB0cmlnZ2VyVXNpbmdPbGRBcGkoKSB7XG4gICAgICAgICAgICAgICAgaGlkZVpvbmVzRXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudChcIkV2ZW50XCIpO1xuICAgICAgICAgICAgICAgIGhpZGVab25lc0V2ZW50LmluaXRFdmVudChvcHRpb25zLkhJREVfWk9ORVNfRVZFTlRfTkFNRSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAod2luZG93LkN1c3RvbUV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaGlkZVpvbmVzRXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQob3B0aW9ucy5ISURFX1pPTkVTX0VWRU5UX05BTUUpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyVXNpbmdPbGRBcGkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRyaWdnZXJVc2luZ09sZEFwaSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChoaWRlWm9uZXNFdmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gYXR0YWNoRXZlbnRzKCkge1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGVsZW1lbnQsIFwiZHJhZ292ZXJcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmICghaXNWYWxpZEZpbGVEcmFnKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGVmZmVjdCA9IHFxLmllKCkgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuZmlsZURyb3AgPyBudWxsIDogZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZDtcbiAgICAgICAgICAgICAgICBpZiAoZWZmZWN0ID09PSBcIm1vdmVcIiB8fCBlZmZlY3QgPT09IFwibGlua01vdmVcIikge1xuICAgICAgICAgICAgICAgICAgICBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gXCJtb3ZlXCI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IFwiY29weVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGVsZW1lbnQsIFwiZHJhZ2VudGVyXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzT3JTZXREcm9wRGlzYWJsZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVmFsaWRGaWxlRHJhZyhlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMub25FbnRlcihlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChlbGVtZW50LCBcImRyYWdsZWF2ZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkRmlsZURyYWcoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvcHRpb25zLm9uTGVhdmUoZSk7XG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0ZWRUYXJnZXQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICAgICAgICAgICAgICBpZiAocXEodGhpcykuY29udGFpbnMocmVsYXRlZFRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvcHRpb25zLm9uTGVhdmVOb3REZXNjZW5kYW50cyhlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGVsZW1lbnQsIFwiZHJvcFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc09yU2V0RHJvcERpc2FibGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkRmlsZURyYWcoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMub25Ecm9wKGUpO1xuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VySGlkZXpvbmVzRXZlbnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBkaXNhYmxlRHJvcE91dHNpZGUoKTtcbiAgICAgICAgYXR0YWNoRXZlbnRzKCk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBkcm9wRGlzYWJsZWQ6IGZ1bmN0aW9uKGlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXNPclNldERyb3BEaXNhYmxlZChpc0Rpc2FibGVkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaXNwb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5kaXNwb3NlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RWxlbWVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl90ZXN0aW5nID0ge307XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcuaXNWYWxpZEZpbGVEcmFnID0gaXNWYWxpZEZpbGVEcmFnO1xuICAgIH07XG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcXEudWlQdWJsaWNBcGkgPSB7XG4gICAgICAgICAgICBhZGRJbml0aWFsRmlsZXM6IGZ1bmN0aW9uKGNhbm5lZEZpbGVMaXN0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5hZGRJbml0aWFsRmlsZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmFkZENhY2hlVG9Eb20oKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbGVhclN0b3JlZEZpbGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLmNsZWFyU3RvcmVkRmlsZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmNsZWFyRmlsZXMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRFeHRyYURyb3B6b25lOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZG5kICYmIHRoaXMuX2RuZC5zZXR1cEV4dHJhRHJvcHpvbmUoZWxlbWVudCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlRXh0cmFEcm9wem9uZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9kbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RuZC5yZW1vdmVEcm9wem9uZShlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SXRlbUJ5RmlsZUlkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fdGVtcGxhdGluZy5pc0hpZGRlbkZvcmV2ZXIoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5yZXNldC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcucmVzZXQoKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX29wdGlvbnMuYnV0dG9uICYmIHRoaXMuX3RlbXBsYXRpbmcuZ2V0QnV0dG9uKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmYXVsdEJ1dHRvbklkID0gdGhpcy5fY3JlYXRlVXBsb2FkQnV0dG9uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHRoaXMuX3RlbXBsYXRpbmcuZ2V0QnV0dG9uKCksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5fb3B0aW9ucy50ZXh0LmZpbGVJbnB1dFRpdGxlXG4gICAgICAgICAgICAgICAgICAgIH0pLmdldEJ1dHRvbklkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9kbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZG5kLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZG5kID0gdGhpcy5fc2V0dXBEcmFnQW5kRHJvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbEZpbGVzSW5CYXRjaCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5fZmlsZXNJbkJhdGNoQWRkZWRUb1VpID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXR1cENsaWNrQW5kRWRpdEV2ZW50SGFuZGxlcnMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXROYW1lOiBmdW5jdGlvbihpZCwgbmV3TmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBmb3JtYXR0ZWRGaWxlbmFtZSA9IHRoaXMuX29wdGlvbnMuZm9ybWF0RmlsZU5hbWUobmV3TmFtZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5zZXROYW1lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy51cGRhdGVGaWxlbmFtZShpZCwgZm9ybWF0dGVkRmlsZW5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhdXNlVXBsb2FkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBwYXVzZWQgPSB0aGlzLl9wYXJlbnQucHJvdG90eXBlLnBhdXNlVXBsb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgcGF1c2VkICYmIHRoaXMuX3RlbXBsYXRpbmcudXBsb2FkUGF1c2VkKGlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGF1c2VkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRpbnVlVXBsb2FkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBjb250aW51ZWQgPSB0aGlzLl9wYXJlbnQucHJvdG90eXBlLmNvbnRpbnVlVXBsb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgY29udGludWVkICYmIHRoaXMuX3RlbXBsYXRpbmcudXBsb2FkQ29udGludWVkKGlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udGludWVkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldElkOiBmdW5jdGlvbihmaWxlQ29udGFpbmVyT3JDaGlsZEVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RlbXBsYXRpbmcuZ2V0RmlsZUlkKGZpbGVDb250YWluZXJPckNoaWxkRWwpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERyb3BUYXJnZXQ6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlID0gdGhpcy5nZXRGaWxlKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGUucXFEcm9wVGFyZ2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS51aVByaXZhdGVBcGkgPSB7XG4gICAgICAgICAgICBfZ2V0QnV0dG9uOiBmdW5jdGlvbihidXR0b25JZCkge1xuICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9nZXRCdXR0b24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBpZiAoIWJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYnV0dG9uSWQgPT09IHRoaXMuX2RlZmF1bHRCdXR0b25JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gdGhpcy5fdGVtcGxhdGluZy5nZXRCdXR0b24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9yZW1vdmVGaWxlSXRlbTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5yZW1vdmVGaWxlKGZpbGVJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3NldHVwQ2xpY2tBbmRFZGl0RXZlbnRIYW5kbGVyczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZmlsZUJ1dHRvbnNDbGlja0hhbmRsZXIgPSBxcS5GaWxlQnV0dG9uc0NsaWNrSGFuZGxlciAmJiB0aGlzLl9iaW5kRmlsZUJ1dHRvbnNDbGlja0V2ZW50KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNpbkV2ZW50U3VwcG9ydGVkID0gIXFxLmZpcmVmb3goKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFZGl0RmlsZW5hbWVFbmFibGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmlsZW5hbWVDbGlja0hhbmRsZXIgPSB0aGlzLl9iaW5kRmlsZW5hbWVDbGlja0V2ZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVuYW1lSW5wdXRGb2N1c0luSGFuZGxlciA9IHRoaXMuX2JpbmRGaWxlbmFtZUlucHV0Rm9jdXNJbkV2ZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVuYW1lSW5wdXRGb2N1c0hhbmRsZXIgPSB0aGlzLl9iaW5kRmlsZW5hbWVJbnB1dEZvY3VzRXZlbnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3NldHVwRHJhZ0FuZERyb3A6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgZHJvcFpvbmVFbGVtZW50cyA9IHRoaXMuX29wdGlvbnMuZHJhZ0FuZERyb3AuZXh0cmFEcm9wem9uZXMsIHRlbXBsYXRpbmcgPSB0aGlzLl90ZW1wbGF0aW5nLCBkZWZhdWx0RHJvcFpvbmUgPSB0ZW1wbGF0aW5nLmdldERyb3Bab25lKCk7XG4gICAgICAgICAgICAgICAgZGVmYXVsdERyb3Bab25lICYmIGRyb3Bab25lRWxlbWVudHMucHVzaChkZWZhdWx0RHJvcFpvbmUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuRHJhZ0FuZERyb3Aoe1xuICAgICAgICAgICAgICAgICAgICBkcm9wWm9uZUVsZW1lbnRzOiBkcm9wWm9uZUVsZW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICBhbGxvd011bHRpcGxlSXRlbXM6IHRoaXMuX29wdGlvbnMubXVsdGlwbGUsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BBY3RpdmU6IHRoaXMuX29wdGlvbnMuY2xhc3Nlcy5kcm9wQWN0aXZlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2luZ0Ryb3BwZWRGaWxlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5zaG93RHJvcFByb2Nlc3NpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzaW5nRHJvcHBlZEZpbGVzQ29tcGxldGU6IGZ1bmN0aW9uKGZpbGVzLCB0YXJnZXRFbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuaGlkZURyb3BQcm9jZXNzaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChmaWxlcywgZnVuY3Rpb24oaWR4LCBmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucXFEcm9wVGFyZ2V0ID0gdGFyZ2V0RWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFkZEZpbGVzKGZpbGVzLCBudWxsLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcEVycm9yOiBmdW5jdGlvbihjb2RlLCBlcnJvckRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9pdGVtRXJyb3IoY29kZSwgZXJyb3JEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wTG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsZXZlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKG1lc3NhZ2UsIGxldmVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9iaW5kRmlsZUJ1dHRvbnNDbGlja0V2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5GaWxlQnV0dG9uc0NsaWNrSGFuZGxlcih7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmc6IHRoaXMuX3RlbXBsYXRpbmcsXG4gICAgICAgICAgICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSwgbHZsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhtZXNzYWdlLCBsdmwpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkRlbGV0ZUZpbGU6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kZWxldGVGaWxlKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2FuY2VsKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uUmV0cnk6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yZXRyeShmaWxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblBhdXNlOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucGF1c2VVcGxvYWQoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25Db250aW51ZTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNvbnRpbnVlVXBsb2FkKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uR2V0TmFtZTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXROYW1lKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaXNFZGl0RmlsZW5hbWVFbmFibGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVtcGxhdGluZy5pc0VkaXRGaWxlbmFtZVBvc3NpYmxlKCkgJiYgIXRoaXMuX29wdGlvbnMuYXV0b1VwbG9hZCAmJiBxcS5GaWxlbmFtZUNsaWNrSGFuZGxlciAmJiBxcS5GaWxlbmFtZUlucHV0Rm9jdXNIYW5kbGVyICYmIHFxLkZpbGVuYW1lSW5wdXRGb2N1c0hhbmRsZXI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2ZpbGVuYW1lRWRpdEhhbmRsZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgdGVtcGxhdGluZyA9IHRoaXMuX3RlbXBsYXRpbmc7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZzogdGVtcGxhdGluZyxcbiAgICAgICAgICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsdmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKG1lc3NhZ2UsIGx2bCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uR2V0VXBsb2FkU3RhdHVzOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmaWxlSWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25HZXROYW1lOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldE5hbWUoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25TZXROYW1lOiBmdW5jdGlvbihpZCwgbmV3TmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXROYW1lKGlkLCBuZXdOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25FZGl0aW5nU3RhdHVzQ2hhbmdlOiBmdW5jdGlvbihpZCwgaXNFZGl0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXFJbnB1dCA9IHFxKHRlbXBsYXRpbmcuZ2V0RWRpdElucHV0KGlkKSksIHFxRmlsZUNvbnRhaW5lciA9IHFxKHRlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRWRpdGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxSW5wdXQuYWRkQ2xhc3MoXCJxcS1lZGl0aW5nXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuaGlkZUZpbGVuYW1lKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLmhpZGVFZGl0SWNvbihpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxSW5wdXQucmVtb3ZlQ2xhc3MoXCJxcS1lZGl0aW5nXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuc2hvd0ZpbGVuYW1lKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLnNob3dFZGl0SWNvbihpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBxcUZpbGVDb250YWluZXIuYWRkQ2xhc3MoXCJxcS10ZW1wXCIpLnJlbW92ZUNsYXNzKFwicXEtdGVtcFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVXBsb2FkU3RhdHVzQ2hhbmdlOiBmdW5jdGlvbihpZCwgb2xkU3RhdHVzLCBuZXdTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vblVwbG9hZFN0YXR1c0NoYW5nZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VkaXRGaWxlbmFtZUVuYWJsZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKSAmJiBuZXdTdGF0dXMgIT09IHFxLnN0YXR1cy5TVUJNSVRURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcubWFya0ZpbGVuYW1lRWRpdGFibGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlRWRpdEljb24oaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvbGRTdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURfUkVUUllJTkcgJiYgbmV3U3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FESU5HKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZVJldHJ5KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zZXRTdGF0dXNUZXh0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcXEodGhpcy5fdGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKSkucmVtb3ZlQ2xhc3ModGhpcy5fY2xhc3Nlcy5yZXRyeWluZyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdTdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURfRkFJTEVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZVBhdXNlKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2JpbmRGaWxlbmFtZUlucHV0Rm9jdXNJbkV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3BlYyA9IHFxLmV4dGVuZCh7fSwgdGhpcy5fZmlsZW5hbWVFZGl0SGFuZGxlcigpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLkZpbGVuYW1lSW5wdXRGb2N1c0luSGFuZGxlcihzcGVjKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYmluZEZpbGVuYW1lSW5wdXRGb2N1c0V2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3BlYyA9IHFxLmV4dGVuZCh7fSwgdGhpcy5fZmlsZW5hbWVFZGl0SGFuZGxlcigpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLkZpbGVuYW1lSW5wdXRGb2N1c0hhbmRsZXIoc3BlYyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2JpbmRGaWxlbmFtZUNsaWNrRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzcGVjID0gcXEuZXh0ZW5kKHt9LCB0aGlzLl9maWxlbmFtZUVkaXRIYW5kbGVyKCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuRmlsZW5hbWVDbGlja0hhbmRsZXIoc3BlYyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3N0b3JlRm9yTGF0ZXI6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fc3RvcmVGb3JMYXRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZVNwaW5uZXIoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkFsbENvbXBsZXRlOiBmdW5jdGlvbihzdWNjZXNzZnVsLCBmYWlsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vbkFsbENvbXBsZXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5yZXNldFRvdGFsUHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25TdWJtaXQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGUgPSB0aGlzLmdldEZpbGUoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlICYmIGZpbGUucXFQYXRoICYmIHRoaXMuX29wdGlvbnMuZHJhZ0FuZERyb3AucmVwb3J0RGlyZWN0b3J5UGF0aHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zU3RvcmUuYWRkUmVhZE9ubHkoaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxcGF0aDogZmlsZS5xcVBhdGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uU3VibWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWRkVG9MaXN0KGlkLCBuYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25TdWJtaXR0ZWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRWRpdEZpbGVuYW1lRW5hYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcubWFya0ZpbGVuYW1lRWRpdGFibGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNob3dFZGl0SWNvbihpZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZm9jdXNpbkV2ZW50U3VwcG9ydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9maWxlbmFtZUlucHV0Rm9jdXNIYW5kbGVyLmFkZEhhbmRsZXIodGhpcy5fdGVtcGxhdGluZy5nZXRFZGl0SW5wdXQoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25Qcm9ncmVzczogZnVuY3Rpb24oaWQsIG5hbWUsIGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vblByb2dyZXNzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy51cGRhdGVQcm9ncmVzcyhpZCwgbG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICAgICAgaWYgKHRvdGFsID09PSAwIHx8IE1hdGgucm91bmQobG9hZGVkIC8gdG90YWwgKiAxMDApID09PSAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlQ2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlUGF1c2UoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVQcm9ncmVzcyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2V0U3RhdHVzVGV4dChpZCwgdGhpcy5fb3B0aW9ucy50ZXh0LndhaXRpbmdGb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BsYXlGaWxlU2l6ZShpZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGlzcGxheUZpbGVTaXplKGlkLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVG90YWxQcm9ncmVzczogZnVuY3Rpb24obG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uVG90YWxQcm9ncmVzcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcudXBkYXRlVG90YWxQcm9ncmVzcyhsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25Db21wbGV0ZTogZnVuY3Rpb24oaWQsIG5hbWUsIHJlc3VsdCwgeGhyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudFJldFZhbCA9IHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uQ29tcGxldGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgdGVtcGxhdGluZyA9IHRoaXMuX3RlbXBsYXRpbmcsIGZpbGVDb250YWluZXIgPSB0ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpLCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZVVwbG9hZChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5zZXRTdGF0dXNUZXh0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcXEoZmlsZUNvbnRhaW5lcikucmVtb3ZlQ2xhc3Moc2VsZi5fY2xhc3Nlcy5yZXRyeWluZyk7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuaGlkZVByb2dyZXNzKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICAgICAgfSkuc3RhdHVzICE9PSBxcS5zdGF0dXMuVVBMT0FEX0ZBSUxFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5oaWRlQ2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLmhpZGVTcGlubmVyKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYXJrRmlsZUFzU3VjY2Vzc2Z1bChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcShmaWxlQ29udGFpbmVyKS5hZGRDbGFzcyhzZWxmLl9jbGFzc2VzLmZhaWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5zaG93Q2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wbGF0aW5nLmlzUmV0cnlQb3NzaWJsZSgpICYmICFzZWxmLl9wcmV2ZW50UmV0cmllc1tpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcShmaWxlQ29udGFpbmVyKS5hZGRDbGFzcyhzZWxmLl9jbGFzc2VzLnJldHJ5YWJsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5zaG93UmV0cnkoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fY29udHJvbEZhaWx1cmVUZXh0RGlzcGxheShpZCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocGFyZW50UmV0VmFsIGluc3RhbmNlb2YgcXEuUHJvbWlzZSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnRSZXRWYWwuZG9uZShmdW5jdGlvbihuZXdSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlVXBsb2FkKG5ld1Jlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlVXBsb2FkKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRSZXRWYWw7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21hcmtGaWxlQXNTdWNjZXNzZnVsOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wbGF0aW5nID0gdGhpcy5fdGVtcGxhdGluZztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNEZWxldGVQb3NzaWJsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuc2hvd0RlbGV0ZUJ1dHRvbihpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHFxKHRlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCkpLmFkZENsYXNzKHRoaXMuX2NsYXNzZXMuc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWF5YmVVcGRhdGVUaHVtYm5haWwoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblVwbG9hZFByZXA6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25VcGxvYWRQcmVwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zaG93U3Bpbm5lcihpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVXBsb2FkOiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJlbnRSZXRWYWwgPSB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vblVwbG9hZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2hvd1NwaW5uZXIoaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRSZXRWYWw7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVXBsb2FkQ2h1bms6IGZ1bmN0aW9uKGlkLCBjaHVua0RhdGEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vblVwbG9hZENodW5rLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgaWYgKGNodW5rRGF0YS5wYXJ0SW5kZXggPiAwICYmIHRoaXMuX2hhbmRsZXIuaXNSZXN1bWFibGUoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuYWxsb3dQYXVzZShpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkNhbmNlbDogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vbkNhbmNlbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUZpbGVJdGVtKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZ2V0Tm90RmluaXNoZWQoKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnJlc2V0VG90YWxQcm9ncmVzcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25CZWZvcmVBdXRvUmV0cnk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldHJ5TnVtRm9yRGlzcGxheSwgbWF4QXV0bywgcmV0cnlOb3RlO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uQmVmb3JlQXV0b1JldHJ5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hvd0NhbmNlbExpbmsoaWQpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLnJldHJ5LnNob3dBdXRvUmV0cnlOb3RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHJ5TnVtRm9yRGlzcGxheSA9IHRoaXMuX2F1dG9SZXRyaWVzW2lkXTtcbiAgICAgICAgICAgICAgICAgICAgbWF4QXV0byA9IHRoaXMuX29wdGlvbnMucmV0cnkubWF4QXV0b0F0dGVtcHRzO1xuICAgICAgICAgICAgICAgICAgICByZXRyeU5vdGUgPSB0aGlzLl9vcHRpb25zLnJldHJ5LmF1dG9SZXRyeU5vdGUucmVwbGFjZSgvXFx7cmV0cnlOdW1cXH0vZywgcmV0cnlOdW1Gb3JEaXNwbGF5KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0cnlOb3RlID0gcmV0cnlOb3RlLnJlcGxhY2UoL1xce21heEF1dG9cXH0vZywgbWF4QXV0byk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2V0U3RhdHVzVGV4dChpZCwgcmV0cnlOb3RlKTtcbiAgICAgICAgICAgICAgICAgICAgcXEodGhpcy5fdGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKSkuYWRkQ2xhc3ModGhpcy5fY2xhc3Nlcy5yZXRyeWluZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkJlZm9yZU1hbnVhbFJldHJ5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vbkJlZm9yZU1hbnVhbFJldHJ5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5yZXNldFByb2dyZXNzKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcXEodGhpcy5fdGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKSkucmVtb3ZlQ2xhc3ModGhpcy5fY2xhc3Nlcy5mYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zZXRTdGF0dXNUZXh0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zaG93U3Bpbm5lcihpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dDYW5jZWxMaW5rKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcXEodGhpcy5fdGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKSkuYWRkQ2xhc3ModGhpcy5fY2xhc3Nlcy5yZXRyeWFibGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNob3dSZXRyeShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uU3VibWl0RGVsZXRlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBvblN1Y2Nlc3NDYWxsYmFjayA9IHFxLmJpbmQodGhpcy5fb25TdWJtaXREZWxldGVTdWNjZXNzLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vblN1Ym1pdERlbGV0ZS5jYWxsKHRoaXMsIGlkLCBvblN1Y2Nlc3NDYWxsYmFjayk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uU3VibWl0RGVsZXRlU3VjY2VzczogZnVuY3Rpb24oaWQsIHV1aWQsIGFkZGl0aW9uYWxNYW5kYXRlZFBhcmFtcykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmRlbGV0ZUZpbGUuZm9yY2VDb25maXJtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dEZWxldGVDb25maXJtLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VuZERlbGV0ZVJlcXVlc3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uRGVsZXRlQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCB4aHIsIGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vbkRlbGV0ZUNvbXBsZXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlU3Bpbm5lcihpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zZXRTdGF0dXNUZXh0KGlkLCB0aGlzLl9vcHRpb25zLmRlbGV0ZUZpbGUuZGVsZXRpbmdGYWlsZWRUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zaG93RGVsZXRlQnV0dG9uKGlkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVGaWxlSXRlbShpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZW5kRGVsZXRlUmVxdWVzdDogZnVuY3Rpb24oaWQsIHV1aWQsIGFkZGl0aW9uYWxNYW5kYXRlZFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZURlbGV0ZUJ1dHRvbihpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zaG93U3Bpbm5lcihpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zZXRTdGF0dXNUZXh0KGlkLCB0aGlzLl9vcHRpb25zLmRlbGV0ZUZpbGUuZGVsZXRpbmdTdGF0dXNUZXh0KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9kZWxldGVIYW5kbGVyLnNlbmREZWxldGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2hvd0RlbGV0ZUNvbmZpcm06IGZ1bmN0aW9uKGlkLCB1dWlkLCBtYW5kYXRlZFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlTmFtZSA9IHRoaXMuZ2V0TmFtZShpZCksIGNvbmZpcm1NZXNzYWdlID0gdGhpcy5fb3B0aW9ucy5kZWxldGVGaWxlLmNvbmZpcm1NZXNzYWdlLnJlcGxhY2UoL1xce2ZpbGVuYW1lXFx9L2csIGZpbGVOYW1lKSwgdXVpZCA9IHRoaXMuZ2V0VXVpZChpZCksIGRlbGV0ZVJlcXVlc3RBcmdzID0gYXJndW1lbnRzLCBzZWxmID0gdGhpcywgcmV0VmFsO1xuICAgICAgICAgICAgICAgIHJldFZhbCA9IHRoaXMuX29wdGlvbnMuc2hvd0NvbmZpcm0oY29uZmlybU1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc0dlbmVyaWNQcm9taXNlKHJldFZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0VmFsLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zZW5kRGVsZXRlUmVxdWVzdC5hcHBseShzZWxmLCBkZWxldGVSZXF1ZXN0QXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmV0VmFsICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9zZW5kRGVsZXRlUmVxdWVzdC5hcHBseShzZWxmLCBkZWxldGVSZXF1ZXN0QXJncyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9hZGRUb0xpc3Q6IGZ1bmN0aW9uKGlkLCBuYW1lLCBjYW5uZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJlcGVuZERhdGEsIHByZXBlbmRJbmRleCA9IDAsIGRvbnREaXNwbGF5ID0gdGhpcy5faGFuZGxlci5pc1Byb3hpZWQoaWQpICYmIHRoaXMuX29wdGlvbnMuc2NhbGluZy5oaWRlU2NhbGVkLCByZWNvcmQ7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuZGlzcGxheS5wcmVwZW5kRmlsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RvdGFsRmlsZXNJbkJhdGNoID4gMSAmJiB0aGlzLl9maWxlc0luQmF0Y2hBZGRlZFRvVWkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmVwZW5kSW5kZXggPSB0aGlzLl9maWxlc0luQmF0Y2hBZGRlZFRvVWkgLSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHByZXBlbmREYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IHByZXBlbmRJbmRleFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWNhbm5lZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5kaXNhYmxlQ2FuY2VsRm9yRm9ybVVwbG9hZHMgJiYgIXFxLnN1cHBvcnRlZEZlYXR1cmVzLmFqYXhVcGxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuZGlzYWJsZUNhbmNlbCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fb3B0aW9ucy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkID0gdGhpcy5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlZFByb3h5R3JvdXAgPSB0aGlzLl9oYW5kbGVkUHJveHlHcm91cCB8fCByZWNvcmQucHJveHlHcm91cElkO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZC5wcm94eUdyb3VwSWQgIT09IHRoaXMuX2hhbmRsZWRQcm94eUdyb3VwIHx8ICFyZWNvcmQucHJveHlHcm91cElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlci5jYW5jZWxBbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jbGVhckxpc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVkUHJveHlHcm91cCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNhbm5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmFkZEZpbGVUb0NhY2hlKGlkLCB0aGlzLl9vcHRpb25zLmZvcm1hdEZpbGVOYW1lKG5hbWUpLCBwcmVwZW5kRGF0YSwgZG9udERpc3BsYXkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnVwZGF0ZVRodW1ibmFpbChpZCwgdGhpcy5fdGh1bWJuYWlsVXJsc1tpZF0sIHRydWUsIHRoaXMuX29wdGlvbnMudGh1bWJuYWlscy5jdXN0b21SZXNpemVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmFkZEZpbGUoaWQsIHRoaXMuX29wdGlvbnMuZm9ybWF0RmlsZU5hbWUobmFtZSksIHByZXBlbmREYXRhLCBkb250RGlzcGxheSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuZ2VuZXJhdGVQcmV2aWV3KGlkLCB0aGlzLmdldEZpbGUoaWQpLCB0aGlzLl9vcHRpb25zLnRodW1ibmFpbHMuY3VzdG9tUmVzaXplcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVzSW5CYXRjaEFkZGVkVG9VaSArPSAxO1xuICAgICAgICAgICAgICAgIGlmIChjYW5uZWQgfHwgdGhpcy5fb3B0aW9ucy5kaXNwbGF5LmZpbGVTaXplT25TdWJtaXQgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuYWpheFVwbG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaXNwbGF5RmlsZVNpemUoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY2xlYXJMaXN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmNsZWFyRmlsZXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU3RvcmVkRmlsZXMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZGlzcGxheUZpbGVTaXplOiBmdW5jdGlvbihpZCwgbG9hZGVkU2l6ZSwgdG90YWxTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNpemUgPSB0aGlzLmdldFNpemUoaWQpLCBzaXplRm9yRGlzcGxheSA9IHRoaXMuX2Zvcm1hdFNpemUoc2l6ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHNpemUgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGVkU2l6ZSAhPT0gdW5kZWZpbmVkICYmIHRvdGFsU2l6ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplRm9yRGlzcGxheSA9IHRoaXMuX2Zvcm1hdFByb2dyZXNzKGxvYWRlZFNpemUsIHRvdGFsU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy51cGRhdGVTaXplKGlkLCBzaXplRm9yRGlzcGxheSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9mb3JtYXRQcm9ncmVzczogZnVuY3Rpb24odXBsb2FkZWRTaXplLCB0b3RhbFNpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHRoaXMuX29wdGlvbnMudGV4dC5mb3JtYXRQcm9ncmVzcztcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiByKG5hbWUsIHJlcGxhY2VtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UobmFtZSwgcmVwbGFjZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByKFwie3BlcmNlbnR9XCIsIE1hdGgucm91bmQodXBsb2FkZWRTaXplIC8gdG90YWxTaXplICogMTAwKSk7XG4gICAgICAgICAgICAgICAgcihcInt0b3RhbF9zaXplfVwiLCB0aGlzLl9mb3JtYXRTaXplKHRvdGFsU2l6ZSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jb250cm9sRmFpbHVyZVRleHREaXNwbGF5OiBmdW5jdGlvbihpZCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgbW9kZSwgcmVzcG9uc2VQcm9wZXJ0eSwgZmFpbHVyZVJlYXNvbjtcbiAgICAgICAgICAgICAgICBtb2RlID0gdGhpcy5fb3B0aW9ucy5mYWlsZWRVcGxvYWRUZXh0RGlzcGxheS5tb2RlO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlUHJvcGVydHkgPSB0aGlzLl9vcHRpb25zLmZhaWxlZFVwbG9hZFRleHREaXNwbGF5LnJlc3BvbnNlUHJvcGVydHk7XG4gICAgICAgICAgICAgICAgaWYgKG1vZGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmFpbHVyZVJlYXNvbiA9IHJlc3BvbnNlW3Jlc3BvbnNlUHJvcGVydHldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZhaWx1cmVSZWFzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVSZWFzb24gPSB0aGlzLl9vcHRpb25zLnRleHQuZmFpbFVwbG9hZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNldFN0YXR1c1RleHQoaWQsIGZhaWx1cmVSZWFzb24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5mYWlsZWRVcGxvYWRUZXh0RGlzcGxheS5lbmFibGVUb29sdGlwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93VG9vbHRpcChpZCwgZmFpbHVyZVJlYXNvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGUgPT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2V0U3RhdHVzVGV4dChpZCwgdGhpcy5fb3B0aW9ucy50ZXh0LmZhaWxVcGxvYWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobW9kZSAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coXCJmYWlsZWRVcGxvYWRUZXh0RGlzcGxheS5tb2RlIHZhbHVlIG9mICdcIiArIG1vZGUgKyBcIicgaXMgbm90IHZhbGlkXCIsIFwid2FyblwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3dUb29sdGlwOiBmdW5jdGlvbihpZCwgdGV4dCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCkudGl0bGUgPSB0ZXh0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zaG93Q2FuY2VsTGluazogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX29wdGlvbnMuZGlzYWJsZUNhbmNlbEZvckZvcm1VcGxvYWRzIHx8IHFxLnN1cHBvcnRlZEZlYXR1cmVzLmFqYXhVcGxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zaG93Q2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2l0ZW1FcnJvcjogZnVuY3Rpb24oY29kZSwgbmFtZSwgaXRlbSkge1xuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gdGhpcy5fcGFyZW50LnByb3RvdHlwZS5faXRlbUVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5zaG93TWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYmF0Y2hFcnJvcjogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX2JhdGNoRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLnNob3dNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXR1cFBhc3RlUHJvbXB0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25QYXN0ZVJlY2VpdmVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gc2VsZi5fb3B0aW9ucy5wYXN0ZS5uYW1lUHJvbXB0TWVzc2FnZSwgZGVmYXVsdFZhbCA9IHNlbGYuX29wdGlvbnMucGFzdGUuZGVmYXVsdE5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcHRpb25zLnNob3dQcm9tcHQobWVzc2FnZSwgZGVmYXVsdFZhbCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZmlsZU9yQmxvYlJlamVjdGVkOiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsRmlsZXNJbkJhdGNoIC09IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fZmlsZU9yQmxvYlJlamVjdGVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3ByZXBhcmVJdGVtc0ZvclVwbG9hZDogZnVuY3Rpb24oaXRlbXMsIHBhcmFtcywgZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbEZpbGVzSW5CYXRjaCA9IGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB0aGlzLl9maWxlc0luQmF0Y2hBZGRlZFRvVWkgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX3ByZXBhcmVJdGVtc0ZvclVwbG9hZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXliZVVwZGF0ZVRodW1ibmFpbDogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRodW1ibmFpbFVybCA9IHRoaXMuX3RodW1ibmFpbFVybHNbZmlsZUlkXSwgZmlsZVN0YXR1cyA9IHRoaXMuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBmaWxlSWRcbiAgICAgICAgICAgICAgICB9KS5zdGF0dXM7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVTdGF0dXMgIT09IHFxLnN0YXR1cy5ERUxFVEVEICYmICh0aHVtYm5haWxVcmwgfHwgdGhpcy5fb3B0aW9ucy50aHVtYm5haWxzLnBsYWNlaG9sZGVycy53YWl0VW50aWxSZXNwb25zZSB8fCAhcXEuc3VwcG9ydGVkRmVhdHVyZXMuaW1hZ2VQcmV2aWV3cykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy51cGRhdGVUaHVtYm5haWwoZmlsZUlkLCB0aHVtYm5haWxVcmwsIHRoaXMuX29wdGlvbnMudGh1bWJuYWlscy5jdXN0b21SZXNpemVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2FkZENhbm5lZEZpbGU6IGZ1bmN0aW9uKHNlc3Npb25EYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fYWRkQ2FubmVkRmlsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2FkZFRvTGlzdChpZCwgdGhpcy5nZXROYW1lKGlkKSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlU3Bpbm5lcihpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlQ2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXJrRmlsZUFzU3VjY2Vzc2Z1bChpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXRTaXplOiBmdW5jdGlvbihpZCwgbmV3U2l6ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX3NldFNpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnVwZGF0ZVNpemUoaWQsIHRoaXMuX2Zvcm1hdFNpemUobmV3U2l6ZSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXNzaW9uUmVxdWVzdENvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmFkZENhY2hlVG9Eb20oKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9zZXNzaW9uUmVxdWVzdENvbXBsZXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSkoKTtcbiAgICBxcS5GaW5lVXBsb2FkZXIgPSBmdW5jdGlvbihvLCBuYW1lc3BhY2UpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5fcGFyZW50ID0gbmFtZXNwYWNlID8gcXFbbmFtZXNwYWNlXS5GaW5lVXBsb2FkZXJCYXNpYyA6IHFxLkZpbmVVcGxvYWRlckJhc2ljO1xuICAgICAgICB0aGlzLl9wYXJlbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMuX29wdGlvbnMsIHtcbiAgICAgICAgICAgIGVsZW1lbnQ6IG51bGwsXG4gICAgICAgICAgICBidXR0b246IG51bGwsXG4gICAgICAgICAgICBsaXN0RWxlbWVudDogbnVsbCxcbiAgICAgICAgICAgIGRyYWdBbmREcm9wOiB7XG4gICAgICAgICAgICAgICAgZXh0cmFEcm9wem9uZXM6IFtdLFxuICAgICAgICAgICAgICAgIHJlcG9ydERpcmVjdG9yeVBhdGhzOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRleHQ6IHtcbiAgICAgICAgICAgICAgICBmb3JtYXRQcm9ncmVzczogXCJ7cGVyY2VudH0lIG9mIHt0b3RhbF9zaXplfVwiLFxuICAgICAgICAgICAgICAgIGZhaWxVcGxvYWQ6IFwiVXBsb2FkIGZhaWxlZFwiLFxuICAgICAgICAgICAgICAgIHdhaXRpbmdGb3JSZXNwb25zZTogXCJQcm9jZXNzaW5nLi4uXCIsXG4gICAgICAgICAgICAgICAgcGF1c2VkOiBcIlBhdXNlZFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGVtcGxhdGU6IFwicXEtdGVtcGxhdGVcIixcbiAgICAgICAgICAgIGNsYXNzZXM6IHtcbiAgICAgICAgICAgICAgICByZXRyeWluZzogXCJxcS11cGxvYWQtcmV0cnlpbmdcIixcbiAgICAgICAgICAgICAgICByZXRyeWFibGU6IFwicXEtdXBsb2FkLXJldHJ5YWJsZVwiLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IFwicXEtdXBsb2FkLXN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgICBmYWlsOiBcInFxLXVwbG9hZC1mYWlsXCIsXG4gICAgICAgICAgICAgICAgZWRpdGFibGU6IFwicXEtZWRpdGFibGVcIixcbiAgICAgICAgICAgICAgICBoaWRlOiBcInFxLWhpZGVcIixcbiAgICAgICAgICAgICAgICBkcm9wQWN0aXZlOiBcInFxLXVwbG9hZC1kcm9wLWFyZWEtYWN0aXZlXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsZWRVcGxvYWRUZXh0RGlzcGxheToge1xuICAgICAgICAgICAgICAgIG1vZGU6IFwiZGVmYXVsdFwiLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlUHJvcGVydHk6IFwiZXJyb3JcIixcbiAgICAgICAgICAgICAgICBlbmFibGVUb29sdGlwOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgICAgICB0b29NYW55RmlsZXNFcnJvcjogXCJZb3UgbWF5IG9ubHkgZHJvcCBvbmUgZmlsZVwiLFxuICAgICAgICAgICAgICAgIHVuc3VwcG9ydGVkQnJvd3NlcjogXCJVbnJlY292ZXJhYmxlIGVycm9yIC0gdGhpcyBicm93c2VyIGRvZXMgbm90IHBlcm1pdCBmaWxlIHVwbG9hZGluZyBvZiBhbnkga2luZC5cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHJ5OiB7XG4gICAgICAgICAgICAgICAgc2hvd0F1dG9SZXRyeU5vdGU6IHRydWUsXG4gICAgICAgICAgICAgICAgYXV0b1JldHJ5Tm90ZTogXCJSZXRyeWluZyB7cmV0cnlOdW19L3ttYXhBdXRvfS4uLlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVsZXRlRmlsZToge1xuICAgICAgICAgICAgICAgIGZvcmNlQ29uZmlybTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29uZmlybU1lc3NhZ2U6IFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB7ZmlsZW5hbWV9P1wiLFxuICAgICAgICAgICAgICAgIGRlbGV0aW5nU3RhdHVzVGV4dDogXCJEZWxldGluZy4uLlwiLFxuICAgICAgICAgICAgICAgIGRlbGV0aW5nRmFpbGVkVGV4dDogXCJEZWxldGUgZmFpbGVkXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaXNwbGF5OiB7XG4gICAgICAgICAgICAgICAgZmlsZVNpemVPblN1Ym1pdDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJlcGVuZEZpbGVzOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhc3RlOiB7XG4gICAgICAgICAgICAgICAgcHJvbXB0Rm9yTmFtZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbmFtZVByb21wdE1lc3NhZ2U6IFwiUGxlYXNlIG5hbWUgdGhpcyBpbWFnZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGh1bWJuYWlsczoge1xuICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgbWF4Q291bnQ6IDAsXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIHdhaXRVbnRpbFJlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgbm90QXZhaWxhYmxlUGF0aDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgd2FpdGluZ1BhdGg6IG51bGxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRpbWVCZXR3ZWVuVGh1bWJzOiA3NTBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzY2FsaW5nOiB7XG4gICAgICAgICAgICAgICAgaGlkZVNjYWxlZDogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93TWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIGlmIChzZWxmLl90ZW1wbGF0aW5nLmhhc0RpYWxvZyhcImFsZXJ0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl90ZW1wbGF0aW5nLnNob3dEaWFsb2coXCJhbGVydFwiLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd0NvbmZpcm06IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5fdGVtcGxhdGluZy5oYXNEaWFsb2coXCJjb25maXJtXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl90ZW1wbGF0aW5nLnNob3dEaWFsb2coXCJjb25maXJtXCIsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3aW5kb3cuY29uZmlybShtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd1Byb21wdDogZnVuY3Rpb24obWVzc2FnZSwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuX3RlbXBsYXRpbmcuaGFzRGlhbG9nKFwicHJvbXB0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl90ZW1wbGF0aW5nLnNob3dEaWFsb2coXCJwcm9tcHRcIiwgbWVzc2FnZSwgZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93LnByb21wdChtZXNzYWdlLCBkZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdHJ1ZSk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLl9vcHRpb25zLCBvLCB0cnVlKTtcbiAgICAgICAgdGhpcy5fdGVtcGxhdGluZyA9IG5ldyBxcS5UZW1wbGF0aW5nKHtcbiAgICAgICAgICAgIGxvZzogcXEuYmluZCh0aGlzLmxvZywgdGhpcyksXG4gICAgICAgICAgICB0ZW1wbGF0ZUlkT3JFbDogdGhpcy5fb3B0aW9ucy50ZW1wbGF0ZSxcbiAgICAgICAgICAgIGNvbnRhaW5lckVsOiB0aGlzLl9vcHRpb25zLmVsZW1lbnQsXG4gICAgICAgICAgICBmaWxlQ29udGFpbmVyRWw6IHRoaXMuX29wdGlvbnMubGlzdEVsZW1lbnQsXG4gICAgICAgICAgICBidXR0b246IHRoaXMuX29wdGlvbnMuYnV0dG9uLFxuICAgICAgICAgICAgaW1hZ2VHZW5lcmF0b3I6IHRoaXMuX2ltYWdlR2VuZXJhdG9yLFxuICAgICAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgICAgICAgIGhpZGU6IHRoaXMuX29wdGlvbnMuY2xhc3Nlcy5oaWRlLFxuICAgICAgICAgICAgICAgIGVkaXRhYmxlOiB0aGlzLl9vcHRpb25zLmNsYXNzZXMuZWRpdGFibGVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW1pdHM6IHtcbiAgICAgICAgICAgICAgICBtYXhUaHVtYnM6IHRoaXMuX29wdGlvbnMudGh1bWJuYWlscy5tYXhDb3VudCxcbiAgICAgICAgICAgICAgICB0aW1lQmV0d2VlblRodW1iczogdGhpcy5fb3B0aW9ucy50aHVtYm5haWxzLnRpbWVCZXR3ZWVuVGh1bWJzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGxhY2Vob2xkZXJzOiB7XG4gICAgICAgICAgICAgICAgd2FpdFVudGlsVXBkYXRlOiB0aGlzLl9vcHRpb25zLnRodW1ibmFpbHMucGxhY2Vob2xkZXJzLndhaXRVbnRpbFJlc3BvbnNlLFxuICAgICAgICAgICAgICAgIHRodW1ibmFpbE5vdEF2YWlsYWJsZTogdGhpcy5fb3B0aW9ucy50aHVtYm5haWxzLnBsYWNlaG9sZGVycy5ub3RBdmFpbGFibGVQYXRoLFxuICAgICAgICAgICAgICAgIHdhaXRpbmdGb3JUaHVtYm5haWw6IHRoaXMuX29wdGlvbnMudGh1bWJuYWlscy5wbGFjZWhvbGRlcnMud2FpdGluZ1BhdGhcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLl9vcHRpb25zLnRleHRcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLl9vcHRpb25zLndvcmthcm91bmRzLmlvczhTYWZhcmlVcGxvYWRzICYmIHFxLmlvczgwMCgpICYmIHFxLmlvc1NhZmFyaSgpKSB7XG4gICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnJlbmRlckZhaWx1cmUodGhpcy5fb3B0aW9ucy5tZXNzYWdlcy51bnN1cHBvcnRlZEJyb3dzZXJJb3M4U2FmYXJpKTtcbiAgICAgICAgfSBlbHNlIGlmICghcXEuc3VwcG9ydGVkRmVhdHVyZXMudXBsb2FkaW5nIHx8IHRoaXMuX29wdGlvbnMuY29ycy5leHBlY3RlZCAmJiAhcXEuc3VwcG9ydGVkRmVhdHVyZXMudXBsb2FkQ29ycykge1xuICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5yZW5kZXJGYWlsdXJlKHRoaXMuX29wdGlvbnMubWVzc2FnZXMudW5zdXBwb3J0ZWRCcm93c2VyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3dyYXBDYWxsYmFja3MoKTtcbiAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcucmVuZGVyKCk7XG4gICAgICAgICAgICB0aGlzLl9jbGFzc2VzID0gdGhpcy5fb3B0aW9ucy5jbGFzc2VzO1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9vcHRpb25zLmJ1dHRvbiAmJiB0aGlzLl90ZW1wbGF0aW5nLmdldEJ1dHRvbigpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGVmYXVsdEJ1dHRvbklkID0gdGhpcy5fY3JlYXRlVXBsb2FkQnV0dG9uKHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogdGhpcy5fdGVtcGxhdGluZy5nZXRCdXR0b24oKSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMuX29wdGlvbnMudGV4dC5maWxlSW5wdXRUaXRsZVxuICAgICAgICAgICAgICAgIH0pLmdldEJ1dHRvbklkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9zZXR1cENsaWNrQW5kRWRpdEV2ZW50SGFuZGxlcnMoKTtcbiAgICAgICAgICAgIGlmIChxcS5EcmFnQW5kRHJvcCAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5maWxlRHJvcCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RuZCA9IHRoaXMuX3NldHVwRHJhZ0FuZERyb3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLnBhc3RlLnRhcmdldEVsZW1lbnQgJiYgdGhpcy5fb3B0aW9ucy5wYXN0ZS5wcm9tcHRGb3JOYW1lKSB7XG4gICAgICAgICAgICAgICAgaWYgKHFxLlBhc3RlU3VwcG9ydCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXR1cFBhc3RlUHJvbXB0KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coXCJQYXN0ZSBzdXBwb3J0IG1vZHVsZSBub3QgZm91bmQuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fdG90YWxGaWxlc0luQmF0Y2ggPSAwO1xuICAgICAgICAgICAgdGhpcy5fZmlsZXNJbkJhdGNoQWRkZWRUb1VpID0gMDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcXEuZXh0ZW5kKHFxLkZpbmVVcGxvYWRlci5wcm90b3R5cGUsIHFxLmJhc2VQdWJsaWNBcGkpO1xuICAgIHFxLmV4dGVuZChxcS5GaW5lVXBsb2FkZXIucHJvdG90eXBlLCBxcS5iYXNlUHJpdmF0ZUFwaSk7XG4gICAgcXEuZXh0ZW5kKHFxLkZpbmVVcGxvYWRlci5wcm90b3R5cGUsIHFxLnVpUHVibGljQXBpKTtcbiAgICBxcS5leHRlbmQocXEuRmluZVVwbG9hZGVyLnByb3RvdHlwZSwgcXEudWlQcml2YXRlQXBpKTtcbiAgICBxcS5UZW1wbGF0aW5nID0gZnVuY3Rpb24oc3BlYykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIEZJTEVfSURfQVRUUiA9IFwicXEtZmlsZS1pZFwiLCBGSUxFX0NMQVNTX1BSRUZJWCA9IFwicXEtZmlsZS1pZC1cIiwgVEhVTUJOQUlMX01BWF9TSVpFX0FUVFIgPSBcInFxLW1heC1zaXplXCIsIFRIVU1CTkFJTF9TRVJWRVJfU0NBTEVfQVRUUiA9IFwicXEtc2VydmVyLXNjYWxlXCIsIEhJREVfRFJPUFpPTkVfQVRUUiA9IFwicXEtaGlkZS1kcm9wem9uZVwiLCBEUk9QWlBPTkVfVEVYVF9BVFRSID0gXCJxcS1kcm9wLWFyZWEtdGV4dFwiLCBJTl9QUk9HUkVTU19DTEFTUyA9IFwicXEtaW4tcHJvZ3Jlc3NcIiwgSElEREVOX0ZPUkVWRVJfQ0xBU1MgPSBcInFxLWhpZGRlbi1mb3JldmVyXCIsIGZpbGVCYXRjaCA9IHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxcbiAgICAgICAgICAgIG1hcDoge31cbiAgICAgICAgfSwgaXNDYW5jZWxEaXNhYmxlZCA9IGZhbHNlLCBnZW5lcmF0ZWRUaHVtYm5haWxzID0gMCwgdGh1bWJuYWlsUXVldWVNb25pdG9yUnVubmluZyA9IGZhbHNlLCB0aHVtYkdlbmVyYXRpb25RdWV1ZSA9IFtdLCB0aHVtYm5haWxNYXhTaXplID0gLTEsIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBsb2c6IG51bGwsXG4gICAgICAgICAgICBsaW1pdHM6IHtcbiAgICAgICAgICAgICAgICBtYXhUaHVtYnM6IDAsXG4gICAgICAgICAgICAgICAgdGltZUJldHdlZW5UaHVtYnM6IDc1MFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRlbXBsYXRlSWRPckVsOiBcInFxLXRlbXBsYXRlXCIsXG4gICAgICAgICAgICBjb250YWluZXJFbDogbnVsbCxcbiAgICAgICAgICAgIGZpbGVDb250YWluZXJFbDogbnVsbCxcbiAgICAgICAgICAgIGJ1dHRvbjogbnVsbCxcbiAgICAgICAgICAgIGltYWdlR2VuZXJhdG9yOiBudWxsLFxuICAgICAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgICAgICAgIGhpZGU6IFwicXEtaGlkZVwiLFxuICAgICAgICAgICAgICAgIGVkaXRhYmxlOiBcInFxLWVkaXRhYmxlXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwbGFjZWhvbGRlcnM6IHtcbiAgICAgICAgICAgICAgICB3YWl0VW50aWxVcGRhdGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRodW1ibmFpbE5vdEF2YWlsYWJsZTogbnVsbCxcbiAgICAgICAgICAgICAgICB3YWl0aW5nRm9yVGh1bWJuYWlsOiBudWxsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGV4dDoge1xuICAgICAgICAgICAgICAgIHBhdXNlZDogXCJQYXVzZWRcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBzZWxlY3RvckNsYXNzZXMgPSB7XG4gICAgICAgICAgICBidXR0b246IFwicXEtdXBsb2FkLWJ1dHRvbi1zZWxlY3RvclwiLFxuICAgICAgICAgICAgYWxlcnREaWFsb2c6IFwicXEtYWxlcnQtZGlhbG9nLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBkaWFsb2dDYW5jZWxCdXR0b246IFwicXEtY2FuY2VsLWJ1dHRvbi1zZWxlY3RvclwiLFxuICAgICAgICAgICAgY29uZmlybURpYWxvZzogXCJxcS1jb25maXJtLWRpYWxvZy1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZGlhbG9nTWVzc2FnZTogXCJxcS1kaWFsb2ctbWVzc2FnZS1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZGlhbG9nT2tCdXR0b246IFwicXEtb2stYnV0dG9uLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBwcm9tcHREaWFsb2c6IFwicXEtcHJvbXB0LWRpYWxvZy1zZWxlY3RvclwiLFxuICAgICAgICAgICAgdXBsb2FkZXI6IFwicXEtdXBsb2FkZXItc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGRyb3A6IFwicXEtdXBsb2FkLWRyb3AtYXJlYS1zZWxlY3RvclwiLFxuICAgICAgICAgICAgbGlzdDogXCJxcS11cGxvYWQtbGlzdC1zZWxlY3RvclwiLFxuICAgICAgICAgICAgcHJvZ3Jlc3NCYXJDb250YWluZXI6IFwicXEtcHJvZ3Jlc3MtYmFyLWNvbnRhaW5lci1zZWxlY3RvclwiLFxuICAgICAgICAgICAgcHJvZ3Jlc3NCYXI6IFwicXEtcHJvZ3Jlc3MtYmFyLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICB0b3RhbFByb2dyZXNzQmFyQ29udGFpbmVyOiBcInFxLXRvdGFsLXByb2dyZXNzLWJhci1jb250YWluZXItc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHRvdGFsUHJvZ3Jlc3NCYXI6IFwicXEtdG90YWwtcHJvZ3Jlc3MtYmFyLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBmaWxlOiBcInFxLXVwbG9hZC1maWxlLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBzcGlubmVyOiBcInFxLXVwbG9hZC1zcGlubmVyLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBzaXplOiBcInFxLXVwbG9hZC1zaXplLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBjYW5jZWw6IFwicXEtdXBsb2FkLWNhbmNlbC1zZWxlY3RvclwiLFxuICAgICAgICAgICAgcGF1c2U6IFwicXEtdXBsb2FkLXBhdXNlLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBjb250aW51ZUJ1dHRvbjogXCJxcS11cGxvYWQtY29udGludWUtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGRlbGV0ZUJ1dHRvbjogXCJxcS11cGxvYWQtZGVsZXRlLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICByZXRyeTogXCJxcS11cGxvYWQtcmV0cnktc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHN0YXR1c1RleHQ6IFwicXEtdXBsb2FkLXN0YXR1cy10ZXh0LXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBlZGl0RmlsZW5hbWVJbnB1dDogXCJxcS1lZGl0LWZpbGVuYW1lLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBlZGl0TmFtZUljb246IFwicXEtZWRpdC1maWxlbmFtZS1pY29uLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBkcm9wVGV4dDogXCJxcS11cGxvYWQtZHJvcC1hcmVhLXRleHQtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGRyb3BQcm9jZXNzaW5nOiBcInFxLWRyb3AtcHJvY2Vzc2luZy1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZHJvcFByb2Nlc3NpbmdTcGlubmVyOiBcInFxLWRyb3AtcHJvY2Vzc2luZy1zcGlubmVyLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICB0aHVtYm5haWw6IFwicXEtdGh1bWJuYWlsLXNlbGVjdG9yXCJcbiAgICAgICAgfSwgcHJldmlld0dlbmVyYXRpb24gPSB7fSwgY2FjaGVkVGh1bWJuYWlsTm90QXZhaWxhYmxlSW1nID0gbmV3IHFxLlByb21pc2UoKSwgY2FjaGVkV2FpdGluZ0ZvclRodW1ibmFpbEltZyA9IG5ldyBxcS5Qcm9taXNlKCksIGxvZywgaXNFZGl0RWxlbWVudHNFeGlzdCwgaXNSZXRyeUVsZW1lbnRFeGlzdCwgdGVtcGxhdGVEb20sIGNvbnRhaW5lciwgZmlsZUxpc3QsIHNob3dUaHVtYm5haWxzLCBzZXJ2ZXJTY2FsZSwgY2FjaGVUaHVtYm5haWxQbGFjZWhvbGRlcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBub3RBdmFpbGFibGVVcmwgPSBvcHRpb25zLnBsYWNlaG9sZGVycy50aHVtYm5haWxOb3RBdmFpbGFibGUsIHdhaXRpbmdVcmwgPSBvcHRpb25zLnBsYWNlaG9sZGVycy53YWl0aW5nRm9yVGh1bWJuYWlsLCBzcGVjID0ge1xuICAgICAgICAgICAgICAgIG1heFNpemU6IHRodW1ibmFpbE1heFNpemUsXG4gICAgICAgICAgICAgICAgc2NhbGU6IHNlcnZlclNjYWxlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHNob3dUaHVtYm5haWxzKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vdEF2YWlsYWJsZVVybCkge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmltYWdlR2VuZXJhdG9yLmdlbmVyYXRlKG5vdEF2YWlsYWJsZVVybCwgbmV3IEltYWdlKCksIHNwZWMpLnRoZW4oZnVuY3Rpb24odXBkYXRlZEltZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkVGh1bWJuYWlsTm90QXZhaWxhYmxlSW1nLnN1Y2Nlc3ModXBkYXRlZEltZyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkVGh1bWJuYWlsTm90QXZhaWxhYmxlSW1nLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIlByb2JsZW0gbG9hZGluZyAnbm90IGF2YWlsYWJsZScgcGxhY2Vob2xkZXIgaW1hZ2UgYXQgXCIgKyBub3RBdmFpbGFibGVVcmwsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlZFRodW1ibmFpbE5vdEF2YWlsYWJsZUltZy5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh3YWl0aW5nVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaW1hZ2VHZW5lcmF0b3IuZ2VuZXJhdGUod2FpdGluZ1VybCwgbmV3IEltYWdlKCksIHNwZWMpLnRoZW4oZnVuY3Rpb24odXBkYXRlZEltZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkV2FpdGluZ0ZvclRodW1ibmFpbEltZy5zdWNjZXNzKHVwZGF0ZWRJbWcpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZFdhaXRpbmdGb3JUaHVtYm5haWxJbWcuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiUHJvYmxlbSBsb2FkaW5nICd3YWl0aW5nIGZvciB0aHVtYm5haWwnIHBsYWNlaG9sZGVyIGltYWdlIGF0IFwiICsgd2FpdGluZ1VybCwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVkV2FpdGluZ0ZvclRodW1ibmFpbEltZy5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBkaXNwbGF5V2FpdGluZ0ltZyA9IGZ1bmN0aW9uKHRodW1ibmFpbCkge1xuICAgICAgICAgICAgdmFyIHdhaXRpbmdJbWdQbGFjZW1lbnQgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgY2FjaGVkV2FpdGluZ0ZvclRodW1ibmFpbEltZy50aGVuKGZ1bmN0aW9uKGltZykge1xuICAgICAgICAgICAgICAgIG1heWJlU2NhbGVQbGFjZWhvbGRlclZpYUNzcyhpbWcsIHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aHVtYm5haWwuc3JjKSB7XG4gICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbC5zcmMgPSBpbWcuc3JjO1xuICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwub25sb2FkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3codGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRpbmdJbWdQbGFjZW1lbnQuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHdhaXRpbmdJbWdQbGFjZW1lbnQuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGhpZGUodGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICB3YWl0aW5nSW1nUGxhY2VtZW50LnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhaXRpbmdJbWdQbGFjZW1lbnQ7XG4gICAgICAgIH0sIGdlbmVyYXRlTmV3UHJldmlldyA9IGZ1bmN0aW9uKGlkLCBibG9iLCBzcGVjKSB7XG4gICAgICAgICAgICB2YXIgdGh1bWJuYWlsID0gZ2V0VGh1bWJuYWlsKGlkKTtcbiAgICAgICAgICAgIGxvZyhcIkdlbmVyYXRpbmcgbmV3IHRodW1ibmFpbCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICBibG9iLnFxVGh1bWJuYWlsSWQgPSBpZDtcbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmltYWdlR2VuZXJhdG9yLmdlbmVyYXRlKGJsb2IsIHRodW1ibmFpbCwgc3BlYykudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBnZW5lcmF0ZWRUaHVtYm5haWxzKys7XG4gICAgICAgICAgICAgICAgc2hvdyh0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgIHByZXZpZXdHZW5lcmF0aW9uW2lkXS5zdWNjZXNzKCk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwcmV2aWV3R2VuZXJhdGlvbltpZF0uZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5wbGFjZWhvbGRlcnMud2FpdFVudGlsVXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIG1heWJlU2V0RGlzcGxheU5vdEF2YWlsYWJsZUltZyhpZCwgdGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRodW1iR2VuZXJhdGlvblF1ZXVlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRodW1ibmFpbFF1ZXVlTW9uaXRvclJ1bm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHZhciBxdWV1ZWRUaHVtYlJlcXVlc3QgPSB0aHVtYkdlbmVyYXRpb25RdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGlmIChxdWV1ZWRUaHVtYlJlcXVlc3QudXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NVcGRhdGVRdWV1ZWRQcmV2aWV3UmVxdWVzdChxdWV1ZWRUaHVtYlJlcXVlc3QpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NOZXdRdWV1ZWRQcmV2aWV3UmVxdWVzdChxdWV1ZWRUaHVtYlJlcXVlc3QpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsUXVldWVNb25pdG9yUnVubmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBnZXRDYW5jZWwgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5jYW5jZWwpO1xuICAgICAgICB9LCBnZXRDb250aW51ZSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLmNvbnRpbnVlQnV0dG9uKTtcbiAgICAgICAgfSwgZ2V0RGlhbG9nID0gZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoY29udGFpbmVyLCBzZWxlY3RvckNsYXNzZXNbdHlwZSArIFwiRGlhbG9nXCJdKTtcbiAgICAgICAgfSwgZ2V0RGVsZXRlID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMuZGVsZXRlQnV0dG9uKTtcbiAgICAgICAgfSwgZ2V0RHJvcFByb2Nlc3NpbmcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGNvbnRhaW5lciwgc2VsZWN0b3JDbGFzc2VzLmRyb3BQcm9jZXNzaW5nKTtcbiAgICAgICAgfSwgZ2V0RWRpdEljb24gPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5lZGl0TmFtZUljb24pO1xuICAgICAgICB9LCBnZXRGaWxlID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmaWxlQmF0Y2gubWFwW2lkXSB8fCBxcShmaWxlTGlzdCkuZ2V0Rmlyc3RCeUNsYXNzKEZJTEVfQ0xBU1NfUFJFRklYICsgaWQpO1xuICAgICAgICB9LCBnZXRGaWxlbmFtZSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLmZpbGUpO1xuICAgICAgICB9LCBnZXRQYXVzZSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLnBhdXNlKTtcbiAgICAgICAgfSwgZ2V0UHJvZ3Jlc3MgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgaWYgKGlkID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChjb250YWluZXIsIHNlbGVjdG9yQ2xhc3Nlcy50b3RhbFByb2dyZXNzQmFyQ29udGFpbmVyKSB8fCBnZXRUZW1wbGF0ZUVsKGNvbnRhaW5lciwgc2VsZWN0b3JDbGFzc2VzLnRvdGFsUHJvZ3Jlc3NCYXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5wcm9ncmVzc0JhckNvbnRhaW5lcikgfHwgZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLnByb2dyZXNzQmFyKTtcbiAgICAgICAgfSwgZ2V0UmV0cnkgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5yZXRyeSk7XG4gICAgICAgIH0sIGdldFNpemUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5zaXplKTtcbiAgICAgICAgfSwgZ2V0U3Bpbm5lciA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLnNwaW5uZXIpO1xuICAgICAgICB9LCBnZXRUZW1wbGF0ZUVsID0gZnVuY3Rpb24oY29udGV4dCwgY3NzQ2xhc3MpIHtcbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0ICYmIHFxKGNvbnRleHQpLmdldEZpcnN0QnlDbGFzcyhjc3NDbGFzcyk7XG4gICAgICAgIH0sIGdldFRodW1ibmFpbCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gc2hvd1RodW1ibmFpbHMgJiYgZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLnRodW1ibmFpbCk7XG4gICAgICAgIH0sIGhpZGUgPSBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgZWwgJiYgcXEoZWwpLmFkZENsYXNzKG9wdGlvbnMuY2xhc3Nlcy5oaWRlKTtcbiAgICAgICAgfSwgbWF5YmVTY2FsZVBsYWNlaG9sZGVyVmlhQ3NzID0gZnVuY3Rpb24ocGxhY2Vob2xkZXIsIHRodW1ibmFpbCkge1xuICAgICAgICAgICAgdmFyIG1heFdpZHRoID0gcGxhY2Vob2xkZXIuc3R5bGUubWF4V2lkdGgsIG1heEhlaWdodCA9IHBsYWNlaG9sZGVyLnN0eWxlLm1heEhlaWdodDtcbiAgICAgICAgICAgIGlmIChtYXhIZWlnaHQgJiYgbWF4V2lkdGggJiYgIXRodW1ibmFpbC5zdHlsZS5tYXhXaWR0aCAmJiAhdGh1bWJuYWlsLnN0eWxlLm1heEhlaWdodCkge1xuICAgICAgICAgICAgICAgIHFxKHRodW1ibmFpbCkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IG1heFdpZHRoLFxuICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IG1heEhlaWdodFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBtYXliZVNldERpc3BsYXlOb3RBdmFpbGFibGVJbWcgPSBmdW5jdGlvbihpZCwgdGh1bWJuYWlsKSB7XG4gICAgICAgICAgICB2YXIgcHJldmlld2luZyA9IHByZXZpZXdHZW5lcmF0aW9uW2lkXSB8fCBuZXcgcXEuUHJvbWlzZSgpLmZhaWx1cmUoKSwgbm90QXZhaWxhYmxlSW1nUGxhY2VtZW50ID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIGNhY2hlZFRodW1ibmFpbE5vdEF2YWlsYWJsZUltZy50aGVuKGZ1bmN0aW9uKGltZykge1xuICAgICAgICAgICAgICAgIHByZXZpZXdpbmcudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgbm90QXZhaWxhYmxlSW1nUGxhY2VtZW50LnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF5YmVTY2FsZVBsYWNlaG9sZGVyVmlhQ3NzKGltZywgdGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsLm9ubG9hZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBub3RBdmFpbGFibGVJbWdQbGFjZW1lbnQuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwuc3JjID0gaW1nLnNyYztcbiAgICAgICAgICAgICAgICAgICAgc2hvdyh0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbm90QXZhaWxhYmxlSW1nUGxhY2VtZW50O1xuICAgICAgICB9LCBwYXJzZUFuZEdldFRlbXBsYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgc2NyaXB0RWwsIHNjcmlwdEh0bWwsIGZpbGVMaXN0Tm9kZSwgdGVtcFRlbXBsYXRlRWwsIGZpbGVMaXN0RWwsIGRlZmF1bHRCdXR0b24sIGRyb3BBcmVhLCB0aHVtYm5haWwsIGRyb3BQcm9jZXNzaW5nLCBkcm9wVGV4dEVsLCB1cGxvYWRlckVsO1xuICAgICAgICAgICAgbG9nKFwiUGFyc2luZyB0ZW1wbGF0ZVwiKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnRlbXBsYXRlSWRPckVsID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3UgTVVTVCBzcGVjaWZ5IGVpdGhlciBhIHRlbXBsYXRlIGVsZW1lbnQgb3IgSUQhXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHFxLmlzU3RyaW5nKG9wdGlvbnMudGVtcGxhdGVJZE9yRWwpKSB7XG4gICAgICAgICAgICAgICAgc2NyaXB0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLnRlbXBsYXRlSWRPckVsKTtcbiAgICAgICAgICAgICAgICBpZiAoc2NyaXB0RWwgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHFxLmZvcm1hdChcIkNhbm5vdCBmaW5kIHRlbXBsYXRlIHNjcmlwdCBhdCBJRCAne30nIVwiLCBvcHRpb25zLnRlbXBsYXRlSWRPckVsKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNjcmlwdEh0bWwgPSBzY3JpcHRFbC5pbm5lckhUTUw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnRlbXBsYXRlSWRPckVsLmlubmVySFRNTCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIllvdSBoYXZlIHNwZWNpZmllZCBhbiBpbnZhbGlkIHZhbHVlIGZvciB0aGUgdGVtcGxhdGUgb3B0aW9uISAgXCIgKyBcIkl0IG11c3QgYmUgYW4gSUQgb3IgYW4gRWxlbWVudC5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNjcmlwdEh0bWwgPSBvcHRpb25zLnRlbXBsYXRlSWRPckVsLmlubmVySFRNTDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNjcmlwdEh0bWwgPSBxcS50cmltU3RyKHNjcmlwdEh0bWwpO1xuICAgICAgICAgICAgdGVtcFRlbXBsYXRlRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgdGVtcFRlbXBsYXRlRWwuYXBwZW5kQ2hpbGQocXEudG9FbGVtZW50KHNjcmlwdEh0bWwpKTtcbiAgICAgICAgICAgIHVwbG9hZGVyRWwgPSBxcSh0ZW1wVGVtcGxhdGVFbCkuZ2V0Rmlyc3RCeUNsYXNzKHNlbGVjdG9yQ2xhc3Nlcy51cGxvYWRlcik7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5idXR0b24pIHtcbiAgICAgICAgICAgICAgICBkZWZhdWx0QnV0dG9uID0gcXEodGVtcFRlbXBsYXRlRWwpLmdldEZpcnN0QnlDbGFzcyhzZWxlY3RvckNsYXNzZXMuYnV0dG9uKTtcbiAgICAgICAgICAgICAgICBpZiAoZGVmYXVsdEJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICBxcShkZWZhdWx0QnV0dG9uKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXFxLkRyYWdBbmREcm9wIHx8ICFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5maWxlRHJvcCkge1xuICAgICAgICAgICAgICAgIGRyb3BQcm9jZXNzaW5nID0gcXEodGVtcFRlbXBsYXRlRWwpLmdldEZpcnN0QnlDbGFzcyhzZWxlY3RvckNsYXNzZXMuZHJvcFByb2Nlc3NpbmcpO1xuICAgICAgICAgICAgICAgIGlmIChkcm9wUHJvY2Vzc2luZykge1xuICAgICAgICAgICAgICAgICAgICBxcShkcm9wUHJvY2Vzc2luZykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZHJvcEFyZWEgPSBxcSh0ZW1wVGVtcGxhdGVFbCkuZ2V0Rmlyc3RCeUNsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5kcm9wKTtcbiAgICAgICAgICAgIGlmIChkcm9wQXJlYSAmJiAhcXEuRHJhZ0FuZERyb3ApIHtcbiAgICAgICAgICAgICAgICBsb2coXCJEbkQgbW9kdWxlIHVuYXZhaWxhYmxlLlwiLCBcImluZm9cIik7XG4gICAgICAgICAgICAgICAgcXEoZHJvcEFyZWEpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5maWxlRHJvcCkge1xuICAgICAgICAgICAgICAgIHVwbG9hZGVyRWwucmVtb3ZlQXR0cmlidXRlKERST1BaUE9ORV9URVhUX0FUVFIpO1xuICAgICAgICAgICAgICAgIGlmIChkcm9wQXJlYSAmJiBxcShkcm9wQXJlYSkuaGFzQXR0cmlidXRlKEhJREVfRFJPUFpPTkVfQVRUUikpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoZHJvcEFyZWEpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBcIm5vbmVcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHFxKHVwbG9hZGVyRWwpLmhhc0F0dHJpYnV0ZShEUk9QWlBPTkVfVEVYVF9BVFRSKSAmJiBkcm9wQXJlYSkge1xuICAgICAgICAgICAgICAgIGRyb3BUZXh0RWwgPSBxcShkcm9wQXJlYSkuZ2V0Rmlyc3RCeUNsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5kcm9wVGV4dCk7XG4gICAgICAgICAgICAgICAgZHJvcFRleHRFbCAmJiBxcShkcm9wVGV4dEVsKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRodW1ibmFpbCA9IHFxKHRlbXBUZW1wbGF0ZUVsKS5nZXRGaXJzdEJ5Q2xhc3Moc2VsZWN0b3JDbGFzc2VzLnRodW1ibmFpbCk7XG4gICAgICAgICAgICBpZiAoIXNob3dUaHVtYm5haWxzKSB7XG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsICYmIHFxKHRodW1ibmFpbCkucmVtb3ZlKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRodW1ibmFpbCkge1xuICAgICAgICAgICAgICAgIHRodW1ibmFpbE1heFNpemUgPSBwYXJzZUludCh0aHVtYm5haWwuZ2V0QXR0cmlidXRlKFRIVU1CTkFJTF9NQVhfU0laRV9BVFRSKSk7XG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsTWF4U2l6ZSA9IHRodW1ibmFpbE1heFNpemUgPiAwID8gdGh1bWJuYWlsTWF4U2l6ZSA6IG51bGw7XG4gICAgICAgICAgICAgICAgc2VydmVyU2NhbGUgPSBxcSh0aHVtYm5haWwpLmhhc0F0dHJpYnV0ZShUSFVNQk5BSUxfU0VSVkVSX1NDQUxFX0FUVFIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2hvd1RodW1ibmFpbHMgPSBzaG93VGh1bWJuYWlscyAmJiB0aHVtYm5haWw7XG4gICAgICAgICAgICBpc0VkaXRFbGVtZW50c0V4aXN0ID0gcXEodGVtcFRlbXBsYXRlRWwpLmdldEJ5Q2xhc3Moc2VsZWN0b3JDbGFzc2VzLmVkaXRGaWxlbmFtZUlucHV0KS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgaXNSZXRyeUVsZW1lbnRFeGlzdCA9IHFxKHRlbXBUZW1wbGF0ZUVsKS5nZXRCeUNsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5yZXRyeSkubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIGZpbGVMaXN0Tm9kZSA9IHFxKHRlbXBUZW1wbGF0ZUVsKS5nZXRGaXJzdEJ5Q2xhc3Moc2VsZWN0b3JDbGFzc2VzLmxpc3QpO1xuICAgICAgICAgICAgaWYgKGZpbGVMaXN0Tm9kZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgdGhlIGZpbGUgbGlzdCBjb250YWluZXIgaW4gdGhlIHRlbXBsYXRlIVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbGVMaXN0RWwgPSBmaWxlTGlzdE5vZGUuY2hpbGRyZW5bMF0uY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAgICAgZmlsZUxpc3ROb2RlLmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgICAgICBpZiAodGVtcFRlbXBsYXRlRWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJESUFMT0dcIikubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpYWxvZ1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxvZyhcIlRlbXBsYXRlIHBhcnNpbmcgY29tcGxldGVcIik7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiB0ZW1wVGVtcGxhdGVFbCxcbiAgICAgICAgICAgICAgICBmaWxlVGVtcGxhdGU6IGZpbGVMaXN0RWxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sIHByZXBlbmRGaWxlID0gZnVuY3Rpb24oZWwsIGluZGV4LCBmaWxlTGlzdCkge1xuICAgICAgICAgICAgdmFyIHBhcmVudEVsID0gZmlsZUxpc3QsIGJlZm9yZUVsID0gcGFyZW50RWwuZmlyc3RDaGlsZDtcbiAgICAgICAgICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgICAgICAgICAgICBiZWZvcmVFbCA9IHFxKHBhcmVudEVsKS5jaGlsZHJlbigpW2luZGV4XS5uZXh0U2libGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhcmVudEVsLmluc2VydEJlZm9yZShlbCwgYmVmb3JlRWwpO1xuICAgICAgICB9LCBwcm9jZXNzTmV3UXVldWVkUHJldmlld1JlcXVlc3QgPSBmdW5jdGlvbihxdWV1ZWRUaHVtYlJlcXVlc3QpIHtcbiAgICAgICAgICAgIHZhciBpZCA9IHF1ZXVlZFRodW1iUmVxdWVzdC5pZCwgb3B0RmlsZU9yQmxvYiA9IHF1ZXVlZFRodW1iUmVxdWVzdC5vcHRGaWxlT3JCbG9iLCByZWxhdGVkVGh1bWJuYWlsSWQgPSBvcHRGaWxlT3JCbG9iICYmIG9wdEZpbGVPckJsb2IucXFUaHVtYm5haWxJZCwgdGh1bWJuYWlsID0gZ2V0VGh1bWJuYWlsKGlkKSwgc3BlYyA9IHtcbiAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVGdW5jdGlvbjogcXVldWVkVGh1bWJSZXF1ZXN0LmN1c3RvbVJlc2l6ZUZ1bmN0aW9uLFxuICAgICAgICAgICAgICAgIG1heFNpemU6IHRodW1ibmFpbE1heFNpemUsXG4gICAgICAgICAgICAgICAgb3JpZW50OiB0cnVlLFxuICAgICAgICAgICAgICAgIHNjYWxlOiB0cnVlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHFxLnN1cHBvcnRlZEZlYXR1cmVzLmltYWdlUHJldmlld3MpIHtcbiAgICAgICAgICAgICAgICBpZiAodGh1bWJuYWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmxpbWl0cy5tYXhUaHVtYnMgJiYgb3B0aW9ucy5saW1pdHMubWF4VGh1bWJzIDw9IGdlbmVyYXRlZFRodW1ibmFpbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heWJlU2V0RGlzcGxheU5vdEF2YWlsYWJsZUltZyhpZCwgdGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlXYWl0aW5nSW1nKHRodW1ibmFpbCkuZG9uZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2aWV3R2VuZXJhdGlvbltpZF0gPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpZXdHZW5lcmF0aW9uW2lkXS5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcsIG9wdGlvbnMubGltaXRzLnRpbWVCZXR3ZWVuVGh1bWJzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVsYXRlZFRodW1ibmFpbElkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlQ2FjaGVkUHJldmlldyhpZCwgcmVsYXRlZFRodW1ibmFpbElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZU5ld1ByZXZpZXcoaWQsIG9wdEZpbGVPckJsb2IsIHNwZWMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGh1bWJuYWlsKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheVdhaXRpbmdJbWcodGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICBnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHByb2Nlc3NVcGRhdGVRdWV1ZWRQcmV2aWV3UmVxdWVzdCA9IGZ1bmN0aW9uKHF1ZXVlZFRodW1iUmVxdWVzdCkge1xuICAgICAgICAgICAgdmFyIGlkID0gcXVldWVkVGh1bWJSZXF1ZXN0LmlkLCB0aHVtYm5haWxVcmwgPSBxdWV1ZWRUaHVtYlJlcXVlc3QudGh1bWJuYWlsVXJsLCBzaG93V2FpdGluZ0ltZyA9IHF1ZXVlZFRodW1iUmVxdWVzdC5zaG93V2FpdGluZ0ltZywgdGh1bWJuYWlsID0gZ2V0VGh1bWJuYWlsKGlkKSwgc3BlYyA9IHtcbiAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVGdW5jdGlvbjogcXVldWVkVGh1bWJSZXF1ZXN0LmN1c3RvbVJlc2l6ZUZ1bmN0aW9uLFxuICAgICAgICAgICAgICAgIHNjYWxlOiBzZXJ2ZXJTY2FsZSxcbiAgICAgICAgICAgICAgICBtYXhTaXplOiB0aHVtYm5haWxNYXhTaXplXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHRodW1ibmFpbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aHVtYm5haWxVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubGltaXRzLm1heFRodW1icyAmJiBvcHRpb25zLmxpbWl0cy5tYXhUaHVtYnMgPD0gZ2VuZXJhdGVkVGh1bWJuYWlscykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF5YmVTZXREaXNwbGF5Tm90QXZhaWxhYmxlSW1nKGlkLCB0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldygpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dXYWl0aW5nSW1nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVdhaXRpbmdJbWcodGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmltYWdlR2VuZXJhdG9yLmdlbmVyYXRlKHRodW1ibmFpbFVybCwgdGh1bWJuYWlsLCBzcGVjKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3codGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWRUaHVtYm5haWxzKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3LCBvcHRpb25zLmxpbWl0cy50aW1lQmV0d2VlblRodW1icyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXliZVNldERpc3BsYXlOb3RBdmFpbGFibGVJbWcoaWQsIHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3LCBvcHRpb25zLmxpbWl0cy50aW1lQmV0d2VlblRodW1icyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1heWJlU2V0RGlzcGxheU5vdEF2YWlsYWJsZUltZyhpZCwgdGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgc2V0UHJvZ3Jlc3NCYXJXaWR0aCA9IGZ1bmN0aW9uKGlkLCBwZXJjZW50KSB7XG4gICAgICAgICAgICB2YXIgYmFyID0gZ2V0UHJvZ3Jlc3MoaWQpLCBwcm9ncmVzc0JhclNlbGVjdG9yID0gaWQgPT0gbnVsbCA/IHNlbGVjdG9yQ2xhc3Nlcy50b3RhbFByb2dyZXNzQmFyIDogc2VsZWN0b3JDbGFzc2VzLnByb2dyZXNzQmFyO1xuICAgICAgICAgICAgaWYgKGJhciAmJiAhcXEoYmFyKS5oYXNDbGFzcyhwcm9ncmVzc0JhclNlbGVjdG9yKSkge1xuICAgICAgICAgICAgICAgIGJhciA9IHFxKGJhcikuZ2V0Rmlyc3RCeUNsYXNzKHByb2dyZXNzQmFyU2VsZWN0b3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJhcikge1xuICAgICAgICAgICAgICAgIHFxKGJhcikuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHBlcmNlbnQgKyBcIiVcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJhci5zZXRBdHRyaWJ1dGUoXCJhcmlhLXZhbHVlbm93XCIsIHBlcmNlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBzaG93ID0gZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgIGVsICYmIHFxKGVsKS5yZW1vdmVDbGFzcyhvcHRpb25zLmNsYXNzZXMuaGlkZSk7XG4gICAgICAgIH0sIHVzZUNhY2hlZFByZXZpZXcgPSBmdW5jdGlvbih0YXJnZXRUaHVtYm5haWxJZCwgY2FjaGVkVGh1bWJuYWlsSWQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXRUaHVtYm5haWwgPSBnZXRUaHVtYm5haWwodGFyZ2V0VGh1bWJuYWlsSWQpLCBjYWNoZWRUaHVtYm5haWwgPSBnZXRUaHVtYm5haWwoY2FjaGVkVGh1bWJuYWlsSWQpO1xuICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIklEIHt9IGlzIHRoZSBzYW1lIGZpbGUgYXMgSUQge30uICBXaWxsIHVzZSBnZW5lcmF0ZWQgdGh1bWJuYWlsIGZyb20gSUQge30gaW5zdGVhZC5cIiwgdGFyZ2V0VGh1bWJuYWlsSWQsIGNhY2hlZFRodW1ibmFpbElkLCBjYWNoZWRUaHVtYm5haWxJZCkpO1xuICAgICAgICAgICAgcHJldmlld0dlbmVyYXRpb25bY2FjaGVkVGh1bWJuYWlsSWRdLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZ2VuZXJhdGVkVGh1bWJuYWlscysrO1xuICAgICAgICAgICAgICAgIHByZXZpZXdHZW5lcmF0aW9uW3RhcmdldFRodW1ibmFpbElkXS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIk5vdyB1c2luZyBwcmV2aW91c2x5IGdlbmVyYXRlZCB0aHVtYm5haWwgY3JlYXRlZCBmb3IgSUQge30gb24gSUQge30uXCIsIGNhY2hlZFRodW1ibmFpbElkLCB0YXJnZXRUaHVtYm5haWxJZCkpO1xuICAgICAgICAgICAgICAgIHRhcmdldFRodW1ibmFpbC5zcmMgPSBjYWNoZWRUaHVtYm5haWwuc3JjO1xuICAgICAgICAgICAgICAgIHNob3codGFyZ2V0VGh1bWJuYWlsKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHByZXZpZXdHZW5lcmF0aW9uW3RhcmdldFRodW1ibmFpbElkXS5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLnBsYWNlaG9sZGVycy53YWl0VW50aWxVcGRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF5YmVTZXREaXNwbGF5Tm90QXZhaWxhYmxlSW1nKHRhcmdldFRodW1ibmFpbElkLCB0YXJnZXRUaHVtYm5haWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgc3BlYyk7XG4gICAgICAgIGxvZyA9IG9wdGlvbnMubG9nO1xuICAgICAgICBpZiAoIXFxLnN1cHBvcnRlZEZlYXR1cmVzLmltYWdlUHJldmlld3MpIHtcbiAgICAgICAgICAgIG9wdGlvbnMubGltaXRzLnRpbWVCZXR3ZWVuVGh1bWJzID0gMDtcbiAgICAgICAgICAgIG9wdGlvbnMubGltaXRzLm1heFRodW1icyA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgY29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXJFbDtcbiAgICAgICAgc2hvd1RodW1ibmFpbHMgPSBvcHRpb25zLmltYWdlR2VuZXJhdG9yICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIHRlbXBsYXRlRG9tID0gcGFyc2VBbmRHZXRUZW1wbGF0ZSgpO1xuICAgICAgICBjYWNoZVRodW1ibmFpbFBsYWNlaG9sZGVycygpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJSZW5kZXJpbmcgdGVtcGxhdGUgaW4gRE9NLlwiKTtcbiAgICAgICAgICAgICAgICBnZW5lcmF0ZWRUaHVtYm5haWxzID0gMDtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGVtcGxhdGVEb20udGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpKTtcbiAgICAgICAgICAgICAgICBoaWRlKGdldERyb3BQcm9jZXNzaW5nKCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZVRvdGFsUHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgICAgICBmaWxlTGlzdCA9IG9wdGlvbnMuZmlsZUNvbnRhaW5lckVsIHx8IGdldFRlbXBsYXRlRWwoY29udGFpbmVyLCBzZWxlY3RvckNsYXNzZXMubGlzdCk7XG4gICAgICAgICAgICAgICAgbG9nKFwiVGVtcGxhdGUgcmVuZGVyaW5nIGNvbXBsZXRlXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbmRlckZhaWx1cmU6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2FudFJlbmRlckVsID0gcXEudG9FbGVtZW50KG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjYW50UmVuZGVyRWwpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsZWFyRmlsZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGZpbGVMaXN0LmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzYWJsZUNhbmNlbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaXNDYW5jZWxEaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWRkRmlsZTogZnVuY3Rpb24oaWQsIG5hbWUsIHByZXBlbmRJbmZvLCBoaWRlRm9yZXZlciwgYmF0Y2gpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZUVsID0gdGVtcGxhdGVEb20uZmlsZVRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKSwgZmlsZU5hbWVFbCA9IGdldFRlbXBsYXRlRWwoZmlsZUVsLCBzZWxlY3RvckNsYXNzZXMuZmlsZSksIHVwbG9hZGVyRWwgPSBnZXRUZW1wbGF0ZUVsKGNvbnRhaW5lciwgc2VsZWN0b3JDbGFzc2VzLnVwbG9hZGVyKSwgZmlsZUNvbnRhaW5lciA9IGJhdGNoID8gZmlsZUJhdGNoLmNvbnRlbnQgOiBmaWxlTGlzdCwgdGh1bWI7XG4gICAgICAgICAgICAgICAgaWYgKGJhdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVCYXRjaC5tYXBbaWRdID0gZmlsZUVsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxcShmaWxlRWwpLmFkZENsYXNzKEZJTEVfQ0xBU1NfUFJFRklYICsgaWQpO1xuICAgICAgICAgICAgICAgIHVwbG9hZGVyRWwucmVtb3ZlQXR0cmlidXRlKERST1BaUE9ORV9URVhUX0FUVFIpO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlTmFtZUVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGZpbGVOYW1lRWwpLnNldFRleHQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lRWwuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgbmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbGVFbC5zZXRBdHRyaWJ1dGUoRklMRV9JRF9BVFRSLCBpZCk7XG4gICAgICAgICAgICAgICAgaWYgKHByZXBlbmRJbmZvKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZXBlbmRGaWxlKGZpbGVFbCwgcHJlcGVuZEluZm8uaW5kZXgsIGZpbGVDb250YWluZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVDb250YWluZXIuYXBwZW5kQ2hpbGQoZmlsZUVsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGhpZGVGb3JldmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVFbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgICAgIHFxKGZpbGVFbCkuYWRkQ2xhc3MoSElEREVOX0ZPUkVWRVJfQ0xBU1MpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhpZGUoZ2V0UHJvZ3Jlc3MoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgaGlkZShnZXRTaXplKGlkKSk7XG4gICAgICAgICAgICAgICAgICAgIGhpZGUoZ2V0RGVsZXRlKGlkKSk7XG4gICAgICAgICAgICAgICAgICAgIGhpZGUoZ2V0UmV0cnkoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgaGlkZShnZXRQYXVzZShpZCkpO1xuICAgICAgICAgICAgICAgICAgICBoaWRlKGdldENvbnRpbnVlKGlkKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0NhbmNlbERpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGVDYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRodW1iID0gZ2V0VGh1bWJuYWlsKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRodW1iICYmICF0aHVtYi5zcmMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZFdhaXRpbmdGb3JUaHVtYm5haWxJbWcudGhlbihmdW5jdGlvbih3YWl0aW5nSW1nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIuc3JjID0gd2FpdGluZ0ltZy5zcmM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdhaXRpbmdJbWcuc3R5bGUubWF4SGVpZ2h0ICYmIHdhaXRpbmdJbWcuc3R5bGUubWF4V2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXEodGh1bWIpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IHdhaXRpbmdJbWcuc3R5bGUubWF4SGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IHdhaXRpbmdJbWcuc3R5bGUubWF4V2lkdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3codGh1bWIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWRkRmlsZVRvQ2FjaGU6IGZ1bmN0aW9uKGlkLCBuYW1lLCBwcmVwZW5kSW5mbywgaGlkZUZvcmV2ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEZpbGUoaWQsIG5hbWUsIHByZXBlbmRJbmZvLCBoaWRlRm9yZXZlciwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWRkQ2FjaGVUb0RvbTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZmlsZUxpc3QuYXBwZW5kQ2hpbGQoZmlsZUJhdGNoLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIGZpbGVCYXRjaC5jb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICAgICAgICAgIGZpbGVCYXRjaC5tYXAgPSB7fTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW1vdmVGaWxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHFxKGdldEZpbGUoaWQpKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGaWxlSWQ6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnROb2RlID0gZWw7XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChjdXJyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoRklMRV9JRF9BVFRSKSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGN1cnJlbnROb2RlLnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGN1cnJlbnROb2RlLmdldEF0dHJpYnV0ZShGSUxFX0lEX0FUVFIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RmlsZUxpc3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlTGlzdDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXJrRmlsZW5hbWVFZGl0YWJsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSBnZXRGaWxlbmFtZShpZCk7XG4gICAgICAgICAgICAgICAgZmlsZW5hbWUgJiYgcXEoZmlsZW5hbWUpLmFkZENsYXNzKG9wdGlvbnMuY2xhc3Nlcy5lZGl0YWJsZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlRmlsZW5hbWU6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVuYW1lRWwgPSBnZXRGaWxlbmFtZShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVuYW1lRWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoZmlsZW5hbWVFbCkuc2V0VGV4dChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWVFbC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBuYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZUZpbGVuYW1lOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0RmlsZW5hbWUoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93RmlsZW5hbWU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc2hvdyhnZXRGaWxlbmFtZShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzRmlsZU5hbWU6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsKS5oYXNDbGFzcyhzZWxlY3RvckNsYXNzZXMuZmlsZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0QnV0dG9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5idXR0b24gfHwgZ2V0VGVtcGxhdGVFbChjb250YWluZXIsIHNlbGVjdG9yQ2xhc3Nlcy5idXR0b24pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVEcm9wUHJvY2Vzc2luZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaGlkZShnZXREcm9wUHJvY2Vzc2luZygpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93RHJvcFByb2Nlc3Npbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNob3coZ2V0RHJvcFByb2Nlc3NpbmcoKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RHJvcFpvbmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGNvbnRhaW5lciwgc2VsZWN0b3JDbGFzc2VzLmRyb3ApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzRWRpdEZpbGVuYW1lUG9zc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpc0VkaXRFbGVtZW50c0V4aXN0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVSZXRyeTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBoaWRlKGdldFJldHJ5KGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNSZXRyeVBvc3NpYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXNSZXRyeUVsZW1lbnRFeGlzdDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93UmV0cnk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc2hvdyhnZXRSZXRyeShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZpbGVDb250YWluZXI6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldEZpbGUoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dFZGl0SWNvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IGdldEVkaXRJY29uKGlkKTtcbiAgICAgICAgICAgICAgICBpY29uICYmIHFxKGljb24pLmFkZENsYXNzKG9wdGlvbnMuY2xhc3Nlcy5lZGl0YWJsZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNIaWRkZW5Gb3JldmVyOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShnZXRGaWxlKGlkKSkuaGFzQ2xhc3MoSElEREVOX0ZPUkVWRVJfQ0xBU1MpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVFZGl0SWNvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IGdldEVkaXRJY29uKGlkKTtcbiAgICAgICAgICAgICAgICBpY29uICYmIHFxKGljb24pLnJlbW92ZUNsYXNzKG9wdGlvbnMuY2xhc3Nlcy5lZGl0YWJsZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNFZGl0SWNvbjogZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWwpLmhhc0NsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5lZGl0TmFtZUljb24sIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEVkaXRJbnB1dDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLmVkaXRGaWxlbmFtZUlucHV0KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0VkaXRJbnB1dDogZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWwpLmhhc0NsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5lZGl0RmlsZW5hbWVJbnB1dCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkLCBsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJhciA9IGdldFByb2dyZXNzKGlkKSwgcGVyY2VudDtcbiAgICAgICAgICAgICAgICBpZiAoYmFyICYmIHRvdGFsID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBwZXJjZW50ID0gTWF0aC5yb3VuZChsb2FkZWQgLyB0b3RhbCAqIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwZXJjZW50ID09PSAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGUoYmFyKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3coYmFyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZXRQcm9ncmVzc0JhcldpZHRoKGlkLCBwZXJjZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlVG90YWxQcm9ncmVzczogZnVuY3Rpb24obG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3MobnVsbCwgbG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZVByb2dyZXNzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBiYXIgPSBnZXRQcm9ncmVzcyhpZCk7XG4gICAgICAgICAgICAgICAgYmFyICYmIGhpZGUoYmFyKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlVG90YWxQcm9ncmVzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlUHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldFByb2dyZXNzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNldFByb2dyZXNzQmFyV2lkdGgoaWQsIDApO1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZVRvdGFsUHJvZ3Jlc3MoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0VG90YWxQcm9ncmVzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldFByb2dyZXNzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd0NhbmNlbDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzQ2FuY2VsRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhbmNlbCA9IGdldENhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbCAmJiBxcShjYW5jZWwpLnJlbW92ZUNsYXNzKG9wdGlvbnMuY2xhc3Nlcy5oaWRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZUNhbmNlbDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBoaWRlKGdldENhbmNlbChpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzQ2FuY2VsOiBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbCkuaGFzQ2xhc3Moc2VsZWN0b3JDbGFzc2VzLmNhbmNlbCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWxsb3dQYXVzZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzaG93KGdldFBhdXNlKGlkKSk7XG4gICAgICAgICAgICAgICAgaGlkZShnZXRDb250aW51ZShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwbG9hZFBhdXNlZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1c1RleHQoaWQsIG9wdGlvbnMudGV4dC5wYXVzZWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWxsb3dDb250aW51ZUJ1dHRvbihpZCk7XG4gICAgICAgICAgICAgICAgaGlkZShnZXRTcGlubmVyKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZVBhdXNlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0UGF1c2UoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1BhdXNlOiBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbCkuaGFzQ2xhc3Moc2VsZWN0b3JDbGFzc2VzLnBhdXNlLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0NvbnRpbnVlQnV0dG9uOiBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbCkuaGFzQ2xhc3Moc2VsZWN0b3JDbGFzc2VzLmNvbnRpbnVlQnV0dG9uLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhbGxvd0NvbnRpbnVlQnV0dG9uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNob3coZ2V0Q29udGludWUoaWQpKTtcbiAgICAgICAgICAgICAgICBoaWRlKGdldFBhdXNlKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBsb2FkQ29udGludWVkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdHVzVGV4dChpZCwgXCJcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGxvd1BhdXNlKGlkKTtcbiAgICAgICAgICAgICAgICBzaG93KGdldFNwaW5uZXIoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93RGVsZXRlQnV0dG9uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNob3coZ2V0RGVsZXRlKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZURlbGV0ZUJ1dHRvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBoaWRlKGdldERlbGV0ZShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzRGVsZXRlQnV0dG9uOiBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbCkuaGFzQ2xhc3Moc2VsZWN0b3JDbGFzc2VzLmRlbGV0ZUJ1dHRvbiwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNSZXRyeTogZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWwpLmhhc0NsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5yZXRyeSwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlU2l6ZTogZnVuY3Rpb24oaWQsIHRleHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGdldFNpemUoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChzaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHNob3coc2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIHFxKHNpemUpLnNldFRleHQodGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFN0YXR1c1RleHQ6IGZ1bmN0aW9uKGlkLCB0ZXh0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHRleHRFbCA9IGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgICAgICBpZiAodGV4dEVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxKHRleHRFbCkuY2xlYXJUZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcSh0ZXh0RWwpLnNldFRleHQodGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZVNwaW5uZXI6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcXEoZ2V0RmlsZShpZCkpLnJlbW92ZUNsYXNzKElOX1BST0dSRVNTX0NMQVNTKTtcbiAgICAgICAgICAgICAgICBoaWRlKGdldFNwaW5uZXIoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93U3Bpbm5lcjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBxcShnZXRGaWxlKGlkKSkuYWRkQ2xhc3MoSU5fUFJPR1JFU1NfQ0xBU1MpO1xuICAgICAgICAgICAgICAgIHNob3coZ2V0U3Bpbm5lcihpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdlbmVyYXRlUHJldmlldzogZnVuY3Rpb24oaWQsIG9wdEZpbGVPckJsb2IsIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzSGlkZGVuRm9yZXZlcihpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGh1bWJHZW5lcmF0aW9uUXVldWUucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVGdW5jdGlvbjogY3VzdG9tUmVzaXplRnVuY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRGaWxlT3JCbG9iOiBvcHRGaWxlT3JCbG9iXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAhdGh1bWJuYWlsUXVldWVNb25pdG9yUnVubmluZyAmJiBnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZVRodW1ibmFpbDogZnVuY3Rpb24oaWQsIHRodW1ibmFpbFVybCwgc2hvd1dhaXRpbmdJbWcsIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzSGlkZGVuRm9yZXZlcihpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGh1bWJHZW5lcmF0aW9uUXVldWUucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVGdW5jdGlvbjogY3VzdG9tUmVzaXplRnVuY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWxVcmw6IHRodW1ibmFpbFVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dXYWl0aW5nSW1nOiBzaG93V2FpdGluZ0ltZ1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgIXRodW1ibmFpbFF1ZXVlTW9uaXRvclJ1bm5pbmcgJiYgZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXNEaWFsb2c6IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEuc3VwcG9ydGVkRmVhdHVyZXMuZGlhbG9nRWxlbWVudCAmJiAhIWdldERpYWxvZyh0eXBlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93RGlhbG9nOiBmdW5jdGlvbih0eXBlLCBtZXNzYWdlLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGlhbG9nID0gZ2V0RGlhbG9nKHR5cGUpLCBtZXNzYWdlRWwgPSBnZXRUZW1wbGF0ZUVsKGRpYWxvZywgc2VsZWN0b3JDbGFzc2VzLmRpYWxvZ01lc3NhZ2UpLCBpbnB1dEVsID0gZGlhbG9nLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiSU5QVVRcIilbMF0sIGNhbmNlbEJ0biA9IGdldFRlbXBsYXRlRWwoZGlhbG9nLCBzZWxlY3RvckNsYXNzZXMuZGlhbG9nQ2FuY2VsQnV0dG9uKSwgb2tCdG4gPSBnZXRUZW1wbGF0ZUVsKGRpYWxvZywgc2VsZWN0b3JDbGFzc2VzLmRpYWxvZ09rQnV0dG9uKSwgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCksIGNsb3NlSGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNhbmNlbENsaWNrSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgICAgIG9rQnRuICYmIG9rQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBva0NsaWNrSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH0sIGNhbmNlbENsaWNrSGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNhbmNlbENsaWNrSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH0sIG9rQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZy5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xvc2VcIiwgY2xvc2VIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICAgICAgb2tCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG9rQ2xpY2tIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhpbnB1dEVsICYmIGlucHV0RWwudmFsdWUpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZGlhbG9nLmFkZEV2ZW50TGlzdGVuZXIoXCJjbG9zZVwiLCBjbG9zZUhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIGNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2FuY2VsQ2xpY2tIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBva0J0biAmJiBva0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgb2tDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgIGlmIChpbnB1dEVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0RWwudmFsdWUgPSBkZWZhdWx0VmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1lc3NhZ2VFbC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLlVpRXZlbnRIYW5kbGVyID0gZnVuY3Rpb24ocywgcHJvdGVjdGVkQXBpKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgZGlzcG9zZXIgPSBuZXcgcXEuRGlzcG9zZVN1cHBvcnQoKSwgc3BlYyA9IHtcbiAgICAgICAgICAgIGV2ZW50VHlwZTogXCJjbGlja1wiLFxuICAgICAgICAgICAgYXR0YWNoVG86IG51bGwsXG4gICAgICAgICAgICBvbkhhbmRsZWQ6IGZ1bmN0aW9uKHRhcmdldCwgZXZlbnQpIHt9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBhZGRIYW5kbGVyOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgYWRkSGFuZGxlcihlbGVtZW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaXNwb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBkaXNwb3Nlci5kaXNwb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBmdW5jdGlvbiBhZGRIYW5kbGVyKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGRpc3Bvc2VyLmF0dGFjaChlbGVtZW50LCBzcGVjLmV2ZW50VHlwZSwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudCA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudDtcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQ7XG4gICAgICAgICAgICAgICAgc3BlYy5vbkhhbmRsZWQodGFyZ2V0LCBldmVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQocHJvdGVjdGVkQXBpLCB7XG4gICAgICAgICAgICBnZXRGaWxlSWRGcm9tSXRlbTogZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnFxRmlsZUlkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERpc3Bvc2VTdXBwb3J0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGlzcG9zZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBxcS5leHRlbmQoc3BlYywgcyk7XG4gICAgICAgIGlmIChzcGVjLmF0dGFjaFRvKSB7XG4gICAgICAgICAgICBhZGRIYW5kbGVyKHNwZWMuYXR0YWNoVG8pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBxcS5GaWxlQnV0dG9uc0NsaWNrSGFuZGxlciA9IGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBpbmhlcml0ZWRJbnRlcm5hbEFwaSA9IHt9LCBzcGVjID0ge1xuICAgICAgICAgICAgdGVtcGxhdGluZzogbnVsbCxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSwgbHZsKSB7fSxcbiAgICAgICAgICAgIG9uRGVsZXRlRmlsZTogZnVuY3Rpb24oZmlsZUlkKSB7fSxcbiAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbihmaWxlSWQpIHt9LFxuICAgICAgICAgICAgb25SZXRyeTogZnVuY3Rpb24oZmlsZUlkKSB7fSxcbiAgICAgICAgICAgIG9uUGF1c2U6IGZ1bmN0aW9uKGZpbGVJZCkge30sXG4gICAgICAgICAgICBvbkNvbnRpbnVlOiBmdW5jdGlvbihmaWxlSWQpIHt9LFxuICAgICAgICAgICAgb25HZXROYW1lOiBmdW5jdGlvbihmaWxlSWQpIHt9XG4gICAgICAgIH0sIGJ1dHRvbkhhbmRsZXJzID0ge1xuICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNwZWMub25DYW5jZWwoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHJ5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNwZWMub25SZXRyeShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVsZXRlQnV0dG9uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNwZWMub25EZWxldGVGaWxlKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXVzZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzcGVjLm9uUGF1c2UoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRpbnVlQnV0dG9uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNwZWMub25Db250aW51ZShpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGZ1bmN0aW9uIGV4YW1pbmVFdmVudCh0YXJnZXQsIGV2ZW50KSB7XG4gICAgICAgICAgICBxcS5lYWNoKGJ1dHRvbkhhbmRsZXJzLCBmdW5jdGlvbihidXR0b25UeXBlLCBoYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpcnN0TGV0dGVyQ2FwQnV0dG9uVHlwZSA9IGJ1dHRvblR5cGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBidXR0b25UeXBlLnNsaWNlKDEpLCBmaWxlSWQ7XG4gICAgICAgICAgICAgICAgaWYgKHNwZWMudGVtcGxhdGluZ1tcImlzXCIgKyBmaXJzdExldHRlckNhcEJ1dHRvblR5cGVdKHRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUlkID0gc3BlYy50ZW1wbGF0aW5nLmdldEZpbGVJZCh0YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICBxcS5wcmV2ZW50RGVmYXVsdChldmVudCk7XG4gICAgICAgICAgICAgICAgICAgIHNwZWMubG9nKHFxLmZvcm1hdChcIkRldGVjdGVkIHZhbGlkIGZpbGUgYnV0dG9uIGNsaWNrIGV2ZW50IG9uIGZpbGUgJ3t9JywgSUQ6IHt9LlwiLCBzcGVjLm9uR2V0TmFtZShmaWxlSWQpLCBmaWxlSWQpKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcihmaWxlSWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKHNwZWMsIHMpO1xuICAgICAgICBzcGVjLmV2ZW50VHlwZSA9IFwiY2xpY2tcIjtcbiAgICAgICAgc3BlYy5vbkhhbmRsZWQgPSBleGFtaW5lRXZlbnQ7XG4gICAgICAgIHNwZWMuYXR0YWNoVG8gPSBzcGVjLnRlbXBsYXRpbmcuZ2V0RmlsZUxpc3QoKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5VaUV2ZW50SGFuZGxlcihzcGVjLCBpbmhlcml0ZWRJbnRlcm5hbEFwaSkpO1xuICAgIH07XG4gICAgcXEuRmlsZW5hbWVDbGlja0hhbmRsZXIgPSBmdW5jdGlvbihzKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgaW5oZXJpdGVkSW50ZXJuYWxBcGkgPSB7fSwgc3BlYyA9IHtcbiAgICAgICAgICAgIHRlbXBsYXRpbmc6IG51bGwsXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGx2bCkge30sXG4gICAgICAgICAgICBjbGFzc2VzOiB7XG4gICAgICAgICAgICAgICAgZmlsZTogXCJxcS11cGxvYWQtZmlsZVwiLFxuICAgICAgICAgICAgICAgIGVkaXROYW1lSWNvbjogXCJxcS1lZGl0LWZpbGVuYW1lLWljb25cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uR2V0VXBsb2FkU3RhdHVzOiBmdW5jdGlvbihmaWxlSWQpIHt9LFxuICAgICAgICAgICAgb25HZXROYW1lOiBmdW5jdGlvbihmaWxlSWQpIHt9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZChzcGVjLCBzKTtcbiAgICAgICAgZnVuY3Rpb24gZXhhbWluZUV2ZW50KHRhcmdldCwgZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChzcGVjLnRlbXBsYXRpbmcuaXNGaWxlTmFtZSh0YXJnZXQpIHx8IHNwZWMudGVtcGxhdGluZy5pc0VkaXRJY29uKHRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZUlkID0gc3BlYy50ZW1wbGF0aW5nLmdldEZpbGVJZCh0YXJnZXQpLCBzdGF0dXMgPSBzcGVjLm9uR2V0VXBsb2FkU3RhdHVzKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gcXEuc3RhdHVzLlNVQk1JVFRFRCkge1xuICAgICAgICAgICAgICAgICAgICBzcGVjLmxvZyhxcS5mb3JtYXQoXCJEZXRlY3RlZCB2YWxpZCBmaWxlbmFtZSBjbGljayBldmVudCBvbiBmaWxlICd7fScsIElEOiB7fS5cIiwgc3BlYy5vbkdldE5hbWUoZmlsZUlkKSwgZmlsZUlkKSk7XG4gICAgICAgICAgICAgICAgICAgIHFxLnByZXZlbnREZWZhdWx0KGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgaW5oZXJpdGVkSW50ZXJuYWxBcGkuaGFuZGxlRmlsZW5hbWVFZGl0KGZpbGVJZCwgdGFyZ2V0LCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3BlYy5ldmVudFR5cGUgPSBcImNsaWNrXCI7XG4gICAgICAgIHNwZWMub25IYW5kbGVkID0gZXhhbWluZUV2ZW50O1xuICAgICAgICBxcS5leHRlbmQodGhpcywgbmV3IHFxLkZpbGVuYW1lRWRpdEhhbmRsZXIoc3BlYywgaW5oZXJpdGVkSW50ZXJuYWxBcGkpKTtcbiAgICB9O1xuICAgIHFxLkZpbGVuYW1lSW5wdXRGb2N1c0luSGFuZGxlciA9IGZ1bmN0aW9uKHMsIGluaGVyaXRlZEludGVybmFsQXBpKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgc3BlYyA9IHtcbiAgICAgICAgICAgIHRlbXBsYXRpbmc6IG51bGwsXG4gICAgICAgICAgICBvbkdldFVwbG9hZFN0YXR1czogZnVuY3Rpb24oZmlsZUlkKSB7fSxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSwgbHZsKSB7fVxuICAgICAgICB9O1xuICAgICAgICBpZiAoIWluaGVyaXRlZEludGVybmFsQXBpKSB7XG4gICAgICAgICAgICBpbmhlcml0ZWRJbnRlcm5hbEFwaSA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZUlucHV0Rm9jdXModGFyZ2V0LCBldmVudCkge1xuICAgICAgICAgICAgaWYgKHNwZWMudGVtcGxhdGluZy5pc0VkaXRJbnB1dCh0YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVJZCA9IHNwZWMudGVtcGxhdGluZy5nZXRGaWxlSWQodGFyZ2V0KSwgc3RhdHVzID0gc3BlYy5vbkdldFVwbG9hZFN0YXR1cyhmaWxlSWQpO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IHFxLnN0YXR1cy5TVUJNSVRURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3BlYy5sb2cocXEuZm9ybWF0KFwiRGV0ZWN0ZWQgdmFsaWQgZmlsZW5hbWUgaW5wdXQgZm9jdXMgZXZlbnQgb24gZmlsZSAne30nLCBJRDoge30uXCIsIHNwZWMub25HZXROYW1lKGZpbGVJZCksIGZpbGVJZCkpO1xuICAgICAgICAgICAgICAgICAgICBpbmhlcml0ZWRJbnRlcm5hbEFwaS5oYW5kbGVGaWxlbmFtZUVkaXQoZmlsZUlkLCB0YXJnZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzcGVjLmV2ZW50VHlwZSA9IFwiZm9jdXNpblwiO1xuICAgICAgICBzcGVjLm9uSGFuZGxlZCA9IGhhbmRsZUlucHV0Rm9jdXM7XG4gICAgICAgIHFxLmV4dGVuZChzcGVjLCBzKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5GaWxlbmFtZUVkaXRIYW5kbGVyKHNwZWMsIGluaGVyaXRlZEludGVybmFsQXBpKSk7XG4gICAgfTtcbiAgICBxcS5GaWxlbmFtZUlucHV0Rm9jdXNIYW5kbGVyID0gZnVuY3Rpb24oc3BlYykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgc3BlYy5ldmVudFR5cGUgPSBcImZvY3VzXCI7XG4gICAgICAgIHNwZWMuYXR0YWNoVG8gPSBudWxsO1xuICAgICAgICBxcS5leHRlbmQodGhpcywgbmV3IHFxLkZpbGVuYW1lSW5wdXRGb2N1c0luSGFuZGxlcihzcGVjLCB7fSkpO1xuICAgIH07XG4gICAgcXEuRmlsZW5hbWVFZGl0SGFuZGxlciA9IGZ1bmN0aW9uKHMsIGluaGVyaXRlZEludGVybmFsQXBpKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgc3BlYyA9IHtcbiAgICAgICAgICAgIHRlbXBsYXRpbmc6IG51bGwsXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGx2bCkge30sXG4gICAgICAgICAgICBvbkdldFVwbG9hZFN0YXR1czogZnVuY3Rpb24oZmlsZUlkKSB7fSxcbiAgICAgICAgICAgIG9uR2V0TmFtZTogZnVuY3Rpb24oZmlsZUlkKSB7fSxcbiAgICAgICAgICAgIG9uU2V0TmFtZTogZnVuY3Rpb24oZmlsZUlkLCBuZXdOYW1lKSB7fSxcbiAgICAgICAgICAgIG9uRWRpdGluZ1N0YXR1c0NoYW5nZTogZnVuY3Rpb24oZmlsZUlkLCBpc0VkaXRpbmcpIHt9XG4gICAgICAgIH07XG4gICAgICAgIGZ1bmN0aW9uIGdldEZpbGVuYW1lU2Fuc0V4dGVuc2lvbihmaWxlSWQpIHtcbiAgICAgICAgICAgIHZhciBmaWxlbmFtZVNhbnNFeHQgPSBzcGVjLm9uR2V0TmFtZShmaWxlSWQpLCBleHRJZHggPSBmaWxlbmFtZVNhbnNFeHQubGFzdEluZGV4T2YoXCIuXCIpO1xuICAgICAgICAgICAgaWYgKGV4dElkeCA+IDApIHtcbiAgICAgICAgICAgICAgICBmaWxlbmFtZVNhbnNFeHQgPSBmaWxlbmFtZVNhbnNFeHQuc3Vic3RyKDAsIGV4dElkeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmlsZW5hbWVTYW5zRXh0O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldE9yaWdpbmFsRXh0ZW5zaW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgdmFyIG9yaWdOYW1lID0gc3BlYy5vbkdldE5hbWUoZmlsZUlkKTtcbiAgICAgICAgICAgIHJldHVybiBxcS5nZXRFeHRlbnNpb24ob3JpZ05hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZU5hbWVVcGRhdGUobmV3RmlsZW5hbWVJbnB1dEVsLCBmaWxlSWQpIHtcbiAgICAgICAgICAgIHZhciBuZXdOYW1lID0gbmV3RmlsZW5hbWVJbnB1dEVsLnZhbHVlLCBvcmlnRXh0ZW5zaW9uO1xuICAgICAgICAgICAgaWYgKG5ld05hbWUgIT09IHVuZGVmaW5lZCAmJiBxcS50cmltU3RyKG5ld05hbWUpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBvcmlnRXh0ZW5zaW9uID0gZ2V0T3JpZ2luYWxFeHRlbnNpb24oZmlsZUlkKTtcbiAgICAgICAgICAgICAgICBpZiAob3JpZ0V4dGVuc2lvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld05hbWUgPSBuZXdOYW1lICsgXCIuXCIgKyBvcmlnRXh0ZW5zaW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzcGVjLm9uU2V0TmFtZShmaWxlSWQsIG5ld05hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3BlYy5vbkVkaXRpbmdTdGF0dXNDaGFuZ2UoZmlsZUlkLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJJbnB1dEJsdXJIYW5kbGVyKGlucHV0RWwsIGZpbGVJZCkge1xuICAgICAgICAgICAgaW5oZXJpdGVkSW50ZXJuYWxBcGkuZ2V0RGlzcG9zZVN1cHBvcnQoKS5hdHRhY2goaW5wdXRFbCwgXCJibHVyXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGhhbmRsZU5hbWVVcGRhdGUoaW5wdXRFbCwgZmlsZUlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVySW5wdXRFbnRlcktleUhhbmRsZXIoaW5wdXRFbCwgZmlsZUlkKSB7XG4gICAgICAgICAgICBpbmhlcml0ZWRJbnRlcm5hbEFwaS5nZXREaXNwb3NlU3VwcG9ydCgpLmF0dGFjaChpbnB1dEVsLCBcImtleXVwXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvZGUgPSBldmVudC5rZXlDb2RlIHx8IGV2ZW50LndoaWNoO1xuICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSAxMykge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVOYW1lVXBkYXRlKGlucHV0RWwsIGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKHNwZWMsIHMpO1xuICAgICAgICBzcGVjLmF0dGFjaFRvID0gc3BlYy50ZW1wbGF0aW5nLmdldEZpbGVMaXN0KCk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuVWlFdmVudEhhbmRsZXIoc3BlYywgaW5oZXJpdGVkSW50ZXJuYWxBcGkpKTtcbiAgICAgICAgcXEuZXh0ZW5kKGluaGVyaXRlZEludGVybmFsQXBpLCB7XG4gICAgICAgICAgICBoYW5kbGVGaWxlbmFtZUVkaXQ6IGZ1bmN0aW9uKGlkLCB0YXJnZXQsIGZvY3VzSW5wdXQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3RmlsZW5hbWVJbnB1dEVsID0gc3BlYy50ZW1wbGF0aW5nLmdldEVkaXRJbnB1dChpZCk7XG4gICAgICAgICAgICAgICAgc3BlYy5vbkVkaXRpbmdTdGF0dXNDaGFuZ2UoaWQsIHRydWUpO1xuICAgICAgICAgICAgICAgIG5ld0ZpbGVuYW1lSW5wdXRFbC52YWx1ZSA9IGdldEZpbGVuYW1lU2Fuc0V4dGVuc2lvbihpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGZvY3VzSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RmlsZW5hbWVJbnB1dEVsLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlZ2lzdGVySW5wdXRCbHVySGFuZGxlcihuZXdGaWxlbmFtZUlucHV0RWwsIGlkKTtcbiAgICAgICAgICAgICAgICByZWdpc3RlcklucHV0RW50ZXJLZXlIYW5kbGVyKG5ld0ZpbGVuYW1lSW5wdXRFbCwgaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufSkod2luZG93KTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZpbmUtdXBsb2FkZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcIi4uL2ZpbmUtdXBsb2FkZXIvZmluZS11cGxvYWRlclwiKTtcbiIsImltcG9ydCBxcSBmcm9tICdmaW5lLXVwbG9hZGVyJztcblxucmVxdWlyZSgnZmluZS11cGxvYWRlci9maW5lLXVwbG9hZGVyL2ZpbmUtdXBsb2FkZXItZ2FsbGVyeS5jc3MnKTtcbnJlcXVpcmUoJ0Bmb3J0YXdlc29tZS9mb250YXdlc29tZS1mcmVlJyk7XG5cbnFxLnVpUHJpdmF0ZUFwaS5faXNFZGl0RmlsZW5hbWVFbmFibGVkID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy5fdGVtcGxhdGluZy5pc0VkaXRGaWxlbmFtZVBvc3NpYmxlKCkgJiYgcXEuRmlsZW5hbWVDbGlja0hhbmRsZXIgJiYgcXEuRmlsZW5hbWVJbnB1dEZvY3VzSGFuZGxlciAmJiBxcS5GaWxlbmFtZUlucHV0Rm9jdXNIYW5kbGVyO1xufTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XG4gICAgbGV0IGZpbmVVcGxvYWRlcnMgPSBbXTtcblxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2RpdltmaW5lLXVwbG9hZGVyPVwidHJ1ZVwiXScpLmZvckVhY2goKGVsZW1lbnQsIGluZGV4KSA9PiB7XG5cbiAgICAgICAgZmluZVVwbG9hZGVyc1tpbmRleF0gPSBuZXcgcXEuRmluZVVwbG9hZGVyKHtcbiAgICAgICAgICAgICAgICAvLyBkZWJ1ZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IGVsZW1lbnQuZGF0YXNldC5yZXF1ZXN0RW5kcG9pbnQsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc0luQm9keTogZmFsc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnZG9uam9obi1tZWRpYScsXG4gICAgICAgICAgICAgICAgY2h1bmtpbmc6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcGFydFNpemU6IHBhcnNlSW50KGVsZW1lbnQuZGF0YXNldC5jaHVua2luZ1BhcnRzaXplLCAxMClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJldHJ5OiB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUF1dG86IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRlbGV0ZUZpbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IGVsZW1lbnQuZGF0YXNldC5kZWxldGVfZmlsZUVuZHBvaW50XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgb25TdWJtaXREZWxldGU6IGZ1bmN0aW9uKGlkKSAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXREZWxldGVGaWxlUGFyYW1zKHtmaWxlbmFtZTogdGhpcy5nZXROYW1lKGlkKX0sIGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsczoge1xuICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdEF2YWlsYWJsZVBhdGg6IGVsZW1lbnQuZGF0YXNldC50aHVtYm5haWxzUGxhY2Vob2xkZXJzTm90QXZhaWxhYmxlcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRpbmdQYXRoOiBlbGVtZW50LmRhdGFzZXQudGh1bWJuYWlsc1BsYWNlaG9sZGVyc1dhaXRpbmdwYXRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2FpdFVudGlsUmVzcG9uc2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbXVsdGlwbGU6IGVsZW1lbnQuZGF0YXNldC5tdWx0aXBsZSxcbiAgICAgICAgICAgICAgICBzZXNzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBlbGVtZW50LmRhdGFzZXQuc2Vzc2lvbkVuZHBvaW50XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0sIHRydWUpO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==